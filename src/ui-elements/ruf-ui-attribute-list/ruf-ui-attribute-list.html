<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../ruf-ui-attribute/ruf-ui-attribute.html">
<link rel="import" href="../ruf-data-getentity/ruf-data-getentity.html">

<!--
`ruf-ui-attribute-list`
attribute-list control for riversand ui framework

@demo demo/index.html 
-->

<dom-module id="ruf-ui-attribute-list">
  <template>
    <style include="shared-styles"></style>
    <template is="dom-repeat" items="[[_getAttributeModels(attributeModelResponse)]]">
      <ruf-ui-attribute mode="{{mode}}" 
         attribute-model-object="[[item]]" attribute-object="{{_getAttribute(item, attributeResponse)}}"></ruf-ui-attribute>
    </template>
    <ruf-data-getentity name="attributeGetService" request="{{attributeRequest}}" response="{{attributeResponse}}"></ruf-data-getentity>
    <ruf-data-getentity name="attributeModelGetService" request="{{attributeModelRequest}}" response="{{attributeModelResponse}}"></ruf-data-getentity>
  </template>

  <script>
    (function() {
      'use strict';
      console.log('outside polymer of list');
      
      Polymer({
        is: 'ruf-ui-attribute-list',
        created: function() {
          console.log('list created');
          //debugger;
        },
        attached: function() {
          console.log('list attached');
        },
        ready: function() {
          console.log('list ready');
          //debugger;
        },
        properties: {
          mode: {
            type: String,
            value: "view"
          },
          attributeRequest: {
            type: Object,
            value: function(){
              return { action: "getAttributes" };
            }
          },
          attributeResponse: {
            type: Object,
            value: function(){
              return {};
            }
          },
          attributeModelRequest: {
            type: Object,
            value: function(){
              return { action: "getAttributeModels" };
            }
          },
          attributeModelResponse: {
            type: Object,
            value: function(){
              return {};
            }
          }
        },
        _getAttribute: function(attributeModel, attributeResponse) {
          if(attributeResponse && attributeResponse.returnValue 
              && attributeResponse.returnValue.attributes && (attributeModel.name in attributeResponse.returnValue.attributes)){
            return attributeResponse.returnValue.attributes[attributeModel.name];
          }
        },
        _getAttributeModels: function(attributeModelResponse) {
          if(attributeModelResponse && attributeModelResponse.returnValue && attributeModelResponse.returnValue.attributeModels){
            return attributeModelResponse.returnValue.attributeModels;
          }
        }
      });
    })();
  </script>

</dom-module>