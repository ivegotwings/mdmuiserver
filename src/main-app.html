<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="elements/pebble-icons/pebble-icons.html">
<link rel="import" href="elements/pebble-styles-shared/pebble-styles-shared.html">
<link rel="import" href="elements/pebble-styles-app/pebble-styles-app.html">
<link rel="import" href="elements/rock-elements/rock-elements.html">
<link rel="import" href="../bower_components/app-layout/app-drawer-layout/app-drawer-layout.html">
<link rel="import" href="../bower_components/app-layout/app-drawer/app-drawer.html">
<link rel="import" href="../bower_components/app-layout/app-scroll-effects/app-scroll-effects.html">
<link rel="import" href="../bower_components/app-layout/app-header/app-header.html">
<link rel="import" href="../bower_components/app-layout/app-header-layout/app-header-layout.html">
<link rel="import" href="../bower_components/app-layout/app-toolbar/app-toolbar.html">
<link rel="import" href="../bower_components/app-route/app-route.html">
<link rel="import" href="../bower_components/app-route/app-location.html">
<link rel="import" href="../bower_components/iron-ajax/iron-ajax.html">
<link rel="import" href="../bower_components/paper-icon-button/paper-icon-button.html">
<link rel="import" href="../bower_components/paper-progress/paper-progress.html">
<!--
`main-app`
Main os app for riversand ui framework

@demo demo/index.html 
-->
<dom-module id="main-app">
	<template>
		<style is="custom-style" include="app-theme">
			app-header {
				color: #fff;
			}
			
			paper-progress {
				width: 100%;
			}
			
			app-header paper-icon-button {
				--paper-icon-button-ink-color: #fff;
			}
			
			app-drawer-layout {
				--app-drawer-layout-content-transition: margin 0.2s;
			}
			
			app-drawer {
				--app-drawer-content-container: {
					background-color: #eee;
				}
			}
			
			.drawer-content {
				margin-top: 65px;
				height: calc(100% - 65px);
				background-color: #036BC3;
				color: white !important;
				overflow: auto;
			}
			
			.drawer-content::-webkit-scrollbar-track {
				-webkit-box-shadow: inset 0 0 6px rgba(0, 0, 0, 0.3);
				background-color: #A9A9AA;
			}
			
			.drawer-content::-webkit-scrollbar {
				width: 4px;
				background-color: #A9A9AA;
			}
			
			.drawer-content::-webkit-scrollbar-thumb {
				background-color: #A9A9AA;
				border: 1px solid #A9A9AA;
			}
			
			app-toolbar {
				color: black;
				background-color: white;
			}
			
			app-toolbar a {
				text-decoration: none;
			}

			
		</style>
		<style is="custom-style" include="shared-styles"></style>
		<style>
			:host {
				--app-primary-color: #4285f4;
				--app-secondary-color: black;
				display: block;
			}
			
			#logoLink {
				float: left;
				margin-right: 10px;
				display: block;
				margin-top: 18px;
				margin-left: 10px;
			}
			
			#logoName {
				display: block;
				margin-top: 10px;
				margin-left: 10px;
				font-size: xx-large;
			}
			
			drawer-list {
				margin: 0 20px;
			}
			
			.drawer-list a {
				display: block;
				padding: 0 16px;
				text-decoration: none;
				color: var(--app-secondary-color);
				line-height: 40px;
			}
			
			.drawer-list a.iron-selected {
				color: black;
				font-weight: bold;
			}
			#middle-container {
				height: 95%;
				padding: 6px;
			}
		</style>
		<app-location route="{{route}}"></app-location>
		<app-route route="{{route}}" pattern="/:page" data="{{routeData}}" tail="{{subroute}}"></app-route>
		<app-header-layout fullbleed>
			<app-header fixed effects="waterfall">
				<app-toolbar>
					<paper-icon-button id="toggle" on-tap="toggleDrawer" icon="pebble-icons:menu"></paper-icon-button>
					<div align="left" main-title>
						<a id="logoLink" data-route="rs-app-userdashboard" href="/" on-click="onDataRouteClick">
							<img width="15" height="30" src="images/logo.svg"></img>
						</a>
						<a id="logoName" data-route="Dashboard" href="/" on-click="onDataRouteClick">MDMCenter</a>
					</div>
					<span class="flex"></span>
					<rock-search></rock-search>
					<paper-icon-button icon="pebble-icons:refresh" class="refresh-icon" on-click="onRefreshClick"></paper-icon-button>
					<paper-icon-button icon="pebble-icons:notifications"></paper-icon-button>
				</app-toolbar>
				<paper-progress id="appProgress" class="middle fit" value="0" min="0" max="1000"></paper-progress>
			</app-header>
			<app-header-layout has-scrolling-region>
				<app-drawer-layout id="drawerLayout" fullbleed>
					<app-drawer has-scrolling-region>
						<div class="drawer-content">
							<iron-ajax auto url="data/menuitems.json" handle-as="json" last-response="{{menuItems}}"></iron-ajax>
							<rock-navmenu id="navMenu" page="{{page}}" menu-items="{{menuItems}}" route="{{routeData}}" on-menu-click="onMenuClick"></rock-navmenu>
						</div>
					</app-drawer>
					<div id="middle-container">
						<rock-content-view-manager id="contentViewManager"></rock-content-view-manager>
					</div>
					<!--<rock-app-pages page="{{page}}" page-items="{{menuItems}}"></rock-app-pages>-->
					<rock-footer></rock-footer>
				</app-drawer-layout>
			</app-header-layout>
		</app-header-layout>
	</template>
	<script>
    Polymer({

      is: 'main-app',
	attached: function(){
		var progress, repeat, maxRepeat = 1, animating = false;

		function nextProgress() {
			animating = true;
			if (progress.value < progress.max) {
				progress.value += 5;
			} 
			else {
				if (++repeat >= maxRepeat) {
					animating = false;
					progress.value = 0;
					return;
				}
				progress.value = progress.min;
			}
			requestAnimationFrame(nextProgress);
		}

		function startProgress() {
			repeat = 0;
			progress.value = progress.min;
			if (!animating) {
				nextProgress();
			}
		}
		progress = this.$.appProgress;
		startProgress();
	},
	  properties:{
         cols: '2',
		 page: {
           type: String,
           reflectToAttribute: true
		 }
	  },
      observers: [
        '_routePageChanged(routeData.page)'
      ],
      _routePageChanged: function(page) {
        this.page = page || 'Dashboard';
        this.toggleDrawer();
      },

	  // Toggle Drawer
      toggleDrawer: function() {
         var drawerLayout = this.$.drawerLayout;
         if (drawerLayout.forceNarrow || !drawerLayout.narrow) {
			/*var contentContainer = drawerLayout.shadowRoot.querySelector('#contentContainer');
			if(contentContainer.style.width=="62px"){
				contentContainer.style.width = "256px";
			}
			else{
				contentContainer.style.width = "62px";
			}*/
            drawerLayout.forceNarrow = !drawerLayout.forceNarrow;
         } else {
            drawerLayout.drawer.toggle();
         }
      },

      //_pageChanged: function(page) {
      //  // Load page import on demand. Show 404 page if fails
      //  var resolvedPageUrl = this.resolveUrl('rock-' + page + '.html');
      //  this.importHref(resolvedPageUrl, null, this._showPage404, true);
      //},
      //_showPage404: function() {
      //  this.page = 'view404';
      //},

	  onDataRouteClick: function() {
          // Close drawer after menu item is selected if drawerPanel is narrow
          var drawerPanel = this.$.paperDrawerPanel;
         
            //drawerPanel.closeDrawer();
		  
	  },

      // Scroll page to top and expand header
      scrollPageToTop: function() {
         document.getElementById('mainContainer').scrollTop = 0;
	  },

	  onMenuClick: function(e, customArgs) {
		  debugger;
		  //alert(customArgs.currentTarget.href);
		  this.$.contentViewManager.openView(customArgs.item.name, customArgs.item);
	  },

	onRefreshClick: function(){
		location.reload();
	},
   });
   
  </script>
</dom-module>