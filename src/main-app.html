<link rel="import" href="../bower_components/polymer/polymer.html">

<link rel="import" href="styles/app-theme.html">
<link rel="import" href="styles/shared-styles.html">
<link rel="import" href="styles/pebble-icons.html">

<link rel="import" href="elements/rock-elements/rock-elements.html">

<link rel="import" href="../bower_components/app-route/app-route.html">
<link rel="import" href="../bower_components/app-route/app-location.html">
<link rel="import" href="../bower_components/app-layout/app-scroll-effects/app-scroll-effects.html">
<link rel="import" href="../bower_components/app-layout/app-toolbar/app-toolbar.html">
<link rel="import" href="../bower_components/iron-ajax/iron-ajax.html">
<link rel="import" href="../bower_components/paper-scroll-header-panel/paper-scroll-header-panel.html">
<link rel="import" href="../bower_components/paper-toolbar/paper-toolbar.html">
<link rel="import" href="../bower_components/paper-icon-button/paper-icon-button.html">
<link rel="import" href="../bower_components/paper-progress/paper-progress.html">
<link rel="import" href="../bower_components/paper-drawer-panel/paper-drawer-panel.html">

<!--
`main-app`
Main os app for riversand ui framework

@demo demo/index.html 
-->

<dom-module id="main-app">
	<template>
		<style is="custom-style" include="app-theme">
			paper-toolbar {
				width: 100%;
				color: black;
				background-color: white;
			}
			
			paper-toolbar a {
				text-decoration: none;
			}
			
			paper-drawer-panel.collapsed-menu {
				width: 62px;
				-webkit-transform: translateX(0);
				transform: translateX(0);
			}
		</style>
		<style is="custom-style" include="shared-styles"></style>
		<style>
			:host {
				--app-primary-color: #4285f4;
				--app-secondary-color: black;
				display: block;
			}
			
			app-toolbar {
				background-color: white;
				padding: 0px;
			}
			
			app-header {
				color: black;
				background-color: white;
			}
			
			app-header paper-icon-button {
				--paper-icon-button-ink-color: white;
			}
			
			paper-drawer-panel {
				margin-top: 64px;
			}
			
			.drawer-list {
				margin: 0 20px;
			}
			
			.drawer-list a {
				display: block;
				padding: 0 16px;
				text-decoration: none;
				color: var(--app-secondary-color);
				line-height: 40px;
			}
			
			.drawer-list a.iron-selected {
				color: black;
				font-weight: bold;
			}
			
			#logoLink {
				float: left;
				margin-right: 10px;
				display: block;
			}
			
			#logoLink img {
				margin-left: 20px;
			}
		</style>
		<app-location route="{{route}}"></app-location>
		<app-route route="{{route}}" pattern="/:page" data="{{routeData}}" tail="{{subroute}}"></app-route>

		<paper-drawer-panel id="paperDrawerPanel" class="collapsed-menu">
			<paper-scroll-header-panel drawer class="rsMenu">
				<iron-ajax auto url="data/menuitems.json" handle-as="json" last-response="{{menuItems}}"></iron-ajax>
				<rock-navmenu id="navMenu" page="{{page}}" menu-items="{{menuItems}}" route="{{route}}"></rock-navmenu>
			</paper-scroll-header-panel>
			<!-- Main content -->
			<paper-scroll-header-panel main>
				<rock-app-pages page="{{page}}" page-items="{{menuItems}}"></rock-app-pages>
				<rock-footer></rock-footer>
			</paper-scroll-header-panel>
		</paper-drawer-panel>
		<!-- Header -->
		<app-toolbar>
			<paper-toolbar class="top-toolbar">
				<paper-icon-button icon="pebble-icons:menu" class="toggle-drawer" on-click="toggleDrawer"></paper-icon-button>
				<a id="logoLink" data-route="rs-app-userdashboard" href="/" on-click="onDataRouteClick">
					<img width="15" height="30" src="images/logo.svg"></img>
				</a>
				<h1>
					<a data-route="Dashboard" href="/" on-click="onDataRouteClick">MDMCenter</a>
				</h1>

				<span class="flex"></span>
				<rock-search></rock-search>
				<paper-icon-button icon="pebble-icons:refresh" class="refresh-icon"></paper-icon-button>
				<paper-icon-button icon="pebble-icons:notifications"></paper-icon-button>
				<paper-progress id="appProgress" class="middle fit" value="0" min="0" max="1000"></paper-progress>
			</paper-toolbar>
		</app-toolbar>

	</template>
	<script>
    Polymer({

      is: 'main-app',
	  properties:{
         cols: '2',
		 page: {
           type: String,
           reflectToAttribute: true,
           observer: '_pageChanged'
		 }
	  },
      observers: [
        '_routePageChanged(routeData.page)'
      ],
      _routePageChanged: function(page) {
        this.page = page || 'Dashboard';
        this.toggleDrawer();
      },
      _pageChanged: function(page) {
        // Load page import on demand. Show 404 page if fails
        var resolvedPageUrl = this.resolveUrl('rock-' + page + '.html');
        this.importHref(resolvedPageUrl, null, this._showPage404, true);
      },
      _showPage404: function() {
        this.page = 'view404';
      },

	  // Toggle Drawer
      toggleDrawer: function() {
         var drawerPanel = this.$.paperDrawerPanel;
         if (drawerPanel.narrow) {
            drawerPanel.togglePanel();
         } else {
            drawerPanel.classList.toggle('collapsed-menu');
         }
      },

	  onDataRouteClick: function() {
          // Close drawer after menu item is selected if drawerPanel is narrow
          var drawerPanel = this.$.paperDrawerPanel;
         
            drawerPanel.closeDrawer();
		  
	  },

      // Scroll page to top and expand header
      scrollPageToTop: function() {
         document.getElementById('mainContainer').scrollTop = 0;
      }
   });
	
  </script>
</dom-module>