<link rel="import" href="../../../bower_components/polymer/polymer.html">

<link rel="import" href="../../../bower_components/iron-icon/iron-icon.html">
<link rel="import" href="../../../bower_components/paper-tabs/paper-tabs.html">
<link rel="import" href="../../../bower_components/paper-icon-button/paper-icon-button.html">

<link rel="import" href="../../../bower_components/paper-menu/paper-menu.html">
<link rel="import" href="../../../bower_components/paper-item/paper-item.html">

<link rel="import" href="../../../bower_components/iron-dropdown/iron-dropdown.html">

<dom-module id="pebble-tabs">
    <template>
        <paper-tabs selected="[[_isSelected(data.config.tabItems)]]" scrollable="[[_isScrollable(data.config.scrollable)]]" >
            <template is="dom-repeat" items="[[data.config.tabItems]]" as="tabItem">
                
                <paper-tab id="[[tabItem.name]]" noink>
                    <!-- Below added style must be removed -->
                    <iron-icon icon="[[tabItem.icon]]" style="margin-right: 0.4em"></iron-icon>
                    [[tabItem.text]]
                    <paper-icon-button id="[[tabItem.name]]_[[_suffix.dropdownButton]]" icon="icons:more-vert" on-tap="toggle" style="margin-left: 0.4em">
                    </paper-icon-button>
                </paper-tab>
                
                <iron-dropdown id="[[tabItem.name]]_[[_suffix.dropdown]]" opened="{{opened}}" focus-target="[[_dropdownContent]]">
                    <paper-menu id="[[tabItem.name]]_[[_suffix.dropdownContent]]" class="dropdown-content">
                        <template is="dom-repeat" items="[[tabItem.menuItems]]" as="menuItem">
                            <paper-item>[[menuItem.text]]</paper-item>
                        </template>
                    </paper-menu>
                </iron-dropdown>

            </template>
        </paper-tabs>
    </template>
</dom-module>

<script>

    (function() {
      'use strict';

      Polymer({
        is: 'pebble-tabs',
        properties: {
            data: {
                type: Object
            },
            opened: {
                type: Boolean,
                value: false,
                notify: true,
                observer: '_openedChanged'
            },
            _suffix: {
                type: Object,
                value: { dropdownButton: "dropdownButton", dropdown: "dropdown", dropdownContent: "dropdownContent" } ,
                readOnly: true
            },
            _dropdownContentId: {
                type: String
            },
            _dropdownContent: {
                type: Object
            },
            _dropdownId: {
                type: String
            },
        },

        ready: function() {
        },

        _isScrollable: function(isScrollable) {
            if(isScrollable) {
                return true;
            } else  {
                return false;
            }
        },

        _isSelected: function(tabItems){
            if(tabItems != null && tabItems != undefined && tabItems.length > 0) {
                for(var tabItemIndex in tabItems){
                    if(tabItems[tabItemIndex].selected) {
                        return tabItemIndex;
                    }
                }
            }

            return "0"; // default selected tab
        },

        _openedChanged: function(opened, oldOpened) {
          if (opened) {
            this._dropdownContent = this.contentElement;
            this.fire('paper-dropdown-open');
          } else if (oldOpened != null) {
            this.fire('paper-dropdown-close');
          }
        },

        get contentElement() {
          return this.$$("#" + this._dropdownContentId);
        },

        toggle: function(e) {
          console.log(e);
          var dropdownButtonId = e.currentTarget.id;
          this._dropdownId = dropdownButtonId.replace(this._suffix.dropdownButton, this._suffix.dropdown);
          this._dropdownContentId = dropdownButtonId.replace(this._suffix.dropdownButton, this._suffix.dropdownContent);

          if (this.opened) {
            this.close(this._dropdownId);
          } else {
            this.open(this._dropdownId);
          }
        },

        open: function(dropdownId) {
          if (this.disabled) {
            return;
          }
          
          this.$$("#" + dropdownId).open();
        },

        close: function(dropdownId) {
          this.$$("#" + dropdownId).close();
        }
      });
    })();

</script>

<script>
        
</script>