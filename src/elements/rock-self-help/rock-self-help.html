<link rel="import" href="../../../bower_components/polymer/polymer-element.html">
<link rel="import" href="../../../bower_components/polymer/lib/mixins/mutable-data.html">
<link rel="import" href="../rock-component-config-behavior/rock-component-config-behavior.html">

<!--
@group rock Elements
@element rock-self-help
-->
<dom-module id="rock-self-help">
    <template></template>
    <script>
        class RockSelfHelp
            extends Polymer.mixinBehaviors([RUFBehaviors.ComponentConfigBehavior], Polymer.Element) {
            static get is() { return 'rock-self-help' }

            static get properties() {
                return {
                    contextData: {
                        type: Object,
                        value: function () {
                            return {};
                        }
                    }
                };
            }

            connectedCallback() {
                super.connectedCallback();
                this.requestConfig("help-settings", this.contextData);
            }

            disconnectedCallback() {
                super.disconnectedCallback();
            }

            onConfigLoaded({config}) {
                if(!_.isEmpty(config)) {
                    if(config.enabled) {
                        //append url to head
                        if (config.mode && config[config.mode + 'url']) {
                            let element = document.createRange().createContextualFragment(config[config.mode + 'url']);
                            document.head.appendChild(element);
                        } else {
                            console.log('self help url unavailable');
                        }
                        //provide role to window var
                        //check for multiple role support
                        window.app_role = RUFUtilities.mainApp.defaultRole;
                    } else {
                        //console.log('self help is disabled');
                    }
                } else {
                    console.log('self help config not found');
                }
            }            
        }
        customElements.define(RockSelfHelp.is, RockSelfHelp);
    </script>
</dom-module>