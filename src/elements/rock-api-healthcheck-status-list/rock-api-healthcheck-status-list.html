<link rel="import" href="../../../bower_components/polymer/polymer.html">
<link rel="import" href="../../../bower_components/iron-flex-layout/iron-flex-layout-classes.html">
<link rel="import" href="../bedrock-style-manager/styles/bedrock-style-common.html">
<link rel="import" href="../rock-api-healthcheck-status-item/rock-api-healthcheck-status-item.html">
<link rel="import" href="../pebble-button/pebble-button.html">
<link rel="import" href="../rock-component-config-behavior/rock-component-config-behavior.html">
<dom-module id="rock-api-healthcheck-status-list">
  <template>
      <style include="bedrock-style-common">
        .block {
          padding: 0 20px;
        }
      </style>
    <div class="block">
      <pebble-button icon="pebble-icon:refresh" id="statusIcon" noink class="pull-right btn btn-primary auto-width m-b-10 pebble-icon-color-white"
        on-click="_handleReload"></pebble-button>
      <template id="statusListTemplate" is="dom-repeat" items="{{calls}}">
        <rock-api-healthcheck-status-item name="{{item.name}}" url="{{item.url}}" status="false">
        </rock-api-healthcheck-status-item>
      </template>
    </div>
  </template>
  <script>
    Polymer({
      is: 'rock-api-healthcheck-status-list',
      ready: function () {

      },
      _validChanged(newValue, oldValue) {
        // console.log(newValue);
        // console.log(oldValue);
      },
      _handleRepeaterReload() {
        return valid
      },
      properties: {
        name: {
          type: String,
          value: null
        },
        storeCalls: {
          type: Object
        },
        valid: {
          type: Boolean,
          value: false,
          notify: true,
          observer: "_validChanged"
        },
        calls: {
          type: Array,
          value: []
        },
        contextData: {
            type: Object,
            value: function () {
                return {};
            },
            observer:'_onContextDataChange'
        }
      },
      behaviors: [
        RUFBehaviors.ComponentConfigBehavior
                ],
      _onContextDataChange: function () {
          if(!_.isEmpty(this.contextData)) {
              var context = DataHelper.cloneObject(this.contextData);
              //App specific
              var appName = ComponentHelper.getCurrentActiveAppName();
              if(appName) {
                  context[ContextHelper.CONTEXT_TYPE_APP] = [{
                      "app": appName
                  }];
              }
              this.requestConfig('rock-api-healthcheck-status-list', context);
          }
      },
      onConfigLoaded: function (componentConfig) {
          if(componentConfig && componentConfig.config) {
            var actionData=[];
            for(var action in componentConfig.config){
                if(componentConfig.config[action]){
                  actionData.push(componentConfig.config[action]);
                }
            }
            this.set("calls", actionData);
          }
      },
      attached: function () {
        this.set('valid', true);
      },
      _onCallsChanged: function () {
        //this.$.statusListTemplate.render();
      },
      _handleReload: function () {
        var temp = JSON.parse(JSON.stringify(this.calls));
        this.calls = [];
        this.$.statusListTemplate.render();
        this.calls = temp;
      }

    });
  </script>
</dom-module>