<!doctype html>

<html>

<head>
  <title>rock-guideme tests</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, minimum-scale=1.0, initial-scale=1, user-scalable=yes">
  <script src="../../../../bower_components/webcomponentsjs/webcomponents-lite.js"></script>
  <script src="../../../../bower_components/web-component-tester/browser.js"></script>
  
  <link rel="import" href="../../bedrock-pubsub/bedrock-pubsub.html">
  <link rel="import" href="../rock-guideme.html">
</head>

<body>

  <test-fixture id="basic">
    <template is="dom-template" id="demo-app">
      <rock-guideme id="guideme"></rock-guideme>
      <bedrock-pubsub></bedrock-pubsub>      
    </template>
  </test-fixture>

  <script>

      suite('rock-guideme testcases', function() {        
        
        test('instantiating the element works', function() {
            var rockElement = fixture('basic');                          
            assert.equal(rockElement[0].is, 'rock-guideme');                 
        });


        test('Should show two variants', function(done) {
            var rockElement = fixture('basic');
            Polymer.dom.flush();
            rockElement[0].async(function(){
                var headers = rockElement[0].querySelectorAll('.header');
                assert.equal(headers.length, 2);
                assert.notEqual(headers[0].innerText.indexOf('Choice'), -1);
                assert.notEqual(headers[1].innerText.indexOf('Size'), -1);
                done();
            }, 150);
        });

        test('Should able to select multiple items', function(done) {
            var rockElement = fixture('basic');

            Polymer.dom.flush();
            rockElement[0].async(function(){
                var lovCheckBoxList = rockElement[0].querySelector('pebble-lov').querySelectorAll('pebble-checkbox');
                lovCheckBoxList[0].click();
                lovCheckBoxList[1].click();
                assert.equal(rockElement[0].selectedItems.length, 2);
                done();
            }, 150);
        });

        test('Should show color elements', function(done) {
            var rockElement = fixture('basic');

            Polymer.dom.flush();
            rockElement[0].async(function(){
                var choiceLov = rockElement[0].querySelector('#ic_choice').querySelector('pebble-lov');
                var sizeLov = rockElement[0].querySelector('#ic_size').querySelector('pebble-lov');

                var choiceColorList = choiceLov.querySelectorAll('.color-wrapper');
                var sizeColorList = sizeLov.querySelectorAll('.color-wrapper');
                var choiceItemColor = window.getComputedStyle(choiceColorList[0], null).getPropertyValue('background-color');
                
                assert.notEqual(choiceColorList.length, 0);
                assert.notEqual(choiceItemColor, undefined);
                assert.equal(sizeColorList.length, 0);
                done();
            }, 150);
        });

        test('Should trigger bedrock event on click save', function(done) {
            var rockElement = fixture('basic'); 

            rockElement[1].addEventListener('bedrock-event-guideme-save', function(e){ 
                assert.equal(e.detail.length, 2);
                assert.equal(e.detail[0].title, 'NRFColor373');
            });
            
            flush(function(){ 
                rockElement[0].async(function(){
                    var lovCheckBoxList = rockElement[0].querySelector('pebble-lov').querySelectorAll('pebble-checkbox');
                    lovCheckBoxList[0].click();
                    lovCheckBoxList[1].click();
                    rockElement[0].querySelectorAll('.buttons')[2].querySelectorAll('pebble-button')[1].click();
                    done();
                }, 150);
            });
        });

        test('Should trigger bedrock event on click cancel', function(done) {
            var rockElement = fixture('basic'); 

            rockElement[1].addEventListener('bedrock-event-guideme-cancel', function(e){                 
                assert.equal(e.detail.length, 0);                
            });
            
            flush(function(){ 
                rockElement[0].async(function(){
                    var lovCheckBoxList = rockElement[0].querySelector('pebble-lov').querySelectorAll('pebble-checkbox');
                    lovCheckBoxList[0].click();
                    lovCheckBoxList[1].click();
                    rockElement[0].querySelectorAll('.buttons')[2].querySelectorAll('pebble-button')[0].click();
                    done();
                }, 150);
            });
        });

        test('Should trigger bedrock event on variant click save', function(done) {
            var rockElement = fixture('basic'); 

            rockElement[1].addEventListener('bedrock-event-guideme-variant-save', function(e){ 
                assert.equal(e.detail.code, 'Code');
                assert.equal(e.detail.title, 'Title');
                assert.equal(e.detail.color, 'red');
            });
            
            flush(function(){ 
                rockElement[0].async(function(){
                    rockElement[0].querySelector('.addvariant').click();
                    var inputList = rockElement[0].querySelector('pebble-popover').querySelectorAll('paper-input');
                    
                    inputList[0].value = "Code";
                    inputList[1].value = "Title";
                    inputList[2].value = "red";

                    rockElement[0].querySelector('pebble-popover').querySelector('.buttons').querySelectorAll('pebble-button')[1].click();
                    done();
                }, 150);
            });
        });
     });
     
    </script>
</body>

</html>