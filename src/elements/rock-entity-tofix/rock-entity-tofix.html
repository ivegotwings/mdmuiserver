<link rel="import" href="../../../bower_components/polymer/polymer.html">
<link rel="import" href="../pebble-image-viewer/pebble-image-viewer.html">
<link rel="import" href="../../../bower_components/iron-flex-layout/iron-flex-layout-classes.html">

<link rel="import" href="../pebble-icon/pebble-icon.html">
<link rel="import" href="../pebble-icons/pebble-icons.html">
<link rel="import" href="../pebble-horizontal-divider/pebble-horizontal-divider.html">
<link rel="import" href="../../../bower_components/iron-ajax/iron-ajax.html">

<!--
`<rock-entity-tofix>` Represents an element that displays entity errors, warnings, and information as a list.

### Example:

    <template is="dom-bind">
        <iron-ajax url="entities.json" last-response="{{response}}" auto></iron-ajax>
		<rock-entity-tofix entities="{{response}}"></rock-entity-tofix>                
	</template>

### Styling

The following custom properties and mixins are available for styling:

Custom property | Description | Default
----------------|-------------|----------
`--entity-tofix-horizontal-divider` | Mixin applied to horizontal divider | {}
`--entity-tofix-container` | Mixin applied to entity item container | {}
`--entity-icon-outer-circle` | Mixin applied to item icon outer circle | {}
`--entity-icon-width` | The width of item icon | 20px
`--entity-icon-height` | The height of item icon | 20px
`--entity-icon-margin` | The margin of item icon | ``
`--error-icon-outer-bg-color` | The outer bg color of error item icon | rgba(251, 96, 103, 1)
`--entity-error-icon-fill-color` | The fill color of error icon | #ffffff
`--entity-error-icon-stroke-color` | The stroke color of error icon | rgba(251, 96, 103, 1)
`--warning-icon-outer-bg-color` | The outer bg color of warning item icon | orange
`--entity-warning-icon-fill-color` | The fill color of warning icon | #ffffff
`--entity-warning-icon-stroke-color` | The stroke color of warning icon | orange
`--info-icon-outer-bg-color` | The outer bg color of info item icon | rgba(22, 180, 252, 1)
`--entity-info-icon-fill-color` | The fill color of info icon | #ffffff
`--entity-info-icon-stroke-color` | The stroke color of info icon | rgba(22, 180, 252, 1)
`--entity-tofix-content` | Mixin applied to entity item content | {}

@group rock Elements
@element rock-entity-tofix
@demo demo/index.html
-->

<dom-module id="rock-entity-tofix">
    <template>
        <style is="custom-style" include="iron-flex iron-flex-alignment">
            pebble-horizontal-divider {
                --pebble-horizontal-divider-color: #ccc;
                @apply(--entity-tofix-horizontal-divider);
            }
            
            .container{
                @apply(--layout-horizontal);             
                align-items: center;
                max-height: 250px;
                max-width: 288px;
                padding: 5px 0;
                cursor: pointer;            
                @apply(--entity-container);
            }

            .entity-icon-outer{
                @apply(--layout);
                @apply(--layout-center-center);
                @apply(--paper-font-common-base); 
                padding: 5px;              
                border-radius: 50%;            
                width: 24px;
                height: 24px;
                margin-right: 10px;                            
                @apply(--entity-icon-outer-circle);
            }

            pebble-icon {
            --pebble-icon-width: var(--entity-icon-width, 20px);
            --pebble-icon-height: var(--entity-icon-height, 20px);
            --pebble-icon-margin: var(--entity-icon-margin);              
            }

            .error{
                background-color: var(--error-icon-outer-bg-color, rgba(251, 96, 103, 1));
            }

            .error > pebble-icon{
                --pebble-icon-fill-color: var(--entity-error-icon-fill-color, #ffffff);
                --pebble-icon-stroke-color: var(--entity-error-icon-stroke-color, rgba(251, 96, 103, 1));
            }

            .warning{
                background-color: var(--warning-icon-outer-bg-color, orange);
            }

            .warning > pebble-icon{
                --pebble-icon-fill-color: var(--entity-warning-icon-fill-color, #ffffff);
                --pebble-icon-stroke-color: var(--entity-warning-icon-stroke-color, orange);
            }

            .information{
                background-color: var(--info-icon-outer-bg-color, rgba(22, 180, 252, 1));
            }

            .information > pebble-icon{
                --pebble-icon-fill-color: var(--entity-info-icon-fill-color, #ffffff);
                --pebble-icon-stroke-color: var(--entity-info-icon-stroke-color, rgba(22, 180, 252, 1));
            }

            .entity-content{
                align-self: flex-center;                          
                @apply(--entity-content);
            }

            .entity-content {
                font-size: 12px !important;
            }
        
        </style>            
            <template is="dom-repeat" items="[[data.tofixes]]">
                <template is="dom-if" if="[[_isDividerNeeded(item, index)]]">
                    <pebble-horizontal-divider></pebble-horizontal-divider>
                </template>                    
                <div class="container" data="[[item.data]]" on-tap="_onTap">
                    <div class$="entity-icon-outer [[item.data.type]]">
                        <pebble-icon icon="[[_getIconByType(item.data.type)]]"></pebble-icon>
                    </div>
                    <div class="entity-content">
                         [[item.data.label]]
                    </div>
                </div>                
            </template>
            <iron-ajax auto url="[[_url]]" handle-as="json" last-response="{{data}}"></iron-ajax>
        </template>

        <script>
            Polymer({
                is: 'rock-entity-tofix',

                properties: {

                    /**
                    *  Indicates the list of entities in JSON format.
                    */
                    data: {
                        type: Object,
                        notify: true,
                        value: function() { return {}; }
                    },

                    /**
                    * Indicates an url to fetch an ajax request.
                    */
                    _url: {
                        type: String,
                        value: "/src/data/EntityManageApp/entity-summary-tofix-data.json"
                    }
                },

               /**
                * Can be used to raise on-tap events as per configuration.
                */
                _onTap: function (e) {                    
                    var eventDetail = {
                        name: e.currentTarget.data.eventName,
                        data: e.currentTarget.data
                    }

                    this.fire('bedrock-event', eventDetail);
                },

                _getIconByType: function(type)
                {
                    if(type == 'information')
                    {
                        return 'pebble-icons:ErrorMessage';
                    }
                    else
                    {
                        return 'pebble-icons:WarningMessage'
                    }
                },

                _isDividerNeeded: function(item, index)
                {                   
                   if(index != 0 && item.data.type != this.data.tofixes[index - 1].data.type)
                   {
                      return true;
                   }

                   return false;                    
                }
            });   
        </script>
</dom-module>