<link rel="import" href="../../../bower_components/polymer/polymer.html">
<link rel="import" href="../../../bower_components/iron-flex-layout/iron-flex-layout-classes.html">

<link rel="import" href="../bedrock-ui-behavior/bedrock-ui-behavior.html">

<link rel="import" href="../pebble-icon/pebble-icon.html">
<link rel="import" href="../pebble-icons/pebble-icons.html">
<link rel="import" href="../pebble-image-viewer/pebble-image-viewer.html">
<link rel="import" href="../pebble-horizontal-divider/pebble-horizontal-divider.html">
<link rel="import" href="../pebble-styles-shared/pebble-styles-shared.html">

<!--
`<rock-entity-tofix>` Represents an element that displays the errors, warnings, and information 
of an entity as a list.

### Example

    <template is="dom-bind">
        <iron-ajax url="entities.json" last-response="{{response}}" auto></iron-ajax>
		<rock-entity-tofix entities="{{response}}"></rock-entity-tofix>                
	</template>

### Styling

The following custom properties and mixins are available for styling:

Custom property | Description | Default
----------------|-------------|----------
`--entity-tofix-horizontal-divider` | Mixin applied to horizontal divider | {}
`--entity-tofix-container` | Mixin applied to entity item container | {}
`--entity-icon-outer-circle` | Mixin applied to item icon outer circle | {}
`--entity-icon-width` | The width of item icon | 20px
`--entity-icon-height` | The height of item icon | 20px
`--entity-icon-margin` | The margin of item icon | ``
`--error-icon-outer-bg-color` | The outer bg color of error item icon | rgba(251, 96, 103, 1)
`--entity-error-icon-fill-color` | The fill color of error icon | #ffffff
`--entity-error-icon-stroke-color` | The stroke color of error icon | rgba(251, 96, 103, 1)
`--warning-icon-outer-bg-color` | The outer bg color of warning item icon | orange
`--entity-warning-icon-fill-color` | The fill color of warning icon | #ffffff
`--entity-warning-icon-stroke-color` | The stroke color of warning icon | orange
`--info-icon-outer-bg-color` | The outer bg color of info item icon | rgba(22, 180, 252, 1)
`--entity-info-icon-fill-color` | The fill color of info icon | #ffffff
`--entity-info-icon-stroke-color` | The stroke color of info icon | rgba(22, 180, 252, 1)
`--entity-tofix-content` | Mixin applied to entity item content | {}

@group rock Elements
@element rock-entity-tofix
@demo demo/index.html
-->

<dom-module id="rock-entity-tofix">
    <template>
        <style is="custom-style" include="iron-flex iron-flex-alignment">
            pebble-horizontal-divider {
                --pebble-horizontal-divider-color: var(--palette-pale-grey-three, #e7ebf0);
                @apply(--entity-tofix-horizontal-divider);
                width: 288px;
            }
            
            .container {
                @apply(--layout-horizontal);
                align-items: center;
                -webkit-align-items: center;
                /* Safari 7.0+ */
                max-height: 250px;
                max-width: 293px;
                padding: 5px 0px;
                cursor: pointer;
                position:relative;
                @apply(--entity-container);
            }
            
            .entity-icon-outer {
                @apply(--layout);
                @apply(--layout-center-center);
                @apply(--paper-font-common-base);
                border-radius: 50%;
                padding: 5px;
                width: 18px;
                height: 19px;
                margin-right: 10px;
                @apply(--entity-icon-outer-circle);
            }
            
            pebble-icon {
                --pebble-icon-width: var(--entity-icon-width, 30px);
                --pebble-icon-height: var(--entity-icon-height, 30px);
                --pebble-icon-margin: var(--entity-icon-margin);
            }
            
            .error {
                background-color: var(--error-icon-outer-bg-color, #f30440);
            }
            
            .error>pebble-icon {
                --pebble-icon-fill-color: var(--entity-error-icon-fill-color, #ffffff);
                --pebble-icon-stroke-color: var(--entity-error-icon-stroke-color, #f30440);
            }
            
            .warning {
                background-color: var(--warning-icon-outer-bg-color, #f78e1e);
            }
            
            .warning>pebble-icon {
                --pebble-icon-fill-color: var(--entity-warning-icon-fill-color, #ffffff);
                --pebble-icon-stroke-color: var(--entity-warning-icon-stroke-color, #f78e1e);
            }
            
            .information {
                background-color: var(--info-icon-outer-bg-color, #0bb2e8);
            }
            
            .information>pebble-icon {
                --pebble-icon-fill-color: var(--entity-info-icon-fill-color, #ffffff);
                --pebble-icon-stroke-color: var(--entity-info-icon-stroke-color, #0bb2e8);
            }
            
            .entity-content {
                align-self: flex-center;
                -webkit-align-self: flex-center;
                @apply(--entity-content);
                font-size: 12px !important;
                color: var(--dark-title-color, #1a2028);
            }
            
            .entity-content {
                font-size: 12px !important;
                color: var(--dark-title-color, #1a2028);
            }
            .entity-content:hover{
                color:var(--focused-line, #026bc3);
            }
            
            .container:hover {
                color:var(--focused-line, #026bc3);
                background-color:var(--bgColor-hover,#e8f4f9);
                
            }
            .container:hover::before{ 
                position: absolute;
                content: ''; 
                top: 0;
                width:15px;
                bottom: 0;
                left: -15px;  
                background-color:var(--bgColor-hover,#e8f4f9);
              
            }
            .container:hover::after{ 
                position: absolute;
                content: ''; 
                top: 0;
                width: 15px;
                bottom: 0;
                right: -15px ; 
                background-color:var(--bgColor-hover,#e8f4f9);
            }
            
            .entity-icon-outer pebble-icon::shadow iron-icon {
                width: 18px !important;
                height: 24px !important;
            }
        </style>
        <template is="dom-repeat" items="[[_data.tofixes]]">
            <template is="dom-if" if="[[_isDividerNeeded(item, index)]]">
                <pebble-horizontal-divider></pebble-horizontal-divider>
            </template>
            <div class="container" data="[[item.data]]" on-tap="_onTap">
                <div class$="entity-icon-outer [[item.data.type]]">
                    <pebble-icon icon="[[_getIconByType(item.data.type)]]"></pebble-icon>
                </div>
                <div class="entity-content">
                    [[item.data.label]]
                </div>
            </div>
        </template>
    </template>

    <script>
        Polymer({
            is: 'rock-entity-tofix',

            properties: {

                /**
                *  Indicates the list of entities in the JSON format.
                */
                data: {
                    type: Object,
                    notify: true,
                    value: function () { return {}; },
                    observer: '_setData'
                },

                _data: {
                    type: Object,
                    notify: true,
                    value: function () { return {}; }
                }
            },

            behaviors: [
                RUFBehaviors.UIBehavior
            ],

            /**
             * Can be used to raise on-tap events as per the configuration.
             */
            _onTap: function (e) {
                var eventDetail = {
                    name: e.currentTarget.data.eventName,
                    data: e.currentTarget.data
                }

                this.fire('bedrock-event', eventDetail);
            },

            _getIconByType: function (type) {
                if (type == 'information') {
                    return 'pebble-icons:ErrorMessage';
                }
                else {
                    return 'pebble-icons:WarningMessage'
                }
            },

            _isDividerNeeded: function (item, index) {
                if (index != 0 && this.data  && this.data.tofixes && item.data.type != this.data.tofixes[index - 1].data.type) {
                    return true;
                }

                return false;
            },

            _setData: function () {
                if (this.data && Object.keys(this.data).length > 0) {
                    this._data = this.data;
                } else {
                    this._data = this.getParentAppConfig('rock-entity-tofix');
                }
            }
        });
    </script>
</dom-module>