<!doctype html>

<html>

<head>
    <title>pebble-date-picker test</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, minimum-scale=1.0, initial-scale=1, user-scalable=yes">
    <link rel="import" href="../../../../bower_components/polymer/polymer.html">
    <script src="../../../../bower_components/webcomponentsjs/webcomponents-lite.js"></script>
    <script src="../../../../bower_components/web-component-tester/browser.js"></script>

    <link rel="import" href="../../../../bower_components/paper-button/paper-button.html">
    <link rel="import" href="../pebble-date-picker.html">
</head>

<body>
    <test-fixture id="DateWithRange">
        <template is="dom-template">
            <pebble-date-picker id="daterangepicker"                           
                                is-range
                                show-ranges                                                                
                                heading-format="ddd, MMM DD YYYY"                           
                                start-date="{{startDate}}"
                                end-date="{{endDate}}"></pebble-date-picker>
        </template>
    </test-fixture>
    <test-fixture id="DateWithRangeAndNoRangeType">
        <template is="dom-template">
            <pebble-date-picker id="daterangepicker"                           
                                is-range
                                show-ranges                                                                
                                heading-format="ddd, MMM DD YYYY"                           
                                start-date="{{startDate}}"
                                end-date="{{endDate}}"></pebble-date-picker>
            <p id="startDate">{{startDate}}</p>
            <p id="endDate">{{endDate}}</p>
        </template>
    </test-fixture>    
    <test-fixture id="DateOnly">
        <template is="dom-template">
            <pebble-date-picker id="daterangepicker"
                                heading-format="ddd, MMM DD YYYY"                           
                                date="{{date}}"></pebble-date-picker>
        </template>
    </test-fixture>
    <script>
        suite('pebble-date-picker testcases', function () {

            test('instantiating the element works', function () {
                var pebbleElement = fixture('DateWithRange');
                assert.equal(pebbleElement.is, 'pebble-date-picker');
            });

            test('Should show last 7 days as selected on specific range button clicked', function () {
                var pebbleElement = fixture('DateWithRange');
                Polymer.dom.flush();
                
                var last7daysBtn = pebbleElement.querySelectorAll("paper-button[data-args='last7days']")[0];
                last7daysBtn.click();
                Polymer.dom.flush();

                var backdate = moment().subtract(6, 'day').format('YYYY-MM-DD');
                var today = moment().format('YYYY-MM-DD');
                var selectedDates = pebbleElement.querySelectorAll('.day-item.selected');

                assert.equal(selectedDates[0].attributes['date'].value, backdate);
                assert.equal(selectedDates[1].attributes['date'].value, today);
            });

            test('Should show today date as selected', function () {
                var pebbleElement = fixture('DateWithRangeAndNoRangeType');
                Polymer.dom.flush();
                
                var today = moment().format('YYYY-MM-DD');
                var selectedDate = pebbleElement[0].querySelector('.day-item.selected').attributes['date'].value;

                assert.equal(selectedDate, today);
            });

            test('Should show two dates as selected for range picker', function () {
                var pebbleElement = fixture('DateWithRangeAndNoRangeType');
                Polymer.dom.flush();
                
                var futuredate = moment().add(5, 'day').format('YYYY-MM-DD');
                var selector = ".day-item[date='" + futuredate + "']";                
                var futuredate_dayitem = pebbleElement[0].querySelector(selector);
                futuredate_dayitem.click();
                Polymer.dom.flush();
                
                var today = moment().format('YYYY-MM-DD');
                var selectedDates = pebbleElement[0].querySelectorAll('.day-item.selected');
                
                assert.equal(selectedDates[0].attributes['date'].value, today);
                assert.equal(selectedDates[1].attributes['date'].value, futuredate);
            });

             test('Should provide the proper dates to consumer as per range selection', function () {
                var pebbleElement = fixture('DateWithRangeAndNoRangeType');
                Polymer.dom.flush();
                
                var futuredate = moment().add(5, 'day').format('YYYY-MM-DD');
                var selector = ".day-item[date='" + futuredate + "']";                
                var futuredate_dayitem = pebbleElement[0].querySelector(selector);
                futuredate_dayitem.click();
                Polymer.dom.flush();                
                
                var selectedDates = pebbleElement[0].querySelectorAll('.day-item.selected');                
                var startDate = moment(new Date(pebbleElement[1].innerHTML)).format('YYYY-MM-DD');
                var endDate = moment(new Date(pebbleElement[2].innerHTML)).format('YYYY-MM-DD');
                
                assert.equal(selectedDates[0].attributes['date'].value, startDate);
                assert.equal(selectedDates[1].attributes['date'].value, endDate);
            });

            test('Should show today date as selected in date picker', function () {
                var pebbleElement = fixture('DateOnly');
                Polymer.dom.flush();
                
                var today = moment().format('YYYY-MM-DD');
                var selectedDate = pebbleElement.querySelector('.day-item.selected').attributes['date'].value;

                assert.equal(selectedDate, today);
            });

            test('Should not allow user to select multiple dates in date picker', function () {
                var pebbleElement = fixture('DateOnly');
                Polymer.dom.flush();
                
                var futuredate = moment().add(5, 'day').format('YYYY-MM-DD');
                var selector = ".day-item[date='" + futuredate + "']";                
                var futuredate_dayitem = pebbleElement.querySelector(selector);
                futuredate_dayitem.click();
                Polymer.dom.flush();
                
                var selectedDates = pebbleElement.querySelectorAll('.day-item.selected');

                assert.equal(selectedDates.length, 1);
                assert.equal(selectedDates[0].attributes['date'].value, futuredate);
            });
            
        });
    </script>
</body>

</html>