<link rel="import" href="../../../bower_components/polymer/polymer.html">

<link rel="import" href="../bedrock-ui-behavior/bedrock-ui-behavior.html">
<link rel="import" href="../bedrock-app-context-behavior/bedrock-app-context-behavior.html">

<script>
    /***
    * `RUFBehaviors.AppBehavior` provides common properties and methods that must be implemented across all
    * the Apps. It is a mandatory behavior for all apps to implement.
    *
    * The App flows use multiple properties defined in the `RUFBehaviors.AppBehavior`.
    *
    *  ### Example
    *
    *     <dom-module id="x-app">
    *        <template>
    *        </template>
    *        <script>
    *           Polymer({
    *             is: "x-app",
    *
    *             behaviors: [
    *               RUFBehaviors.AppBehavior
    *             ],
    *
    *             properties: {
    *              
    *             }
    *           });
    *        &lt;/script>
    *     </dom-module>
    * @demo demo/index.html
    * @polymerBehavior RUFBehaviors.AppBehavior
    */

    window.RUFBehaviors = window.RUFBehaviors || {};
    /** @polymerBehavior RUFBehaviors.AppBehavior */
    RUFBehaviors.AppBehaviorImpl = {

        properties: {

            /**
            * Content is not appearing - Specifies whether or not the component is Riversand UI Framework's App. 
            */
            isRufApp: {
                type: Boolean,
                value: true,
                reflectToAttribute: true
            },

          /**
            * Content is not appearing - Content development is under progress.
            */
            contentHeightVariable: {
                type: String,
                value: ""
            }

        },

        /**
          * Content is not appearing - Content development is under progress.
          */
        attached: function () {
            if (this.contentHeightVariable != "") {
                var viewPortHeight = Math.max(document.documentElement.clientHeight, window.innerHeight || 0);
                var rockLayout = this.shadowRoot.querySelector("rock-layout");
                var rockTitle = rockLayout.querySelector("rock-titlebar");
                var rockFooter = rockLayout.shadowRoot.querySelector("rock-footer");
                if (rockTitle) {
                    viewPortHeight -= rockTitle.offsetHeight == 0 ? 40 : rockTitle.offsetHeight;
                }
                if (rockFooter) {
                    viewPortHeight -= rockFooter.offsetHeight == 0 ? 68 : rockFooter.offsetHeight;
                }
                else {
                    viewPortHeight -= 32;
                }

                this.updateStyles({[this.contentHeightVariable]:parseInt(viewPortHeight) - 22 + 'px'});
            }

        },

        openBusinessFunctionDialog(detail, sharedData) {
            if(!this.contextData) return;

            const data = {
                contextData: this.contextData,
                ...detail,
                sharedData: {
                    "context-data": DataHelper.cloneObject(this.contextData),
                    ...sharedData
                }
            };

            var eventData = {
                data,
                name: "business-dialog-opened",
            };

            this.dispatchEvent(new CustomEvent('bedrock-event',{detail:eventData, bubbles:true, composed:true}));
        }
    };
    /** @polymerBehavior */
    RUFBehaviors.AppBehavior = [RUFBehaviors.UIBehavior, RUFBehaviors.AppBehaviorImpl];

</script>