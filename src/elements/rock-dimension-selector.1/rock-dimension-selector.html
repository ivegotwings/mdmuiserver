<link rel="import" href="../../../bower_components/polymer/polymer.html" />
<link rel="import" href="../../../bower_components/paper-dropdown-menu/paper-dropdown-menu.html" />
<link rel="import" href="../../../bower_components/paper-listbox/paper-listbox.html" />
<link rel="import" href="../../../bower_components/paper-item/paper-item.html" />
<link rel- "import" href="../../../bower_components/paper-toolbar/paper-toolbar.html" />
<link rel="import" href="../../../bower_components/iron-icons/iron-icons.html" />
<link rel="import" href="../../../bower_components/iron-icons/device-icons.html" />
<link rel="import" href="../pebble-icons/pebble-icons.html" />
<link rel="import" href="../bedrock-ui-behavior/bedrock-ui-behavior.html">

<!--
`<rock-dimension-selector>` Represents a component to hold a catalog, source, date, and locale information. 
The elements inside this component can be dyncamically loaded based on a config json.

### Styling

The following custom properties and mixins are available for styling:

Custom property | Description | Default
----------------|-------------|----------
`--dimesion-selector-catalog-dropdown` | Mixin applied to catalog selector dropdown  | `{}`
`--dimesion-selector-source-dropdown`  | Mixin applied to source selector dropdown   | `{}`
`--dimesion-selector-date-dropdown`    | Mixin applied to date selector dropdown     | `{}`
`--dimesion-selector-locale-dropdown`  | Mixin applied to locale selector dropdown   | `{}`

@group rock Elements
@element rock-dimension-selector
@demo demo/index.html
-->

<dom-module id="rock-dimension-selector">
    <template>
        <style include="pebble-styles-shared"></style>
        <style is="custom-style"> 
            :host {
                --icon-set-height:20px;
                display: inline-block;  
                --paper-input-container-underline: {
                    display: none; 
                }
                --paper-input-container-underline-focus: {
                    display: none;
                }
                                                
            }
            paper-toolbar{
                display:inline-block;
            }
            paper-dropdown-menu{
                height:var(--icon-set-height,26px);
            }
             #catalogDropdown { 
                @apply(--dimesion-selector-catalog-dropdown);             
            }

            #sourceDropdown{
                @apply(--dimesion-selector-source-dropdown);
                width: 55px;
            }

            #dateDropdown{
               /* width: 59px;
                height: 16px;*/
                font-weight: normal;
                font-style: normal;
                font-stretch: normal;
                color: var(--datedropdown-text-color);
                @apply(--dimesion-selector-date-dropdown);
                width: 60px;
            }

            #localeDropdown{
                @apply(--dimesion-selector-locale-dropdown);
                width:65px;
            }

            paper-toolbar iron-icon {                
                fill: var(--palette-steel-grey);  
                height: var(--icon-set-height);
                width: var(--icon-set-height);
                @apply(--dimension-selector-icon);              
            }  
            paper-dropdown-menu::shadow paper-menu-button paper-input::shadow input,paper-dropdown-menu::shadow paper-menu-button paper-input::shadow label  {
                font-size: var(--default-font-size);
                color: var(--palette-dark);
            }       
            paper-dropdown-menu::shadow paper-menu-button paper-input::shadow paper-input-container{
                padding:0;
            }
            paper-dropdown-menu::shadow paper-menu-button paper-input::shadow paper-input-container::shadow .floated-label-placeholder{
                display: none;
            }
            paper-dropdown-menu::shadow paper-menu-button paper-ripple{
                display: none;
            }
        </style>

<paper-toolbar>
    <template is="dom-if" if="{{configData.catalogSelector.visible}}">

        <iron-icon icon="pebble-icons:Perspective"></iron-icon>

        <paper-dropdown-menu id="catalogDropdown" on-iron-select="_selected" on-selected-item-label-changed="_selectionChange" data="[[configData.catalogSelector.catalogItems]]"
            parent="[[configData.catalogSelector]]" no-label-float>
            <paper-listbox class="dropdown-content" attr-for-selected="value" selected="{{_getSelectedValue(configData.catalogSelector.catalogItems)}}">
                <template is="dom-repeat" items="{{configData.catalogSelector.catalogItems}}" as="catalogItem">
                    <paper-item value="{{catalogItem.value}}">
                        <template is="dom-if" if="{{catalogItem.icon}}">
                            <iron-icon icon={{catalogItem.icon}}></iron-icon>
                        </template>
                        {{catalogItem.text}}
                    </paper-item>
                </template>
            </paper-listbox>
        </paper-dropdown-menu>
    </template>

    <template is="dom-if" if="{{configData.sourceSelector.visible}}">

        <iron-icon icon="pebble-icons:Source"></iron-icon>

        <paper-dropdown-menu id="sourceDropdown" on-iron-select="_selected" on-selected-item-label-changed="_selectionChange" data="[[configData.sourceSelector.sourceItems]]"
            parent="[[configData.sourceSelector]]" no-label-float>
            <paper-listbox class="dropdown-content" attr-for-selected="value" selected="{{_getSelectedValue(configData.sourceSelector.sourceItems)}}">
                <template is="dom-repeat" items="{{configData.sourceSelector.sourceItems}}" as="sourceItem">
                    <paper-item value="{{sourceItem.value}}">
                        <template is="dom-if" if="{{sourceItem.icon}}">
                            <iron-icon icon={{sourceItem.icon}}></iron-icon>
                        </template>
                        {{sourceItem.text}}
                    </paper-item>
                </template>
            </paper-listbox>
        </paper-dropdown-menu>

    </template>

    <template is="dom-if" if="{{configData.dateSelector.visible}}">

        <iron-icon icon="pebble-icons:AccessTime"></iron-icon>
        <paper-dropdown-menu id="dateDropdown" label="Now">
            <paper-listbox class="dropdown-content">
            </paper-listbox>
        </paper-dropdown-menu>
    </template>

    <template is="dom-if" if="{{configData.localeSelector.visible}}">

        <iron-icon icon="pebble-icons:Language"></iron-icon>

        <paper-dropdown-menu id="localeDropdown" on-iron-select="_selected" on-selected-item-label-changed="_selectionChange" data="[[configData.localeSelector.localeItems]]"
            parent="[[configData.localeSelector]]" no-label-float>
            <paper-listbox class="dropdown-content" attr-for-selected="value" selected="{{_getSelectedValue(configData.localeSelector.localeItems)}}">
                <template is="dom-repeat" items="{{configData.localeSelector.localeItems}}" as="localeItem">
                    <paper-item value="{{localeItem.value}}">
                        <template is="dom-if" if="{{localeItem.icon}}">
                            <iron-icon icon={{localeItem.icon}}></iron-icon>
                        </template>
                        {{localeItem.text}}
                    </paper-item>
                </template>
            </paper-listbox>
        </paper-dropdown-menu>
    </template>
</paper-toolbar>
</template>
</dom-module>
<script>
    Polymer({
        is: "rock-dimension-selector",
        properties: {
            /**
            * Fired when user changes the catalog selector selection 
            *
            * @event dimension-selector-catalog (pub-sub event)
            * @param {Object} detail
            * @param {Object} detail.value gives the selected value			
            */

            /**
            * Fired when user changes the source selector selection 
            *
            * @event dimension-selector-source (pub-sub event)
            * @param {Object} detail
            * @param {Object} detail.value gives the selected value			
            */

            /**
            * Fired when user changes the locale selector selection 
            *
            * @event dimension-selector-locale (pub-sub event)
            * @param {Object} detail
            * @param {Object} detail.value gives the selected value			
            */

            /**
             * Returns the list of items which you must place in the dimension selector component.
             */
            configData: {
                type: Object,
                value: function () { return {}; }
            }
        },
        behaviors: [
            RUFBehaviors.UIBehavior
        ],
        _getSelectedValue: function (data) {
            if (data != undefined && data != null) {
                for (var i = 0; i < data.length; i++) {
                    if (data[i].selected == true) {
                        return data[i].value;
                    }
                }
            }
        },
        _selectionChange: function (e) {
            var eventObject = null;
            var currentSelectedValue = e.detail.value;
            var currentDimension = e.target.parent;
            var itemCollection = e.currentTarget.data;

            if (itemCollection != undefined && itemCollection != null && currentSelectedValue != undefined) {
                for (var i = 0; i < itemCollection.length; i++) {
                    if (itemCollection[i].text == currentSelectedValue) {
                        eventObject = itemCollection[i];
                        break;
                    }
                }
            }

            var eventName = "";
            for (var key in currentDimension) {
                if (key == "catalogItems" && currentDimension.hasOwnProperty(key)) {
                    eventName = "dimension-selector-catalog";
                    break;
                }
                else if (key == "sourceItems" && currentDimension.hasOwnProperty(key)) {
                    eventName = "dimension-selector-source";
                    break;
                }
                else if (key == "localeItems" && currentDimension.hasOwnProperty(key)) {
                    eventName = "dimension-selector-locale";
                    break;
                }
            }

            if (eventObject != null && eventName != null) {
                var eventDetail = {
                    data: eventObject,
                    name: eventName
                }
                this.fireBedrockEvent(eventName, eventDetail);
            }
        },
        _selected: function (e) {
            //console.log('e.detail.item.textContent: '+e.detail.item.textContent);
            //console.log('Polymer.dom(e.detail.item).textContent: '+Polymer.dom(e.detail.item).textContent);        
        }
    });
</script>