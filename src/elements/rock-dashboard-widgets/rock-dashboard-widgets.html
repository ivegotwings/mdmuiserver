<link rel="import" href="../../../bower_components/polymer/polymer-element.html">

<link rel="import" href="../rock-widget-panel/rock-widget-panel.html">
<link rel="import" href="../rock-component-config-behavior/rock-component-config-behavior.html">

<!--
@group rock Elements
@element rock-dashboard-widgets
@demo demo/index.html
-->
<dom-module id="rock-dashboard-widgets">
    <template>
        <style include="bedrock-style-common"></style>
        <style>
        </style>
       <rock-widget-panel config="[[config]]" context-data="[[contextData]]"></rock-widget-panel>
    </template>
    <script>
        class RockDashboardWidgets
            extends Polymer.mixinBehaviors([RUFBehaviors.ComponentConfigBehavior], Polymer.Element) {
            static get is() { return 'rock-dashboard-widgets' }
            ready() {
                super.ready();
            }
            static get properties() {
                return {
                    contextData: {
                        type: Object,
                        value: function() {
                            return {};
                        },
                        observer: '_onContextDataChange'
                    },
                    config: {
                        type: Object,
                        value: function() {
                            return {};
                        }
                    }
                }
            }
            /**
            *
            */
            connectedCallback() {
                super.connectedCallback();
            }
            /**
            *
            */
            disconnectedCallback() {
                super.disconnectedCallback();
            }
            _onContextDataChange() {
                if(!_.isEmpty(this.contextData)) {
                    var context = DataHelper.cloneObject(this.contextData);
                    //App specific
                    var appName = ComponentHelper.getCurrentActiveAppName();
                    if(appName) {
                        context[ContextHelper.CONTEXT_TYPE_APP] = [{
                            "app": appName
                        }];
                    }

                    this.requestConfig('rock-dashboard-widgets', context);
                }
            }
            onConfigLoaded(componentConfig) {
                if(componentConfig && componentConfig.config) {
                    var config = componentConfig.config;
                    var widgets = DataHelper.convertObjectToArray(config.widgets);
                    for(var widget in widgets){
                        if(widgets[widget].config){
                            widgets[widget].config.iconButtons = DataHelper.convertObjectToArray(widgets[widget].config.iconButtons);
                        }
                    }
                    config.widgets = widgets;
                    this.config = config;
                }
            }
            
            
        }
        customElements.define(RockDashboardWidgets.is, RockDashboardWidgets);
    </script>
</dom-module>