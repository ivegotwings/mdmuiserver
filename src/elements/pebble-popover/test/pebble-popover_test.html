<!doctype html>

<html>

<head>
    <title>pebble-popover test</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, minimum-scale=1.0, initial-scale=1, user-scalable=yes">
    <script src="../../../../bower_components/webcomponentsjs/webcomponents-lite.js"></script>
    <script src="../../../../bower_components/web-component-tester/browser.js"></script>

    <link rel="import" href="../../pebble-button/pebble-button.html">
    <link rel="import" href="../pebble-popover.html">
</head>

<body>

    <test-fixture id="basic">
        <template>
            <pebble-popover></pebble-popover>
        </template>
    </test-fixture>

    <!--Opening popover, checking is overlap or not, and display with default alignment Top/Left-->
    <test-fixture id="OpenPopover">
        <template>
            <pebble-button id="simpleButton" button-text="Test Button" onclick="buttonpopover.show()"></pebble-button>
            <pebble-popover id="buttonpopover" for="simpleButton" auto-fit-on-attach no-overlap>
                Popover simple text.
            </pebble-popover>
        </template>
    </test-fixture>    

    <test-fixture id="horizontalPopover-right">
        <template>
            <pebble-button id="simpleButton" button-text="Test Button" onclick="buttonpopover.show()"></pebble-button>
            <pebble-popover id="buttonpopover" for="simpleButton" auto-fit-on-attach no-overlap horizontal-align="right">
                Popover simple text.
            </pebble-popover>
        </template>
    </test-fixture>

    <!-- Default setup is top -->
    <test-fixture id="verticlePopover-left">
        <template>
            <pebble-button id="simpleButton" button-text="Test Button" onclick="buttonpopover.show()"></pebble-button>
            <pebble-popover id="buttonpopover" for="simpleButton" auto-fit-on-attach no-overlap vertical-align="bottom">
                Popover simple text.
            </pebble-popover>
        </template>
    </test-fixture>

    <test-fixture id="verticlePopover-right">
        <template>            
                <pebble-button id="simpleButton" button-text="Test Button" onclick="buttonpopover.show()" style=""></pebble-button>
                <pebble-popover id="buttonpopover" for="simpleButton" auto-fit-on-attach no-overlap vertical-align="bottom" horizontal-align="right">
                    Popover simple text.
                </pebble-popover>           
        </template>
    </test-fixture>

    <script>

      suite('pebble-popover testcases', function() {
        
        test('instantiating the element works', function() {
          var pebbleElement = fixture('basic');
          assert.equal(pebbleElement.is, 'pebble-popover');
        }); 

        test('Should open a popover and close on outside click', function() {
                var pebbleElement = fixture('OpenPopover');
                Polymer.dom(pebbleElement.root).querySelector('pebble-button').click();                
                assert.equal(pebbleElement[1].attributes['aria-hidden'], undefined); //popover not hidden and its opened  

                //Overlay behavior to capture outside click
                document.addEventListener('click', function(){
                    pebbleElement[1]._onCaptureClick();
                });

                document.body.click();                
                assert.equal(pebbleElement[1].attributes['aria-hidden'].value, 'true');
         });
        
         test('Should not overlap when nooverlap is set', function(done) {

          var pebbleElement = fixture('OpenPopover');
          Polymer.dom(pebbleElement.root).querySelector('pebble-button').click();                

          flush(function () {
                    var btnBounderies = pebbleElement[0].getBoundingClientRect();
                    var poBounderies = pebbleElement[1].getBoundingClientRect();   
                                     
                    assert.equal((poBounderies.top > btnBounderies.bottom), true);
                    done();
                }); 
        });    

        test('Should show popover below the target (Top/Left)', function(done) {

          var pebbleElement = fixture('OpenPopover');
          Polymer.dom(pebbleElement.root).querySelector('pebble-button').click();                

          flush(function () {
                    var btnBounderies = pebbleElement[0].getBoundingClientRect();
                    var poBounderies = pebbleElement[1].getBoundingClientRect();

                    assert.equal((btnBounderies.left < poBounderies.left 
                                  && btnBounderies.bottom < poBounderies.top), true);
                    done();
                }); 
        });     


        test('Should show popover below the target (Top/Right)', function(done) {

          var pebbleElement = fixture('horizontalPopover-right');
          Polymer.dom(pebbleElement.root).querySelector('pebble-button').click();                

          flush(function () {
                    var btnBounderies = pebbleElement[0].getBoundingClientRect();
                    var poBounderies = pebbleElement[1].getBoundingClientRect();

                    assert.equal((btnBounderies.right > poBounderies.right
                                  && btnBounderies.bottom < poBounderies.top), true);
                    done();
                }); 
        });  

        test('Should show popover above the target (Bottom/Left)', function(done) {

          var pebbleElement = fixture('verticlePopover-left');
          Polymer.dom(pebbleElement.root).querySelector('pebble-button').click();                

          flush(function () {
                    var btnBounderies = pebbleElement[0].getBoundingClientRect();
                    var poBounderies = pebbleElement[1].getBoundingClientRect();

                    assert.equal((btnBounderies.top > poBounderies.top
                                  && btnBounderies.left < poBounderies.left), true);
                    done();
                }); 
        }); 

        test('Should show popover above the target (Bottom/Right)', function(done) {

          var pebbleElement = fixture('verticlePopover-right');
          Polymer.dom(pebbleElement.root).querySelector('pebble-button').click();                

          flush(function () {
                    var btnBounderies = pebbleElement[0].getBoundingClientRect();
                    var poBounderies = pebbleElement[1].getBoundingClientRect();

                    assert.equal((btnBounderies.top > poBounderies.top
                                  && btnBounderies.right > poBounderies.right), true);
                    done();
                }); 
        });        

        });
    </script>
</body>

</html>