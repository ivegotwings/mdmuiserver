<link rel="import" href="../../../bower_components/polymer/polymer.html">
<link rel="import" href="../../../bower_components/iron-fit-behavior/iron-fit-behavior.html">
<link rel="import" href="../../../bower_components/iron-overlay-behavior/iron-overlay-behavior.html">
<link rel="import" href="../pebble-styles-shared/pebble-styles-shared.html">
<!--<link rel="import" href="popover-styles.html">--> <!--Arrow styles-->

<!--
`<pebble-popover>` is a popover raised for a target.

Example:

    <pebble-button id="simpleButton" button-text="Test Button" onclick="buttonpopover.show()"></pebble-button>
    <pebble-popover id="buttonpopover" for="simpleButton" auto-fit-on-attach no-overlap>
        Popover simple text.                    
    </pebble-popover>

### Styling

The following custom properties and mixins are available for styling:

Custom property | Description | Default

-----------------------------------------------------------------------------------

`--pebble-popover-background-color` | The background color of the popover | `#ffffff`

`--pebble-popover-text-color` | The color of the popover text | `#000000`

`--pebble-popover-max-height` | The max height of the popover | `300px`

`--pebble-popover-max-width` | The max width of the popover | `300px`


@group Pebble Elements
@element pebble-popover
@demo demo/index.html
-->


<dom-module id="pebble-popover">
  <template>
    <!--<style include="popover-styles"></style>--> <!--For arrow styles-->
    <style is="custom-style" include="shared-styles">
      :host {
        display: block;
        position: absolute;
        background-color: var(--pebble-popover-background-color, #ffffff);
        color: var(--pebble-popover-text-color, #000000);
        max-height: var(--pebble-popover-max-height, 300px);
        max-width: var(--pebble-popover-max-width, 300px);
        padding: 16px 24px;
        box-sizing: border-box;
        box-shadow: 0 2px 5px 0 rgba(0, 0, 0, 0.26);
        border-radius: 2px;
        margin: 8px;
        font-size: 14px;
        overflow: auto;
      }
    </style>

    <div>
      <content>
      </content>
    </div>

    <script>
         //Reset positions of the popovers on scroll & resize
         window.onscroll = fixPopoverOnScrollAndResize;
         window.onresize = fixPopoverOnScrollAndResize;

          function fixPopoverOnScrollAndResize() {
              //looped for multiple popovers on same window 
              var popoversList = document.querySelectorAll('pebble-popover');
              popoversList.forEach(function(popover){
                    if(popover.opened)
                    {
                      popover.refitPopover();
                    }
              });
          }
    </script>

  </template>

  <script>
      Polymer({
        is: 'pebble-popover',

        properties: {

          /**
            popover Id
          */

           id: {
             type: String
           },

          /*
            Target for popover to display
          */

           for: {
             type: String
           },

           /*
              Align popover vertically 
              above the target (bottom)
              and below the target (top)
           */

           verticalAlign: {
             type: String,
             value: "top"
           },

           /*
              Align popover horizontally
              left of the target 
              and right of the target - left/right
           */

           horizontalAlign: {
             type: String,
             value: "left"
           },

           /*
              If true, then it prevents overlap with target
           */
           noOverlap: {
             type: Boolean,
             value: false
           }
        },

        
        behaviors: [
          Polymer.IronOverlayBehavior
          //Polymer.IronFitBehavior //IronFitBehavior is under IronOverlayBehavior, so no need to mention here
        ],

        
        /*
          Display the popover
        */

        show : function() {
            this.open(); //IronOverlayBehavior to displat popover

            var scope = Polymer.dom(this).getOwnerRoot();
            var target = Polymer.dom(scope).querySelector('#' + this.for);
            var popover = Polymer.dom(scope).querySelector('#' + this.id);
            popover.positionTarget = target;

            this.updateAlign();
          },

          /*
           Hide the popover
         */

          hide: function() {            
            this.close();
          },

          /*
            Update alignment based on properties
          */

          updateAlign: function(e) {
            var scope = Polymer.dom(this).getOwnerRoot();
            var popover = Polymer.dom(scope).querySelector('#' + this.id);
            popover.horizontalAlign = this.horizontalAlign;
            popover.verticalAlign = this.verticalAlign;
            popover.noOverlap = this.noOverlap;            
            this.refitPopover();
          },

          /*
            Reset position of the popover
          */

          refitPopover: function() {
              var scope = Polymer.dom(this).getOwnerRoot();
              var popover = Polymer.dom(scope).querySelector('#' + this.id);
              popover.refit();
          }
      });
  </script>

</dom-module>