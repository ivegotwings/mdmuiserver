<link rel="import" href="../../../bower_components/polymer/polymer.html">
<link rel="import" href="../../../bower_components/iron-fit-behavior/iron-fit-behavior.html">
<link rel="import" href="../../../bower_components/iron-overlay-behavior/iron-overlay-behavior.html">
<link rel="import" href="../pebble-styles-shared/pebble-styles-shared.html">
<!--<link rel="import" href="popover-styles.html">--> <!--Arrow styles-->

<!--
`<pebble-popover>` Represents a popover raised for a target.

Example:

    <pebble-button id="simpleButton" button-text="Test Button" onclick="buttonpopover.show()"></pebble-button>
    <pebble-popover id="buttonpopover" for="simpleButton" auto-fit-on-attach no-overlap>
        Popover simple text.                    
    </pebble-popover>

### Styling

The following custom properties and mixins are available for styling:

Custom property | Description | Default
----------------|-------------|---------
`--pebble-popover-background-color` | The background color of the popover | `#ffffff`
`--pebble-popover-text-color` | The color of the popover text | `#000000`
`--pebble-popover-max-height` | The max height of the popover | `300px`
`--pebble-popover-max-width` | The max width of the popover | `300px`

@group Pebble Elements
@element pebble-popover
@demo demo/index.html
-->


<dom-module id="pebble-popover">
  <template>
    <!--<style include="popover-styles"></style>--> <!--For arrow styles-->
    <style is="custom-style" include="shared-styles">
      :host {
        display: block;
        position: absolute;
        background-color: var(--pebble-popover-background-color, #ffffff);
        color: var(--pebble-popover-text-color, #000000);
        max-height: var(--pebble-popover-max-height, 300px);
        max-width: var(--pebble-popover-max-width, 300px);        
        box-sizing: border-box;
        box-shadow: 0 2px 5px 0 rgba(0, 0, 0, 0.26);
        border-radius: 2px;        
        font-size: 14px;
        overflow: auto;
        padding: 5px;
        margin: 5px;
      }
    </style>

    <div>
      <content>
      </content>
    </div>

  </template>

  <script>
      Polymer({
        is: 'pebble-popover',

        properties: {          

          /*
          *  Indicates the target for popover to display.
          */

           for: {
             type: String,
             value: null
           },

           /*
           *  Indicates the "vertical" alignment of the popover. 
           *  If <b>value</b> is selected as "top", then popover is aligned above the target.  
           *  If <b>value</b> is selected as "below", then popover is aligned below the target.
           */

           verticalAlign: {
             type: String,
             value: "top"
           },

           /*
           *  Indicates the "horizontal" alignment of the popover. 
           *  If <b>value</b> is selected as "left", then popover is aligned to the left of the target.  
           *  If <b>value</b> is selected as "below", then popover is aligned to the right of the target.
           */

           horizontalAlign: {
             type: String,
             value: "left"
           },

           /*
           *  Specifies the popover not to overlap with target.
           */
           noOverlap: {
             type: Boolean,
             value: false
           }
        },

        
        behaviors: [
          Polymer.IronOverlayBehavior
          //Polymer.IronFitBehavior //IronFitBehavior is under IronOverlayBehavior, so no need to mention here
        ],

        attached: function(){
            window.addEventListener('scroll', this._fixPopoverOnScrollAndResize);
            window.addEventListener('resize', this._fixPopoverOnScrollAndResize);
        },

        _fixPopoverOnScrollAndResize: function() {
              //looped for multiple popovers on same window       
              var popoversList = document.querySelectorAll('pebble-popover');
              popoversList.forEach(function(popover){
                    if(popover.opened)
                    {
                      popover._refitPopover();
                    }
              });
          },

        
        /*
        *  Can be used to display the popover.
        */
        show : function() {
            this.open(); //IronOverlayBehavior to displat popover

            var scope = Polymer.dom(this).getOwnerRoot();
            var target = Polymer.dom(scope).querySelector('#' + this.for);            
            this.positionTarget = target;

            this._updateAlign();
          },

          /*
          *  Can be used to hide the popover.
         */

          hide: function() {            
            this.close();
          },

          /*
          *  Can be used to update an alignment based on the properties.
          */

          _updateAlign: function(e) {
            var scope = Polymer.dom(this).getOwnerRoot();         
            this.horizontalAlign = this.horizontalAlign;
            this.verticalAlign = this.verticalAlign;
            this.noOverlap = this.noOverlap;            
            this._refitPopover();
          },

          /*
          *  Can be used to reset the position of the popover.
          */

          _refitPopover: function() {
              var scope = Polymer.dom(this).getOwnerRoot();              
              this.refit();
          }
      });
  </script>

</dom-module>