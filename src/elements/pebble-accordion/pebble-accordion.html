<link rel="import" href="../../../bower_components/polymer/polymer.html">
<link rel="import" href="../../../bower_components/paper-card/paper-card.html">
<link rel="import" href="../../../bower_components/paper-ripple/paper-ripple.html">
<link rel="import" href="../../../bower_components/iron-icon/iron-icon.html">
<link rel="import" href="../../../bower_components/iron-icons/iron-icons.html">
<link rel="import" href="../../../bower_components/iron-flex-layout/iron-flex-layout.html">
<link rel="import" href="../pebble-styles-shared/pebble-styles-shared.html">

<!--
`pebble-accordion` Represents an element that creates a collapsible block of content. The content is shown after the text is clicked in the header. 
In addition to this, an icon for the collapsed status may be setup which contains any component or content that can be shown or hidden.
    <pebble-accordion header="Please click me" default-icon="expand-less" open-icon="expand-more">...</pebble-accordion>
	
By default, the collapsed block disappears after clicking on the header text again.
    
The accordion element provides some custom CSS properties for styling the element.

Custom property | Description | Default
----------------|-------------|----------
`--accordion-header` | mixin for the header | `{}`
`--accordion-header-text` | mixin for the header text | `{}`
`--accordion-header-ripple-color` | sets the color of the ripple | `#4285f4`
`--accordion-duration` | Transition duration time which defines how long the transition takes | `300ms`


@demo demo/index.html
@element pebble-accordion
-->

<dom-module id="pebble-accordion">
	<template>
		<style is="custom-style" include="pebble-styles-shared">
            .accordion-content-wrapper{
                transition-property: height;
                -webkit-transition-property: height; /* Safari */
                transition-duration: var(--accordion-duration,300ms);
                -webkit-transition-duration: var(--accordion-duration,300ms);; /* Safari */
                overflow: hidden;
                display:block;
                box-shadow: 0 0 0 0;
            }

            .header{       
                width: 100%;  
                background-color: var(--accordion-header-bg, #ffffff);
                height: 32px;
                border-top: 1px solid var(--default-border-color,#c1cad4);
                border-bottom: 1px solid var(--default-border-color,#c1cad4);
                box-shadow: 0 0 0 0;
            }
            .header-text{
                display: inline-block !important;
                width: 100%;
                text-align: left;
                @apply(--layout-horizontal);
                font-weight: var(--font-bold, bold);
                height: 30px;
                padding-top: 5px;
            }

            .header-text a {
                text-decoration: none;
                color:  var(--text-primary-color,#1a2028);
                display: inline-block;
                @apply(--accordion-header-text);
                vertical-align: top;
                padding-top: 6px;   
            }	

            .header-text iron-icon{
                cursor: pointer;
                float: right;
                padding-right: 0px;
                margin-right: 5px;
                margin-top: 0px;
            }

            .header-items-space{
                padding-left: 5px;
            }

            paper-ripple {
                color: var(--accordion-header-ripple-color, #4285f4);
            }

            .container{
                display: block;
                width:100%;
            }

            paper-card {
                --paper-card-actions: {
                    padding: 0px;
                }
            }

            .inline {
                display: inline-block;
                vertical-align: middle;
                padding-top:3px;
            }
            .card-actions{
                border-top:none !important;
            }
            #open_link{		
                color:var(--dark-title-color,#1a2028);
                vertical-align: middle;	
            }
            
	</style>
    <div id="paper-accordion-container">
	<paper-card class="header">
     <div>
        <paper-ripple recenters></paper-ripple>
         <div class="header-text">
             <div class="inline">
                <slot select=".header-content"></slot>
             </div>
            <a href="#" id="open_link" class="p-b-15" hidden$=[[!headerText]]>[[headerText]]</a>
            <iron-icon hidden$=[[!defaultIcon]] icon="pebble-xs-icons:Expand" id="accordion_icon"></iron-icon>
         </div>
     </div>
    </paper-card>
    <paper-card class="accordion-content-wrapper" id="accordion_content_container" >
    <div class="card-actions" >    
        <slot id="cont"></slot>
    </div>
    </paper-card>
    </div>
    
	</template>
	<script>
		Polymer({
			is:"pebble-accordion",
            properties:{
                /*
                *  
                * @attribute header-Text
                */
                headerText:{
                    type:String,
                    value:''
                },
                
                /*
                * Specifies whether or not to pass the expected icon. An expected icon is passed if the header contains an icon.
                * Note that only the icons of the iron-icons set are supported.
                * @attribute default-Icon
                */
                defaultIcon:{
                    type:String,
                    value:''
                },
                
                /*
                * Indicates an Icon which is displayed if an accordion is collapsed.
                * @attribute open-Icon
                */
                openIcon:{
                    type:String,
                    value:''
                },

                /*
                * Specifies whether or not the text block is collapsed.
                * @property isCollapsed
                */
                isCollapsed:{
                    type:Boolean,
                    value:false,
                    notify:true,
                    observer:'_collapseChanged'
                }
            }, 	
            listeners:{
                /*
			     * registration of the onClick event handler which is used to show or disappear the content
			     */
                'open_link.click':'_onOpenClick',
                /*
			     * registration of the CSS event transitioned. It is required for computing the correct height of a content container. 
			     */
                'transitionend':'_transitionEnd',
                /*
                * registration of the onClick event handler of the icon
                */
                'accordion_icon.click':'_onOpenClick'
                
            },
            hostAttributes:{
			/*
             * tag attribute which can be used to identify if the content is collapsed or not
             * @attribute content-collpased
             */
            'content-collapsed':'false'	
		    },
            
            /*
            * init height property
            */
            attached:function(){
                this._SetItemHeight('auto'); 
                this._ChangeIcon();
                this.isCollapsed = true;
            },
            
            _computeIfSpaceNeeded: function(headerText, iconValue, openIconValue){
                var classValue='header-items-space';
                if(!headerText && ! iconValue && ! openIconValue)
                { 
                    return null;
                }
                
                if(headerText && iconValue)
                { 
                    return classValue;
                }
                
                if(headerText && openIconValue)
                {
                     return classValue;
                }
            },          

            _onOpenClick: function (e) {
                if (this.isCollapsed) {
                    this.hideContainer();
                } else {
                    /*
                    * Fires an additional event which is handled by the element accordion-container if the accordion element is surrounded by the container element.
                    */
                    this.fire('opening');
                    this.showContainer();
                }
            },

            _transitionEnd:function(e){
                if(this.isCollapsed){
                        this._SetItemHeight('auto');
                        this._EnableTransitionDuration(false);
                        this.updateStyles();                           
                    }else{
                        this._EnableTransitionDuration(false);
                      }
            },
        
            /*
            * Can be used to show the content.
            * @method showContainer
            */
            showContainer:function(){
                if(this.isCollapsed)
                {
                    return;
                }
                this.isCollapsed=true; 
                this._SetItemHeight('auto');
                var calculatedValue = this._CalculateItemHeight();
                this._SetItemHeight('0px');
                this._SetOffsetHeight();
                this._EnableTransitionDuration(true);
                this._SetItemHeight(calculatedValue);
                this._ChangeIcon();                   
            },
            /*
            * Can be used to hide the content.
            * @method hideContainer
            */
            hideContainer:function(){
                if(!this.isCollapsed)
                {
                    return;
                }
                this.isCollapsed=false; 
                var calculatedHeight = this._CalculateItemHeight();
                this._SetItemHeight(calculatedHeight);
                this._EnableTransitionDuration(true);
                this._SetOffsetHeight();
                this._SetItemHeight('0px');
                this._ChangeIcon(); 
            },
            
            _collapseChanged:function(){
                this.setAttribute('content-collapsed',this.isCollapsed);	
            },
            _CalculateItemHeight:function(){
                return this.$.accordion_content_container.getBoundingClientRect()['height']+'px';
            },
            _GetCurrentItemHeight:function(){
                return this.$.accordion_content_container.style['height'];
            },
            _EnableTransitionDuration:function(shouldBeActivated){
                this.$.accordion_content_container.style.transitionDuration = (shouldBeActivated ? '':'0s');
            },
            _SetItemHeight:function(size){
                this.$.accordion_content_container.style['height'] = size;
            },
            _SetDisplay:function(displayValue){
                this.$.accordion_content_container.style['display']=displayValue;
            },
            _SetOffsetHeight:function(){
                this.$.accordion_content_container.offsetHeight = this.$.accordion_content_container.offsetHeight;
            },
            _ChangeIcon:function(){
                if(!this.defaultIcon || !this.openIcon)return;
                this.$.accordion_icon.icon = (this.isCollapsed) ? this.openIcon : this.defaultIcon;                 
            }	
		});
	</script>
	
</dom-module>