<link rel="import" href="../../../bower_components/polymer/polymer.html">
<link rel="import" href="../../../bower_components/shadycss/apply-shim.html">
<link rel="import" href="../../../bower_components/paper-card/paper-card.html">
<link rel="import" href="../../../bower_components/paper-ripple/paper-ripple.html">
<link rel="import" href="../../../bower_components/iron-flex-layout/iron-flex-layout.html">

<link rel="import" href="../bedrock-style-manager/styles/bedrock-style-common.html">
<link rel="import" href="../bedrock-style-manager/styles/bedrock-styles-scroll-bar.html"/>


<!--
`pebble-accordion` Represents an element that creates a collapsible block of contents. The contents are shown after the text is clicked on the header. 
In addition to this, you can setup an icon for the collapsed status that contains any component or contents that you can either show or hide.
    
    <pebble-accordion header="Please click me" default-icon="expand-less" open-icon="expand-more">...</pebble-accordion>
	
By default, the collapsed block disappears after you click on the header text again.
    
The accordion element provides some custom CSS properties for styling the element.

Custom property | Description | Default
----------------|-------------|----------
`--accordion-header` | mixin for the header | `{}`
`--accordion-header-text` | mixin for the header text | `{}`
`--accordion-header-ripple-color` | sets the color of the ripple | `#4285f4`
`--accordion-duration` | Transition duration time which defines how long the transition takes | `300ms`


@demo demo/index.html
@element pebble-accordion
-->

<dom-module id="pebble-accordion">
	<template>
		<style  include="bedrock-style-common bedrock-styles-scroll-bar">
            :host{
                display:block;
                height:100%;
            }
            .accordion-content-wrapper{
                transition-property: height;
                -webkit-transition-property: height;
                transition-duration: var(--accordion-duration,300ms);
                -webkit-transition-duration: var(--accordion-duration,300ms);
                overflow: hidden;
                display:block;
                height:100% !important;
                box-shadow: 0 0 0 0;
                padding-top: 10px;
            }
            .header{
                width: 100%;
                background-color: var(--palette-pale-grey-four, #eff4f8);    
                border: none;
                box-shadow: none;
                height: 40px;
                @apply --accordion-header;

            }
            .header-text{
                width: 100%;
                text-align: left;
                font-weight: var(--font-bold, bold);
                display: flex;
                align-items: center;
                height: 40px;
                @apply --accordion-header-text;
            }

            .header-text a {
                text-decoration: none;
                color:  var(--text-primary-color,#1a2028);
                @apply --accordion-header-text;
            }

            .header-items-space{
                padding-left: 5px;
                @apply --accordion-header-items-space;
            }

            paper-ripple {
                color: var(--accordion-header-ripple-color, #4285f4);
            }

            .container{
                display: block;
                width:100%;
            }

            paper-card {
                --paper-card-actions: {
                    padding-top: 0px;
                    padding-right: 0px;
                    padding-bottom: 0px;
                    padding-left: 0px;

                };
            }

            .inline {
                display: inline-block;
                vertical-align: middle;
                padding-top:4px;
            }
            .card-actions{
                height:100%;
                border-top:none !important;
                @apply --accordion-card-actions;
            }
            #open_link{
                color:var(--dark-title-color,#1a2028);
                vertical-align: middle;
            }
            #paper-accordion-container .header{
                border-top: 0px;
                border-bottom: 0px;
            }
             pebble-accordion pebble-lov {
                 box-shadow: none;
             }

	</style>
        <div id="paper-accordion-container" class="base-grid-structure">
            <div class="base-grid-structure-child-1">
                <div class="header">
                    <div>
                        <paper-ripple recenters></paper-ripple>
                        <div class="header-text">
                            <div class="inline">
                                <slot name="header-content"></slot>
                            </div>
                            <pebble-icon hidden$=[[!defaultIcon]] icon="pebble-icon:action-scope-take-selection" class="pebble-icon-size-16 m-r-10 m-l-10" id="accordion_icon"
                            on-tap="_onOpenClick"></pebble-icon>
                            <a href="#" id="open_link" hidden$=[[!headerText]] on-tap="_onOpenClick">[[headerText]]</a>
                            <slot name="header-actions"></slot>                        
                        </div>
                    </div>
                </div>
            </div>
            <div class="base-grid-structure-child-2">
            <div class="accordion-content-wrapper" id="accordion_content_container">
                <div class="card-actions">
                    <slot id="cont" name="accordion-content"></slot>
                </div>
            </div>
            </div>
        </div>
    
	</template>
	<script>
		Polymer({
			is:"pebble-accordion",
            properties:{
                /*
                *  
                * @attribute header-Text
                * <b><i>Content development is under progress... </b></i> 
                */
                headerText:{
                    type:String,
                    value:''
                },
                
                /*
                * Specifies whether or not to pass the expected icon. An expected icon is passed if the header contains an icon.
                * Note that only the icons of the `pebble-icon` set are supported.
                * @attribute default-Icon
                */
                defaultIcon:{
                    type:String,
                    value:''
                },
                
                /*
                * Indicates an icon which is displayed if an accordion is collapsed.
                * @attribute open-Icon
                */
                openIcon:{
                    type:String,
                    value:''
                },

                /*
                * Specifies whether or not the text block is collapsed.
                * @property isCollapsed
                */
                isCollapsed:{
                    type:Boolean,
                    value:false,
                    notify:true,
                    observer:'_collapseChanged'
                }
            }, 	
            listeners:{
                /*
			     * registration of the CSS event transitioned. It is required for computing the correct height of a content container. 
			     */
                'transitionend':'_transitionEnd'
            },
            hostAttributes:{
			/*
             * tag attribute which can be used to identify if the content is collapsed or not
             * @attribute content-collpased
             */
            'content-collapsed':'false'	
		    },
            
            /*
            * init height property
            */
            attached:function(){
                this._setDisplay();
                this._transitionEnd();
            },
            
            _computeIfSpaceNeeded: function(headerText, iconValue, openIconValue){
                var classValue='header-items-space';
                if(!headerText && ! iconValue && ! openIconValue)
                { 
                    return null;
                }
                
                if(headerText && iconValue)
                { 
                    return classValue;
                }
                
                if(headerText && openIconValue)
                {
                     return classValue;
                }
            },          

            _onOpenClick: function (e) {
               this.toggle();
            },
            toggle:function () {
                this.isCollapsed=!this.isCollapsed;
                this._setDisplay();
            },
            _setDisplay:function () {
                if (this.isCollapsed) {
                    this.hideContainer();
                } else {
                    /*
                    * Fires an additional event which is handled by the element accordion-container if the accordion element is surrounded by the container element.
                    */
                    this.dispatchEvent(new CustomEvent('opening',{bubbles:true,composed:true}));
                    this.showContainer();
                }
            },
            _transitionEnd:function(e){
                if(!this.isCollapsed){
                        this._SetItemHeight('auto');
                        this._EnableTransitionDuration(false);
                        this.updateStyles();                           
                    }else{
                        this._EnableTransitionDuration(false);
                      }
                this.dispatchEvent(new CustomEvent("accordion-transition-end", { detail:{"isCollapsed": this.isCollapsed, "accordion": this}, bubbles:true,composed:true}));
            },
        
            /*
            * Can be used to show the contents.
            * @method showContainer
            */
            showContainer:function(){
                this.isCollapsed=false;
                this._SetItemHeight('auto');
                var calculatedValue = this._CalculateItemHeight();
                this._SetItemHeight('0px');
                this._SetOffsetHeight();
                this._EnableTransitionDuration(true);
                this._SetItemHeight(calculatedValue);
                this._ChangeIcon();                   
            },
            /*
            * Can be used to hide the contents.
            * @method hideContainer
            */
            hideContainer:function(){
                this.isCollapsed=true;
                var calculatedHeight = this._CalculateItemHeight();
                this._SetItemHeight(calculatedHeight);
                this._EnableTransitionDuration(true);
                this._SetOffsetHeight();
                this._SetItemHeight('0px');
                this._ChangeIcon(); 
            },
            
            _collapseChanged:function(){
                this.setAttribute('content-collapsed',this.isCollapsed);
            },
            _CalculateItemHeight:function(){
                return this.$.accordion_content_container.getBoundingClientRect()['height']+'px';
            },
            _GetCurrentItemHeight:function(){
                return this.$.accordion_content_container.style['height'];
            },
            _EnableTransitionDuration:function(shouldBeActivated){
                this.$.accordion_content_container.style.transitionDuration = (shouldBeActivated ? '':'0s');
            },
            _SetItemHeight:function(size){
                this.$.accordion_content_container.style['height'] = size;
            },
            _SetDisplay:function(displayValue){
                this.$.accordion_content_container.style['display']=displayValue;
            },
            _SetOffsetHeight:function(){
                this.$.accordion_content_container.offsetHeight = this.$.accordion_content_container.offsetHeight;
            },
            _ChangeIcon:function(){
                if(!this.defaultIcon || !this.openIcon)return;
                this.$.accordion_icon.icon = (this.isCollapsed) ? this.defaultIcon : this.openIcon;
            }	
		});
	</script>
	
</dom-module>