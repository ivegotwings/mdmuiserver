<link rel="import" href="../../../bower_components/polymer/polymer.html">

<link rel="import" href="../bedrock-ui-behavior/bedrock-ui-behavior.html">
<link rel="import" href="../bedrock-component-context-behavior/bedrock-component-context-behavior.html">

<link rel="import" href="../pebble-styles-shared/pebble-styles-shared.html">

<link rel="import" href="../rock-grid/rock-grid.html">

<dom-module id="rock-attribute-grid">
    <template>
        <style is="custom-style" include="pebble-styles-shared">
        
        </style>
        <rock-grid id="attributesGrid" config="[[_gridConfig]]" data="[[_gridData]]" no-header page-size="5"></rock-grid>
    </template>
    <script>
        (function() {
            'use strict';

            Polymer({
                is: "rock-attribute-grid",

                properties: {
                    contextData: {
                        type: Object,
                        value: function() {
                            return {};
                        }
                    },
                    /**
                     * Indicates whether the attribute is rendered in edit mode or view mode.
                     * The two possible values are <b>view</b> and <b>edit</b>.
                     */
                    mode: {
                        type: String,
                        value: "view",
                        notify: true
                    },
                    /**
                    * Indicates the JSON for the attribute value object. This object records all the user changes to the value.
                    * Sample: {
                                "value":"Nivea Creme 400 Ml"
                              }
                    */
                    attributeObject: {
                        type: Object,
                        value: function() {
                            return {};
                        },
                        notify: true
                    },
                    /**
                    * Indicates the JSON for the original attribute value object. This object does not record all the user changes to the value.
                    * Sample: {
                                "value":"Nivea Creme 400 Ml"
                              }
                    */
                    originalAttributeObject: {
                        type: Object,
                        value: function() {
                            return {};
                        }
                    },
                    /**
                    * Indicates the JSON for the attribute model object.
                    * It renders appropriate UI element to edit the attribute, to configure the validation, and other behaviors.
                    * Sample: {
                                "name": "name",
                                "externalName": "Name",
                                "displayType": "textbox",
                                "minLength": 5,
                                "maxLength": 10
                              }
                    */
                    attributeModelObject: {
                        type: Object,
                        value: function() {
                            return {};
                        }
                    },
                    /**
                     * Indicates whether or not an attribute object value is changed.
                     */
                    changed: {
                        type: Boolean,
                        value: false,
                        notify: true,
                        reflectToAttribute: true
                    },
                    _gridConfig: {
                        type: Object,
                        value: function () {
                            return {
                                "viewMode": "Tabular",
                                "readOnly": true,
                                "tabular": {
                                    "settings": {
                                        "isMultiSelect": false
                                    },
                                    "columns": [
                                        {
                                            "header": "Attribute Name",
                                            "name": "attributeName"
                                        },
                                        {
                                            "header": "Value",
                                            "name": "attributeValue"
                                        }
                                    ]
                                }
                            };
                        }
                    },
                    _gridData: {
                        type: Array,
                        value: function () {
                            return [];
                        }
                    },
                },
                behaviors: [
                    RUFBehaviors.UIBehavior,
                    RUFBehaviors.ComponentContextBehavior
                ],
                observers: [
                    '_attributeModelObjectChanged(attributeModelObject)'
                ],
                _attributeModelObjectChanged: function() {
                    this._prepareGridData(this.attributeModelObject);
                },
                _prepareGridData: function(attributeModelObject) {
                    this._gridData = [];
                    var attributesGrid = this.$$("#attributesGrid");
                    attributesGrid.attributeModels = {};
                    if(attributeModelObject && attributeModelObject.data && attributeModelObject.data.attributes) {
                        var keys = Object.keys(attributeModelObject.data.attributes);
                        if(keys && keys.length > 0) {
                            for(var i=0; i<keys.length; i++) {
                                var attributeName = keys[i];
                                var attributeValue = attributeModelObject.data.attributes[attributeName].value;
                                var colData = {
                                    "attributeName": attributeName,
                                    "attributeValue": attributeValue
                                };
                                this._gridData.push(colData);
                            }
                        }
                    }
                }
            });
        })();
    </script>
</dom-module>