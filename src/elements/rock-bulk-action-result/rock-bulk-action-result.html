<link rel="import" href="../../../bower_components/polymer/polymer.html">

<link rel="import" href="../bedrock-ui-behavior/bedrock-ui-behavior.html">
<link rel="import" href="../bedrock-component-context-behavior/bedrock-component-context-behavior.html">
<link rel="import" href="../bedrock-helpers/component-helper.html">

<link rel="import" href="../pebble-data-table/pebble-data-table.html">
<link rel="import" href="../pebble-button/pebble-button.html">
<link rel="import" href="../pebble-styles-shared/pebble-styles-shared.html">
<!--
<b><i>Content development is under progress... </b></i>

@demo demo/index.html
-->
<dom-module id="rock-bulk-action-result">
    <template>
        <style include="pebble-styles-shared">
            :host {
                padding-top: 20px;
            }
            #grid-container {
                padding-top: 20px;
                padding-bottom: 20px;
            }
            #user-actions {
                padding-top: 20px;
                padding-bottom: 20px;
            }            
        </style>
        <style is="custom-style">
             pebble-data-table {
				--iron-data-table-header: {
					height: 45px;
				}
				--iron-data-table-row-odd: {
					background-color: var(--secondary-button-color, #ffffff);
				}
                --iron-data-table-row: {                    
                    align-items: center;
                }
                --iron-data-table: {
                    height: 275px;
                }
			}
			
			pebble-data-table[loading] {
				pointer-events: none;
			}
			
			pebble-data-table data-table-row[header],
			pebble-data-table data-table-row[header] /deep/ label {
				font-weight: var(--font-bold, bold);
				color: var(--palette-cerulean, #036bc3);
				border-bottom: none;
				text-transform: uppercase;
				font-size: var(--table-head-font-size, 11px);
			}
			
			pebble-data-table data-table-row:not([header]) {
				color: var(--palette-dark, #1a2028);
				font-size: var(--default-font-size, 12px);
				height: 100%;
				background-color: var(--palette-white, #ffffff);
			}
			
			pebble-data-table data-table-row:not([header]):hover,
			data-table-row[selected] {
				background-color: var(--table-row-selected-color, #c1cad4) !important;
			}
			
			pebble-data-table data-table-row:not([header]):hover data-table-checkbox,
			data-table-row[selected] data-table-checkbox {
				background-color: var(--palette-white, #ffffff) !important;
			}
			
			pebble-data-table data-table-row[header] /deep/ paper-icon-button:not([direction]) {
				opacity: 0.7 !important;
			}
            pebble-data-table data-table-row data-table-cell {
                padding: 0 0 0 2px !important;
                justify-content: center;
                height: 80px;
                overflow: auto;
            }
            #inputDiv {
                width:250px;
                border-bottom: 1px solid #d2d8de;
                height: 42px;         
            }
            .attributes-span .context-span {
                line-height: 56px;
            }  
            #iconDiv {
                align-self: flex-end;
                -webkit-align-self: flex-end;
                padding-bottom: 5px;
                margin-left: -20px; 
                cursor: pointer;
            }
            .dropdown-icon {
                --pebble-icon-height: 10px !important;
                --pebble-icon-width: 10px !important;
            }
            .actionButton {
				margin-right: var(--default-margin, 10px);
			}
        </style>
        <template is="dom-if" if="[[!_noGrid]]">
            <div id="grid-container">
                <pebble-data-table id="mapping-grid" items="[[_gridData]]">
                    <template is="dom-repeat" items="[[_gridColumns]]" as="column">
                        <data-table-column name="[[column]]">
                            <template>[[_itemValue(item, column)]]</template>
                        </data-table-column>
                    </template>                
                </pebble-data-table>
            </div>
        </template>
        <template is="dom-if" if="[[_noGrid]]">
            <div align="center">[[message]]</div>
        </template>
        <div id="user-actions" align="center">
            <template is="dom-repeat" items="[[businessFunctionData.actions]]" as="action">
                <pebble-button class="action-button-focus dropdownText btn btn-success m-r-5" icon="pebble-md-icons:actions" button-text="[[action.text]]" data="[[action]]" on-tap="_onActionTap"></pebble-button>
            </template>
        </div>
    </template>
    <script>
        (function() {
            'use strict';

            Polymer({
                is: "rock-bulk-action-result",

                properties: {
          /**
            * <b><i>Content development is under progress... </b></i> 
            */
                    businessFunctionData: {
                        type: Object,
                        value: function() { return {}; }
                    },

                    _gridColumns: {
                        type: Array,
                        value: function() {
                            return [];
                        }
                    },

                    _gridData: {
                        type: Array,
                        value: function() {
                            return [];
                        }
                    },

                    _noGrid: {
                        type: Boolean,
                        value: false
                    }
                },                
                
                behaviors: [
                    RUFBehaviors.UIBehavior,
                    RUFBehaviors.ComponentContextBehavior
                ],

                observers: [
                    'onBusinessFunctionChange(businessFunctionData.messages)'
                ],

                _itemValue: function(item, column) {
                    return item[column.name];
                },
          /**
            * <b><i>Content development is under progress... </b></i> 
            */
                onBusinessFunctionChange: function() {
                    if(!_.isEmpty(this.businessFunctionData)) {
                        
                        if(this.businessFunctionData.noGrid) {
                            this._noGrid = this.businessFunctionData.noGrid;
                        }

                        if(!this._noGrid) {
                            if(this.businessFunctionData.messages)
                            {
                                var gridColumns = [];
                                var message = this.businessFunctionData.messages[0];

                                for (var key in message) {
                                    gridColumns.push(key);
                                }

                                //Set the columns and data
                                this._gridColumns = gridColumns;                        
                                this._gridData = this.businessFunctionData.messages;
                            }
                        }
                        else {
                            if(this.businessFunctionData.message) {
                                this.message = this.businessFunctionData.message;
                            }
                        }
                    }                    
                },

                _onActionTap: function(e) {                    
                    if(e && e.currentTarget && e.currentTarget.data) {
                        var actionData = e.currentTarget.data;
                        
                        if(actionData.isNotApp) {
                            this.fire("last-step-completed");
                        }
                        else {
                            ComponentHelper.closeCurrentApp();
                        }

                        if(actionData.dataRoute && actionData.dataRoute != "") {
                            var mainApp = document.querySelector("main-app");
                            if(actionData.queryParams) {
                                ComponentHelper.setQueryParamsWithoutEncode(actionData.queryParams);
                            } else  {
                                ComponentHelper.setQueryParamsWithoutEncode({});
                            }
                            
                            mainApp.changePageRoutePath(actionData.dataRoute);   
                        }
                    }
                }
            });
        })();
    </script>
</dom-module>