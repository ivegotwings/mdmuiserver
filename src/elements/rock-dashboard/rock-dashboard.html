<link rel="import" href="../rock-elements/rock-elements.html">
<dom-module id="rock-dashboard">
  <template>
    <style include="shared-styles">

      #widget-panel>div {
        float: left;
        width: 48%;
        margin-right: 1%
      }

      #widget-panel {
        padding: 12px;
      }
      
    </style>
    <div id="widget-panel"></div>
    <iron-ajax auto url="../../data/dashboard-widgets.json" handle-as="json" last-response="{{widgets}}"></iron-ajax>
  </template>
  <script>
    (function() {
      'use strict';

      Polymer({
          is: 'rock-dashboard',
          properties: {
            widgets: {
              type: Object,
              value: function () { 
                return {}; 
              },
              observer: "loadWidgets"
            }
          },
          loadWidgets: function() {
            var widgets = this.widgets;

            if(widgets)
            {
              for(var i = 0; i < widgets.length; i++) {
                if(widgets[i]) {
                  var widget = document.createElement("rock-widget");

                  widget.setAttribute("id", widgets[i].name);

                  widget.setAttribute("icon-buttons", widgets[i].iconButtons);

                  if (widgets[i].nonClosable) {
                    widget.setAttribute("non-closable", "non-closable");
                  }

                  if (widgets[i].nonMaximizable) {
                    widget.setAttribute("non-maximizable", "non-maximizable");
                  }

                  if (widgets[i].nonDraggable) {
                    widget.setAttribute("non-draggable", "non-draggable");
                  }

                  widget.setAttribute("config", JSON.stringify(widgets[i].config));

                  var divElement = document.createElement("div");
                  divElement.append(widget);

                  this.$$("#widget-panel").append(divElement);
                }
              }
            }
          }
      });
    })();
  </script>
</dom-module>