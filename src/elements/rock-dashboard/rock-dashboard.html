<link rel="import" href="../rock-elements/rock-elements.html">
<dom-module id="rock-dashboard">
  <template>
    <style include="shared-styles"></style>
    <div id="widget-panel"></div>
    <iron-ajax auto url="../../data/dashboard-widgets.json" handle-as="json" last-response="{{widgets}}"></iron-ajax>
  </template>
  <script>
    (function() {
      'use strict';

      Polymer({
          is: 'rock-dashboard',
          properties: {
            widgets: {
              type: Object,
              value: function () { 
                return {}; 
              },
              observer: "loadWidgets"
            }
          },
          loadWidgets: function() {
            var widgets = this.widgets;

            if(widgets)
            {
              for(var i = 0; i < widgets.length; i++) {
                if(widgets[i]) {
                  var widget = document.createElement("rock-widget");

                  widget.setAttribute("id", widgets[i].name);
                  widget.setAttribute("icon-buttons", widgets[i].iconButtons);
                  widget.setAttribute("non-maximizable", widgets[i].nonMaximizable);
                  widget.setAttribute("non-closable", widgets[i].nonClosable);
                  widget.setAttribute("non-draggable", widgets[i].nonDraggable);

                  widget.setAttribute("config", JSON.stringify(widgets[i].config));

                  this.$$("#widget-panel").append(widget);
                }
              }
            }
          }
      });
    })();
  </script>
</dom-module>