<link rel="import" href="../../../bower_components/polymer/polymer.html">
<link rel="import" href="../liquid-base-behavior/liquid-base-behavior.html">
<link rel="import" href="../liquid-entity-model-get/liquid-entity-model-get.html">

<!--
`liquid-entity-model-composite-get`
Boolean control

@demo demo/index.html 
-->
<dom-module id="liquid-entity-model-composite-get">
    <template>
        <liquid-entity-model-get id="liquidEntityModelGet" $verbose="[[verbose]]" operation="getbyids" on-response="_onResponse"
            on-error="_onError"></liquid-entity-model-get>
    </template>
    <script>
        (function () {
            'use strict';

            Polymer({
                is: 'liquid-entity-model-composite-get',
                behaviors: [RUFBehaviors.LiquidBaseBehavior],
                attached: function () {
                },
                ready: function () {
                },
                properties: {
                    dataIndex: {
                        type: String,
                        value: 'entityModel'
                    },
                    liquidEntityModelGet: {
                        type: Object,
                        value: function () {
                            return this.$$('#liquidEntityModelGet');
                        }
                    }
                },
                generateRequest: function () {
                    if (!this._validate(this.requestData)) {
                        return;
                    }
                    
                    var internalRequestData = this.requestData;

                    if (internalRequestData.params && internalRequestData.params.query) {
                        var query = internalRequestData.params.query;
                        
                        if (query.valueContexts) {
                            delete query.valueContexts;
                        }

                        if (!query.contexts) {
                            query.contexts = [];
                        }

                        if (query.locale) {
                            var localeCtx = { "locale": query.locale };
                            this.localeCtx = localeCtx;
                            query.contexts.push(localeCtx);
                        }
                        if (!query.filters) {
                            query.filters = {};
                        }

                        query.filters.typesCriterion = ['entityCompositeModel'];
                    }

                    var liqModelGet = this.liquidEntityModelGet;

                    liqModelGet.requestData = internalRequestData;
                    liqModelGet.bubbles = false;
                    liqModelGet.generateRequest();
                },
                _validate: function (reqData) {
                    return true;
                },
                _onResponse: function (e) {
                    var eventDetail = e.detail;
                    this.fire('entity-model-composite-get-response', eventDetail, { bubbles: this.bubbles });
                    this.fire('liquid-entity-model-composite-get-response', eventDetail, { bubbles: this.bubbles });
                },
                _onError: function (e) {
                    var eventDetail = e.detail;
                    this.fire('error', eventDetail, { bubbles: this.bubbles });
                    this.fire('liquid-error', eventDetail, { bubbles: this.bubbles });
                }
            });
        })();
    </script>
</dom-module>