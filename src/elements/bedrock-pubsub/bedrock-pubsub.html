<link rel="import" href="../../../bower_components/polymer/polymer.html">

<script>
(function(){
/**
@demo demo/index.html
*/
  Polymer({
    is: 'bedrock-pubsub',

    attached: function() {
      pubsubInstances.push(this);
    },
    detached: function() {
      var i = pubsubInstances.indexOf(this);
      if (i >= 0) {
        pubsubInstances.splice(i, 1);
      }
    }
  });

  //pubsub instance storage
  var pubsubInstances = [];

  // event dispatcher
  function publish(name, data) {
    var rufEevent = new CustomEvent('bedrock-event-' + name, {
      bubbles: false,
      detail: data
    });
    // dispatch named-event to all pubsubInstances
    pubsubInstances.forEach(function(s) {
      s.dispatchEvent(rufEevent);
    });
  }

  // signal listener at document
  document.addEventListener('bedrock-event', function(e) {
    publish(e.detail.name, e.detail.data);
  });

})();
</script>
