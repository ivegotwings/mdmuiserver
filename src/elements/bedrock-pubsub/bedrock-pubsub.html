<link rel="import" href="../../../bower_components/polymer/polymer.html">

<script>
(function(){
/**
`bedrock-pubsub` Represents the basic publish-subscribe functionality.

To send a signal, fire a custom event of type `bedrock-event`, with
a detail object containing `name` and `data` fields.

    this.fire('bedrock-event', {name: 'hello', data: null});

To receive a signal, listen for `bedrock-event-<name>` event on a
`bedrock-pubsub` element.

  <bedrock-pubsub on-bedrock-event-hello="{{helloSignal}}">

You can fire a signal event from anywhere, and all
`bedrock-pubsub` elements will receive the event, regardless
of where they are in DOM.

@demo demo/index.html
*/
  Polymer({
    is: 'bedrock-pubsub',

    attached: function() {
      pubsubInstances.push(this);
    },
    detached: function() {
      var i = pubsubInstances.indexOf(this);
      if (i >= 0) {
        pubsubInstances.splice(i, 1);
      }
    }
  });

  //pubsub instance storage
  var pubsubInstances = [];

  // event dispatcher
  function publish(name, data) {
    var rufEevent = new CustomEvent('bedrock-event-' + name, {
      bubbles: false,
      detail: data
    });
    // dispatch named-event to all pubsubInstances
    pubsubInstances.forEach(function(s) {
      s.dispatchEvent(rufEevent);
    });
  }

  // signal listener at document
  document.addEventListener('bedrock-event', function(e) {
    publish(e.detail.name, e.detail.data);
  });

})();
</script>
