<link rel="import" href="../../../bower_components/polymer/polymer.html">
<link rel="import" href="../../../bower_components/iron-flex-layout/iron-flex-layout.html">
<link rel="import" href="../../../bower_components/iron-input/iron-input.html">

<link rel="import" href="../pebble-button/pebble-button.html">
<link rel="import" href="../bedrock-ui-behavior/bedrock-ui-behavior.html">

<!--
`rock-search-bar`
Represents a single line text box for the user to enter text.

@demo demo/index.html
-->

<dom-module id="rock-search-bar">
    <template>
        <style include="pebble-styles-shared"></style>
        <style>
			:host {
				@apply(--layout-horizontal);
				@apply(--layout-center);
		        border:1px solid #9b9b9b;
		        border-radius: 3px;
                overflow: hidden;
			}

			.input-panel {
				width: 100%;
				@apply(--layout-horizontal);
				@apply(--layout-center);
			}
			#input {
			    margin: 0 10px;             
				border: 0;
				outline: 0;
				cursor: text;
				font-family:var(--default-font-family);
				background: transparent;
				color: var(--search-text-color);
				font-size: var(--font-size-sm, 12px);
				width:92%;
			}
            pebble-button.icon{
                --pebble-button: {                    
                    color: #9b9b9b;
                };
                --pebble-button-hover: {
                    background: #1976D2;
                    color: #FFFFFF;
                }
            }
            pebble-button::shadow paper-button{
                min-width: 16px;
            }
        </style>

        <div class="input-panel">
            <pebble-button icon="pebble-md-icons:ToolbarSearch" class="icon pebble-md-icons m-l-5" on-tap="search"></pebble-button>
            <input is="iron-input" id="input" bind-value="{{query}}" placeholder="[[placeholder]]" on-keyup="searchOnEnter"></input>
        </div>
        <pebble-button icon="pebble-icons:TagCancel" hidden$="[[!query]]" on-tap="clear" ></pebble-button>
        </template>
</dom-module>

<script>

    (function () {

        Polymer({
            is: 'rock-search-bar',
            /**
            * PubSub event named "rock-search" fired when the user requests to search for a query. Data passed in the event:  {'name':'rock-search', 'data':this.query}
            *
            * @event bedrock-event
            */
            properties: {
                /**
                 * Indicates the text for the user search.
                 */
                query: {
                    type: String,
                    notify: true,
                    value: ''
                },
                /**
                 * Indiactes an icon shown in the search background.
                 */
                icon: {
                    type: String,
                    value: 'search'
                },
                /**
                 * Indicates the text shown in the search box if the user does not enter any query.
                 */
                placeholder: {
                    type: String,
                    value: 'Search'
                },
                /**
                 * Indicates that the text is passed as Json as Search input. This usually comes from filter query.
                 */
                searchInput: {
                    type: Object,
                    notify: true,
                    value: function () {
                        return [];
                    },
                    observer: "searchQueryFromInput"
                }
            },
            behaviors: [
                RUFBehaviors.UIBehavior
            ],
            /**
             * Clear the search query
            */
            clear: function () {
                this.query = "";
                this.$.input.focus();
            },
            /**
             * Call the search functionality
            */
            search: function () {
                this.fireBedrockEvent('rock-search', this.query);
            },
            /**
             * Call the search functionality on pressing enter
            */
            searchOnEnter: function (e) {
                if (e.keyCode === 13) {
                    this.search();
                }
            },
            /**
             * observer for searchInput jsonarray. It will create the search query using the searchInput
            */
            searchQueryFromInput: function () {
                var length = this.searchInput.length;
                for (var i = 0; i < length; i++) {
                    this.query += this.searchInput[i].name + " = " + this.searchInput[i].value;
                    if (i < length - 1) {
                        this.query += " and ";
                    }
                }
            }
        });

    })();

</script>