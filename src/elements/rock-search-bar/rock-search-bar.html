<link rel="import" href="../../../bower_components/polymer/polymer.html">
<link rel="import" href="../../../bower_components/iron-flex-layout/iron-flex-layout.html">
<link rel="import" href="../../../bower_components/iron-input/iron-input.html">
<link rel="import" href="../bedrock-ui-behavior/bedrock-ui-behavior.html">
<link rel="import" href="../pebble-button/pebble-button.html">


<!--
`rock-search-bar`
Represents a single line text box for the user to enter the text.

@demo demo/index.html
-->

<dom-module id="rock-search-bar">
    <template>
        <style include="pebble-styles-shared"></style>
        <style>
			:host {
				@apply(--layout-horizontal);
				@apply(--layout-center);
			}
			.input-panel {
				width: 100%;
				@apply(--layout-horizontal);
				@apply(--layout-center);
                position: relative;
			}
			#input {
				outline: 0;
				cursor: text;
				font-family:var(--default-font-family,'Roboto',Helvetica,Arial,sans-serif);
				background: transparent;
				color: var(--search-text-color,#75808b);
				font-size: var(--font-size-sm, 12px);
				width: calc(100% - 35px);
                border: 1px solid var(--default-border-color, #c1cad4);
                border-radius: 3px;
                border-top-right-radius:0;
                border-bottom-right-radius:0;  
                padding: 5px;  
                height: 30px;
                border-right:0; 
			}            
            pebble-button.toolbarsearch{
                border-top-left-radius:0!important;
                border-bottom-left-radius:0!important;  
                width: 36px;
                height: 30px;
                background-color: var(--primary-button-color,#139ee7)!important;
                border-color: var(--primary-button-color,#139ee7)!important;
            }
            pebble-button.toolbarsearch::shadow paper-button iron-icon{
                width: 16px!important;
                height: 16px !important;
                text-align: center;
                padding: 0;
            }
            pebble-button::shadow paper-button{
                min-width: auto !important;
            }
            .resetsearch{
                position: absolute;
                right: 0;
                bottom: -20px;
                font-size: var(--font-size-xs);
                color: var(--link-text-color);
            }
            .resetsearch pebble-button::shadow paper-button{
                font-size: var(--font-size-xs);
            }
            .resetsearch pebble-button::shadow iron-icon{
                width: 14px !important;
                height: 14px!important;
                margin-right: 2px;
                margin-top: 3px;
            }
        </style>

        <div class="input-panel">            
            <input is="iron-input" id="input" bind-value="{{query}}" placeholder="[[placeholder]]" on-keyup="searchOnEnter"></input>
            <pebble-button icon="pebble-md-icons:ToolbarSearch-wt" class="btn btn-primary toolbarsearch" on-tap="search"></pebble-button>
            <div class="resetsearch" hidden$="[[!query]]"><pebble-button icon="pebble-sm-icons:Resetsearch" class="btn-link" on-tap="clear" button-text="Reset Search"></pebble-button></div>
        </div>
        
    </template>
</dom-module>

<script>

    (function () {

        Polymer({
            is: 'rock-search-bar',
            /**
            * PubSub event named `rock-search` is fired when the user requests to search for a query. Data passed in the event is:  {'name':'rock-search', 'data':this.query}
            *
            * @event bedrock-event
            */
            properties: {
                /**
                 * Indicates the text for the user search.
                 */
                query: {
                    type: String,
                    notify: true,
                    value: ''
                },
                /**
                 * Indiactes an icon shown in the search background.
                 */
                icon: {
                    type: String,
                    value: 'search'
                },
                /**
                 * Indicates the text shown in the search box if the user does not enter any query.
                 */
                placeholder: {
                    type: String,
                    value: 'Search'
                },
                /**
                 * Indicates that the text is passed as json object for the search input. This usually comes from filter query.
                 */
                searchInput: {
                    type: Object,
                    notify: true,
                    value: function () {
                        return [];
                    },
                    observer: "searchQueryFromInput"
                }
            },
            behaviors: [
                RUFBehaviors.UIBehavior
            ],
            /**
             * Can be used to clear the search query.
            */
            clear: function () {
                this.query = "";
                this.$.input.focus();
                this.fireBedrockEvent('rock-search-clear', null);
            },
            /**
             * Can be used to call the search functionality.
            */
            search: function () {
                this.fireBedrockEvent('rock-search', this.query);
            },
            /**
             * Can be used to call the search functionality on pressing enter key.
            */
            searchOnEnter: function (e) {
                if (e.keyCode === 13) {
                    this.search();
                }
            },
            /**
             * Can be used to observe the `searchInput` json array. It creates the search query 
             * using the `searchInput`.
            */
            searchQueryFromInput: function () {
                var length = this.searchInput.length;
                for (var i = 0; i < length; i++) {
                    this.query += this.searchInput[i].name + " = " + this.searchInput[i].value;
                    if (i < length - 1) {
                        this.query += " and ";
                    }
                }
            }
        });

    })();

</script>