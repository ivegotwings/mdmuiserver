<link rel="import" href="../../../bower_components/polymer/polymer.html">
<link rel="import" href="../../../bower_components/iron-flex-layout/iron-flex-layout-classes.html">
<link rel="import" href="../pebble-styles-shared/pebble-styles-shared.html">
<link rel="import" href="../pebble-styles-app/pebble-styles-app.html">
<link rel="import" href="../liquid-rest/liquid-rest.html">
<link rel="import" href="../../../bower_components/iron-icons/iron-icons.html">
<link rel="import" href="../../../bower_components/iron-icons/social-icons.html">
<link rel="import" href="../../../bower_components/iron-icons/communication-icons.html"> 
<link rel="import" href="../pebble-icon/pebble-icon.html">

<dom-module id="rock-status-item">
  
  <template>
    <style is="custom-style" include="pebble-styles-shared pebble-styles-app iron-flex iron-flex-alignment">
       :host {
        margin-bottom: 2px;
        display: table;
        width: 100%;

       }
       .statusRow {
        background-color: #eaeaea;
        padding: 10px 0px 0px 0px;
        cursor: pointer;
        }
        .statusRow .row {
          background: #eaeaea;
          padding-bottom: 10px;
        }
        #descriptionRow {
          padding: 10px;
          background-color: rgb(245, 245, 245);
          width: 100%;
          border-left: 2px white solid;
          border-right: 2px white solid;
          

        }
        #descriptionRow div {
          width: 100%;
        }
       
    </style>

    <div class="statusRow row" on-click="_handleRowClick">
      <div class="row col-12">
        <div class="col-1">
          <pebble-icon icon="pebble-md-icons:AccessTime" id="statusIcon" class="iconstyle">
        </div>
        <div class="col-10">
          {{name}}  
        </div>
        
        <div class="col-1">
          <pebble-icon icon="icons:arrow-drop-down" id="descriptionIcon" class="iconstyle">
        </div>
      </div>
      <div id="descriptionRow" class="row" hidden$="{{!collapse}}">
          
            <div><strong>Url: </strong>{{url}}</div>
          
          
          <div><strong>Response: </strong>{{message}}</div>
          
        
      </div>
      
    </div>
    
    <liquid-rest id="mycall" url="{{url}}" method="GET" request-data="{{request}}"
          on-response="_onResponseReceived" on-error="_onResponseFailed">              
    </liquid-rest>    
    
  </template>

  <script>
    Polymer({
      is: 'rock-status-item',
      ready: function(){
        this.$.mycall.generateRequest()
      },
      _onResponseReceived: function(event,response){
        this.$.statusIcon.icon = "pebble-sm-icons:successCheck";        
        this.message = JSON.stringify(response.request);
      },
      _onResponseFailed: function(event,response){
        this.collapse = true;
        this.$.statusIcon.icon = "pebble-sm-icons:errorcheck";
      },
      _handleRowClick: function(){
        this.collapse = !this.collapse;
        if(this.collapse) {
          this.$.descriptionIcon.icon = "icons:arrow-drop-up";
        } else {
          this.$.descriptionIcon.icon = "icons:arrow-drop-down";   
        }
        
      },
      
      properties: {
        name: {
          type: String
        },
        collapse: {
          type: Boolean,
          value: false 
        
        },
        status: {
          type: Boolean
        },
        url: {
          name: {
            type: String
          }
        },
        /**
         * Indicates the URL of an image.
         */
        message: {
          type: String,
          value: null
        },

        timestamp: {
          type: String,
          value: "Howdy"
        }
        /**
         * Indicates a alternative short text for an image.
         */
        // timestamp: {
        //   type: Date,
        //   value: function() {
        //     var today = new Date();
        //     var dd = today.getDate();
        //     var mm = today.getMonth()+1; //January is 0!
        //     var hours = today.getHours();
        //     var minutes = today.getMinutes();
        //     var seconds = today.getSeconds();
        //     var yyyy = today.getFullYear();
        //     if(dd<10){
        //         dd='0'+dd;
        //     } 
        //     if(mm<10){
        //         mm='0'+mm;
        //     } 
        //     var today = dd+'/'+mm+'/'+yyyy+' - '+ hours + ':' + minutes + ':' + seconds;
        //     return today;
        //   }
        // }
      }
    });
  </script>
</dom-module>