<link rel="import" href="../../../bower_components/polymer/polymer.html">

<link rel="import" href="../bedrock-pubsub/bedrock-pubsub.html">
<link rel="import" href="../bedrock-ui-behavior/bedrock-ui-behavior.html">
<link rel="import" href="../bedrock-component-context-behavior/bedrock-component-context-behavior.html">

<link rel="import" href="../liquid-entity-model-get/liquid-entity-model-get.html">
<link rel="import" href="../liquid-rest/liquid-rest.html">

<link rel="import" href="../pebble-spinner/pebble-spinner.html">
<link rel="import" href="../pebble-button/pebble-button.html">
<link rel="import" href="../pebble-card/pebble-card.html">
<link rel="import" href="../pebble-styles-shared/pebble-styles-shared.html">
<link rel="import" href="../pebble-accordion/pebble-accordion.html">

<link rel="import" href="../rock-scope-selector/rock-scope-selector.html">
<link rel="import" href="../rock-attribute-split-list/rock-attribute-split-list.html">
<!--
<b><i>Content development is under progress... </b></i>

@demo demo/index.html
-->
<dom-module id="rock-scope-manage">
    <template>
        <style include="pebble-styles-shared">

            .message {
                text-align: center;
            }

            .buttonSection {
                text-align: center;
            }

            #card{
                height: 100%;
                padding-bottom:20px;
            }
            pebble-card{
                --pebble-card-widget-box:{
                    height:100%;
                    padding-bottom: 10px;
                    margin:0 0 0 0;
                    min-width:auto;
                }
            }
            .card-content
            {
                height: 100%;
                overflow: hidden;
            }
            #buttonContainer{
                margin-top:3px;
                text-align: right;
            }
            #splitList{
                    --table-height: 300px!important;
            }
            #cancelButton{
                margin-left: 15px;
            }

        </style>
        <pebble-spinner active="[[_loading]]"></pebble-spinner>
        <div class="message">[[_message]]</div>
        <pebble-card id="card" no-header>
            <rock-scope-selector id="scopeSelector" selected-scope="[[selectedItems]]" context-data="[[contextData]]" show-title allow-manage-scope show-settings>
            </rock-scope-selector>
            <bedrock-pubsub event-name="rock-scope-click" handler="_onScopeTagClicked"></bedrock-pubsub>
        </pebble-card>
        <pebble-accordion is-collapsed header-text="[[_getHeaderText(_selectedScope)]]" default-icon="expand-less" open-icon="expand-more" class="custom-style">
                <rock-attribute-split-list id="splitList" retain-selected-items="[[retainSelectedItems]]" selected-items="{{selectedItems}}" config="[[splitListConfig]]"></rock-attribute-split-list>
                <div id="buttonContainer" >
                    <pebble-button id="save" class="focus btn btn-success" button-text="Download" on-tap="_save" elevation=1 raised></pebble-button>
                    <pebble-button id="Download" class="focus btn btn-success" button-text="Save" on-tap="_save" elevation=1 raised></pebble-button>
                </div>
        </pebble-accordion>
            <pebble-button id="cancelButton" class="btn btn-secondary m-r-10" button-text="Cancel" on-tap="_onCancelTap" elevation=1 raised></pebble-button>
    </template>
    <script>
        (function () {
            'use strict';

            Polymer({
                is: 'rock-scope-manage',

                properties: {

                    /**
                     * <b><i>Content development is under progress... </b></i>
                     */
                    contextData: {
                        type: Object,
                        value: function () {
                            return {};
                        }
                    },

                    _loading: {
                        type: Boolean,
                        value: false
                    },

                    _message: {
                        type: String
                    },
                    splitListConfig:{
                        type:Object
                    },
                    selectedItems:{
                        type:Array,
                        value:function () {
                            return [];
                        }
                    },
                    retainSelectedItems: {
                        type:Boolean,
                        value:false
                    },
                    _selectedScope:{
                        type:String,
                        value:""
                    }
                },

                behaviors: [
                    RUFBehaviors.UIBehavior,
                    RUFBehaviors.ComponentContextBehavior
                ],

                observers: [],
                ready:function () {
                   this.splitListConfig=this.getParentAppConfig("rock-scope-manage","","splitListConfig");
                },

                _onScopeTagClicked: function (e, detail) {
                    if(detail && detail.data ) {
                        this.selectedItems=[];
                        this.selectedItems = detail.data.scope;
                        var eventDetail = {
                            name:"onNext"
                        };
                        this.fireBedrockEvent("onNext",eventDetail,{"ignoreId":true});
                    }
                },
                _save:function () {

                },
                _onCancelTap:function () {
                    var eventDetail = {
                        name:"onCancel"
                    };
                    this.fireBedrockEvent("onCancel",eventDetail,{"ignoreId":true});
                },
                _getHeaderText:function (_selectedScope) {
                    return this._selectedScope? "Edit "+ this._selectedScope:"New Scope";
                }
            });
        })();
    </script>
</dom-module>