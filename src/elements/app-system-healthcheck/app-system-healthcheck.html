<link rel="import" href="../../../bower_components/polymer/polymer.html" />

<link rel="import" href="../bedrock-app-behavior/bedrock-app-behavior.html" />
<link rel="import" href="../bedrock-style-manager/styles/bedrock-style-common.html" />
<link rel="import" href="../bedrock-helpers/context-helper.html">

<link rel="import" href="../liquid-config-aggregate-get/liquid-config-aggregate-get.html">
<link rel="import" href="../liquid-rest/liquid-rest.html" />

<link rel="import" href="../pebble-spinner/pebble-spinner.html" />
<link rel="import" href="../pebble-accordion/pebble-accordion.html" />
<link rel="import" href="../pebble-horizontal-divider/pebble-horizontal-divider.html" />

<link rel="import" href="../rock-layout/rock-layout.html" />
<link rel="import" href="../rock-layout/rock-titlebar/rock-titlebar.html" />
<link rel="import" href="../rock-api-healthcheck-status-list/rock-api-healthcheck-status-list.html" />
<link rel="import" href="../rock-log-service/rock-log-service.html" />
<link rel="import" href="../rock-dimension-selector/rock-dimension-selector.html">

<dom-module id="app-system-healthcheck">
    <template>
        <style include="bedrock-style-common">
            .summary-container {
                padding: 20px;
            }
        </style>
        <rock-layout>
            <liquid-config-aggregate-get id="getSystemHealthcheckConfig" operation="getbyids" request-id="req1" app-name="app-system-healthcheck"
                context-data="[[contextData]]" on-config-get-response="_onApplicationConfigReceived"></liquid-config-aggregate-get>
            <!--<liquid-rest id="taskDetailsGet" url="/data/eventservice/getTaskDetails" method="POST" request-data={{_taskDetailsGetRequest}}
                on-liquid-response="_onTaskDetailsGetResponse" on-liquid-error="_onTaskDetailsGetError"></liquid-rest>-->
            <pebble-spinner active="[[_loading]]"></pebble-spinner>
            <rock-titlebar slot="rock-titlebar" icon="pebble-md-icons:HealthCheck" main-title="System health check" closable minimizable>
                <div id="dimensionContainer" align="right">
                    <rock-dimension-selector id="dimensionSelector" app-name="app-system-healthcheck" all-multi-select></rock-dimension-selector>
                </div>
            </rock-titlebar>
            <div class="flex">
                <div class="summary-container">
                    <pebble-accordion header-text="API health check paths" default-icon="pebble-icon:RightArrow" is-collapsed="true" open-icon="pebble-icon:Expand">
                        <rock-api-healthcheck-status-list context-data="[[contextData]]"></rock-api-healthcheck-status-list>
                    </pebble-accordion>
                    <pebble-accordion header-text="Logger Service" default-icon="pebble-icon:RightArrow" is-collapsed="true" open-icon="pebble-icon:Expand">
                        <rock-log-service></rock-log-service>
                    </pebble-accordion>
                </div>
            </div>
        </rock-layout>

    </template>
    <script>
        (function () {
            'use strict';

            Polymer({
                is: "app-system-healthcheck",

                properties: {
                    contextData: {
                        type: Object,
                        value: function() {
                            return {};
                        }
                    },
                    _loading: {
                        type: Boolean,
                        value: false
                    }
                },

                behaviors: [
                    RUFBehaviors.AppBehavior
                ],

                created: function () {
                    var userContext = {
                        "role": this.roleId,
                        "user": this.userId,
                        "ownershipData": this.ownershipData,
                        "tenant": this.tenantId
                    };

                    this.contextData[ContextHelper.CONTEXT_TYPE_USER] = [userContext];
                },
                _onRefreshClick: function () {
                },
                 _onApplicationConfigReceived: function (e) {
                    console.log('app configs loaded', JSON.stringify(e.detail, null, 2)); 
                    this.set('applicationConfig', e.detail);
                }
            });
        })();
    </script>
</dom-module>