<link rel="import" href="../../../bower_components/polymer/polymer.html" />

<link rel="import" href="../bedrock-pubsub/bedrock-pubsub.html" />
<link rel="import" href="../bedrock-app-behavior/bedrock-app-behavior.html" />

<link rel="import" href="../liquid-config-aggregate-get/liquid-config-aggregate-get.html">
<link rel="import" href="../liquid-rest/liquid-rest.html" />

<link rel="import" href="../pebble-styles-shared/pebble-styles-shared.html" />
<link rel="import" href="../pebble-spinner/pebble-spinner.html" />
<link rel="import" href="../pebble-accordion/pebble-accordion.html" />
<link rel="import" href="../pebble-horizontal-divider/pebble-horizontal-divider.html" />

<link rel="import" href="../rock-layout/rock-layout.html" />
<link rel="import" href="../rock-layout/rock-titlebar/rock-titlebar.html" />

<link rel="import" href="../rock-api-healthcheck-status-list/rock-api-healthcheck-status-list.html" />

<dom-module id="app-system-healthcheck">
    <template>
        <style include="pebble-styles-shared"></style>
        <style include="iron-flex"></style>
        <style is="custom-style">
        </style>
        <rock-layout>
            <liquid-config-aggregate-get id="getSystemHealthcheckConfig" operation="getbyids" request-id="req1" app-name="app-system-healthcheck"
                context-data="[[contextData]]" on-config-get-response="_onApplicationConfigReceived"></liquid-config-aggregate-get>
            <!--<liquid-rest id="taskDetailsGet" url="/data/eventservice/getTaskDetails" method="POST" request-data={{_taskDetailsGetRequest}}
                on-liquid-response="_onTaskDetailsGetResponse" on-liquid-error="_onTaskDetailsGetError"></liquid-rest>-->
            <pebble-spinner active="[[_loading]]"></pebble-spinner>
            <rock-titlebar icon="pebble-md-icons:Advancesearch" main-title="Riversan dataplatform health check" closable minimizable>
                <div id="dimensionContainer" align="right">
                    <rock-dimension-selector id="dimensionSelector" config-data="[[getConfig('rock-dimension-selector')]]" all-multi-select></rock-dimension-selector>
                </div>
            </rock-titlebar>
            <div class="flex">
                <div class="summary-container">
                    <pebble-accordion header-text="API Health check" default-icon="chevron-right" open-icon="expand-more">
                        <rock-api-healthcheck-status-list calls="[[getConfig('rock-api-healthcheck-status-list')]]"></rock-api-healthcheck-status-list>
                    </pebble-accordion>
                </div>
            </div>
        </rock-layout>

    </template>
    <script>
        (function () {
            'use strict';

            Polymer({
                is: "app-system-healthcheck",

                properties: {
                    _loading: {
                        type: Boolean,
                        value: false
                    }
                },

                behaviors: [
                    RUFBehaviors.AppBehavior
                ],

                ready: function () {
                },

                attached: function () {
                    var userContext = {
                        "role": this.roleId,
                        "user": this.userId,
                        "ownershipData": this.ownershipData
                    };

                    this.contextData[this.CONTEXT_TYPE_USER] = [userContext];
                },
                _onRefreshClick: function () {
                },
                 _onApplicationConfigReceived: function (e) {
                    console.log('app configs loaded', JSON.stringify(e.detail, null, 2)); 
                    this.set('applicationConfig', e.detail);
                },
            });
        })();
    </script>
</dom-module>