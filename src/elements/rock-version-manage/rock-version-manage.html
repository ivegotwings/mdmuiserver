<link rel="import" href="../../../bower_components/polymer/polymer.html">
<link rel="import" href="../../../bower_components/iron-flex-layout/iron-flex-layout-classes.html">

<link rel="import" href="../liquid-rest/liquid-rest.html" />

<link rel="import" href="../bedrock-style-manager/styles/bedrock-style-common.html">
<link rel="import" href="../pebble-button/pebble-button.html">

<dom-module id="rock-version-manage">
  <template>
      <style include="bedrock-style-common">
        .block {
          padding: 0 20px;
        }
        .attribute {
            width: 33%;
            height: 20px;
            line-height: 20px;
            padding-right: 30px;
            -webkit-transition: all 0.4s;
            -moz-transition: all 0.4s;
            -o-transition: all 0.4s;
            transition: all 0.4s;
        }
        .trim {
            text-overflow: ellipsis;
            overflow: hidden;
            white-space: nowrap;
        }
        #attrName {
            width: 282px;
            height: 20px;
            font-family: var(--default-font-family);
            font-size: var(--default-font-size, 14px);
            font-weight: normal;
            font-style: normal;
            font-stretch: normal;
            color: var(--palette-steel-grey, #75808b);
            position: relative;
        }
        #attrVal {
            font-size: var(--font-size-sm, 12px);
            font-weight: var(--font-medium, 500);
            color: var(--palette-dark, #1a2028);
            margin-left: 5px;
        }
      </style>
    <div class="block">
      <div id="attribute">
        <span id="attrName">Current Runtime Version Number:</span>
        <span id="attrVal">[[runtimeVersion]]</span>
        <pebble-button id="statusIcon" class="btn btn-success m-t-15 m-l-10"  
          button-text="Bump up version >>"
          on-click="_handleSave">
        </pebble-button>
      </div>

      <liquid-rest id="liqRuntimeVersionUpdate" 
                  url="/data/version/updateRuntimeVersion" 
                  method="POST"
                  on-liquid-response="_onResponse" 
                  on-liquid-error="_onError">
      </liquid-rest>
    </div>
  </template>
  <script>
    Polymer({
      is: 'rock-version-manage',
      properties:{
        runtimeVersion: {
          type: String,
          value: "0.0.0.0"
        }
      },
      attached: function () {
        this.runtimeVersion = SharedUtils.RuntimeVersionManager.getVersion();
      },
      _handleSave: function () {
        this.generateRequest();
      },
      generateRequest: function () {
          var configSaveService = this.shadowRoot.querySelector('#liqRuntimeVersionUpdate');
          if (configSaveService) {
              configSaveService.operation = "get";
              configSaveService.requestData = {};
              configSaveService.generateRequest();
          }
      },
      _onResponse: function (e) {
        //console.log(JSON.stringify(e.detail.response));
        if(e.detail && e.detail.response && e.detail.response.newVersion) {
          this.runtimeVersion = e.detail.response.newVersion;
          SharedUtils.RuntimeVersionManager.setVersion(this.runtimeVersion);
        }
      }
    });
  </script>
</dom-module>