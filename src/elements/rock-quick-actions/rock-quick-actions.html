<link rel="import" href="../../../bower_components/polymer/polymer-element.html">

<link rel="import" href="../pebble-actions/pebble-actions.html">
<link rel="import" href="../bedrock-pubsub/bedrock-pubsub.html">
<link rel="import" href="../bedrock-ui-behavior/bedrock-ui-behavior.html">
<link rel="import" href="../bedrock-component-context-behavior/bedrock-component-context-behavior.html">
<link rel="import" href="../bedrock-helpers/component-helper.html">

<link rel="import" href="../rock-component-config-behavior/rock-component-config-behavior.html">

<!--
@group rock Elements
@element rock-business-actions
@demo demo/index.html
-->
<dom-module id="rock-quick-actions">
    <template>
        <style include="bedrock-style-common"></style>
        
    
    <pebble-actions id="quickActions" class="m-l-10" button-icon="pebble-md-icons:Quickactions" button-text="Quick Actions"
    actions-data="[[actionsData]]">
    </pebble-actions>
    <bedrock-pubsub event-name="pebble-actions-button-click" handler="_onActionItemTap" target-id=""></bedrock-pubsub>

</template>
<script>
    class RockQuickActions
        extends Polymer.mixinBehaviors([RUFBehaviors.UIBehavior, RUFBehaviors.ComponentContextBehavior, RUFBehaviors.ComponentConfigBehavior], Polymer.Element) {
        static get is() { return 'rock-quick-actions' }
        ready() {
            super.ready();
        }
        static get properties() {
            return {
                contextData: {
                    type: Object,
                    value: function () {
                        return {};
                    },
                    observer: '_onContextDataChange'
                },
                actionsData: {
                        type: Array,
                        value: function () { return []; }
                }
            }
        }
        static get observers() {
            return []
        }
        /**
        *
        */
        connectedCallback() {
            super.connectedCallback();
        }
        /**
        *
        */
        disconnectedCallback() {
            super.disconnectedCallback();
        }
        _onContextDataChange() {
            if (!_.isEmpty(this.contextData)) {
                var context = DataHelper.cloneObject(this.contextData);
                //App specific
                var appName = ComponentHelper.getCurrentActiveAppName();
                if(appName) {
                    context[ContextHelper.CONTEXT_TYPE_APP] = [{
                        "app": appName
                    }];
                }

                this.requestConfig('rock-quick-actions', context);
            }
        }
        onConfigLoaded(componentConfig) {
            if (componentConfig && componentConfig.config) {
                var actionGroups = [];

                if (componentConfig.config.actionGroups) {
                    var actionsData = DataHelper.convertObjectToArray(componentConfig.config.actionGroups);
                    for(var data in actionsData){
                        if(actionsData[data].actions){
                            actionsData[data].actions = DataHelper.convertObjectToArray(actionsData[data].actions);
                        }
                    }
                    this.actionsData = actionsData;
                }
            }
        }

        _onActionItemTap(e, detail, sender) {
           //Content development in progress
        }

    }
    customElements.define(RockQuickActions.is, RockQuickActions);
</script>
</dom-module>