<link rel="import" href="../../../bower_components/polymer/polymer.html">
<link rel="import" href="../rock-layout/rock-layout.html">
<link rel="import" href="../rock-layout/rock-titlebar/rock-titlebar.html">
<link rel="import" href="../rock-widget-panel/rock-widget-panel.html">
<link rel="import" href="../pebble-icons/pebble-icons.html">
<link rel="import" href="../bedrock-ui-behavior/bedrock-ui-behavior.html">
<link rel="import" href="../bedrock-pubsub/bedrock-pubsub.html">

<dom-module id="app-dashboard">
  <template>
    <rock-layout>
      <rock-titlebar icon="pebble-md-icons:UserIcon" class="pebble-md-icons" title="User Dashboard"></rock-titlebar>
      <iron-ajax auto url="/src/data/dashboard-widgets.json" handle-as="json" on-response="_handleResponse"></iron-ajax>
      <rock-widget-panel config="{{_widgetConfig}}"></rock-widget-panel>
    </rock-layout>
    <bedrock-pubsub event-name="actions-parent-button-tap" handler="_onSavedSearchTap" target-id=""></bedrock-pubsub>
    <bedrock-pubsub event-name="favourite-saved-search" handler="_markSavedSearchAsFavourite" target-id=""></bedrock-pubsub>
    <bedrock-pubsub event-name="delete-saved-search" handler="_markSavedSearchAsDelete" target-id=""></bedrock-pubsub>
                 
  </template>
  <script>
    (function() {
      'use strict';

        Polymer({
            is: 'app-dashboard',
            properties: {
              _widgetConfig: {
                type: Object,
                value: function() { return {}; }
              }
            },
            behaviors: [
                RUFBehaviors.UIBehavior
            ],
            _markSavedSearchAsFavourite: function(e, detail, sender){
                if(detail){
                    // detail object has info of the favorite action button, its parent button and tab info.
                }
            },
            _markSavedSearchAsDelete: function(e, detail, sender){
                if(detail){
                   // detail object has info of the delete action button, its parent button and tab info.
                }
            },
            _onSavedSearchTap: function(e, detail, sender) {
                document.querySelector("main-app").set('route.__queryParams', {"savedSearchId": detail.id.toString() });
                document.querySelector("main-app").set('route.path', "/entity-discovery");
            },
             _handleResponse: function(e) {
                this._setWidgetConfigData(e.currentTarget.lastResponse);
            },
            _setWidgetConfigData: function(data) {
                //can alter the data before setting it to widgetConfig for widget-panel
                this.set("_widgetConfig", data);
            }
      });
    })();
  </script>
</dom-module>