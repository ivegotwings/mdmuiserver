<link rel="import" href="../../../bower_components/polymer/polymer.html">
<link rel="import" href="../../../bower_components/iron-ajax/iron-ajax.html">

<link rel="import" href="../bedrock-ui-behavior/bedrock-ui-behavior.html">
<link rel="import" href="../bedrock-pubsub/bedrock-pubsub.html">

<link rel="import" href="../liquid-config-get/liquid-config-get.html">

<link rel="import" href="../pebble-icons/pebble-icons.html">
<link rel="import" href="../pebble-styles-shared/pebble-styles-shared.html">
<link rel="import" href="../pebble-button/pebble-button.html">
<link rel="import" href="../pebble-icon/pebble-icon.html">

<link rel="import" href="../rock-layout/rock-layout.html">
<link rel="import" href="../rock-layout/rock-titlebar/rock-titlebar.html">
<link rel="import" href="../rock-widget-panel/rock-widget-panel.html">
<link rel="import" href="../rock-footer/rock-footer.html">
<dom-module id="app-dashboard">
  <template>
    <style>
        pebble-icon::shadow iron-icon {
            margin: 11px 10px 0 0;
            width: 16px;
            height: 16px;
            color: var(--sub-header-icon-color);
        }

        pebble-button::shadow paper-button {
            min-width: 0px;
            color: var(--sub-header-icon-color);
            padding: 5px;
            width: 26px;
        }

        #footer {
                background: var(--palette-pale-grey-five);
                padding-top: 10px;
        }
    </style>
    <rock-layout hide-footer>
      <liquid-config-get auto id="getAppConfig" operation="getconfigs" request-id="getAppConfig" request-data="{{_configRequest}}"
                         last-response="{{applicationConfig}}"></liquid-config-get>
      <bedrock-pubsub event-name="component-creating" handler="_onComponentCreating"></bedrock-pubsub>
      <rock-titlebar icon="pebble-md-icons:UserIcon" class="pebble-md-icons" title="User Dashboard">  
      </rock-titlebar>      
      <rock-widget-panel config="[[getConfig('rock-widget-panel')]]"></rock-widget-panel>
      <div id="footer">
         <rock-footer></rock-footer>
      </div>
    </rock-layout>
    <bedrock-pubsub event-name="actions-parent-button-tap" handler="_onSavedSearchTap" target-id=""></bedrock-pubsub>
    <bedrock-pubsub event-name="favourite-saved-search" handler="_markSavedSearchAsFavourite" target-id=""></bedrock-pubsub>
    <bedrock-pubsub event-name="delete-saved-search" handler="_markSavedSearchAsDelete" target-id=""></bedrock-pubsub>
    <bedrock-pubsub on-bedrock-event-rock-my-todo-click="_onTapSummaryViewItem"></bedrock-pubsub> 
    <bedrock-pubsub on-bedrock-event-rock-my-todo-product-click="_onTapDetailViewItem"></bedrock-pubsub> 
    <bedrock-pubsub on-bedrock-event-rock-my-todo-view-all="_onTapDetailViewAll"></bedrock-pubsub>          
  </template>
  <script>
    (function () {
      'use strict';

        Polymer({
            is: 'app-dashboard',
            properties: {            
              _configRequest: {
                        type: Object,
                        value: function () {
                            return {
                                "apps": [
                                    "app-dashboard"
                                ],
                                "tenantId": "t1",
                                "security": {
                                    "user": "user1",
                                    "role": "role1"
                                },
                                "ctx": []
                            };
                        },
                        notify: true                                      
               },
               _savedSearches: {
                        type: Object,
                        value: function() { return{}; },
                        notify: true,
                        computed: 'getConfig("rock-saved-searches")',
                        observer: '_onSavedSeachesChange'
               }
            },
            behaviors: [
                RUFBehaviors.UIBehavior
            ],
            _markSavedSearchAsFavourite: function (e, detail, sender) {
                if (detail) {
                    // detail object has info of the favorite action button, its parent button and tab info.
                }
            },
            _markSavedSearchAsDelete: function (e, detail, sender) {
                if (detail) {
                   // detail object has info of the delete action button, its parent button and tab info.
                }
            },
            _onSavedSearchTap: function (e, detail, sender) {
                document.querySelector("main-app").set('pageRoute.__queryParams', {
                        "savedSearchId": detail.id.toString()
                });
                document.querySelector("main-app").changePageRoutePath("/entity-discovery");
            },
             _handleResponse: function (e) {
                this._setWidgetConfigData(e.currentTarget.lastResponse);
            },
            _setWidgetConfigData: function (data) {
                //can alter the data before setting it to widgetConfig for widget-panel
                this.set("_widgetConfig", data);
            },
            _onTapSummaryViewItem: function(e, detail, sender) {                
                document.querySelector("main-app").set('pageRoute.__queryParams', {"mytodoid": e.detail.id.toString() });
                document.querySelector("main-app").changePageRoutePath("/entity-discovery");
            },
            _onTapDetailViewItem: function(e, detail, sender) {
                document.querySelector("main-app").set('pageRoute.__queryParams', {"mytodoid": e.detail.id.toString() });
                document.querySelector("main-app").changePageRoutePath("/entity-discovery");
            },
            _onTapDetailViewAll: function(e, detail, sender) {                
                document.querySelector("main-app").changePageRoutePath("/entity-discovery");
            },
            _onSavedSeachesChange: function(newValue, oldValue){
                console.log('dashboard saved searches!!!!', newValue, oldValue);
            },            
            _onComponentCreating: function (e, detail, sender) {
                var component = detail.data;
                
                if (component.name == "rock-saved-searches" && this._savedSearches) {
                    component.properties["saved-searches"] = this._savedSearches;
                }
            }
      });
    })();
  </script>
</dom-module>