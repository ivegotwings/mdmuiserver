<link rel="import" href="../../../../bower_components/polymer/polymer.html">
<dom-module id="rock-header">
    <template>
        <style>
             :host {
                box-sizing: border-box;
            }
            
            #rockHeaderContainer {
                min-height: 85px;
                height: auto;
                border: 3px solid green;
                width: inherit;
                overflow-x: auto;
                white-space: normal;
            }

            @media only screen and (max-width: 716px) {
                #rockHeaderContainer {
                    width: auto;
                }
            }
        </style>
        <div id="rockHeaderContainer">
            <content></content>
        </div>
    </template>
    <script>
        Polymer({
            is: 'rock-header',
            properties: {
                fixed:{
                    type: Boolean,
                    reflectToAttribute: true
                }
            },
            observers: [
                'resetHeaderLayout(isAttached)'
            ],
            _height: 0,
            _dHeight:0,
            _top: 0,
            _maxHeaderTop:0,
            _initScrollTop:0,
            _initTimeStamp:0,
            _lastScrollTop:0,            
            _lastTimeStamp:0,
            get _maxHeaderTop() {
                return this.fixed ? this._dHeight : this._height + 5;
            },
            get _scrollerElement(){
                return this.parentElement.$.rockLayoutContainer; 
            },
            attached: function() {
                this._scrollerElement.addEventListener('scroll', this.scrollHandler, false);
            },
            ready: function() {
                this.scrollHandler = this._scroll.bind(this);
            },
            _scroll: function() {
                this._updateScrollState();
            },
            // resetHeaderLayout: function() {
            //     this.debounce('resetHeaderLayout', function() {

            //         if(this.offsetWidth === 0 && this.offsetHeight === 0)
            //         {
            //             return;
            //         }

            //         var scrollTop = this._clampedScrollTop;
            //         var firstSetup = this._height === 0 || scrollTop === 0;
            //         var currentDisabled = this.disabled;

            //         this._height = this.offsetHeight;
            //         this.disabled = true;

            //         if(!firstSetup)
            //         {
            //             this._updateScrollState();
            //         }

            //     })
            // },
            _updateScrollState: function() {
                // if(this._height === 0)
                // {
                //     return;
                // }

                // var scrollTop = 0;
                // var progress = 0;
                // var top = 0;
                // var lastTop = this._top;
                // var lastScrollTop = this._scrollerElement.scrollTop;
                // var maxHeaderTop = this._maxHeaderTop;
                // var dScrollTop = scrollTop - this._lastScrollTop;
                // var absDScrollTop = Math.abs(dScrollTop);
                // var isScrollingDown = scrollTop > this._lastScrollTop;
                // var now = Date.now();

                // if(scrollTop >= maxHeaderTop)
                // {
                //     if(isScrollingDown)
                //     {
                //         top = maxHeaderTop;
                //     }
                // }

                // if(lastTop !== 0 && scrollTop === 0)
                // {
                //     this._transformHeader(top);
                // }

                if(this._scrollerElement.scrollTop > 0)
                {
                    this.$.rockHeaderContainer.style.height = '43px';
                    this.$.rockHeaderContainer.style.minHeight = '0px';
                }
                else if(this._scrollerElement.scrollTop == 0)
                {
                    this.$.rockHeaderContainer.style.height = 'auto';
                    this.$.rockHeaderContainer.style.minHeight = '85px';
                }
            },
            _transformHeader: function(x) {
                this.translate3d(0, (-x) + '%', 0);
            }
        });
    </script>
</dom-module>