<link rel="import" href="../../../../bower_components/polymer/polymer.html">

<link rel="import" href="../../pebble-styles-shared/pebble-styles-shared.html">

<!--
`<rock-header>` Represents a header layout structure inside rock-layout. 
This element is a child element of `<rock-layout>` element.

It can contian any elements or components.

### Accessibility

Defualt behavior, header will get shrunk while scrolling of rock layout content.
for that '<rock-header>' shold contain it's all content in two divs with class name of each `fixed-content` and `shrunk-content`.
So when header is shrunk then div with class `shrunk-content` content will get render else div with class `fixed-content` will get render inside `<rock-header>`. 

For example:

    <rock-layout>
        <rock-header>
            <div class='fixed-content'>
                fixed header content . . .
            </div>
            <div class='shrunk-content'>
                shrunk header content . . .
            </div>
        </rock-header>
        main layout content . . .
    </rock-layout>

To make header frozen in rock layout use `frozen` property, so that header will not get shrunk.

For example:

    <rock-layout>
        <rock-header frozen>
            <div class='fixed-content'>
                fixed header content . . .
            </div>
        </rock-header>
        main layout content . . .
    </rock-layout>

@demo ../demo/index.html
-->

<dom-module id="rock-header">
    <template>
        <style>
             :host {
                box-sizing: border-box;
            }
            
            #rockHeaderContainer {
                height: auto;
                width: 100%;
                white-space: normal;
            }
            
            #fixedHeader, #shrunkHeader{
                display: inline-block;
                width: calc(100% - 0px);
            }

            #rightHeader {
                display: block;
                float: right;
            }
            
            #leftHeader {
                display: block;
                float: left;
            }

            @media only screen and (max-width: 768px) {
                #rockHeaderContainer {
                    width: auto;
                }
            }
        </style>
        <div id="rockHeaderContainer">
            <div id="rightHeader">
                <slot select=".rock-header-right-sidebar">
                </slot>
            </div>
            <div id="fixedHeader">
                <slot id="headerContent" select=".fixed-content"></slot>
            </div>
            <div id="shrunkHeader">
                <slot id="headerContent" select=".shrunk-content"></slot>
            </div>
            <div id="leftHeader">
                <slot select=".rock-header-left-sidebar">
                </slot>
            </div>
        </div>
    </template>
    <script>
        Polymer({
            is: 'rock-header',
            properties: {
                /*
                * Indicates that the header should be frozen or not while scrolling of rock layout content.
                * If `true` then header will be frozen.
                * If `false` then header will get shrunk while scrolling of rock layout content.
                */
                frozen: {
                    type: Boolean,
                    reflectToAttribute: true
                }
            },
            _headerContainerHeight: 0,
            _shrinkableHeight:0,
            _scrollableHeight:0,
            _scrollableContainerHeight:0,
            _lastTop:0,
            get _scrollerElement(){
                return Polymer.dom(this).parentNode.$.mainContent;
            },
            attached: function() {
                this._scrollerElement.addEventListener('scroll', this.scrollHandler, false);
                this._hideAndShowContent('inline-block','none');
                this._headerContainerHeight = this.$.rockHeaderContainer.offsetHeight;
            },
            ready: function() {
                this.scrollHandler = this._scroll.bind(this);
            },
            _scroll: function() {
                if(this._lastTop == 0){
                    this._shrinkableHeight = this._headerContainerHeight - 40;
                    this._scrollableContainerHeight = this._scrollerElement.offsetHeight;
                    this._scrollableHeight = this._scrollerElement.scrollHeight - this._scrollableContainerHeight;
                }
                this._updateScrollState();
            },
            _updateScrollState: function() {
                if(!this.frozen)
                {
                    var headerHeight = 0;
                    var scrollTop = this._scrollerElement.scrollTop;

                    if(scrollTop > 0)
                    {
                        if(this._scrollableHeight > (this._shrinkableHeight * 2))
                        {
                            if(scrollTop >= (this._headerContainerHeight - 40))
                            {
                                this.$.rockHeaderContainer.style.height = '40px';
                                this.$.rockHeaderContainer.style.minHeight = '0px';
                                this._hideAndShowContent('none','inline-block');
                            }
                            else
                            {
                                headerHeight = this._headerContainerHeight - scrollTop;
                                this.$.rockHeaderContainer.style.height = headerHeight + 'px';
                                this.$.rockHeaderContainer.style.minHeight = headerHeight + 'px';
                                this._hideAndShowContent('inline-block','none');
                            }
                        }
                        else
                        {
                            this.$.rockHeaderContainer.style.height = '40px';
                            this.$.rockHeaderContainer.style.minHeight = '0px';
                            this._hideAndShowContent('none','inline-block');
                        }
                        
                        this.$.headerContent.select = '.shrunk-content';
                    }
                    else if(scrollTop == 0)
                    {
                        this.$.rockHeaderContainer.style.height = 'auto';
                        this.$.rockHeaderContainer.style.minHeight = this._headerContainerHeight + 'px';
                        this.$.headerContent.select = '.fixed-content';
                        this._hideAndShowContent('inline-block','none');
                    }
                    
                    this._lastTop = scrollTop;
                }
            },
            _hideAndShowContent: function(frozen, shrink) {
                this.$.fixedHeader.style.display = frozen;
                this.$.shrunkHeader.style.display = shrink;
                if(Polymer.dom(this).firstElementChild && Polymer.dom(this).firstElementChild.$)
                {
                    Polymer.dom(this).firstElementChild.$.fixedHeader.style.display = frozen;
                    Polymer.dom(this).firstElementChild.$.shrunkHeader.style.display = shrink;                    
                }
                if(Polymer.dom(this).lastElementChild && Polymer.dom(this).lastElementChild.$)
                {
                    Polymer.dom(this).lastElementChild.$.fixedHeader.style.display = frozen;
                    Polymer.dom(this).lastElementChild.$.shrunkHeader.style.display = shrink;
                }
            }
        });
    </script>
</dom-module>