<link rel="import" href="../../../../bower_components/polymer/polymer.html">

<dom-module id="rock-header">
    <template>
        <style>
             :host {
                box-sizing: border-box;
            }
            
            #rockHeaderContainer {
                min-height: 85px;
                height: auto;
                border: 1px solid green;
                width: inherit;
                overflow-x: auto;
                white-space: normal;
            }

            @media only screen and (max-width: 768px) {
                #rockHeaderContainer {
                    width: auto;
                }
            }
        </style>
        <div id="rockHeaderContainer">
            <content id="headerContent" select=".fixedContent"></content>
        </div>
    </template>
    <script>
        Polymer({
            is: 'rock-header',
            properties: {
                fixedPosition: {
                    type: Boolean,
                    reflectToAttribute: true
                }
            },
            get _scrollerElement(){
                return Polymer.dom(this).parentNode.$.rockLayoutContainer;
            },
            attached: function() {
                this._scrollerElement.addEventListener('scroll', this.scrollHandler, false);
            },
            ready: function() {
                this.scrollHandler = this._scroll.bind(this);
            },
            _scroll: function() {
                this._updateScrollState();
            },
            _updateScrollState: function() {
                if(!this.fixedPosition)
                {
                    var headerHeight = 0;
                    var scrollTop = this._scrollerElement.scrollTop;
                    var shrinkedHeight = 43;
                    var shrinkTimeDuration = 4;
                    var fixedHeight = 85;

                    if(scrollTop > 0)
                    {
                        if(scrollTop >= (shrinkedHeight * shrinkTimeDuration))
                        {
                            this.$.rockHeaderContainer.style.height = '43px';
                            this.$.rockHeaderContainer.style.minHeight = '0px';
                        }
                        else
                        {
                            headerHeight = (fixedHeight - (scrollTop/4));
                            this.$.rockHeaderContainer.style.height = headerHeight + 'px';
                            this.$.rockHeaderContainer.style.minHeight = headerHeight + 'px';
                        }

                        this.$.headerContent.select = '.shrinkedContent';
                    }
                    else if(scrollTop == 0)
                    {
                        this.$.rockHeaderContainer.style.height = 'auto';
                        this.$.rockHeaderContainer.style.minHeight = fixedHeight + 'px';
                        this.$.headerContent.select = '.fixedContent';
                    }
                }
            }
        });
    </script>
</dom-module>