<!doctype html>
<html>

<head>
  <title>rock-layout test</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, minimum-scale=1.0, initial-scale=1, user-scalable=yes">
  <script src="../../../../bower_components/webcomponentsjs/webcomponents-lite.js"></script>
  <script src="../../../../bower_components/web-component-tester/browser.js"></script>
  <script src="../../../../bower_components/iron-test-helpers/mock-interactions.js"></script>
  <link rel="import" href="../../../../bower_components/iron-demo-helpers/demo-pages-shared-styles.html" />
  <link rel="import" href="../rock-layout.html">
  <link rel="import" href="../rock-sidebar/rock-sidebar.html">
  <link rel="import" href="../rock-header/rock-header.html">
  <link rel="import" href="../rock-header-sidebar/rock-header-sidebar.html">
  <style>
    #headerContent {
      height: 100px;
    }
    
    #content {
      height: 2000px;
    }
  </style>
</head>

<body>
  <!-- rock-layout unit tests  -->
  <test-fixture id="simpleRockLayout">
    <template>
      <rock-layout></rock-layout>
    </template>
  </test-fixture>
  <!-- rock-sidebar unit tests  -->
  <test-fixture id="rockLayoutWithSidebar">
    <template>
      <rock-layout>
        <rock-sidebar>
        </rock-sidebar>
      </rock-layout>
    </template>
  </test-fixture>
  <test-fixture id="rockLayoutWithSidebarPosition">
    <template>
      <rock-layout>
        <rock-sidebar position="left">
        </rock-sidebar>
      </rock-layout>
    </template>
  </test-fixture>
  <!-- end of rock-sidebar unit tests -->
  <!-- rock-header unit tests -->
  <test-fixture id="rockLayoutWithHeader">
    <template>
      <rock-layout>
        <rock-header>
        </rock-header>
      </rock-layout>
    </template>
  </test-fixture>
  <test-fixture id="rockLayoutWithHeaderFrozen">
    <template>
      <rock-layout>
        <rock-header frozen>
          <div class="fixedContent">
            <div id="headerContent"></div>
          </div>
          <div class="shrinkedContent"></div>
        </rock-header>
        <div id="content"></div>
      </rock-layout>
    </template>
  </test-fixture>
  <test-fixture id="rockLayoutWithHeaderNotFrozen">
    <template>
      <rock-layout>
        <rock-header>
          <div class="fixedContent">
            <div id="headerContent"></div>
          </div>
          <div class="shrinkedContent"></div>
        </rock-header>
        <div id="content"></div>
      </rock-layout>
    </template>
  </test-fixture>

  <test-fixture id="rockLayoutWithHeaderSidebar">
    <template>
      <rock-layout>
        <rock-header>
          <rock-header-sidebar class="rock-header-right-sidebar">
            <div class="fixedContent">
              <div id="headerContent"></div>
            </div>
            <div class="shrinkedContent"></div>
          </rock-header-sidebar>
          <div class="fixedContent">
            <div id="headerContent"></div>
          </div>
          <div class="shrinkedContent"></div>
        </rock-header>
        <div id="content"></div>
      </rock-layout>
    </template>
  </test-fixture>
  <!-- end of rock-header unit tests -->
  <!-- end of rock-layout unit tests -->
  <script>

    /* rock-layout unit test */
    suite('rock-layout', function() {
        test('instantiating the rock-layout works', function(done) {
          flush(function(){
            var element = fixture('simpleRockLayout');
            assert.equal(element.is, 'rock-layout');

            done();
          });
        });
    });

    /* rock-sidebar unit test */
    suite('rock-sidebar', function() {
        test('instantiating the rock-sidebar works', function(done) {
          flush(function(){
            var element = fixture('rockLayoutWithSidebar');
            assert.notEqual(element.querySelector("rock-sidebar"), undefined);

            done();  
          });
        });
    });

    suite('rock-sidebar position', function() {
        test('instantiating the rock-sidebar works', function(done) {
          flush(function(){
            var element = fixture('rockLayoutWithSidebarPosition');
            var sidebar = element.querySelector("rock-sidebar");

            var parentContainer = Polymer.dom(sidebar).parentNode.$.container;
            var parentContainerStyle = window.getComputedStyle(parentContainer);
            
            assert.notEqual(sidebar, undefined);
            assert.equal(parentContainerStyle.flexDirection, 'row-reverse'); // row-reverse means 'left'

            done();
          });
        });
    });
    /* end of rock-sidebar unit test */

    /* rock-header unit test */
    suite('rock-header', function() {
        test('instantiating the rock-header works', function(done) {
          flush(function(){
            var element = fixture('rockLayoutWithHeader');
            assert.notEqual(element.querySelector("rock-header"), undefined);

            done();
          });
        });
    });

    suite('rock-header frozen', function() {
        test('instantiating the rock-header frozen works', function(done) {
          flush(function(){
            var element = fixture('rockLayoutWithHeaderFrozen');
            var layoutContainer = Polymer.dom(element).node.$.rockLayoutContainer;
            var headerContainer = Polymer.dom(element).firstElementChild.$.rockHeaderContainer;
            
            scrollTestHelper(layoutContainer, 
              {
                  y: headerContainer.offsetHeight * 10,
                  callback: function() {
                  assert.equal(headerContainer.querySelector("#fixedHeader").style.display, "inline-block");

                  done();
                }
              });
          });
        });
    });

    suite('rock-header shrinked', function() {
        test('instantiating the rock-header shrinked works', function(done) {
          flush(function(){
            var element = fixture('rockLayoutWithHeaderNotFrozen');
            var layoutContainer = Polymer.dom(element).node.$.rockLayoutContainer;
            var headerContainer = Polymer.dom(element).firstElementChild.$.rockHeaderContainer;

            scrollTestHelper(layoutContainer, 
              {
                  y: headerContainer.offsetHeight * 10,
                  callback: function() {
                    assert.equal(headerContainer.querySelector("#fixedHeader").style.display, "none");
                    assert.equal(headerContainer.querySelector("#shrinkedHeader").style.display, "inline-block");
                    
                    done();
                  }
              });
          });
        });
    });

     suite('rock-header-sidebar', function() {
        test('instantiating the rock-header-sidebar works', function(done) {
          flush(function(){
            var element = fixture('rockLayoutWithHeaderSidebar');
            assert.notEqual(element.querySelector("rock-header-sidebar"), undefined);

            done();
          });
        });
    });
    /* end of rock-header unit test */

    /* end of rock-layout unit test */

    /* Helper methods */
    function scrollTestHelper(scroller, test) {

      function scrollEventHandler() {
          test.callback();
      }

      function triggerScrollEvent() {
        var scrollTop = scroller.scrollTop;
        if (test.y === scrollTop) {
          scrollEventHandler();
        } 
        else
        {
          scroller.scrollTop = test.y;
        }
      }
      
      var scrollTarget = scroller;
      scrollTarget.addEventListener('scroll', scrollEventHandler);
      triggerScrollEvent();
    }
    /* end of Helper methods */
  </script>
</body>

</html>