<!doctype html>
<html>

<head>
  <title>rock-layout test</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, minimum-scale=1.0, initial-scale=1, user-scalable=yes">
  <script src="../../../../bower_components/webcomponentsjs/webcomponents-lite.js"></script>
  <script src="../../../../bower_components/web-component-tester/browser.js"></script>
  <script src="../../../../bower_components/iron-test-helpers/mock-interactions.js"></script>
  <link rel="import" href="../../../../bower_components/iron-demo-helpers/demo-pages-shared-styles.html" />
  <link rel="import" href="../rock-layout.html">
  <link rel="import" href="../rock-titlebar/rock-titlebar.html">
  <link rel="import" href="../rock-sidebar/rock-sidebar.html">
  <link rel="import" href="../rock-header/rock-header.html">
  <link rel="import" href="../rock-header-sidebar/rock-header-sidebar.html">
  <link rel="import" href="../../pebble-test-helpers/pebble-test-helpers.html">
  <style>
    #headerContent {
      height: 100px;
    }
    
    #content {
      height: 2000px;
    }
  </style>
</head>

<body>
  <!-- rock-layout unit tests  -->
  <test-fixture id="simpleRockLayout">
    <template>
      <rock-layout></rock-layout>
    </template>
  </test-fixture>
  <!-- rock-sidebar unit tests  -->
  <test-fixture id="rockLayoutWithSidebar">
    <template>
      <rock-layout>
        <rock-sidebar>
        </rock-sidebar>
      </rock-layout>
    </template>
  </test-fixture>
  <test-fixture id="rockLayoutWithSidebarPosition">
    <template>
      <rock-layout>
        <rock-sidebar position="left">
        </rock-sidebar>
      </rock-layout>
    </template>
  </test-fixture>
  <!-- end of rock-sidebar unit tests -->
  <!-- rock-titlebar unit tests  -->
  <test-fixture id="rockLayoutWithTitlebar">
    <template>
      <rock-layout>
        <rock-titlebar sub-title="sub title" title="main title" closable minimizable>
        </rock-titlebar>
      </rock-layout>
    </template>
  </test-fixture>
  <!-- end of rock-titlebar unit tests -->
  <!-- rock-header unit tests -->
  <test-fixture id="rockLayoutWithHeader">
    <template>
      <rock-layout>
        <rock-header>
        </rock-header>
      </rock-layout>
    </template>
  </test-fixture>
  <test-fixture id="rockLayoutWithHeaderFrozen">
    <template>
      <rock-layout>
        <rock-header frozen>
          <div class="fixed-content">
            <div id="headerContent"></div>
          </div>
          <div class="shrunk-content"></div>
        </rock-header>
        <div id="content"></div>
      </rock-layout>
    </template>
  </test-fixture>
  <test-fixture id="rockLayoutWithHeaderNotFrozen">
    <template>
      <rock-layout>
        <rock-header>
          <div class="fixed-content">
            <div id="headerContent"></div>
          </div>
          <div class="shrunk-content"></div>
        </rock-header>
        <div id="content"></div>
      </rock-layout>
    </template>
  </test-fixture>

  <test-fixture id="rockLayoutWithHeaderSidebar">
    <template>
      <rock-layout>
        <rock-header>
          <rock-header-sidebar class="rock-header-right-sidebar">
            <div class="fixed-content">
              <div id="headerContent"></div>
            </div>
            <div class="shrunk-content"></div>
          </rock-header-sidebar>
          <div class="fixed-content">
            <div id="headerContent"></div>
          </div>
          <div class="shrunk-content"></div>
        </rock-header>
        <div id="content"></div>
      </rock-layout>
    </template>
  </test-fixture>
  <!-- end of rock-header unit tests -->
  <!-- end of rock-layout unit tests -->
  <script>

    /* rock-layout unit test */
    suite('rock-layout', function() {
        test('instantiating the rock-layout works', function(done) {
            var element = fixture('simpleRockLayout');
            assert.equal(element.is, 'rock-layout');

            done();
        });
    });

    /* rock-sidebar unit test */
    suite('rock-sidebar', function() {
        test('instantiating the rock-sidebar works', function(done) {
            var element = fixture('rockLayoutWithSidebar');
            assert.notEqual(element.querySelector("rock-sidebar"), undefined);

            done();
        });
    });

    suite('rock-sidebar position', function() {
        test('instantiating the rock-sidebar works', function(done) {
            var element = fixture('rockLayoutWithSidebarPosition');
            var sidebar = element.querySelector("rock-sidebar");

            var parentContainer = Polymer.dom(sidebar).parentNode.$.container;
            var parentContainerStyle = window.getComputedStyle(parentContainer);
            
            assert.notEqual(sidebar, undefined);
            assert.equal(parentContainerStyle.flexDirection, 'row-reverse'); // row-reverse means 'left'

            done();
        });
    });
    /* end of rock-sidebar unit test */

    /* rock-titlebar unit test */

    suite('rock-titlebar', function() {
        var element, titlebar;

        setup(function() {
          element = fixture('rockLayoutWithTitlebar');
          Polymer.dom.flush();
          titlebar = element.querySelector("rock-titlebar");
        })
        
        test('instantiating the rock-titlebar works', function(done) {
            assert.equal(titlebar.is, 'rock-titlebar');
            done();
        });

        test('rock-titlebar closable button enable works', function(done) {
            assert.notEqual(titlebar.querySelector("#close"), undefined); 
            done();
        });

        test('rock-titlebar minimizable button enable works', function(done) {
            assert.notEqual(titlebar.querySelector("#minimize"), undefined); 
            done();
        });

        test('rock-titlebar sub-title works', function(done) {
            var subTitle = titlebar.querySelector("#subTitle");

            assert.notEqual(subTitle, undefined);
            assert.equal(subTitle.innerText, 'sub title'); 
            
            done();
        });

        test('rock-titlebar title works', function(done) {
            var mainTitle = titlebar.querySelector("#mainTitle");

            assert.notEqual(mainTitle, undefined);
            assert.equal(mainTitle.innerText, 'main title'); 
            
            done();
        });
    });
    /* end of rock-titlebar unit test */

    /* rock-header unit test */
    suite('rock-header', function() {
        test('instantiating the rock-header works', function(done) {
            var element = fixture('rockLayoutWithHeader');
            assert.notEqual(element.querySelector("rock-header"), undefined);

            done();
        });
    });

    suite('rock-header frozen', function() {
        test('instantiating the rock-header frozen works', function(done) {
            var element = fixture('rockLayoutWithHeaderFrozen');
            var layoutContainer = Polymer.dom(element).node.$.mainContent;
            var headerContainer = Polymer.dom(element).firstElementChild.$.rockHeaderContainer;
            
            scrollTestHelper(layoutContainer, 
              {
                  y: headerContainer.offsetHeight * 10,
                  callback: function() {
                    assert.equal(headerContainer.querySelector("#fixedHeader").style.display, "inline-block");
                    done();
                  }
              });
              
        });
    });

    suite('rock-header shrunk', function() {
        test('instantiating the rock-header shrunk works', function(done) {
            var element = fixture('rockLayoutWithHeaderNotFrozen');
            var layoutContainer = Polymer.dom(element).node.$.mainContent;
            var headerContainer = Polymer.dom(element).firstElementChild.$.rockHeaderContainer;

            scrollTestHelper(layoutContainer, 
              {
                  y: headerContainer.offsetHeight * 10,
                  callback: function() {
                    assert.equal(headerContainer.querySelector("#fixedHeader").style.display, "none");
                    assert.equal(headerContainer.querySelector("#shrunkHeader").style.display, "inline-block");
                    done();
                  }
              });
              
        });
    });

     suite('rock-header-sidebar', function() {
        test('instantiating the rock-header-sidebar works', function(done) {
            var element = fixture('rockLayoutWithHeaderSidebar');
            assert.notEqual(element.querySelector("rock-header-sidebar"), undefined);

            done();
        });
    });
    /* end of rock-header unit test */

    /* end of rock-layout unit test */
  </script>
</body>

</html>