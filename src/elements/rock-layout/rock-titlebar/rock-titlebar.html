<link rel="import" href="../../../../bower_components/polymer/polymer.html">
<link rel="import" href="../../../../bower_components/shadycss/apply-shim.html">

<link rel="import" href="../../bedrock-pubsub/bedrock-pubsub.html">
<link rel="import" href="../../bedrock-ui-behavior/bedrock-ui-behavior.html">

<link rel="import" href="../../pebble-vertical-divider/pebble-vertical-divider.html">
<link rel="import" href="../../pebble-button/pebble-button.html">
<link rel="import" href="../../pebble-icon/pebble-icon.html">

<link rel="import" href="../../pebble-icons/pebble-icons.html">
<link rel="import" href="../../bedrock-style-manager/styles/bedrock-style-common.html">

<!--
`<rock-titlebar>` Represents a titlebar layout structure inside rock-layout. 
This element is a child of `<rock-layout>` element.

It can contian any elements or components.

For example:

        <rock-layout>
            <rock-titlebar icon="" sub-title="" main-title="" closable minimizable>
                title content . . .
            </rock-titlebar>
        </rock-layout>

@demo ../demo/index.html
-->
<dom-module id="rock-titlebar">
    <template>
        <style include="bedrock-style-common"></style>
        <style>
            :host {
                display: -webkit-box;
                display: -webkit-flex;
                display: -ms-flexbox;
                display: flex;
                position:relative;
                height: 34px;
            }            
            .header {
                @apply --layout-horizontal;
                width: 100%;
                box-shadow: 0 1px 2px 0 rgba(193, 202, 211, 0.7);
                padding:0px 10px;
                justify-content: flex-end;
                align-items: center;
            }            
            #title {
                display: flex;
                width: 100%;
                flex-direction: column;
            }            
            #subTitle {
                color: var(--label-text-color, #96B0C5);
                line-height: 12px;
            }            
            #mainTitle {
                font-family: var(--default-font-family);
                color: var(--pagetitle-text-color, #034c89);
                line-height: 14px;
            }         
            .header .title-text {
                display: flex;
                flex: 1 0 auto;
                height: 100%;
                align-items: center;
            }
            pebble-vertical-divider {
                margin: 0;
                display: inline-block;
                vertical-align: middle;
                --pebble-vertical-divider-color: var(--divider-color, #c1cad4);
                min-width: 1px;
                margin-top: 10px;
                padding-right: 5px;
                margin-bottom: 10px;
                padding-left: 5px;
                min-height: 18px;
            }
            .entity-image {
                width: 20px;
                height: 20px;
                background: #ddd;
            }
        </style>
<div id="rockTitle" class="header">
    <div hidden$="{{!mainTitle}}" class="title-text ">
        <template is="dom-if" if="[[_entityHasImage(config)]]">
            <img class="entity-image" src="[[config.image]]"/>
        </template>
        <template is="dom-if" if="[[!_entityHasImage(config)]]">
            <pebble-icon class="m-r-10 pebble-icon-size-16 pebble-icon-color-blue " icon="[[icon]]"></pebble-icon>
        </template>
        <div id="title" class="text-ellipsis">
            <template is="dom-if" if="{{_isSubTitleDefined(subTitle, mainTitle)}}">
                <div id="subTitle" class="text-ellipsis font-12 font-w-100" title="{{subTitle}}">{{subTitle}}</div>
                <div id="mainTitle" title="{{mainTitle}}" class="font-w-500 font-14">{{mainTitle}}</div>
            </template>
            <template is="dom-if" if="{{!_isSubTitleDefined(subTitle, mainTitle)}}">
                <div id="mainTitle" title="{{mainTitle}}" class="font-w-500 font-14">{{mainTitle}}
                </div>
            </template>
        </div>
        <slot></slot>         
    </div>
    <div class="pull-right">
        <template is="dom-if" if="[[noShare]]">
            <pebble-icon id="share" class="minimize pebble-icon-color-blue pebble-icon-size-16 m-l-5 tooltip-bottom" data-tooltip="Share" name="share" icon="pebble-icon:share"></pebble-icon>
        </template>
        <template is="dom-if" if="[[noSettings]]">
            <pebble-icon id="settings" class="minimize pebble-icon-color-blue pebble-icon-size-16 m-l-5 tooltip-bottom" name="settings" data-tooltip="Settings"
                icon="pebble-icon:settings"></pebble-icon>
        </template>
        <template is="dom-if" if="[[!nonMinimizable]]">
            <pebble-icon id="minimize" class="minimize pebble-icon-color-blue pebble-icon-size-12 m-l-5 tooltip-bottom" name="minimize" data-tooltip="Minimize"
                icon="pebble-icon:window-action-minimize" on-tap="_onMinimize"></pebble-icon>
        </template>
        <template is="dom-if" if="[[!nonClosable]]">
            <pebble-icon id="close" name="close" icon="pebble-icon:window-action-close" data-tooltip="Close" on-tap="_onClose" class="pebble-icon-color-blue pebble-icon-size-12 m-l-5 tooltip-left"></pebble-icon>
        </template>
    </div>
</div>
</template>
<script>
    Polymer({
        is: 'rock-titlebar',
        properties: {
            config: {
                type: String,
                value: function() { return {}; }
            },
            /*
            * Indicates icon if value is set
            */
            icon: {
                type: String
            },
            /*
            * Indicates title if value is set
            */
            mainTitle: {
                type: String,
                notify: true
            },
            /*
            * Indicates sub title if value is set
            */
            subTitle: {
                type: String,
                notify: true
            },
            /*
            * Indicates close icon should come or not to close window
            */
            nonClosable: {
                type: Boolean
            },
            /* Specifies whether the card container have share icon or not.
             * If it is set to <b>true</b>, then the card container has share icon.
             */
            noShare: {
                type: Boolean
            },
            /* Specifies whether the card container have Minimize icon or not.
             * If it is set to <b>true</b>, then the card container has Minimize icon.
             */
            nonMinimizable:{
                type: Boolean
            },
            
            /* Specifies whether the card container have settings icon or not.
             * If it is set to <b>true</b>, then the card container has settings icon.
             */
            noSettings: {
                type: Boolean
            }
            
        },
        behaviors: [
            RUFBehaviors.UIBehavior
        ],
        _onMinimize: function () {
            const { contentViewManager } = RUFUtilities.mainApp;

            if(contentViewManager) {
                var contentView = contentViewManager.activeContentView;
                contentView.onMinimizeClick(contentView.name);
            }
        },
       _onClose: function () {
            var isDirty;
            const { contentViewManager } = RUFUtilities.mainApp;
            if(!contentViewManager) return;

            var contentView = contentViewManager.activeContentView;
            if(!contentView) return;

            var firstChild = contentView.shadowRoot.querySelector('#content').firstElementChild;
            if(firstChild && firstChild.getIsDirty) {
                isDirty = firstChild.getIsDirty();
            }

            if(isDirty) {
                var retVal = confirm("There are unsaved changes. Do you want to discard the changes?");
                if(retVal == true) {
                    contentView.onCloseClick(contentView.name);
                }
            }
            else {
                contentView.onCloseClick(contentView.name);
            }
        },
        _isSubTitleDefined: function () {
            if (this.subTitle) {
                return true;
            }
            return false;
        },
        _entityHasImage: function(config) {
            if(config && config.image && config.image != "") {
                return true
            }
            return false;
        }
    });
</script>
</dom-module>
