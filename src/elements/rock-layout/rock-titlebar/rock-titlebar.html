<link rel="import" href="../../../../bower_components/polymer/polymer.html">
<link rel="import" href="../../../../bower_components/shadycss/apply-shim.html">

<link rel="import" href="../../bedrock-pubsub/bedrock-pubsub.html">
<link rel="import" href="../../bedrock-ui-behavior/bedrock-ui-behavior.html">

<link rel="import" href="../../pebble-vertical-divider/pebble-vertical-divider.html">
<link rel="import" href="../../pebble-button/pebble-button.html">
<link rel="import" href="../../pebble-icon/pebble-icon.html">

<link rel="import" href="../../pebble-icons/pebble-icons.html">
<link rel="import" href="../../bedrock-style-manager/styles/bedrock-style-common.html">
<link rel="import" href="../../pebble-image-viewer/pebble-image-viewer.html">

<!--
`<rock-titlebar>` Represents a titlebar layout structure inside rock-layout. 
This element is a child of `<rock-layout>` element.

It can contian any elements or components.

For example:

        <rock-layout>
            <rock-titlebar icon="" sub-title="" main-title="" closable minimizable>
                title content . . .
            </rock-titlebar>
        </rock-layout>

@demo ../demo/index.html
-->
<dom-module id="rock-titlebar">
    <template>
        <style include="bedrock-style-common"></style>
        <style>
            :host {
                display: -webkit-box;
                display: -webkit-flex;
                display: -ms-flexbox;
                display: flex;
                height: auto;
            }            
            .header {
                position: inherit;
                background-color:var(--palette-white,#fff);
                border-top-left-radius: inherit;
                border-top-right-radius: inherit;
                @apply --layout-horizontal;
                width: 100%;
                justify-content: flex-end;
                box-shadow: 0 1px 2px 0 rgba(193, 202, 211, 0.7);
                padding:10px;
            }            
            #title {
                display: -webkit-box;
                display: -webkit-flex;
                display: -ms-flexbox;
                display: flex;
                flex-direction: column;
                -webkit-flex-direction: column;
                width: 100%;
                min-height: 24px;
            }            
            #subTitle {
                font-size: var(--font-size-sm, 12px);
                font-weight: normal;
                font-style: normal;
                font-stretch: normal;
                color: var(--label-text-color, #96B0C5);
                line-height: 14px;
                padding-right: 30px;
            }            
            #mainTitle {
                height: 16px;
                font-size: var(--default-font-size, 14px);
                font-weight: var(--font-medium, 500);
                font-style: normal;
                font-stretch: normal;
                font-family: var(--default-font-family);
                color: var(--pagetitle-text-color, #034c89);
                line-height: 18px;
                @apply --rock-main-title;
            }         
            .header .title-text {
                display: -webkit-box;
                display: -webkit-flex;
                display: -ms-flexbox;
                display: flex;
                width: 60%;
                flex-direction: row;
                -webkit-flex-direction: row;
                @apply --layout-flex;
            }
            pebble-icon {
                --pebble-icon:{
                    width: 16px;
                    height: 16px;
                    fill:var(--palette-deep-sea-blue, #034c89);
               };
            }
            pebble-vertical-divider {
                --pebble-vertical-divider-color: var(--divider-color, #c1cad4);
                min-width: 1px;
                margin-top: 10px;
                padding-right: 5px;
                margin-bottom: 10px;
                padding-left: 5px;
                min-height: 18px;
            }
            .floatright{
                float:right;
                display: inline-flex;
                display: -webkit-inline-flex;
            }
            pebble-vertical-divider{
                margin: 0;
                display: inline-block;
                vertical-align: middle;

            }
            .entity-image {
                width: 20px;
                height: 20px;
                background: #ddd;
            }
        </style>
<div id="rockTitle" class="header">
    <div hidden$="{{!mainTitle}}" class="title-text">
        <template is="dom-if" if="[[_entityHasImage(config)]]">
            <pebble-image-viewer class="entity-image" src="config.image" sizing="contain"></pebble-image-viewer>
        </template>
        <template is="dom-if" if="[[!_entityHasImage(config)]]">
            <pebble-icon class="m-r-10" icon="[[icon]]"></pebble-icon>
        </template>
        <div id="title" class="text-ellipsis">
            <template is="dom-if" if="{{_isSubTitleDefined()}}">
                <div id="subTitle" class="text-ellipsis" title="{{subTitle}}">{{subTitle}}</div>
                <div id="mainTitle" title="{{mainTitle}}">{{mainTitle}}</div>
            </template>
            <template is="dom-if" if="{{!_isSubTitleDefined()}}">
                <div id="mainTitle" class="m-t-5" title="{{mainTitle}}">{{mainTitle}}
                </div>
            </template>
        </div>
        <slot></slot>         
    </div>
    <div class="pull-right">
        <template is="dom-if" if="[[noShare]]">
            <pebble-icon id="share" class="minimize m-l-5 tooltip-bottom" data-tooltip="Share" name="share" icon="pebble-md-icons:Sharepage"></pebble-icon>
        </template>
        <template is="dom-if" if="[[noSettings]]">
            <pebble-icon id="settings" class="minimize m-l-5 tooltip-bottom" name="settings" data-tooltip="Settings"
                icon="pebble-md-icons:Settings"></pebble-icon>
        </template>
        <template is="dom-if" if="[[!nonMinimizable]]">
            <pebble-icon id="minimize" class="minimize m-l-5 tooltip-bottom" name="minimize" data-tooltip="Minimize"
                icon="pebble-md-icons:Remove" on-tap="_onMinimize"></pebble-icon>
        </template>
        <template is="dom-if" if="[[!nonClosable]]">
            <pebble-icon id="close" name="close" icon="pebble-md-icons:Clear" data-tooltip="Close" on-tap="_onClose" class="m-l-5 tooltip-left"></pebble-icon>
        </template>
    </div>
</div>
</template>
<script>
    Polymer({
        is: 'rock-titlebar',
        properties: {
            config: {
                type: String,
                value: function() { return {}; }
            },
            /*
            * Indicates icon if value is set
            */
            icon: {
                type: String,
                reflectToAttribute: true
            },
            /*
            * Indicates title if value is set
            */
            mainTitle: {
                type: String,
                reflectToAttribute: true,
                notify: true
            },
            /*
            * Indicates sub title if value is set
            */
            subTitle: {
                type: String,
                reflectToAttribute: true,
                notify: true
            },
            /*
            * Indicates close icon should come or not to close window
            */
            nonClosable: {
                type: Boolean,
                reflectToAttribute: true
            },
            /* Specifies whether the card container have share icon or not.
             * If it is set to <b>true</b>, then the card container has share icon.
             */
            noShare: {
                type: Boolean,
                reflectToAttribute: true
            },
            /* Specifies whether the card container have Minimize icon or not.
             * If it is set to <b>true</b>, then the card container has Minimize icon.
             */
            nonMinimizable:{
                type: Boolean,
                reflectToAttribute: true
            },
            
            /* Specifies whether the card container have settings icon or not.
             * If it is set to <b>true</b>, then the card container has settings icon.
             */
            noSettings: {
                type: Boolean,
                reflectToAttribute: true
            }
        },
        behaviors: [
            RUFBehaviors.UIBehavior
        ],
        _onMinimize: function () {
            var contentView = document.querySelector("main-app").shadowRoot.querySelector("rock-content-view-manager").shadowRoot.querySelector("rock-content-view:not([hidden])");
            contentView.onMinimizeClick(contentView.name);
        },
       _onClose: function () {
           var isDirty = undefined;
            var contentView = document.querySelector("main-app").shadowRoot.querySelector("rock-content-view-manager").shadowRoot.querySelector("rock-content-view:not([hidden])");
            if(contentView) {
                var firstChild = contentView.shadowRoot.querySelector('#content').firstElementChild;
                if(firstChild && firstChild.getIsDirty) {
                    isDirty = firstChild.getIsDirty();
                }
            }
            if(isDirty) {
                var retVal = confirm("There are unsaved changes. Do you want to discard the changes?");
                if(retVal == true) {
                    contentView.onCloseClick(contentView.name);
                }
            }
            else {
                contentView.onCloseClick(contentView.name);
            }
        },
        _isSubTitleDefined: function () {
            if (this.attributes["sub-title"] == undefined) {
                return false;
            }
            return true;
        },
        _entityHasImage: function(config) {
            if(config && config.image && config.image != "") {
                return true
            }
            return false;
        }
    });
</script>
</dom-module>
