<link rel="import" href="../../../../bower_components/polymer/polymer.html">

<link rel="import" href="../../bedrock-pubsub/bedrock-pubsub.html">
<link rel="import" href="../../bedrock-ui-behavior/bedrock-ui-behavior.html">

<link rel="import" href="../../pebble-button/pebble-button.html">
<link rel="import" href="../../pebble-icon/pebble-icon.html">
<link rel="import" href="../../pebble-styles-shared/pebble-styles-shared.html">

<!--
`<rock-titlebar>` Represents a titlebar layout structure inside rock-layout. 
This element is a child of `<rock-layout>` element.

It can contian any elements or components.

For example:

        <rock-layout>
            <rock-titlebar icon="" sub-title="" title="" closable minimizable>
                title content . . .
            </rock-titlebar>
        </rock-layout>

@demo ../demo/index.html
-->
<dom-module id="rock-titlebar">
    <template>
        <style include="pebble-styles-shared"></style>
        <style>
            :host {
                display: flex;
                height: auto;
            }
            
            .header {
                color: black;
                position: inherit;
                background-color:var(--palette-pale-grey-five);
                border-top-left-radius: inherit;
                border-top-right-radius: inherit;
                overflow: hidden;
                box-shadow: 0 1px 2px 0 rgba(193, 202, 211, 0.7);
                /* @apply(--paper-card-header); */
                @apply(--layout-horizontal);
                width: 100%;
                height: 35px;
                padding: 0 10px;
            }
            
            #title {
                display: flex;
                flex-direction: column;
                width: 100%;
            }
            
            #subTitle {
                font-size: 12px;
                font-weight: normal;
                font-style: normal;
                font-stretch: normal;
                color: var(--color-steal-grey);
                line-height: 10px;
                margin-top: 7px;
            }
            
            #mainTitle {
                height: 16px;
                font-size: 14px;
                font-weight: 500;
                font-style: normal;
                font-stretch: normal;
                font-family: var(--default-font-family);
                color: var(--palette-deep-sea-blue);
                line-height: 22px;
            }

            .titleMargin {
                margin-top: 10px;
            }
            
            .header .title-text {
                display: flex;
                flex-direction: row;
                @apply(--layout-flex);
            }
            
            pebble-icon::shadow iron-icon {
                margin: 11px 10px 0 0;
                width: 16px;
                height: 16px;
                color:var(--palette-deep-sea-blue);
            }
            
            pebble-button::shadow paper-button {
                min-width: 0px;
            }            
            
        </style>
<div id="rockTitle" class="header">
    <div hidden$="{{!title}}" class="title-text">
        <pebble-icon icon="[[icon]]"></pebble-icon>
        <div id="title">
            <template is="dom-if" if="{{_isSubTitleDefined()}}">
                <div id="subTitle">{{subTitle}}</div>
                <div id="mainTitle">{{title}}</div>
            </template>
            <template is="dom-if" if="{{!_isSubTitleDefined()}}">
                <div id="mainTitle" class="titleMargin">{{title}}</div>
            </template>
        </div>
        <content>
        </content>
    </div>
    <div class="m-t-7">
        <template is="dom-if" if="[[minimizable]]">
            <pebble-button id="minimize" class="minimize pebble-md-icons" name="minimize" icon="pebble-md-icons:Remove" title="Minimize" on-tap="_onMinimize">
            </pebble-button>
        </template>
        <template is="dom-if" if="[[closable]]">
            <pebble-button id="close" name="close" icon="pebble-md-icons:Clear" title="Close" on-tap="_onClose" class="pebble-md-icons"></pebble-button>
        </template>
    </div>
</div>
</template>
<script>
    Polymer({
        is: 'rock-titlebar',
        properties: {
            /*
            * Indicates icon if value is set
            */
            icon: {
                type: String,
                reflectToAttribute: true
            },
            /*
            * Indicates title if value is set
            */
            title: {
                type: String,
                reflectToAttribute: true,
                notify: true
            },
            /*
            * Indicates sub title if value is set
            */
            subTitle: {
                type: String,
                reflectToAttribute: true,
                notify: true
            },
            /*
            * Indicates close icon should come or not to close window
            */
            closable: {
                type: Boolean,
                reflectToAttribute: true
            },
            /*
            * Indicates minimize icon should come or not to minimize window
            */
            minimizable: {
                type: Boolean,
                reflectToAttribute: true
            }
        },
        behaviors: [
            RUFBehaviors.UIBehavior
        ],
        _onMinimize: function () {
            var contentView = document.querySelector("main-app").$$("rock-content-view-manager").$$("rock-content-view:not([hidden])");
            contentView.onMinimizeClick(contentView.name);
        },
       _onClose: function () {
           var isDirty = undefined;
            var contentView = document.querySelector("main-app").$$("rock-content-view-manager").$$("rock-content-view:not([hidden])");
            if(contentView) {
                var firstChild = contentView.$$('#content').firstElementChild;
                if(firstChild && firstChild.getIsDirty) {
                    isDirty = firstChild.getIsDirty();
                }
            }
            if(isDirty) {
                var retVal = confirm("There are unsaved changes. Do you want to discard the changes?");
                if(retVal == true) {
                    contentView.onCloseClick(contentView.name);
                }
            }
            else {
                contentView.onCloseClick(contentView.name);
            }
        },
        _isSubTitleDefined: function () {
            if (this.attributes["sub-title"] == undefined) {
                return false;
            }
            return true;
        },
    });
</script>
</dom-module>