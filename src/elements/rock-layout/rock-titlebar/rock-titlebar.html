<link rel="import" href="../../../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bedrock-pubsub/bedrock-pubsub.html">
<link rel="import" href="../../bedrock-ui-behavior/bedrock-ui-behavior.html">
<link rel="import" href="../../pebble-vertical-divider/pebble-vertical-divider.html">
<link rel="import" href="../../pebble-button/pebble-button.html">
<link rel="import" href="../../pebble-icon/pebble-icon.html">
<link rel="import" href="../../pebble-styles-shared/pebble-styles-shared.html">
<link rel="import" href="../../pebble-image-viewer/pebble-image-viewer.html">

<!--
`<rock-titlebar>` Represents a titlebar layout structure inside rock-layout. 
This element is a child of `<rock-layout>` element.

It can contian any elements or components.

For example:

        <rock-layout>
            <rock-titlebar icon="" sub-title="" main-title="" closable minimizable>
                title content . . .
            </rock-titlebar>
        </rock-layout>

@demo ../demo/index.html
-->
<dom-module id="rock-titlebar">
    <template>
        <style include="pebble-styles-shared"></style>
        <style>
            :host {
                display: flex;
                display: -webkit-flex; /* Safari */
                height: auto;
            }            
            .header {
                position: inherit;
                background-color:var(--palette-white,#fff);
                border-top-left-radius: inherit;
                border-top-right-radius: inherit;
                @apply(--layout-horizontal);
                width: 100%;
             
                box-shadow: 0 1px 2px 0 rgba(193, 202, 211, 0.7);
                z-index: 9;
                padding:10px;
            }            
            #title {
                display: flex;
                display: -webkit-flex; /* Safari */
                flex-direction: column;
                -webkit-flex-direction: column;
                width: 100%;
            }            
            #subTitle {
                font-size: var(--font-size-sm, 12px);
                font-weight: normal;
                font-style: normal;
                font-stretch: normal;
                color: var(--label-text-color);
                line-height: 14px;
                padding-right: 30px;
            }            
            #mainTitle {
                height: 16px;
                font-size: var(--default-font-size, 14px);
                font-weight: var(--font-medium, 500);
                font-style: normal;
                font-stretch: normal;
                font-family: var(--default-font-family);
                color: var(--pagetitle-text-color);
                line-height: 18px;
            }         
            .header .title-text {
                display: flex;
                width: 60%;
                display: -webkit-flex; /* Safari */
                flex-direction: row;
                -webkit-flex-direction: row;
                @apply(--layout-flex);
            }            
            pebble-icon::shadow iron-icon {
                width: 16px;
                height: 16px;
                color:var(--palette-deep-sea-blue);
                margin-right: 10px;
            }
            pebble-button::shadow paper-button {
                min-width: 0px;
                color:var(--palette-deep-sea-blue);
            }            
            pebble-vertical-divider {
                --pebble-vertical-divider-color: var(--divider-color);
                min-width: 1px;
                margin: 10px 5px;
                min-height: 18px;
            }
            .floatright{
                float:right;
                display: inline-flex;
                display: -webkit-inline-flex;
            }
            pebble-vertical-divider{
                margin: 0;
                display: inline-block;
                vertical-align: middle;

            }
            .entity-image {
                width: 20px;
                height: 20px;
                background: #ddd;
            }
            .searchIcon {
            fill: #3BC2E6;
            *background-color: #3BC2E6;*
            height: 38px;
            width: 60px;
            border-radius: 5px;
        }
        </style>
<div id="rockTitle" class="header">
    <div hidden$="{{!mainTitle}}" class="title-text">
        <template is="dom-if" if="[[_entityHasImage(config)]]">
            <pebble-image-viewer class="entity-image" src="config.image" sizing="contain"></pebble-image-viewer>
        </template>
        <template is="dom-if" if="[!_entityHasImage(config)]]">
            <pebble-icon icon="[[icon]]" class="searchIcon"></pebble-icon>
        </template>
        <div id="title" class="text-ellipsis">
            <template is="dom-if" if="{{_isSubTitleDefined()}}">
                <div id="subTitle" class="text-ellipsis">{{subTitle}}</div>
                <div id="mainTitle">{{mainTitle}}</div>
            </template>
            <template is="dom-if" if="{{!_isSubTitleDefined()}}">
                <div id="mainTitle" class="m-t-5">{{mainTitle}}
                </div>
            </template>
        </div>
        <slot></slot>         
    </div>
    <div class="pull-right">
        <template is="dom-if" if="[[minimizable]]">
            <pebble-vertical-divider></pebble-vertical-divider>
            <template is="dom-if" if="[[showShare]]">
                 <pebble-button id="share" class="minimize pebble-md-icons m-l-5 tooltip-bottom" data-tooltip="Share" name="share" icon="pebble-md-icons:Sharepage"></pebble-button>
            </template>
            <template is="dom-if" if="[[showSettings]]">
                 <pebble-button id="settings" class="minimize pebble-md-icons m-l-5 tooltip-bottom" name="settings" data-tooltip="Settings" icon="pebble-md-icons:Settings"></pebble-button>
            </template>
            <template is="dom-if" if="[[showMinimize]]">
                <pebble-button id="minimize" class="minimize pebble-md-icons m-l-5 tooltip-bottom" name="minimize" data-tooltip="Minimize"  icon="pebble-md-icons:Remove" on-tap="_onMinimize"></pebble-button>
            </template>
        </template>
        <template is="dom-if" if="[[closable]]">
            <pebble-button id="close" name="close" icon="pebble-md-icons:Clear" data-tooltip="Clear" on-tap="_onClose" class="pebble-md-icons m-l-5 tooltip-left"></pebble-button>
        </template>
    </div>
</div>
</template>
<script>
    Polymer({
        is: 'rock-titlebar',
        properties: {
            config: {
                type: String,
                value: function() { return {}; }
            },
            /*
            * Indicates icon if value is set
            */
            icon: {
                type: String,
                reflectToAttribute: true
            },
            /*
            * Indicates title if value is set
            */
            mainTitle: {
                type: String,
                reflectToAttribute: true,
                notify: true
            },
            /*
            * Indicates sub title if value is set
            */
            subTitle: {
                type: String,
                reflectToAttribute: true,
                notify: true
            },
            /*
            * Indicates close icon should come or not to close window
            */
            closable: {
                type: Boolean,
                reflectToAttribute: true
            },
            /* Specifies whether the card container have share icon or not.
             * If it is set to <b>true</b>, then the card container has share icon.
             */
            showShare: {
                type: Boolean,
                value: true
            },
            /* Specifies whether the card container have Minimize icon or not.
             * If it is set to <b>true</b>, then the card container has Minimize icon.
             */
            showMinimize:{
                type: Boolean,
                value:true
            },
            
            /* Specifies whether the card container have settings icon or not.
             * If it is set to <b>true</b>, then the card container has settings icon.
             */
            showSettings: {
                type: Boolean,
                value: true
            },
            /*
            * Indicates minimize icon should come or not to minimize window
            */
            minimizable: {
                type: Boolean,
                reflectToAttribute: true
            }
        },
        behaviors: [
            RUFBehaviors.UIBehavior
        ],
        _onMinimize: function () {
            var contentView = document.querySelector("main-app").$$("rock-content-view-manager").$$("rock-content-view:not([hidden])");
            contentView.onMinimizeClick(contentView.name);
        },
       _onClose: function () {
           var isDirty = undefined;
            var contentView = document.querySelector("main-app").$$("rock-content-view-manager").$$("rock-content-view:not([hidden])");
            if(contentView) {
                var firstChild = contentView.$$('#content').firstElementChild;
                if(firstChild && firstChild.getIsDirty) {
                    isDirty = firstChild.getIsDirty();
                }
            }
            if(isDirty) {
                var retVal = confirm("There are unsaved changes. Do you want to discard the changes?");
                if(retVal == true) {
                    contentView.onCloseClick(contentView.name);
                }
            }
            else {
                contentView.onCloseClick(contentView.name);
            }
        },
        _isSubTitleDefined: function () {
            if (this.attributes["sub-title"] == undefined) {
                return false;
            }
            return true;
        },
        _entityHasImage: function(config) {
            if(config && config.image && config.image != "") {
                return true
            }
            return false;
        }
    });
</script>
</dom-module>