<link rel="import" href="../../../bower_components/polymer/polymer.html">
<link rel="import" href="../../../bower_components/iron-flex-layout/iron-flex-layout.html">
<link rel="import" href="../../../bower_components/iron-icons/iron-icons.html">
<link rel="import" href="../../../bower_components/iron-icons/device-icons.html">
<link rel="import" href="../../../bower_components/paper-dropdown-menu/paper-dropdown-menu.html" />
<link rel="import" href="../../../bower_components/paper-listbox/paper-listbox.html">
<link rel="import" href="../../../bower_components/paper-item/paper-item.html">
<link rel="import" href="../bedrock-ui-behavior/bedrock-ui-behavior.html">
<link rel="import" href="../bedrock-helpers/data-helper.html">
<link rel="import" href="../pebble-button/pebble-button.html">
<link rel="import" href="../pebble-icons/pebble-icons.html">
<link rel="import" href="../pebble-lov/pebble-lov.html">
<link rel="import" href="../pebble-popover/pebble-popover.html">
<link rel="import" href="../pebble-styles-shared/pebble-styles-shared.html">
<!--
`<rock-dimension-selector>` Represents a component to hold a container, source, date, and locale information. 
The elements inside this component can be dyncamically loaded based on a config json.

### Styling

The following custom properties and mixins are available for styling:

Custom property | Description | Default
----------------|-------------|----------
`--dimesion-selector-container-popover` | Mixin applied to container selector dropdown  | `{}`
`--dimesion-selector-source-popover` | Mixin applied to source selector dropdown   | `{}`
`--dimesion-selector-locale-popover` | Mixin applied to locale selector dropdown   | `{}`

@group rock Elements
@element rock-dimension-selector
@demo demo/index.html
-->
<dom-module id="rock-dimension-selector">
    <template>
        <style include="pebble-styles-shared"></style>
        <style is="custom-style" include="iron-flex"></style>
        <style is="custom-style">
            :host {
                display: inline-block;
            }
            
            #listPopover {
                @apply(--dimesion-selector-container-popover);
                --pebble-popover-width: 160px;
            }
            
            #sourcePopover {
                @apply(--dimesion-selector-source-popover);
                --pebble-popover-width: 160px;
            }
            
            #localePopover {
                @apply(--dimesion-selector-locale-popover);
                --pebble-popover-width: 160px;
            }
            
            div iron-icon {
                fill: var(--palette-steel-grey);
                height: var(--icon-set-height);
                width: var(--icon-set-height);
                @apply(--dimension-selector-icon);
            }
            
            .default-btn::shadow paper-menu-button paper-button {
                height: 26px;
            }
            
            .default-btn::shadow paper-menu-button paper-button #rightIcon {
                width: 20px;
                height: 20px;
            }
            
            .default-btn::shadow paper-button,
            .default-btn::shadow pebble-button::shadow paper-button {
                border: 0;
                background-color: inherit;
            }
            pebble-button::shadow paper-button {
                color:var(--palette-deep-sea-blue) !important;
            } 
        </style>
        <div class="horizontal layout container">
            <div hidden="[[!configData.catalogSelector.visible]]">
                <div>
                    <pebble-button id="listPopoverToggle" icon="pebble-lg-icons:Perspective" class="dropdownText default-btn m-l-5 m-r-5" menu-button
                        dropdown-icon button-text="Container" noink raised no-overlap vertical-offset="-211" horizontal-offset="11"
                        on-tap="_onDimensionTapped">
                        </pebble-button>
                </div>
                <pebble-popover id="listPopover" for="listPopoverToggle" auto-fit-on-attach no-overlap>
                    <pebble-lov id="listLov" items="[[configData.catalogSelector.catalogItems]]" selected-items="[[configData.catalogSelector.selectedCatalogItems]]"
                        multi-select no-sub-title show-action-buttons></pebble-lov>
                </pebble-popover>
            </div>
            <div hidden="[[!configData.sourceSelector.visible]]">
                <div>
                    <pebble-button id="sourcePopoverToggle" icon="pebble-lg-icons:Source" class="dropdownText default-btn
                m-l-5 m-r-5" menu-button dropdown-icon button-text="Source" noink raised no-overlap vertical-offset="-211"
                        horizontal-offset="11" on-tap="_onDimensionTapped">
                        </pebble-button>
                </div>
                <pebble-popover id="sourcePopover" for="sourcePopoverToggle" auto-fit-on-attach no-overlap>
                    <pebble-lov id="sourceLov" items="[[configData.sourceSelector.sourceItems]]" selected-items="[[configData.sourceSelector.selectedSourceItems]]"
                        multi-select no-sub-title show-action-buttons></pebble-lov>
                </pebble-popover>
            </div>
            <div hidden="[[!configData.dateSelector.visible]]">
                <div>
                    <!-- Todo -->
                </div>
            </div>
            <div hidden="[[!configData.localeSelector.visible]]">
                <div>
                    <pebble-button id="localePopoverToggle" icon="pebble-lg-icons:Language" class="dropdownText default-btn
                m-l-5 m-r-5" menu-button dropdown-icon button-text="Locales" noink raised no-overlap vertical-offset="-211"
                        horizontal-offset="11" on-tap="_onDimensionTapped">
                        </pebble-button>
                </div>
                <pebble-popover id="localePopover" for="localePopoverToggle" auto-fit-on-attach no-overlap>
                    <pebble-lov id="localeLov" items="[[configData.localeSelector.localeItems]]" selected-items="[[configData.localeSelector.selectedLocaleItems]]"
                        multi-select no-sub-title show-action-buttons></pebble-lov>
                </pebble-popover>
            </div>
        </div>
    </template>
</dom-module>
<script>
    Polymer({
         is:"rock-dimension-selector",
        properties: {
            /**
             * Fired when user changes the list selector selection 
             *
             * @event dimension-selector-list (pub-sub event)
             * @param {Object} selectedItemsInfo
             */

            /**
             * Fired when user changes the source selector selection 
             *
             * @event dimension-selector-source (pub-sub event)
             * @param {Object} selectedItemsInfo
             */

            /**
             * Fired when user changes the locale selector selection 
             *
             * @event dimension-selector-locale (pub-sub event)
             * @param {Object} selectedItemsInfo
             */

            /**
             * Returns the list of items which you must place in the dimension selector component.
             */
            configData: {
                type: Object,
                value: function () {
                    return {};
                },
                'observer': '_configDataChanged'
            },

            allMultiSelect: {
                type: Boolean,
                value: false
            },

            listSelector: {
                type: Object,
                value: function () {
                    return {};
                }
            },

            sourceSelector: {
                type: Object,
                value: function () {
                    return {};
                }
            },

            localeSelector: {
                type: Object,
                value: function () {
                    return {};
                }
            },

            selectedList: {
                type: String,
                observer: '_selectedListChanged'
            },

            selectedLists: {
                type: Array,
                value: function () {
                    return [];
                },
                observer: '_selectedListsChanged'
            },

            selectedSource: {
                type: String,
                observer: '_selectedSourceChanged'
            },

            selectedSources: {
                type: Array,
                value: function () {
                    return [];
                },
                observer: '_selectedSourcesChanged'
            },

            selectedLocale: {
                type: String,
                observer: '_selectedLocaleChanged'
            },

            selectedLocales: {
                type: Array,
                value: function () {
                    return [];
                },
                observer: '_selectedLocalesChanged'
            },

            _isListSelectorMultiSelect: {
                type: Boolean,
                value: true,
                observer: '_listSelectorModeChanged'
            },

            _isSourceSelectorMultiSelect: {
                type: Boolean,
                value: true,
                observer: '_sourceSelectorModeChanged'
            },

            _isLocaleSelectorMultiSelect: {
                type: Boolean,
                value: true,
                observer: '_localeSelectorModeChanged'
            },

            _selectedDimensionPopover: {
                type: Object,
                value: function () {
                    return {};
                }
            },

            _selectedDimensionLov: {
                type: Object,
                value: function () {
                    return {};
                }
            },

            selectedDimensions: {
                type: Object,
                notify: true,
                value: function() {
                    return {
                        "locales": [],
                        "sources": [],
                        "lists": []
                    };
                }
            }
        },

        behaviors: [
            RUFBehaviors.UIBehavior
        ],

        listeners: {
            'lov-confirm-button-tap': '_onLovConfirmButtonTapped',
            'lov-close-button-tap': '_onLovCloseButtonTapped',
        },

        ready: function () {
            this._initializeObjects();
        },

        // observers
        _selectedListChanged: function () {

        },

        _selectedListsChanged: function () {
            
        },

        _selectedSourceChanged: function () {

        },

        _selectedSourcesChanged: function () {

        },

        _selectedLocaleChanged: function () {

        },

        _selectedLocalesChanged: function () {

        },
        // observers

        _initializeObjects: function () {
            if (DataHelper.isEmptyObject(this.listSelector)) {
                this.listSelector.toggleButton = this.$$("#listPopoverToggle");
                this.listSelector.toggleButton.defaultButtonText = "Container";
                this.listSelector.popover = this.$$("#listPopover");
                this.listSelector.lov = this.$$("#listLov");
                this.listSelector.selectionChangedHandler = this._listSelectionChanged.bind(this);
                this.listSelector.selectedItem = null;
                this.set("listSelector.selectedItems", []);
            }

            if (DataHelper.isEmptyObject(this.sourceSelector)) {
                this.sourceSelector.toggleButton = this.$$("#sourcePopoverToggle");
                this.sourceSelector.toggleButton.defaultButtonText = "Source";
                this.sourceSelector.popover = this.$$("#sourcePopover");
                this.sourceSelector.lov = this.$$("#sourceLov");
                this.sourceSelector.selectionChangedHandler = this._sourceSelectionChanged.bind(this);
                this.sourceSelector.selectedItem = null;
                this.set("sourceSelector.selectedItems", []);
            }

            if (DataHelper.isEmptyObject(this.localeSelector)) {
                this.localeSelector.toggleButton = this.$$("#localePopoverToggle");
                this.localeSelector.toggleButton.defaultButtonText = "Locale";
                this.localeSelector.popover = this.$$("#localePopover");
                this.localeSelector.lov = this.$$("#localeLov");
                this.localeSelector.selectionChangedHandler = this._localeSelectionChanged.bind(this);
                this.localeSelector.selectedItem = null;
                this.set("localeSelector.selectedItems", []);
            }
        },

        _configDataChanged: function () {
            if (this.configData && this.configData.catalogSelector) {
                // Here it is assumed that first time the lov will always be multi-select
                this.listSelector.lov.selectedItems = this.configData.catalogSelector.selectedCatalogItems;
                this.listSelector.lov.selectedItem = this.configData.catalogSelector.selectedCatalogItem;

                if (this.listSelector.lov.selectedItems) {
                    this.listSelector.selectedItems = this.listSelector.lov.selectedItems;
                    if (this.listSelector.selectedItems && this.listSelector.selectedItems.length > 0) {
                        this.listSelector.selectedItem = this.listSelector.selectedItems[0];
                    }
                } else {
                    this.listSelector.selectedItem = this.listSelector.lov.selectedItem;
                    if (this.listSelector.selectedItem) {
                        this.listSelector.selectedItems.push(this.listSelector.selectedItem);
                    }
                }

                this._displayToggleButtonText(this.listSelector, this._isListSelectorMultiSelect);
            }

            if (this.configData && this.configData.sourceSelector) {
                // Here it is assumed that first time the lov will always be multi-select
                this.sourceSelector.lov.selectedItems = this.configData.sourceSelector.selectedSourceItems;
                this.sourceSelector.lov.selectedItem = this.configData.sourceSelector.selectedSourceItem;

                if (this.sourceSelector.lov.selectedItems) {
                    this.sourceSelector.selectedItems = this.sourceSelector.lov.selectedItems;
                    if (this.sourceSelector.selectedItems && this.sourceSelector.selectedItems.length > 0) {
                        this.sourceSelector.selectedItem = this.sourceSelector.selectedItems[0];
                    }
                } else {
                    this.sourceSelector.selectedItem = this.sourceSelector.lov.selectedItem;
                    if (this.sourceSelector.selectedItem) {
                        this.sourceSelector.selectedItems.push(this.sourceSelector.selectedItem);
                    }
                }

                this._displayToggleButtonText(this.sourceSelector, this._isSourceSelectorMultiSelect);
            }

            if (this.configData && this.configData.localeSelector) {
                // Here it is assumed that first time the lov will always be multi-select
                this.localeSelector.lov.selectedItems = this.configData.localeSelector.selectedLocaleItems;
                this.localeSelector.lov.selectedItem = this.configData.localeSelector.selectedLocaleItem;

                if (this.localeSelector.lov.selectedItems) {
                    this.localeSelector.selectedItems = this.localeSelector.lov.selectedItems;
                    if (this.localeSelector.selectedItems && this.localeSelector.selectedItems.length > 0) {
                        this.localeSelector.selectedItem = this.localeSelector.selectedItems[0];
                    }
                } else {
                    this.localeSelector.selectedItem = this.localeSelector.lov.selectedItem;
                    if (this.localeSelector.selectedItem) {
                        this.localeSelector.selectedItems.push(this.localeSelector.selectedItem);
                    }
                }

                this._displayToggleButtonText(this.localeSelector, this._isLocaleSelectorMultiSelect);
            }

            if (this.configData && this.configData.localeSelector) {

                this._setSelectedDimension();

                this.fire('dimension-selector-initialized', {
                    item: "value"
                });
            }
        },

        _onDimensionTapped: function (event) {
            if (this.listSelector && Polymer.dom(event).path.indexOf(this.listSelector.toggleButton) !==
                -1) {
                this._selectedDimensionPopover = this.listSelector.popover;
                this._selectedDimensionLov = this.listSelector.lov;
            }

            if (this.sourceSelector && Polymer.dom(event).path.indexOf(this.sourceSelector.toggleButton) !==
                -1) {
                this._selectedDimensionPopover = this.sourceSelector.popover;
                this._selectedDimensionLov = this.sourceSelector.lov;
            }

            if (this.localeSelector && Polymer.dom(event).path.indexOf(this.localeSelector.toggleButton) !==
                -1) {
                this._selectedDimensionPopover = this.localeSelector.popover;
                this._selectedDimensionLov = this.localeSelector.lov;
            }

            this._toggleLovPopover(this._selectedDimensionPopover, this._selectedDimensionLov);
        },

        _onLovConfirmButtonTapped: function (event) {
            if (Polymer.dom(event).path.indexOf(this.listSelector.popover) !== -1) {
                if (this.listSelector.lov.multiSelect) {

                    if (!this.allMultiSelect) {
                        this._toggleLovSelectionMode(this.listSelector, [this.sourceSelector, this.localeSelector]);


                        // This can also be listened on multi-select-changed event
                        this._isSourceSelectorMultiSelect = this.sourceSelector.lov.multiSelect;
                        this._isLocaleSelectorMultiSelect = this.localeSelector.lov.multiSelect;
                    }

                    this._displayToggleButtonText(this.listSelector, this._isListSelectorMultiSelect);
                }

                this.fire('bedrock-event', {
                    name: "dimension-selector-list",
                    data: this._getSelectedItemsInfo(this.listSelector)
                });
            }

            if (Polymer.dom(event).path.indexOf(this.sourceSelector.popover) !== -1) {
                if (this.sourceSelector.lov.multiSelect) {

                    if (!this.allMultiSelect) {
                        this._toggleLovSelectionMode(this.sourceSelector, [this.listSelector, this.localeSelector]);

                        this._isListSelectorMultiSelect = this.listSelector.lov.multiSelect;
                        this._isLocaleSelectorMultiSelect = this.localeSelector.lov.multiSelect;
                    }

                    this._displayToggleButtonText(this.sourceSelector, this._isSourceSelectorMultiSelect);
                }

                this.fire('bedrock-event', {
                    name: "dimension-selector-source",
                    data: this._getSelectedItemsInfo(this.sourceSelector)
                });
            }

            if (Polymer.dom(event).path.indexOf(this.localeSelector.popover) !== -1) {
                if (this.localeSelector.lov.multiSelect) {

                    if (!this.allMultiSelect) {
                        this._toggleLovSelectionMode(this.localeSelector, [this.listSelector, this.sourceSelector]);

                        this._isListSelectorMultiSelect = this.listSelector.lov.multiSelect;
                        this._isSourceSelectorMultiSelect = this.sourceSelector.lov.multiSelect;
                    }

                    this._displayToggleButtonText(this.localeSelector, this._isLocaleSelectorMultiSelect);
                }

                this.fire('bedrock-event', {
                    name: "dimension-selector-locale",
                    data: this._getSelectedItemsInfo(this.localeSelector)
                });
            }

            this.listSelector.selectedItems = this.listSelector.lov.selectedItems;
            this.sourceSelector.selectedItems = this.sourceSelector.lov.selectedItems;
            this.localeSelector.selectedItems = this.localeSelector.lov.selectedItems;

           this._setSelectedDimension();

            this._toggleLovPopover(this._selectedDimensionPopover, this._selectedDimensionLov);
        },

        _toggleLovSelectionMode: function (currentSelector, otherSelectors) {
            if (currentSelector.lov.selectedItems.length > 1) {
                for (var i = 0; i < otherSelectors.length; i++) {
                    otherSelectors[i].lov.multiSelect = !currentSelector.lov.multiSelect;
                }
            } else {
                for (var i = 0; i < otherSelectors.length; i++) {
                    otherSelectors[i].lov.multiSelect = currentSelector.lov.multiSelect;
                }
            }
        },

        _onLovCloseButtonTapped: function () {
            this._toggleLovPopover(this._selectedDimensionPopover, this._selectedDimensionLov);
        },

        _listSelectorModeChanged: function () {
            if (this.listSelector.lov) {
                if (!this.listSelector.lov.multiSelect) {
                    this.listSelector.lov.addEventListener('selection-changed', this.listSelector.selectionChangedHandler);

                    if (this.listSelector.selectedItems && this.listSelector.selectedItems.length ==
                        1) {
                        this.listSelector.lov.selectedItem = this.listSelector.selectedItems[0];
                    }
                } else {
                    this.listSelector.lov.removeEventListener('selection-changed', this.listSelector.selectionChangedHandler);

                    if (this.listSelector.selectedItem) {
                        this.listSelector.lov.push('selectedItems', this.listSelector.selectedItem);
                    }
                }

                this._displayToggleButtonText(this.listSelector, this._isListSelectorMultiSelect);
                this.listSelector.isMultiSelect = this._isListSelectorMultiSelect;
            }
        },

        _listSelectionChanged: function () {
            if (this.listSelector && this.listSelector.lov) {
                this.listSelector.selectedItem = this.listSelector.lov.selectedItem;
                this._displayToggleButtonText(this.listSelector, this._isListSelectorMultiSelect);
                this.fire('bedrock-event', {
                    name: "dimension-selector-list",
                    data: this._getSelectedItemsInfo(this.listSelector)
                });

                if (this.listSelector.popover.isopen) {
                    this.listSelector.popover.hide();
                }
            }
        },

        _sourceSelectorModeChanged: function () {
            if (this.sourceSelector && this.sourceSelector.lov) {
                if (!this.sourceSelector.lov.multiSelect) {
                    this.sourceSelector.lov.addEventListener('selection-changed', this.sourceSelector.selectionChangedHandler);

                    if (this.sourceSelector.selectedItems && this.sourceSelector.selectedItems.length == 1) {
                        this.sourceSelector.lov.selectedItem = this.sourceSelector.selectedItems[0];
                    }
                } else {
                    this.sourceSelector.lov.removeEventListener('selection-changed', this.sourceSelector.selectionChangedHandler);

                    if (this.sourceSelector.selectedItem) {
                        this.sourceSelector.lov.push('selectedItems', this.sourceSelector.selectedItem);
                    }
                }

                this._displayToggleButtonText(this.sourceSelector, this._isSourceSelectorMultiSelect);
            }
        },

        _sourceSelectionChanged: function () {
            if (this.sourceSelector && this.sourceSelector.lov) {
                this.sourceSelector.selectedItem = this.sourceSelector.lov.selectedItem;
                this._displayToggleButtonText(this.sourceSelector, this._isSourceSelectorMultiSelect);
                this.fire('bedrock-event', {
                    name: "dimension-selector-source",
                    data: this._getSelectedItemsInfo(this.sourceSelector)
                });

                if (this.sourceSelector.popover.isopen) {
                    this.sourceSelector.popover.hide();
                }
            }
        },

        _localeSelectorModeChanged: function () {
            if (this.localeSelector && this.localeSelector.lov) {
                if (!this.localeSelector.lov.multiSelect) {
                    this.localeSelector.lov.addEventListener('selection-changed', this.localeSelector.selectionChangedHandler);

                    if (this.localeSelector.selectedItems && this.localeSelector.selectedItems.length == 1) {
                        this.localeSelector.lov.selectedItem = this.localeSelector.selectedItems[0];
                    }
                } else {
                    this.localeSelector.lov.removeEventListener('selection-changed', this.localeSelector.selectionChangedHandler);

                    if (this.localeSelector.selectedItem) {
                        this.localeSelector.lov.push('selectedItems', this.localeSelector.selectedItem);
                    }
                }

                this._displayToggleButtonText(this.localeSelector, this._isLocaleSelectorMultiSelect);
            }
        },

        _localeSelectionChanged: function () {
            if (this.localeSelector && this.localeSelector.lov) {
                this.localeSelector.selectedItem = this.localeSelector.lov.selectedItem;
                this._displayToggleButtonText(this.localeSelector, this._isLocaleSelectorMultiSelect);
                this.fire('bedrock-event', {
                    name: "dimension-selector-locale",
                    data: this._getSelectedItemsInfo(this.localeSelector)
                });

                if (this.localeSelector.popover.isopen) {
                    this.localeSelector.popover.hide();
                }
            }
        },

         _toggleLovPopover: function () {
            if (!DataHelper.isEmptyObject(this._selectedDimensionPopover) && !DataHelper.isEmptyObject(this
                    ._selectedDimensionLov)) {
                if (!this._selectedDimensionPopover.opened && !this._selectedDimensionLov.isopen) {
                    this._selectedDimensionPopover.show();
                    this._selectedDimensionLov.activate();
                } else {
                    this._selectedDimensionPopover.hide();
                }
            }
        },

        _displayToggleButtonText: function (dimensionObject, isMultiSelect) {
            if (!dimensionObject && !dimensionObject.toggleButton) {
                console.error('dimensionObject or toggleButton is undefined, cannot show dimension selector text');
                return;
            }
            if (dimensionObject.lov.selectedItem) {
                dimensionObject.toggleButton.buttonText = dimensionObject.lov.selectedItem.title;
            }
            else if (dimensionObject.lov.selectedItems && dimensionObject.lov.selectedItems.length == 1) {
                dimensionObject.toggleButton.buttonText = dimensionObject.lov.selectedItems[0].title;
            }
            else if(dimensionObject.lov.selectedItems && dimensionObject.lov.selectedItems.length > 1) {
                dimensionObject.toggleButton.buttonText = dimensionObject.lov.selectedItems.length + " " + 
                    dimensionObject.toggleButton.defaultButtonText.toLowerCase() +"s";
            }
            else {
                //this shouldn't happen
                dimensionObject.toggleButton.buttonText = dimensionObject.toggleButton.defaultButtonText;
            }
        },

        _getSelectedItemsInfo: function (dimensionSelector) {
            var dimensionSelectedItem;
            var dimensionSelectedItems = [];

            if (dimensionSelector.lov.multiSelect) {
                if (dimensionSelector.lov.selectedItems.length > 0) {
                    dimensionSelectedItem = dimensionSelector.lov.selectedItems[0];
                    dimensionSelectedItems = dimensionSelector.lov.selectedItems;
                }
            } else {
                if (dimensionSelector.lov.selectedItem) {
                    dimensionSelectedItems.push(dimensionSelector.lov.selectedItem);
                    dimensionSelectedItem = dimensionSelector.lov.selectedItem;
                }
            }

            return {
                multiSelect: dimensionSelector.lov.multiSelect,
                selectedItem: dimensionSelectedItem,
                selectedItems: dimensionSelectedItems,
            }
        },

        /*
         * returns object of selected dimensions as below,
         * object.selectedLocales
         * object.selectedSources
         * object.selectedContexts
         */
        getSelectedDimensions: function () {
            var dimensionData = {};

            dimensionData.selectedContexts = [this._getSelectedValue(this.configData.catalogSelector.catalogItems,
                this.configData.catalogSelector.selectedCatalogItems)];
            dimensionData.selectedSources = [this._getSelectedValue(this.configData.sourceSelector.sourceItems,
                this.configData.sourceSelector.selectedSourceItems)];
            dimensionData.selectedLocales = [this._getSelectedValue(this.configData.localeSelector.localeItems,
                this.configData.localeSelector.selectedLocaleItems)];

            return dimensionData;
        },

        _getSelectedValue: function (data, selectedItems) {
            if (data != undefined && data != null) {
                for (var i = 0; i < data.length; i++) {
                    if (this._indexOfItem(selectedItems, data[i])) {
                        return data[i].value;
                    }
                }
            }
        },

        _indexOfItem: function (selectedItems, selectedItemToCompare) {
             var isSelected = false;
            
            selectedItems.forEach(function(item) {
                if(item.id == selectedItemToCompare.id) {
                    isSelected = true;
                }
            }, this);

            return isSelected;
         },
         
         _setSelectedDimension: function() {
            this.selectedDimensions = undefined;
            this.selectedDimensions = {
                "lists": this.listSelector.selectedItems,
                "sources": this.sourceSelector.selectedItems,
                "locales": this.localeSelector.selectedItems
            };
         }
    });
</script>