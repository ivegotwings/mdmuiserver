<!Doctype html>
<html>

<head>
    <title>dimension-selector test</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, minimum-scale=1.0, initial-scale=1, user-scalable=yes">
    <script src="../../../../bower_components/webcomponentsjs/webcomponents-lite.js"></script>
    <script src="../../../../bower_components/web-component-tester/browser.js"></script>
     
    <link rel="import" href="../../../../bower_components/polymer/polymer.html">
    <!--<link rel="import" href="../../../../bower_components/iron-test-helpers/test-helpers.html" />-->
    <link rel="import" href="../rock-dimension-selector.html" />
</head>

<body>
    <test-fixture id="dimensionSelector">
        <template>
            <rock-dimension-selector></rock-dimension-selector>
        </template>
    </test-fixture>
    <script>
        var dimensionSelectorElement;

        suite('dimension-selector', function () {

            setup(function () {
                dimensionSelectorElement = fixture('dimensionSelector');
                dimensionSelectorElement.configData = config;
            });

            test('instantiating the dimension selector works', function () {
                assert.equal(dimensionSelectorElement.is, 'rock-dimension-selector');
            });

            test('dimensions with visible flag set to true are displayed', function () {
                // date selector visible flag is set to false. So, shouldn't be visible
                Polymer.dom.flush();
                var dateSelector = document.getElementById('datePopover');

                assert.equal(dateSelector, undefined);
            });

            test('dropdown with a pre-selected item works', function () {
                // catalog selector has master item has selected flag set to true 
                Polymer.dom.flush();
                var actualSelectedItems = dimensionSelectorElement.$.listLov.selectedItems;
                var expectedSelectedItems = config.catalogSelector.selectedCatalogItems;
                expect(actualSelectedItems).to.be.equal(expectedSelectedItems);
            });

            test('no. of items in the dropdown match with the no. of items given in config', function () {
                // catalog selector has 2 items - master and staging. So, count should be 2.
                Polymer.dom.flush();
                var actualSelectedItems = dimensionSelectorElement.$.listLov.selectedItems;
                var expectedSelectedItems = config.catalogSelector.selectedCatalogItems;
                assert.equal(actualSelectedItems.length, expectedSelectedItems.length);
            });

            // To be corrected
            // test('dropdown opens when tapped', function (done) {
            //     Polymer.dom.flush();

            //     var catalogSelector = document.getElementById('catalogPopover');
            //     var content = Polymer.dom(catalogSelector).querySelector('.dropdown-content');

            //     var contentRect = content.getBoundingClientRect();
            //     expect(contentRect.width).to.be.equal(0);
            //     expect(contentRect.height).to.be.equal(0);
            //     runAfterOpen(catalogSelector, function () {
            //         contentRect = content.getBoundingClientRect();
            //         expect(catalogSelector.opened).to.be.equal(true);
            //         expect(contentRect.width).to.be.greaterThan(0);
            //         expect(contentRect.height).to.be.greaterThan(0);
            //         done();
            //     });
            //     expect(catalogSelector.opened).to.be.equal(true);

            // });

            // test('dropdown closes when an item is selected', function (done) {
            //     Polymer.dom.flush();
            //     var catalogSelector = document.getElementById('catalogPopover');
            //     var content = Polymer.dom(catalogSelector).querySelector('.dropdown-content');

            //     runAfterOpen(catalogSelector, function () {
            //         var firstItem = Polymer.dom(content).querySelector('paper-item');
            //         MockInteractions.tap(firstItem);
            //         Polymer.Base.async(function () {
            //             expect(catalogSelector.opened).to.be.equal(false);
            //             done();
            //         });
            //     });
            // });
        });

        function runAfterOpen(menu, callback) {
            menu.$.menuButton.$.dropdown.addEventListener('iron-overlay-opened', function () {
                Polymer.Base.async(callback, 1);
            });
            MockInteractions.tap(menu);
        }

        var config = {
            "catalogSelector": {
                "visible": true,
                "catalogItems": [{
                        "id": 1,
                        "title": "UK Website",
                        "subtitle": "UK Website",
                        "value": "ukWebsiteData",
                        "image": ""
                    },
                    {
                        "id": 2,
                        "title": "Fall 2016",
                        "subtitle": "Fall 2016",
                        "value": "fall2016",
                        "image": ""
                    },
                    {
                        "id": 3,
                        "title": "Ecommerce",
                        "subtitle": "Ecommerce",
                        "value": "ecommerce",
                        "image": ""
                    },
                    {
                        "id": 4,
                        "title": "Master",
                        "subtitle": "Master",
                        "value": "productMaster",
                        "image": ""
                    }
                ],
                "selectedCatalogItems": [{
                    "id": 4,
                    "title": "Master",
                    "subtitle": "Master",
                    "value": "productMaster",
                    "image": ""
                }]
            },
            "sourceSelector": {
                "visible": true,
                "sourceItems": [{
                        "id": 1,
                        "title": "SAP",
                        "subtitle": "SAP",
                        "value": "SAP",
                        "image": ""
                    },
                    {
                        "id": 2,
                        "title": "PLM",
                        "subtitle": "PLM",
                        "value": "PLM",
                        "image": ""
                    }
                ],
                "selectedSourceItems": [{
                    "id": 1,
                    "title": "SAP",
                    "subtitle": "SAP",
                    "value": "SAP",
                    "image": ""
                }]
            },
            "dateSelector": {
                "visible": true
            },
            "localeSelector": {
                "visible": true,
                "localeItems": [{
                        "id": 1,
                        "title": "German",
                        "subtitle": "Germany",
                        "value": "de-DE",
                        "image": ""
                    },
                    {
                        "id": 2,
                        "title": "United States",
                        "subtitle": "English",
                        "value": "en-US",
                        "image": ""
                    },
                    {
                        "id": 3,
                        "title": "Spain",
                        "subtitle": "Spanish",
                        "value": "es-ES",
                        "image": ""
                    },
                    {
                        "id": 4,
                        "title": "French",
                        "subtitle": "France",
                        "value": "fr-FR",
                        "image": ""
                    }
                ],
                "selectedLocaleItems": [{
                    "id": 2,
                    "title": "United States",
                    "subtitle": "English",
                    "value": "en-US",
                    "image": ""
                }]
            }
        }
    </script>
</body>

</html>