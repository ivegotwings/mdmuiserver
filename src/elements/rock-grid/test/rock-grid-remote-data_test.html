<!doctype html>
<html>

<head>
  <title>rock-grid-remote-data tests</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, minimum-scale=1.0, initial-scale=1, user-scalable=yes">
  <script src="../../../../bower_components/web-component-tester/browser.js"></script>
  <script src="../../../../bower_components/iron-test-helpers/mock-interactions.js"></script>
  <link rel="import" href="../../../../bower_components/iron-test-helpers/iron-test-helpers.html">
  <link rel="import" href="../../../../bower_components/polymer/polymer.html">
  <link rel="import" href="../rock-grid.html">
  <link rel="import" href="fake-data-source.html">
  <link rel="import" href="../../pebble-test-helpers/pebble-test-helpers.html">
</head>

<body>
  <test-fixture id="basic">
    <template>
      <fake-data-source></fake-data-source>
      <rock-grid record-size="50" page-size="10"></rock-grid>
    </template>
  </test-fixture>
  <script>
    var gridElement;
    var dataElement;
    var config = {
      "viewMode": "Tabular",
      "title": "Simple Data Table",
      "mode": "read",
      "header": {
        "displayTitle": false,
        "defaultValue": "Simple Data Table"
      },
      "tabular": {
        "settings": {

          "isMultiSelect": true,
          "actions": [{
              "name": "delete",
              "icon": "pebble-icons:Delete",
              "eventName": "delete-item"
            },
            {
              "name": "edit"
            }

          ]

        },
        "columns": [{
            "header": "Short Name",
            "name": "shortName",
            "sortable": true,
            "filterable": false,
            "displayType": "textbox",
            "maxLength": 7
          },
          {
            "header": "Long Name",
            "name": "longName",
            "sortable": false,
            "filterable": true,
            "displayType": "textarea",
            "maxLength": 10
          },
          {
            "header": "Product Type",
            "name": "productType",
            "sortable": false,
            "filterable": false,
            "displayType": "textbox",
            "maxLength": 10
          },
          {
            "header": "Description",
            "name": "description",
            "sortable": true,
            "filterable": false,
            "displayType": "textbox",
            "maxLength": "20"

          },
          {
            "header": "Is New",
            "name": "isNew",
            "sortable": false,
            "filterable": false,
            "displayType": "boolean",
            "required": true
          }
        ]
      }
    };

    setup(function () {
      //replace('liquid-entity-data-get').with('fake-liquid-entity-data-get');
      gridElement = fixture('basic')[1];
      dataElement = fixture('basic')[0];

      gridElement.config = config;
      gridElement.dataSource = dataElement.dataSource;
      gridElement.gridDataSize = dataElement.size;
      Polymer.dom.flush();
    });

    function getIronDataTable() {
      return Polymer.dom(gridElement.root).node.querySelector("iron-data-table") ||
        Polymer.dom(gridElement).node.querySelector("iron-data-table");
    }

    suite('rock-grid', function () {
      test('instantiating the rock grid element works', function () {
        assert.equal(gridElement.is, 'rock-grid');
      });

      test('Data binding works', function (done) {
        setTimeout(function () {
          var ironDataTable = getIronDataTable();
          assert.equal(ironDataTable.$.list.items.length, 10);
          done();
        }, 1000);
      });

      //TO-DO this unit test requires other findings to make it work
      // Right now scroll is not working since iron-list has 10 recored but internal div of iron-list
      // is not getting rendered with this records it's blank so manual scroll will not work
      // Need to check seperately.

      // test('Lazy loading works', function (done) {
      //   //setTimeout(function() {
      //   //flush(function () {
      //     var ironDataTable = getIronDataTable();
      //     var itemContainer = Polymer.dom(ironDataTable).node.$.list.$$('div[id="items"]');
      //     Polymer.dom.flush();
      //     //setTimeout(function () {
      //       //flush(function() {
      //         scrollTestHelper(itemContainer, {
      //           y: gridElement.offsetHeight + gridElement.pageSize * 2,
      //           callback: function () {
      //             setTimeout(function () {
      //               flush(function () {
      //                 ironDataTable = getIronDataTable();
      //                 assert.equal(ironDataTable.$.list.items.length, 10);
      //                 done();
      //               });
      //             }, 1000);
      //           }
      //         });
      //        // done();              
      //       //});
      //     //}, 1000);
      //   //});
      // });
    });
  </script>
</body>

</html>