<link rel="import" href="/bower_components/iron-label/iron-label.html">
<link rel="import" href="/src/elements/pebble-button/pebble-button.html">
<link rel="import" href="/src/elements/pebble-popover/pebble-popover.html">
<link rel="import" href="/src/elements/pebble-lookup/pebble-lov.html">
<dom-module id="pebble-combo-box">
    <template>
        <style is="custom-style">
            pebble-button.icon-text-button {
                --pebble-button: {
                    height: 30px;
                    padding: 0.5em 0em 0.5em 0em;
                    border: 1px solid #036BC3;
                }
                --pebble-button-iron-icon: {
                    height: 18px;
                    width: 18px;
                    padding-bottom: 2px;
                }
            }
        </style>
        <pebble-button id="button" class="icon-text-button" icon="home" button-text="Add" on-click="onPopoverClick"></pebble-button>
        <iron-label>
            SelectedItem: [[selectedItem.title]]
        </iron-label>
        <pebble-popover id="buttonpopover" for="button" auto-fit-on-attach no-overlap>
            <pebble-lov id="overlay" items="{{items}}" multi-selection="false" show-image="true">
            </pebble-lov>
        </pebble-popover>
    </template>
    <script>
        Polymer({
            is: 'pebble-combo-box',
            properties: {
                items: {
                    type: Array
                },

                selectedItem: {
                    type: Object,
                    value: function() { 
                        return { title: "No item selected" }; 
                    } 
                }
            },

            listeners: {
                'selection-changed': '_selectedItemChanged'
            },

            onPopoverClick: function () {
                if (!this.$.overlay.opened && !this.$.buttonpopover.isopen) {
                    this.$.overlay.open();
                    this.$.buttonpopover.show();
                } else {
                    this.$.overlay.close();
                    this.$.buttonpopover.hide();
                }
            },

            _selectedItemChanged: function (event) {
                this.selectedItem = event.detail.item;
                if (this.$.buttonpopover.isopen) {
                    this.$.buttonpopover.hide();
                }
            }
        });
    </script>
</dom-module>