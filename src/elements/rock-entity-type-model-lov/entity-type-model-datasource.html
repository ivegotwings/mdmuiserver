<link rel="import" href="../../../bower_components/polymer/polymer.html">


<link rel="import" href="../liquid-entity-model-get/liquid-entity-model-get.html">
<dom-module id="entity-type-model-datasource">
    <template>
        <liquid-entity-model-get id="initGetEntities" operation="initiatesearch" request-data="{{request}}" last-response="{{_initGetEntitySearchResponse}}"
            on-error="_onError" on-response= "_generateSearchRequest" exclude-in-progress></liquid-entity-data-get>
        <liquid-entity-model-get id="getEntitiesSearchResults" operation="getsearchresultdetail" request-data="{{request}}" request-id="[[_initGetEntitySearchResponse.content.requestId]]"
            on-response="_onGetResponse" on-error="_onError" exclude-in-progress></liquid-entity-data-get>
    
    </template>
    <script>
        Polymer({
            is: 'entity-type-model-datasource',
            properties: {
                request: {
                    type: Object,
                    value: function(){
                        return {};
                    },
                    observer:'_initiateRequest'
                }  
            },
            ready: function () {
                
            },
            _initiateRequest: function () {
                if(this.request.params){
                    Polymer.dom(this).node.$$(
                        "liquid-entity-model-get[id='initGetEntities']").generateRequest();
                }
            },
            _generateSearchRequest: function (){
                Polymer.dom(this).node.$$(
                    "liquid-entity-model-get[id='getEntitiesSearchResults']").generateRequest();  
            },

            _onGetResponse: function (e) {
                var response=event.detail.response;
                if (typeof (this.dataFormatter) == 'function') {
                    if (response.status === "success") {
                        this.dataFormatter(response);
                    }
                }
            }

        });
    </script>
</dom-module>