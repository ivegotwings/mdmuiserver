<link rel="import" href="../../../bower_components/iron-icon/iron-icon.html">
<link rel="import" href="../../../bower_components/iron-icons/iron-icons.html">
<link rel="import" href="../../../bower_components/paper-menu-button/paper-menu-button.html">
<link rel="import" href="../../../bower_components/paper-menu/paper-menu.html">
<link rel="import" href="../../../bower_components/paper-item/paper-item.html">

<link rel="import" href="../pebble-dropdown/pebble-dropdown.html">
<link rel="import" href="../rock-tags/rock-tags.html">
<link rel="import" href="../rock-tag-item/rock-tag-item.html">
<link rel="import" href="../rock-search-bar/rock-search-bar.html">
<link rel="import" href="../pebble-button/pebble-button.html">

<!--
`rock-search-filter`
Element containing search bar and filter tags. User can switch between search mode and filter mode to get the query they want to search

@demo demo/index.html
-->

<dom-module id="rock-search-filter">

    <template>
        <style include="shared-styles"></style>
        <style>
          .container {
            @apply(--layout-horizontal);
            @apply(--layout-center);
          }
          .button{
             --pebble-button: {
               height:40px;
               min-width:40px;
               border:1px solid #D2D7DD;
               border-radius:5px;
             }
          }

        </style>
        <template is="dom-if" if="{{searchMode}}">
            <div class="container" >
                <rock-search-bar id="searchSection" style="width:90%" search-input="{{tags}}" ></rock-search-bar>
                <pebble-button icon="filter-list"  class='button' on-tap="toggleMode" raised></pebble-button>
            </div>
        </template>
        <template is="dom-if" if="{{!searchMode}}">
            <div class="container">

                <pebble-button icon="search"  class='button' on-tap="toggleMode" raised></pebble-button>
                <!--<pebble-button class="button" id="pebbleButtonMenu1" items={{filters}} icon="filter-list" filter="_alreadyAdded" menu-button  raised  on-iron-select="_dropdownValueChanged" ></pebble-button>-->
                <paper-menu-button>
                    <pebble-button icon="filter-list" class="button dropdown-trigger" on-tap="refreshFilter"></pebble-button>
                    <paper-menu class="dropdown-content" on-iron-select="_dropdownValueChanged">
                    <template id="filterList" is="dom-repeat" items="{{filters}}" filter="_alreadyAdded" observe="tags">
                        <paper-item >[[item]]</paper-item>
                    </template>
                    </paper-menu>
                </paper-menu-button>
                <rock-tags id="filter-tags" tags="{{tags}}" tag-colors="{{tagColors}}" disable-add="{{disableFilterAdd}}" is-non-editable="{{filterNonEditable}}" disable-delete="{{disableFilterDelete}}"></rock-tags>
            </div>
        </template>

    </template>
    <script>

  Polymer({

    is: 'rock-search-filter',

    properties: {
    /**
       * list of String that holds tags. Values in this array should be identical and avoids duplicates due to the definition of tags.
       */
      tags:{
        type:Array,
        notify: true,
        reflectToAttribute: true,
        value:function(){return []}
      },
       /**
       * list of properties that can be passed as filter tags
       */
      filters:{
        type:Array,
        notify: true,
        value:function(){return []},
      },
      /**
        * Boolean flag to indicate if the element is in search mode or filter mode
       */
      searchMode:{
        type:Boolean,
        value:false,
        notify: true
      },
       /**
        * Boolean flag to indicate if value of the filter tag is editable or not
       */
       filterNonEditable: {
        type: Boolean,
        value: false
      },
      /**
        * Boolean flag to indicate if adding more filter tag is allowed or not
       */
      disableFilterAdd: {
        type: Boolean,
        value: false
      },
      /**
        * List of colors to be used in the filter tags. Order of color used is based on index.
       */
      tagColors:{
       type: Array,
       notify: true,
       value: function(){return []}
      },
       /**
        * Boolean flag to indicate if delete of filter tag is allowed
       */
      disableFilterDelete: {
        type: Boolean,
        value: false
      }

    },
    /**
        * Method to add a filter tag on selecting it from the dropdown
    */
    _dropdownValueChanged: function(e) {
      var attributeName = e.target.selectedItem.innerText;
      var tag = {
        "name": attributeName,
        "value": "",
        "editMode": false
      };
      this.$$("#filter-tags ").addTag(tag);
    },
    /**
     *  toggle between search mode and filter mode
    */
    toggleMode: function(e){
      this.searchMode= !this.searchMode;
    },
    /**
     *  Check if a property is already added in the filter tags. If yes, then that property won't be shown in the dropdown list
    */
    _alreadyAdded: function(item){
        if (!item){
          return false;
        }
        var tag  = this.tags.filter(function(i){
          return i.name == item;
        });
        if(tag && tag.length>0){
          return false;
        }
        return true;
    },
    /**
     *  refresh the dropdown elements
    */
    refreshFilter: function(){
        var list=this.$$("#filterList");
        if(list){
          list.render();
          this.$$('paper-menu').selected=null;
        }
    }

  });

</script>
</dom-module>