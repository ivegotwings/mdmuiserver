<link rel="import" href="../../../../bower_components/polymer/polymer.html">
<link rel="import" href="../liquid-entity-getdata.html">

<dom-module id="liquid-entity-getdata-demo2">
  <template>
    <liquid-entity-getdata id="entityGetData2" auto verbose operation="initiatesearch" 
        request-data={{request}} 
        last-response={{searchResponse}}>
    </liquid-entity-getdata>
    
    <liquid-entity-getdata id="entityGetData3" auto verbose operation="getsearchresultdetail" 
        request-data={{request}} 
        request-id="[[searchResponse.content.requestId]]" 
        last-response="{{resultedEntities}}"
        on-response="_entitiesRecieved">
    </liquid-entity-getdata>
  </template>
  <script>
    (function() {
      'use strict';

      Polymer({
        is: 'liquid-entity-getdata-demo2',
        properties: {
          request:{
            type: Object,
            value: function(){
              return {
                  "data": {
                      "query": {
                          "ctx": [
                              {
                                  "list": "productMaster",
                                  "classification": "nivea/niveaBodyCare/niveaBody/nbodyEssential/nbody/ess/nourishingMilkDry"
                              }
                          ],
                          "valCtx": [
                              {
                                  "source": "SAP",
                                  "locale": "en-US"
                              }
                          ],
                          "filters": {
                              "attributesCriterion": [],
                              "typesCriterion": [
                                  "nart"
                              ]
                          }
                      },
                      "fields": {
                          "ctxTypes": [
                              "properties"
                          ],
                          "attributes": [
                              "cpimProductName",
                              "csapDescriptionOfNart"
                          ],
                          "relationships": [
                              "ALL"
                          ]
                      },
                      "options": {
                          "from": 0,
                          "to": 3
                      }
                  }
              };
            }
          },
          searchResponse:{
            type: Object,
            value: function(){ return {};},
            notify: true
          },
          resultedEntities:{
            type: Object,
            value: function(){ return {};},
            notify: true
          }
        },
        _entitiesRecieved: function (e) {
            console.log('search result entities received with detail', e.detail);
            
            if(this.request.data.options.from != 4){
                console.log('updating from and to options..');
                var options = {"from": 4, "to": 9};
                this.set("request.data.options", options);
            }
        }
      });
    })();
  </script>
</dom-module>