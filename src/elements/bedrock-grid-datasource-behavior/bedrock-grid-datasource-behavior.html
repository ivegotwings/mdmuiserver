<link rel="import" href="../../../bower_components/polymer/polymer.html">
<link rel="import" href="../bedrock-datasource-behavior/bedrock-datasource-behavior.html">

<script>
    /***
     * `RUFBehaviors.GridDataSourceBehavior` provides common properties and methods that must be implemented across all
     *  the grid datasource components. It is a mandatory behavior for all these components to implement.
     *
     *  ### Example
     *
     *     <dom-module id="x-grid-datasource">
     *        <template>
     *        </template>
     *        <script>
     *           Polymer({
     *             is: ""x-grid-datasource",
     *
     *             behaviors: [
     *               RUFBehaviors.DataSourceBehavior
     *             ],
     *
     *             properties: {
     *              
     *             }
     *           });
     *        &lt;/script>
     *     </dom-module>
     * @demo demo/index.html
     * @polymerBehavior RUFBehaviors.GridDataSourceBehavior
     */

    RUFBehaviors = RUFBehaviors || {};
    RUFBehaviors.GridDataSourceBehaviorImpl = {

        properties: {
            /**
             * Content is not appearing - Indicates an incremental data size for each page in the grid using "datasource" for virtualization.
             * This is auto calculated.
             **/
            currentRecordSize: {
                type: Number,
                notify: true,
                value: 0
            },

            /**
             * Content is not appearing - Indicates the total record size of the grid.
             * This is auto calculated.
             */
            totalRecords: {
                type: Number,
                notify: true,
                value: 0
            },
            /**
             * Content is not appearing - Indicates the total record size available.
             *
             */
            totalCount: {
                type: Number,
                notify: true,
                value: 0
            },

            _lastPage: {
                type: Number,
                value: -1
            }
        },

        _prepareRequestOptions: function (data) {
            return {
                "from": data.page * data.pageSize,
                "to": ((data.page * data.pageSize) + data.pageSize) - 1
            };
        },

        _formatResponse: function (data) {
            if (typeof (this.dataFormatter) == 'function') {
                return this.dataFormatter(data);
            } else {
                return data;
            }
        },

        _updateCurrentRecordSize: function (options, records,totalCount) {
            if (options.pageSize <= records.length) {
                if (this.currentRecordSize / options.pageSize >= options.page) {
                    this.currentRecordSize += this.currentRecordSize == 0 ? options.pageSize *
                        2 : options.pageSize;
                }
            } else {
                if (this.currentRecordSize == 0) {
                    this.currentRecordSize = records.length;
                } else {
                    this.currentRecordSize -= (options.pageSize-records.length);
                }
            }

            this._lastPage = options.page;
            this.totalRecords += records.length;
            if(totalCount !== undefined){
                this.totalCount=totalCount;
            }

        },

        _resetDataSource: function () {
            this.currentRecordSize = 0;
            this.totalRecords = 0;
            this._lastPage = -1;
        },
    };

    RUFBehaviors.GridDataSourceBehavior = [RUFBehaviors.DataSourceBehavior, RUFBehaviors.GridDataSourceBehaviorImpl];
</script>