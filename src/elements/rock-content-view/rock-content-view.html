<link rel="import" href="../../../bower_components/polymer/polymer.html">
<link rel="import" href="../../../bower_components/iron-flex-layout/iron-flex-layout.html">
<link rel="import" href="../../../bower_components/paper-material/paper-material.html">
<link rel="import" href="../../../bower_components/paper-styles/default-theme.html">
<link rel="import" href="../../../bower_components/iron-icons/iron-icons.html">
<link rel="import" href="../../../bower_components/iron-icons/communication-icons.html">
<link rel="import" href="../../../bower_components/iron-icons/hardware-icons.html">
<link rel="import" href="../../../bower_components/iron-icons/social-icons.html">
<link rel="import" href="../../../bower_components/paper-icon-button/paper-icon-button.html">
<link rel="import" href="../../../bower_components/paper-menu/paper-menu.html">
<link rel="import" href="../../../bower_components/paper-item/paper-item.html">

<!--
` <rock-content-view> ` Represents a card which is configurable by a JSON config.
  The config can have details about the component to be used within content-view, buttons and icons.
  content-views are normally used on dashboard type of apps.

@demo demo/index.html 
-->

<dom-module id="rock-content-view">
  <template>
    <style include="shared-styles">
      .content-view-container{
        box-shadow: 0 2px 2px 0 rgba(0, 0, 0, 0.14),
                  0 1px 5px 0 rgba(0, 0, 0, 0.12),
                  0 3px 1px -2px rgba(0, 0, 0, 0.2);

        min-height: 600px;
      }
      .header {
        background-color: #198FFF;
        border-radius: 1px;
        color: white;
     
				position: relative;
				border-top-left-radius: inherit;
				border-top-right-radius: inherit;
				overflow: hidden;
				/* @apply(--paper-card-header); */
				@apply(--layout-horizontal);
				width: 100%;
			}
      
      .header iron-icon {
        width: 16px;
        height: 16px;
				@apply(--layout-start);
			}
			
			.header .title-text {
				padding: 8px;
				font-size: 12px;
				font-weight: 400;
				
				
				@apply(--layout-flex);
			}

      :host .card-icons {
				padding: 4px;
			}
			
			:host paper-icon-button {
				
				width: 24px;
				height: 24px;
				padding: 4px;
			}
      
			:host paper-item {
				cursor: pointer;
			}
    </style>

    <div id="content-view-container" class="content-view-container">
      <div id="header" class="header">
        <div hidden$="[[!heading]]" class="title-text">
          <iron-icon icon="[[headerIcon]]"></iron-icon> [[heading]] [[name]]
        </div>
        <div class="card-icons">
          <!--<template is="dom-if" if="[[!nonMaximizable]]">-->
            <paper-icon-button name="minimize" icon="icons:remove" title="Minimize" on-tap="_onMinimizeClick"></paper-icon-button>
          <!--</template>-->
          <!--<template is="dom-if" if="[[!nonClosable]]">-->
            <paper-icon-button name="close" icon="icons:clear" title="Close" on-tap="_onCloseClick"></paper-icon-button>
          <!--</template>-->
          <!--<template is="dom-if" if="[[iconButtons]]">
            <paper-menu-button>
              <paper-icon-button class="dropdown-trigger" name="more" icon="icons:more-vert" title="More options"></paper-icon-button>
              <paper-menu class="dropdown-content">
                <template is="dom-repeat" items="[[iconButtons]]">
                  <paper-item name="[[item.name]]" on-tap="_onIconButtonClick">[[item.label]]</paper-item>
                </template>
              </paper-menu>
            </paper-menu-button>
          </template>-->
        </div>
      </div>
      <div id="content">
          <!--My Content View [[name]] 
            <paper-button id="btnClose1" raised on-click="_onCloseClick">Close</paper-button>
            <paper-button id="btnMinimize1" raised on-click="_onMinimizeClick">Minimize</paper-button>-->
      </div>
    </div>
  </template>

  <script>
    (function() {
      'use strict';

      Polymer({
        is: 'rock-content-view',
       
        properties: {
          /**
           * This is a private property and should not be used directly. This is bound to config.component.
           * Indicates the component to be shown in the card. It is a JSON with information about the component.
           * 
					 */
          /**
           * Indicates title of the card.
           * 
					 */
          heading: {
            type: String,
            value: "Card Heading"
          },
					/**
           * Indicates the url of the title image of the card.
           * 
					 */
          headerIcon: {
            type: String,
            value: "icons:dashboard"
          },
          name: {
            type: String
          },
          component: {
            type: Object,
            value: function() {
              return {};
            }
          },
          manager: {
            type: Object
          }
        },

        render: function(){
          var contentElement = this.$.content;
          if(contentElement && this.component && this.component.path) {
            //cleanup first
            while (contentElement.firstChild) {
              Polymer.dom(contentElement).removeChild(contentElement.firstChild);
            }

            this.importHref(this.component.path, 
              function (e) {
                
                //component file import successful
                var dynamicEl = document.createElement(this.component.name);
                for (var property in this.component.properties) {
                  if (this.component.properties.hasOwnProperty(property)) {
                    var val = this.component.properties[property];
                    if (typeof val == "object") {
                      dynamicEl.setAttribute(property, JSON.stringify(val));
                    }
                    else {
                      dynamicEl.setAttribute(property, val);
                    }
                  }
                }
                dynamicEl.setAttribute("id", "component");
                dynamicEl.setAttribute("class", dynamicEl.getAttribute("class") + " view-component");
                Polymer.dom(contentElement).appendChild(dynamicEl);
              },
              function (e) {
                //component file import failed
                //TODO: log this
              }
            );
          }
        },

        _onCloseClick: function() {
          this.manager.closeView(this.name);
        },

        _onMinimizeClick: function() {
          this.manager.minimizeView(this.name);
        }

      });
    })();
  </script>

</dom-module>