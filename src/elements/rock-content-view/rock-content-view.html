<link rel="import" href="../../../bower_components/polymer/polymer.html">
<link rel="import" href="../../../bower_components/iron-flex-layout/iron-flex-layout.html">
<link rel="import" href="../../../bower_components/paper-material/paper-material.html">
<link rel="import" href="../../../bower_components/paper-styles/default-theme.html">
<link rel="import" href="../../../bower_components/iron-icons/iron-icons.html">
<link rel="import" href="../../../bower_components/iron-icons/communication-icons.html">
<link rel="import" href="../../../bower_components/iron-icons/hardware-icons.html">
<link rel="import" href="../../../bower_components/iron-icons/social-icons.html">
<link rel="import" href="../../../bower_components/paper-icon-button/paper-icon-button.html">
<link rel="import" href="../../../bower_components/paper-menu/paper-menu.html">
<link rel="import" href="../../../bower_components/paper-item/paper-item.html">

<!--
` <rock-content-view> ` Represents a view which will hold content for the middle area of the application.
  It can take configuration for the component which should be rendered in the content view.
  It supports minimze and close actions which can configured using boolean properties.
  rock-content-view has to be used with rock-content-view-manager.

@demo demo/index.html 
-->

<dom-module id="rock-content-view">
	<template>
		<style include="shared-styles">
			.content-view-container {
				/*margin: 16px 18px 48px;*/
				box-sizing: border-box;
				
        box-shadow: 0 2px 2px 0 rgba(0, 0, 0, 0.14),
                  0 1px 5px 0 rgba(0, 0, 0, 0.12),
                  0 3px 1px -2px rgba(0, 0, 0, 0.2);
                  
				border: 1px solid #CBD2DA;
				height: 100%;
        border-radius: 3px;
			}
			
			#content {
				height: 90%;
				overflow: auto;
			}
			
			.header {
				background-color: #198FFF;
				border-radius: 1px;
				color: white;
				position: inherit;
				border-top-left-radius: inherit;
				border-top-right-radius: inherit;
				overflow: hidden;
				/* @apply(--paper-card-header); */
				@apply(--layout-horizontal);
				width: 100%;
			}
			
			.header iron-icon {
				width: 16px;
				height: 16px;
				@apply(--layout-start);
			}
			
			.header .title-text {
				padding: 8px;
				font-size: 14px;
				font-weight: 400;
				@apply(--layout-flex);
			}
			
			:host .card-icons {
				padding: 4px;
			}
			
			:host paper-icon-button {
				width: 32px;
				height: 32px;
				padding: 4px;
			}
			
			:host paper-item {
				cursor: pointer;
			}
			
			:host #content {
				/*padding: 10px;*/
			}
		</style>

		<div id="content-view-container" class="content-view-container">
			<div id="header" class="header">
				<div hidden$="[[!title]]" class="title-text">
					<iron-icon icon="[[icon]]"></iron-icon> [[title]]
				</div>
				<div class="content-view-icons">
					<template is="dom-if" if="[[!nonMinimizable]]">
						<paper-icon-button name="minimize" icon="icons:remove" title="Minimize" on-tap="_onMinimizeClick"></paper-icon-button>
					</template>
					<template is="dom-if" if="[[!nonClosable]]">
						<paper-icon-button name="close" icon="icons:clear" title="Close" on-tap="_onCloseClick"></paper-icon-button>
					</template>
					<!--<template is="dom-if" if="[[iconButtons]]">
            <paper-menu-button>
              <paper-icon-button class="dropdown-trigger" name="more" icon="icons:more-vert" title="More options"></paper-icon-button>
              <paper-menu class="dropdown-content">
                <template is="dom-repeat" items="[[iconButtons]]">
                  <paper-item name="[[item.name]]" on-tap="_onIconButtonClick">[[item.label]]</paper-item>
                </template>
              </paper-menu>
            </paper-menu-button>
          </template>-->
				</div>
			</div>
			<div id="content">
				<!--My Content View [[name]] 
            <paper-button id="btnClose1" raised on-click="_onCloseClick">Close</paper-button>
            <paper-button id="btnMinimize1" raised on-click="_onMinimizeClick">Minimize</paper-button>-->
			</div>
		</div>
	</template>

	<script>
    (function() {
      'use strict';

      Polymer({
        is: 'rock-content-view',
       
        properties: {
          layout: {
            type: String,
            value: "full-header"
          },
          /**
           * Indicates title of the card.
           * 
					 */
          title: {
            type: String,
            value: "View Title"
          },
					/**
           * Indicates the url of the title icon image of the card.
           * 
					 */
          icon: {
            type: String,
            value: "icons:dashboard"
          },
          /**
           * Indicates the name of the card.
           * The content view manager finds the content view based on the name. So <b>it has to be unique </b>.
					 */
          name: {
            type: String
          },
           /**
           * Indicates the configuration for the component which has to be loaded within the content view.
           * 
					 */
          component: {
            type: Object,
            value: function() {
              return {};
            }
          },
          /**
           * Indicates the rock-content-view-manager element instance which will manage this content-view.
           * TODO: We might have to remove this property and find the manager dynamically.
					 */
          manager: {
            type: Object
          },
          /**
           * Specifies whether the view can be closed or not.
					 * If it is set to <b>true</b>, then the view cannot be closed.
           * 
					 */
          nonClosable: {
            type: Boolean,
            value: false
          },
          /**
           * Specifies whether the view can be minimized or not.
					 * If it is set to <b>true</b>, then the view cannot be minimized.
           * 
					 */
          nonMinimizable: {
            type: Boolean,
            value: false
          },
        },

        /**
        * Renders the component based on given configuration.
        * 
        */
        render: function(){
          var contentElement = this.$.content;
          if(contentElement && this.component && this.component.path) {
            //cleanup first
            while (contentElement.firstChild) {
              Polymer.dom(contentElement).removeChild(contentElement.firstChild);
            }
            this.importHref(this.component.path, 
              function (e) {
                
                //component file import successful
                var dynamicEl = document.createElement(this.component.name);
                for (var property in this.component.properties) {
                  if (this.component.properties.hasOwnProperty(property)) {
                    var val = this.component.properties[property];
                    if (typeof val == "object") {
                      dynamicEl.setAttribute(property, JSON.stringify(val));
                    }
                    else {
                      dynamicEl.setAttribute(property, val);
                    }
                  }
                }
                dynamicEl.contentViewManager = this.manager;
                dynamicEl.setAttribute("id", "component");
                dynamicEl.setAttribute("class", dynamicEl.getAttribute("class") + " view-component");
                Polymer.dom(contentElement).appendChild(dynamicEl);
              },
              function (e) {
                //component file import failed
                //TODO: log this
              }
            );
          }
        },

        _onCloseClick: function() {
          this.manager.closeView(this.name);
        },

        _onMinimizeClick: function() {
          this.manager.minimizeView(this.name);
        }

      });
    })();
  </script>

</dom-module>