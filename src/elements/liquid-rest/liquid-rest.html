<link rel="import" href="../../../bower_components/polymer/polymer.html">
<link rel="import" href="../../../bower_components/iron-ajax/iron-ajax.html">

<link rel="import" href="../bedrock-helpers/data-helper.html">

<link rel="import" href="../liquid-base-behavior/liquid-base-behavior.html">

<!--
    <b><i>Content development is under progress... </b></i>
    @demo demo/index.html
-->

<dom-module id="liquid-rest">
    <template>
        <iron-ajax url="[[url]]" params="[[params]]" method="[[method]]" headers="[[headers]]" content-type="[[contentType]]" body=[[requestData]]
            handle-as="json" timeout="{{timeout}}" auto="[[auto]]" verbose="[[verbose]]" last-request="{{lastRequest}}" loading="{{loading}}" last-response="{{lastResponse}}"
            last-error="{{lastError}}" active-requests="{{activeRequests}}" debounce-duration="{{debounceDuration}}"
            on-response="_onResponse" on-error="_onError"></iron-ajax>
    </template>
    <script>
        (function () {
            'use strict';

            Polymer({
                is: 'liquid-rest',
                behaviors: [RUFBehaviors.LiquidBaseBehavior],
                properties: {
                    /**
                     * Indicates the URL target of the request.
                     */
                    url: {
                        type: String
                    },

                    /**
                     * Indicates an object that contains the query parameters which are appended to the
                     * specified `url` when generating the request. If you wish to set the body
                     * content when you make a POST request, you must use the `request-data` property
                     * instead.
                     */
                    params: {
                        type: Object,
                        value: function () {
                            return {};
                        }
                    },

                    /**
                     * Indicates the HTTP method to use such as 'GET', 'POST', 'PUT', or 'DELETE'.
                     * Default is 'GET'.
                     */
                    method: {
                        type: String,
                        value: 'GET'
                    },

                    /**
                     * Indicates the HTTP request headers to send.
                     *
                     * Example
                     *
                     *     <iron-ajax
                     *         auto
                     *         url="http://somesite.com"
                     *         headers='{"X-Requested-With": "XMLHttpRequest"}'
                     *         handle-as="json"></iron-ajax>
                     *
                     * Note: The value of the `Content-Type` header overrides the value
                     * of the `contentType` property of this element.
                     */
                    headers: {
                        type: Object,
                        value: function () {
                            return {};
                        }
                    },
                  
                    /**
                     * Indicates the type of the content to use when you send the data. If `contentType`
                     * is set and `Content-Type` header is specified in the `headers`,
                     * the value of the `headers` takes precedence.
                     *
                     * It alters the handling of the `body` parameter.
                     */
                    contentType: {
                        type: String,
                        value: "application/json"
                    }
                },
                /**
                 * Can be used to generate the requests.
                 * 
                 */
                generateRequest: function () {
                    //console.log('generateRequest requestData', this.requestData);
                    this.shadowRoot.querySelector('iron-ajax').generateRequest();
                },
                _onResponse: function (e) {
                    var eventDetail = {
                        "request": {
                            "requestData": this.requestData
                        },
                        "response": e.detail.response
                    };
                    this.dispatchEvent(new CustomEvent('liquid-response', { detail:eventDetail, bubbles:this.bubbles, composed:true}));
                    this.dispatchEvent(new CustomEvent('response', { detail:eventDetail, bubbles:this.bubbles, composed:true}));
                    this.cancelBubble = true;
                },
                _onError: function (e) {
                    this.dispatchEvent(new CustomEvent('liquid-error', {detail:e, bubbles:this.bubbles, composed:true}));
                    this.dispatchEvent(new CustomEvent('error', { detail:e, bubbles:this.bubbles, composed:true}));
                    this.cancelBubble = true;
                }
            });
        })();
    </script>
</dom-module>