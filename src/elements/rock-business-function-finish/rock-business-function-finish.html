<link rel="import" href="../../../bower_components/polymer/polymer-element.html">
<link rel="import" href="../bedrock-ui-behavior/bedrock-ui-behavior.html">
<link rel="import" href="../bedrock-component-context-behavior/bedrock-component-context-behavior.html">
<link rel="import" href="../bedrock-business-function-behavior/bedrock-component-business-function-behavior.html">
<link rel="import" href="../bedrock-helpers/component-helper.html">
<link rel="import" href="../pebble-button/pebble-button.html">
<link rel="import" href="../bedrock-style-manager/styles/bedrock-style-common.html">

<!--
<b><i>Content development is under progress... </b></i>

@demo demo/index.html
-->
<dom-module id="rock-business-function-finish">
    <template>
        <style include="bedrock-style-common">
            :host {
                padding-top: 20px;
            }

            #message-label {
                padding-top: 20px;
                padding-bottom: 20px;
            }

            #user-actions {
                padding-top: 20px;
                padding-bottom: 20px;
            }
        </style>
        <template is="dom-if" if="[[isReadyToShowFinish]]">
            <div id="message-label" align="center">
                <template is="dom-repeat" items="[[businessFunctionData.messages]]" as="message">
                    <p>[[message.message]]</p>
                </template>
            </div>
            <div id="user-actions" align="center">
                <template is="dom-repeat" items="[[businessFunctionData.actions]]" as="action">
                    <pebble-button class="action-button-focus dropdownText btn btn-success m-r-5" icon="pebble-icon:action-take-task" button-text="[[action.text]]"
                        data="[[action]]" on-tap="_onActionTap"></pebble-button>
                </template>
            </div>
        </template>
    </template>
    <script>
        class RockBusinessFunctionFinish extends Polymer.mixinBehaviors([
            RUFBehaviors.UIBehavior,
            RUFBehaviors.ComponentContextBehavior,
            RUFBehaviors.ComponentBusinessFunctionBehavior,
        ], Polymer.Element) {
            static get is() {
                return "rock-business-function-finish";
            }

            static get properties() {
                return {
                    businessFunctionData: {
                        type: Object,
                        value: function () { return {}; }
                    },
                    isReadyToShowFinish: {
                        type: Boolean,
                        value: false
                    }
                };
            }

            connectedCallback() {
                super.connectedCallback();
                if(this.isPartOfBusinessFunction) {
                    this.fireBedrockEvent("load-business-function-properties", null, {ignoreId: true});
                } else {
                    this.isReadyToShowFinish = true;
                }
            }

            resetComponent() {
                this.isReadyToShowFinish = true;
            }

            _onActionTap(e) {
                if (e && e.currentTarget && e.currentTarget.data) {
                    let actionData = e.currentTarget.data;
                    actionData.closeBusinessFunction = true;
                    let eventName = "onNext";
                    this.fireBedrockEvent(eventName, actionData, {
                        ignoreId: true
                    });
                }
            }
        }

        customElements.define(RockBusinessFunctionFinish.is, RockBusinessFunctionFinish);
    </script>
</dom-module>