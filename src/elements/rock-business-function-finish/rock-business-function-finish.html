<link rel="import" href="../../../bower_components/polymer/polymer.html">

<link rel="import" href="../bedrock-ui-behavior/bedrock-ui-behavior.html">
<link rel="import" href="../bedrock-component-context-behavior/bedrock-component-context-behavior.html">
<link rel="import" href="../bedrock-helpers/component-helper.html">

<link rel="import" href="../pebble-button/pebble-button.html">
<link rel="import" href="../pebble-styles-shared/pebble-styles-shared.html">

<dom-module id="rock-business-function-finish">
    <template>
        <style include="pebble-styles-shared">
            :host {
                padding-top: 20px;
            }
            #message-label {
                padding-top: 20px;
                padding-bottom: 20px;
            }
            #user-actions {
                padding-top: 20px;
                padding-bottom: 20px;
            }
        </style>
        <div id="message-label" align="center">
            <template is="dom-repeat" items="[[businessFunctionData.messages]]" as="message">
                <p>[[message.message]]</p>
            </template>
        </div>
        <div id="user-actions" align="center">
            <template is="dom-repeat" items="[[businessFunctionData.actions]]" as="action">
                <pebble-button class="action-button-focus dropdownText btn btn-success m-r-5" icon="pebble-md-icons:actions" button-text="[[action.text]]" data="[[action]]" on-tap="_onActionTap"></pebble-button>
            </template>
        </div>
    </template>
    <script>
        (function() {
            'use strict';

            Polymer({
                is: "rock-business-function-finish",

                properties: {
                    businessFunctionData: {
                        type: Object,
                        value: function() { return {}; }
                    }
                },
                behaviors: [
                    RUFBehaviors.UIBehavior,
                    RUFBehaviors.ComponentContextBehavior
                ],
                _onActionTap: function(e) {                    
                    if(e && e.currentTarget && e.currentTarget.data) {
                        var actionData = e.currentTarget.data;
                        
                        if(actionData.isNotApp)
                        {
                            this.fire("last-step-completed");
                        }
                        else
                        {
                            ComponentHelper.closeCurrentApp();
                        }

                        if(actionData.dataRoute && actionData.dataRoute != "") {
                            var mainApp = document.querySelector("main-app");
                            if(actionData.queryParams) {
                                mainApp.set('pageRoute.__queryParams', actionData.queryParams);
                            }
                            mainApp.changePageRoutePath(actionData.dataRoute);   
                        }
                    }
                }
            });
        })();
    </script>
</dom-module>