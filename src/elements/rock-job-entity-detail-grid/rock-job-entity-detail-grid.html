<link rel="import" href="../../../bower_components/polymer/polymer.html">

<link rel="import" href="../bedrock-ui-behavior/bedrock-ui-behavior.html">
<link rel="import" href="../bedrock-pubsub/bedrock-pubsub.html">

<link rel="import" href="../pebble-icon/pebble-icon.html">
<link rel="import" href="../pebble-button/pebble-button.html">
<link rel="import" href="../pebble-popover/pebble-popover.html">
<link rel="import" href="../pebble-lov/pebble-lov.html">
<link rel="import" href="../pebble-styles-shared/pebble-styles-shared.html">

<link rel="import" href="../rock-search-bar/rock-search-bar.html">
<link rel="import" href="../rock-grid/rock-grid.html">
<link rel="import" href="../rock-entity-search-filter/rock-entity-search-filter.html">

<!--
`<rock-job-entity-detail-grid>`

@group rock Elements
@element rock-job-entity-detail-grid
@demo demo/index.html
-->

<dom-module id="rock-job-entity-detail-grid">
    <template>
        <style include="pebble-styles-shared"></style>
        <style is="custom-style">


            rock-grid {
                --rock-grid-container: {
                    padding-top: 3px;
                    border-spacing: inherit;
                    border: 1px solid var(--divider-color, #c1cad4);
                }
            }




        </style>
            <!--TODO remove these iron-ajax after api integration-->
            <iron-ajax auto url="demo/data.json" handle-as="json" last-response="{{data}}"></iron-ajax>
            <rock-grid id="entityGrid" selection-enabled no-header data="{{data}}" config="{{gridConfig}}" page-size="10" selecting-item="{{selectedEntity}}"></rock-grid>
            <bedrock-pubsub event-name="grid-selecting-item" handler="_onSelectingGridItem" target-id="entityGrid"></bedrock-pubsub>
    </template>

    <script>
        (function () {
            'use strict';

            Polymer({
                is: 'rock-job-entity-detail-grid',

                properties: {
                    selectedEntity:{
                        type:Object,
                        value:function () {
                            return {};
                        },
                        notify:true
                    }

                },
                behaviors: [
                    RUFBehaviors.UIBehavior
                ],
                listeners: {

                },
                _getEntityGrid:function () {
                    return ElementHelper.getElement(this, "#entityGrid");
                },
                _onSelectingGridItem: function (e, detail, sender) {
                        this.selectedEntity = detail.item;
                },
                getSelectedItemIndex: function () {
                    return this._getEntityGrid().getSelectedItemIndex();
                },
                _setGridHeight: function () {
                    var layout = this.parentElement.parentNode.parentNode.root.querySelector('#rockLayoutContainer')
                    var rockGridHeight = 0;

                    if (layout) {
                        var footer = layout.querySelector('rock-footer');
                        rockGridHeight = layout.offsetHeight;

                        if (footer) {
                            rockGridHeight = rockGridHeight - footer.offsetHeight;
                        }
                    }

                    var rockGrid = Polymer.dom(this).node.$$('rock-grid');
                    if (rockGrid && rockGridHeight > 0) {
                        rockGrid._getIronDataTable().style.height = rockGridHeight - 80 + 'px';
                    }
                },
                notifyResize: function () {
                    this._getEntityGrid().notifyResize();
                },
                scrollToIndex: function (index) {
                    this._getEntityGrid().scrollToIndex(index);
                },
                /**
                 *  To select an item
                 */
                selectItem: function (item) {
                    this._getEntityGrid().selectItem(item);
                },

                /**
                 * Can be used to get the grid data.
                 */
                getData: function () {
                    return this._getEntityGrid().getData();
                },

            });
        })();
    </script>

</dom-module>