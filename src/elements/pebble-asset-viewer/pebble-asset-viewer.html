<link rel="import" href="../../../bower_components/polymer/polymer.html">
<link rel="import" href="../pebble-spinner/pebble-spinner.html">
 <link rel="import" href="../../../bower_components/pdf-viewer/pdf-viewer.html">
 <link rel="import" href="../../../bower_components/paper-fab/paper-fab.html">
 <link rel="import" href="../../../bower_components/paper-tooltip/paper-tooltip.html">
<dom-module id="pebble-asset-viewer">
    <template>
        <style include="bedrock-style-common">
            .asset-render{
                height: 80vh;
            }
            .overflow{
                overflow-y: auto;
                overflow-x: auto;
            }
            .video-extension-not-supported{
                position:absolute;
                left:40%;
                top:50%;
            }
            nav{
                position: absolute;
                bottom: 20px;
                right: 10px;
            }
            nav div{
                display: block;
            }
            footer{
                display: flex;
                flex-direction: row;
                align-items: center;
                justify-content: center;
            }
        </style>
        <div id="viewerContainer" class$="[[_computeClass(assetType)]]">
            <pebble-spinner active="[[_loading]]"></pebble-spinner>
            <template is="dom-if" if="[[isImageView(assetType)]]">
                <a href="[[assetUrl]]">Download</a>  
                <img class="modal-content" width="100%" src="[[assetUrl]]" height="100%" id="bigImage" sizing="contain" onload="[[_onAssetLoad]]"/>
                
            </template>
            <template is="dom-if" if="[[isVideoView(assetType)]]">
                <template is="dom-if" if="[[assetError]]">
                    <div class="video-extension-not-supported">
                        <span>Video extension not supported</span>
                        <a href="[[assetUrl]]">Download</a>
                    </div>      
                </template>
                <template is="dom-if" if="[[!assetError]]">
                    <video id="videoPlay" controls autoplay src="[[assetUrl]]" height="100%" width="100%" oncanplay="[[_onAssetLoad]]" onerror="[[_onAssetError]]"></video>
                </template>
            </template>
            <template is="dom-if" if="[[isDocumentView(assetType)]]">
                <template is="dom-if" if="[[assetError]]">
                    <span>Document Preview Not Available!</span>
                    <a href="[[assetUrl]]">Download</a> 
                </template>
                <template is="dom-if" if="[[!assetError]]">
                    <a href="[[assetUrl]]">Download</a> 
                    <pdf-viewer id="docViewer" initial-zoom="fit-width" src="[[assetUrl]]" page="[[documentPage]]" mode="single"></pdf-viewer>
                    <footer>
                        <paper-fab mini icon="arrow-back" action="previous" on-tap="_performDocumentAction"></paper-fab>
                        <paper-fab mini icon="arrow-forward" action="next" on-tap="_performDocumentAction"></paper-fab>
                    </footer>
                    <nav>
                    <div>
                        <paper-fab mini icon="fullscreen" action="full" on-tap="_performDocumentAction"></paper-fab>
                        <paper-tooltip position="left">Fit page width</paper-tooltip>
                    </div>
                    <div>
                        <paper-fab mini icon="fullscreen-exit" action="fit" on-tap="_performDocumentAction"></paper-fab>
                        <paper-tooltip position="left">Fit page</paper-tooltip>
                    </div>
                    <div>
                        <paper-fab mini icon="zoom-in" action="zoomin" on-tap="_performDocumentAction"></paper-fab>
                        <paper-tooltip position="left">Zoom in</paper-tooltip>
                    </div>
                    <div>
                        <paper-fab mini icon="zoom-out" action="zoomout" on-tap="_performDocumentAction"></paper-fab>
                        <paper-tooltip position="left">Zoom out</paper-tooltip>
                    </div>
                    </nav>
                </template>
            </template>
            <template is="dom-if" if="[[isAudioView(assetType)]]">
                    <audio controls autoplay src="[[assetUrl]]" oncanplay="[[_onAssetLoad]]">
                    </audio>
            </template>
        </div>
            
           
    </template>
    <script>
        (function () {
            'use strict';

            Polymer({
                is: "pebble-asset-viewer",

                properties: {
                    assetType:{
                        type: String
                    },
                    assetUrl: {
                        type: String
                    },
                    assetExtension:{
                        type: String
                    },
                    _loading: {
                        type: Boolean,
                        value: false
                    },
                    assetError: {
                        type: Boolean,
                        value: false
                    },
                    documentPage: {
                        type: Number,
                        value: 1
                    },
                    documentPages: {
                        type: Number,
                        notify: true
                    },
                },
                _onAssetLoad: function () {
                    var viewer = this.__dataHost.parentModel;
                    viewer.set("_loading" , false);
                },
                _onAssetError: function () {
                    var viewer = this.__dataHost.parentModel;
                    viewer.set("_loading" , false);
                    viewer.$.viewerContainer.classList.remove("asset-render");
                    viewer.set("assetError" , true);
                },
                isImageView: function (assetType) {
                    if(assetType == "image"){
                        this.set("_loading" , true);
                        return true;
                    }
                    return false;
                },
                isVideoView: function (assetType) {
                    if(assetType == "video"){
                        this.set("_loading" , true);
                        return true;
                    }
                    return false;
                },
                isDocumentView: function (assetType) {
                    if(assetType == "document"){
                        if(this.assetExtension != "pdf"){
                            this.set("assetError" , true);
                        }
                        return true;
                    }
                    return false;
                },
                isAudioView: function (assetType) {
                    if(assetType == "audio"){
                        return true;
                    }
                    return false;
                },
                _computeClass: function (assetType) {
                    //compute class if no error is there
                    if(!this.assetError){
                        if(assetType == "image" || assetType == "video"){
                            return "asset-render";
                        }
                        else if(assetType == "document"){
                            return "asset-render overflow";
                        }
                    }
                    
                },
                _performDocumentAction: function (event) {
                    var document = this.shadowRoot.querySelector("#docViewer");
                    var action = event.target.getAttribute("action")
                   
                    switch (action) {
                        case "previous":
                           document.previous();
                           break;
                        case "next":
                            document.next();
                            break;
                        case "full":
                            document.fitWidth();
                            break;
                        case "fit":
                            document.fit();
                            break;
                        case "zoomin":
                            document.zoomin();
                            break;
                        case "zoomout":
                            document.zoomout();
                            break;
                        default:
                            alert("No Action")
                           break;
                    }
                   
                   
                }
            });
        })();
    </script>
</dom-module>