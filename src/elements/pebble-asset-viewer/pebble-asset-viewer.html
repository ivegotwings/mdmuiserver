<link rel="import" href="../../../bower_components/polymer/polymer.html">
<link rel="import" href="../pebble-spinner/pebble-spinner.html">
<dom-module id="pebble-asset-viewer">
    <template>
        <style include="bedrock-style-common">
            .asset-render{
                height: 80vh;
            }
            .video-extension-not-supported{
                position:absolute;
                left:40%;
                top:50%;
            }
        </style>
        <div id="viewerContainer" class$="[[_computeClass(assetType)]]">
            <pebble-spinner active="[[_loading]]"></pebble-spinner>
            <template is="dom-if" if="[[isImageView(assetType)]]">
                <a href="[[assetUrl]]">Download</a>  
                <img class="modal-content" width="100%" src="[[assetUrl]]" height="100%" id="bigImage" sizing="contain" onload="[[_onAssetLoad]]"/>
                
            </template>
            <template is="dom-if" if="[[isVideoView(assetType)]]">
                <template is="dom-if" if="[[assetError]]">
                    <div class="video-extension-not-supported">
                        <span>Video extension not supported</span>
                        <a href="[[assetUrl]]">Download</a>
                    </div>      
                </template>
                <template is="dom-if" if="[[!assetError]]">
                    <video id="videoPlay" controls autoplay src="[[assetUrl]]" height="100%" width="100%" oncanplay="[[_onAssetLoad]]" onerror="[[_onAssetError]]"></video>
                </template>
            </template>
            <template is="dom-if" if="[[isDocumentView(assetType)]]">
                <span>Document Preview Not Available!</span>
                <a href="[[assetUrl]]">Download</a> 
            </template>
            <template is="dom-if" if="[[isAudioView(assetType)]]">
                    <audio controls autoplay src="[[assetUrl]]" oncanplay="[[_onAssetLoad]]">
                    </audio>
            </template>
        </div>
            
           
    </template>
    <script>
        (function () {
            'use strict';

            Polymer({
                is: "pebble-asset-viewer",

                properties: {
                    assetType:{
                        type: String
                    },
                    assetUrl: {
                        type: String
                    },
                    _loading: {
                        type: Boolean,
                        value: false
                    },
                    assetError: {
                        type: Boolean,
                        value: false
                    },
                    documentPage: {
                        type: Number,
                        value: 1
                    },
                    documentPages: {
                        type: Number,
                        notify: true
                    },
                },
                _onAssetLoad: function () {
                    var viewer = this.__dataHost.parentModel;
                    viewer.set("_loading" , false);
                },
                _onAssetError: function () {
                    var viewer = this.__dataHost.parentModel;
                    viewer.set("_loading" , false);
                    viewer.$.viewerContainer.classList.remove("asset-render");
                    viewer.set("assetError" , true);
                },
                isImageView: function (assetType) {
                    if(assetType == "image"){
                        this.set("_loading" , true);
                        return true;
                    }
                    return false;
                },
                isVideoView: function (assetType) {
                    if(assetType == "video"){
                        this.set("_loading" , true);
                        return true;
                    }
                    return false;
                },
                isDocumentView: function (assetType) {
                    if(assetType == "document"){
                        return true;
                    }
                    return false;
                },
                isAudioView: function (assetType) {
                    if(assetType == "audio"){
                        return true;
                    }
                    return false;
                },
                _computeClass: function (assetType) {
                    if(assetType == "image" || assetType == "video"){
                        return "asset-render";
                    }
                },
                _performDocumentAction: function (event) {
                    var document = this.shadowRoot.querySelector("#docViewer");
                    var action = event.target.getAttribute("action")
                   
                    switch (action) {
                        case "previous":
                           document.previous();
                           break;
                        case "next":
                            document.next();
                            break;
                        case "full":
                            document.fitWidth();
                            break;
                        case "fit":
                            document.fit();
                            break;
                        case "zoomin":
                            document.zoomin();
                            break;
                        case "zoomout":
                            document.zoomout();
                            break;
                        default:
                            alert("No Action")
                           break;
                    }
                   
                   
                }
            });
        })();
    </script>
</dom-module>