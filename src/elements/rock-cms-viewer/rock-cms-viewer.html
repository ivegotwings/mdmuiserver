<link rel="import" href="../../../bower_components/polymer/polymer.html">
<link rel="import" href="../../../bower_components/juicy-html/juicy-html.html">

<dom-module id="rock-cms-viewer">
    <template>
        <style include="bedrock-style-common">
            :host {
                display: block;
                height: 100%;
            }
        </style>
        <juicy-html html="{{template}}" model="{{viewmodel}}"></juicy-html>
        <div></div>
    </template>
    <script>
        (function () {
            Polymer({
                is: 'rock-cms-viewer',

                properties: {
                    viewmodel: {
                        type: Object,
                        value: function () {
                            return {};
                        }
                    }
                },

                behaviors: [
                    Polymer.Templatizer
                ],

                ready() {
                    this.viewmodel = {
                        name: 'entity',
                        price: '30',
                        colors: ['red', 'blue', 'green']
                    };

                    this.template =
                        `
                            <dom-bind>
                                <template is="dom-bind">
                                    #embbed#
                                </template>
                            </dom-bind>                    
                    `
                    this.html =
                        `
                            <span> Name {{model.name}} </span>
                            <span> Price {{model.price}}</span>
                            <loop items="{{model.colors}}" as="color">
                                <p>{{color}}</p>
                            </loop>
                        `
                    this.embbedLoops();
                    this.templatize();
                },

                embbedLoops() {
                    if (this.html.indexOf('loop') !== -1) {
                        this.html = this.html
                            .replace(/<\bloop\b/g, '<template is="dom-repeat"')
                            .replace(/<\/\bloop\b>/g, '</template>');
                    }
                },

                templatize() {
                    this.template = this.template.replace(/#\bembbed\b#/g, this.html);
                }
            })
        })()
    </script>
</dom-module>