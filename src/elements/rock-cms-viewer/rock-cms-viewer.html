<link rel="import" href="../../../bower_components/polymer/polymer.html">
<link rel="import" href="../../../bower_components/juicy-html/juicy-html.html">

<dom-module id="rock-cms-viewer">
    <template>
        <style>
            :host {
                height: 100%;
                display: block;
            }
        </style>
        <juicy-html html="{{template}}" model="{{viewmodel}}"></juicy-html>
        <div></div>
    </template>
    <script>
        (function () {
            Polymer({
                is: 'rock-cms-viewer',

                properties: {
                    viewmodel: {
                        type: Object,
                        value: function () {
                            return {};
                        }
                    }
                },

                behaviors: [
                    Polymer.Templatizer
                ],

                ready() {
                    this.viewmodel = {
                        name: 'entity',
                        price: '30',
                        colors: ['red', 'blue', 'green']
                    };

                    this.html =
                        `
                            <span> Name {{model.name}} </span>
                            <span> Price {{model.price}}</span>
                            <loop items="{{model.colors}}" as="color">
                                <p>{{color}}</p>
                            </loop>
                        `
                    this.embbedLoops();

                    this.externStyle =
                        `
                            :host {
                                height: 100%;
                                display: block;
                            } 
                            span{
                                color: red;
                                font-size:16px;
                            } 
                            p{
                                color: blue;
                                font-size: 10px;
                            } 
                       `
                    this.externJs =
                        `
                            setTimeout(() => {
                                console.log('ok');
                                throw(new Error('test error'));
                            },3000)        
                        `
                    this.evalJS();

                    this.template =
                        `
                            <dom-bind>
                                <template is="dom-bind">
                                    <style>
                                        ${this.externStyle}
                                    </style>
                                    ${this.html}
                                </template>
                            </dom-bind>                    
                    `
                },

                embbedLoops() {
                    if (this.html.indexOf('loop') !== -1) {
                        this.html = this.html
                            .replace(/<\bloop\b/g, '<template is="dom-repeat"')
                            .replace(/<\/\bloop\b>/g, '</template>');
                    }
                },

                evalJS() {
                    try {
                        eval(this.externJs);
                    } catch (e) {
                        console.log(e.error);
                    }
                }
            })
        })()
    </script>
</dom-module>