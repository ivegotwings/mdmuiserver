<link rel="import" href="../../../bower_components/polymer/polymer.html">
<link rel="import" href="../bedrock-helpers/element-helper.html">
<link rel="import" href="../bedrock-helpers/component-helper.html">
<link rel="import" href="../bedrock-helpers/data-helper.html">
<link rel="import" href="../bedrock-i18n/bedrock-i18n.html">
<link rel="import" href="../bedrock-settings-behavior/bedrock-settings-behavior.html">
<link rel="import" href="../bedrock-externalref-underscore/bedrock-externalref-underscore.html">
<script>
    /***
    * `RUFBehaviors.UIBehavior` provides common properties and methods that must be  implemented for all
    * elements and components. It is a mandatory behavior for all elements and components to implement.
    *
    * `RUFBehaviors.UIBehavior` has multiple properties that are used in the context flow, authentication, and configuration.
    *
    *  ### Example
    *
    *     <dom-module id="x-app">
    *        <template>
    *        </template>
    *        <script>
    *           Polymer({
    *             is: "x-app",
    *
    *             behaviors: [
    *               RUFBehaviors.UIBehavior
    *             ],
    *
    *             properties: {
    *              
    *             }
    *           });
    *        &lt;/script>
    *     </dom-module>
    * @demo demo/index.html
    * @polymerBehavior RUFBehaviors.UIBehavior
    */

    window.RUFBehaviors = window.RUFBehaviors || {};
    /** @polymerBehavior RUFBehaviors.UIBehavior */
    RUFBehaviors.UIBehaviorImpl = {

        properties: {
            /**
            * Content is not appearing - Indicates html identification of the element. If it is not given, then unique identification 
            * gets created.
            */
            id: {
                type: String,
                // value: ""
            },
            /**
            * Content is not appearing - Indicates the tenant identification. It reads the tenant identification from the main App.
            */
            tenantId: {
                type: String,
                notify: true,
                value: function () {
                    var mainApp = RUFUtilities.mainApp;
                    if (mainApp) {
                        return mainApp.tenantId;
                    }
                    return "";
                }
            },
            /**
            * Content is not appearing - Indicates the role identification of the currently logged-in user. It reads the role identification 
            * from the main App.
            */
            roleId: {
                type: String,
                notify: true,
                value: function () {
                    var mainApp = RUFUtilities.mainApp;
                    if (mainApp) {
                        return mainApp.roleId;
                    }
                    return "";
                }
            },
            /**
            * Content is not appearing - Indicates the user identification of the currently logged-in user. It reads the user identification 
            * from the main App.
            */
            userId: {
                type: String,
                notify: true,
                value: function () {
                    var mainApp = RUFUtilities.mainApp;
                    if (mainApp) {
                        return mainApp.userId;
                    }
                    return "";
                }
            },
            /**
            * Indicates the ownership data of the currently logged-in user. It reads the ownership data identification 
            * from the main App.
            */
            ownershipData: {
                type: String,
                notify: true,
                value: function () {
                    var mainApp = RUFUtilities.mainApp;
                    if (mainApp) {
                        return mainApp.ownershipData;
                    }
                    return "";
                }
            },
            /**
            * Content is not appearing - Indicates an App identification. There is no need to pass this value when you use it.
            */
            appId: {
                type: String,
                value: function () {
                    return this.getAppId();
                }
            },
            /**
            * Content is not appearing - Specifies whether or not the component is Riversand UI Framework's element or component.
            */
            isRufComponent: {
                type: Boolean,
                value: true,
                reflectToAttribute: true
            }
        },
        /**
          * Content is not appearing - Content development is under progress. 
          */
        attached: function () {
            if (this && (!this.id || this.id == "")) {
                this.id = ElementHelper.getRandomId();
            }
            if (this && (!this.appId || this.appId == "")) {
                this.appId = this.getAppId();
            }
        },
        /**
        * Content is not appearing - Can be used to fire the bedrock event.
        *
        * @method fireBedrockEvent
        * @param {(String)} name The name of the event
        * @param {(Object)} data The detail object for the event
        */
        fireBedrockEvent: function (name, data, settings) {
            return ComponentHelper.fireBedrockEvent(name, data, settings, this);
        },
        /**
        * Content is not appearing - Content development is under progress. 
        */
        getAppId: function () {
            var appId = "";
            var componentContainer = ComponentHelper.getComponentContainer(this);

            if (componentContainer && componentContainer.localName == "main-app") {
                if (componentContainer.id) {
                    appId = componentContainer.id;
                }
            } else {
                var viewComponent = ComponentHelper.getCurrentActiveApp();
                if (viewComponent) {
                    appId = viewComponent.id;
                }
            }

            return appId;
        },
        _isNullOrEmpty: function (val, fallbackVal) {
            return _.isNullOrEmpty(val, fallbackVal);
        },
        /**
          * Content is not appearing - Content development is under progress. 
          */
        showSuccessToast: function (message, toastDuration) {
            if (RUFUtilities.appCommon)
                RUFUtilities.appCommon.toastText = message;
            var toastElement = this.getToast();
            toastElement.toastType = "success";
            toastElement.heading = "Success";
            toastElement.autoClose = true;

            if (typeof (toastDuration) !== "undefined") {
                toastElement.toastDuration = toastDuration;
            }

            toastElement.show();
        },
        /**
        * Content is not appearing - Content development is under progress. 
        */
        showErrorToast: function (message, toastDuration) {
            RUFUtilities.appCommon.toastText = message;
            var toastElement = this.getToast();
            toastElement.toastType = "error";
            toastElement.heading = "Error";
            toastElement.autoClose = true;

            if (typeof (toastDuration) !== "undefined") {
                toastElement.toastDuration = toastDuration;
            }

            toastElement.show();
        },
        /**
        * Content is not appearing - Content development is under progress. 
        */
        showInformationToast: function (message, toastDuration) {
            RUFUtilities.appCommon.toastText = message;
            var toastElement = this.getToast();
            toastElement.toastType = "information";
            toastElement.heading = "Information";
            toastElement.autoClose = true;

            if (typeof (toastDuration) !== "undefined") {
                toastElement.toastDuration = toastDuration;
            }

            toastElement.show();
        },
        /**
        * Content is not appearing - Content development is under progress. 
        */
        showWarningToast: function (message, toastDuration) {
            RUFUtilities.appCommon.toastText = message;
            var toastElement = this.getToast();
            toastElement.toastType = "warning";
            toastElement.heading = "Warning";
            toastElement.autoClose = true;

            if (typeof (toastDuration) !== "undefined") {
                toastElement.toastDuration = toastDuration;
            }

            toastElement.show();
        },
        /**
        * Content is not appearing - Content development is under progress. 
        */
        getToast: function () {
            return RUFUtilities.pebbleAppToast;
        },
        _getExceptionMessage: function (ex) {
            if (ex.message) {
                return ex.message;
            } else if (ex.description) {
                return ex.description;
            } else {
                return DataHelper.toStr(ex);
            }
        },
        _getUrlFileName: function (url) {
            var lastSlashIndex = Math.max(url.lastIndexOf("/"), url.lastIndexOf("\\"));
            return url.substr(lastSlashIndex + 1);
        },
        _formatException: function (ex) {
            if (ex) {
                var exStr = "Exception: " + this._getExceptionMessage(ex);
                if (ex.lineNumber) {
                    exStr += " on line number " + ex.lineNumber;
                }
                if (ex.fileName) {
                    exStr += " in file " + this._getUrlFileName(ex.fileName);
                }
                if (ex.stack) {
                    exStr += "\r\n" + "Stack trace:" + "\r\n" + ex.stack;
                }
                return exStr;
            }
            return null;

        },
        logWarning: function () {
            var translatedMessage = this.localize.apply(this, arguments);
            //RUFtilities.Logger.warn(translatedMessage);
        },
        logError: function () {
            var translatedMessage = this.localize.apply(this, arguments);
            if (arguments.length % 2 == 1) {
                //RUFtilities.Logger.error(translatedMessage);
            }
            else {
                var exception = this._formatException(arguments[arguments.length - 1]);
                //RUFtilities.Logger.error(translatedMessage + "\r\n" + "Original error: " + exception);
            }

        },
        logInfo: function () {
            var translatedMessage = this.localize.apply(this, arguments);
            //RUFtilities.Logger.info(translatedMessage);
        }
    };

    /** @polymerBehavior */
    RUFBehaviors.UIBehavior = [RUFBehaviors.Internationalization, RUFBehaviors.SettingsBehavior, RUFBehaviors.UIBehaviorImpl];

</script>