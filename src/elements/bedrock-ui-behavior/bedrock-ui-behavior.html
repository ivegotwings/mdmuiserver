<link rel="import" href="../bedrock-helpers/element-helper.html">
<script>
    /***
    * `RUFBehaviors.UIBehavior` provides common properties/methods, which need to be implemented across all
    * elements/components. It is a mandatory behavior to be implemented by all elements/components
    *
    * `RUFBehaviors.UIBehavior` has multiple properties to be used targeting context flow, authentication, configuration.
    *
    * Sample usage of using : RUFBehaviors.UIBehavior
    *
    *     <dom-module id="x-app">
    *        <template>
    *        </template>
    *        <script>
    *           Polymer({
    *             is: "x-app",
    *
    *             behaviors: [
    *               RUFBehaviors.UIBehavior
    *             ],
    *
    *             properties: {
    *              
    *             }
    *           });
    *        &lt;/script>
    *     </dom-module>
    *
    * @polymerBehavior RUFBehaviors.UIBehavior
    */

    window.RUFBehaviors = window.RUFBehaviors || {};
    RUFBehaviors.UIBehavior = {

        properties: {
            /**
            * Indicates html id of the element. if id is not provided, unique id would be created
            */
            id: {
                type: String,
                value: function() { return null; }
            },
            /**
            * Indicates the tenant id, it reads tenant id from main app
            */
            tenantId: {
                type: String,
                notify: true,
                value: function () {
                    var mainApp = document.querySelector("main-app");
                    if (mainApp) {
                        return mainApp.tenantId;
                    }
                    return "";
                }
            },

            /**
            * Indicates the role id of the current logged-in user. it reads role id from main app
            */
            roleId: {
                type: String,
                notify: true,
                value: function () {
                    var mainApp = document.querySelector("main-app");
                    if (mainApp) {
                        return mainApp.roleId;
                    }
                    return "";
                }
            },

            /**
            * Indicates the user id of the current logged-in user. it reads user id from main app
            */
            userId: {
                type: String,
                notify: true,
                value: function () {
                    var mainApp = document.querySelector("main-app");
                    if (mainApp) {
                        return mainApp.userId;
                    }
                    return "";
                }
            },

            /**
            * Indicates app id, no need to pass this value while using it
            */
            appId: {
                type: String,
                value: function () {
                    return this._getAppId();
                }
            },
            /**
            * Indicates whether the component is riversand ui framework element/component
            */
            isRufComponent: {
                type: Boolean,
                value: true,
                reflectToAttribute: true
            }

        },
        attached: function () {
            if (!this.id || this.id == "") {
                this.id = ElementHelper.getRandomId();
            }
            if (!this.appId || this.appId == "") {
                this.appId = this._getAppId();
            }
        },

        /**
        * Fires the bedrock event.
        *
        * @method fireBedrockEvent
        * @param {(String)} name The name of the event
        * @param {(Object)} data The detail object for the event
        */
        fireBedrockEvent: function (name, data) {
            if (this.id) {
                name = name + "-" + this.id;
            }

            if (this.appId) {
                name = name + "-" + this.appId;
            }
            this.fire('bedrock-event' + "-" + name, data);
        },

        _getAppId: function () {
            var appId = "";
            var mainApp = document.querySelector("main-app");
            if (mainApp) {
                var contentViewMgr = mainApp.$$("rock-content-view-manager");
                if (contentViewMgr) {
                    var activeContentView = contentViewMgr.$.contentViewManager.querySelector(
                        "rock-content-view:not([hidden])");
                    if (activeContentView) {
                        var contentViewContainer = activeContentView.$$("#content-view-container");
                        if (contentViewContainer) {
                            var viewComponent = contentViewContainer.querySelector(".view-component");
                            if (viewComponent) {
                                appId = contentViewContainer.querySelector(".view-component").id;
                            }
                        }
                    }
                }
            }
            return appId;
        }


    };

</script>