<link rel="import" href="../bedrock-helpers/element-helper.html">
<link rel="import" href="../bedrock-helpers/component-helper.html">
<link rel="import" href="../bedrock-externalref-underscore/bedrock-externalref-underscore.html">
<script>
    /***
    * `RUFBehaviors.UIBehavior` provides common properties and methods that need to be implemented across all
    * elements and components. It is a mandatory behavior for all elements and components to implement.
    *
    * `RUFBehaviors.UIBehavior` has multiple properties that can be used in the context flow, authentication, and configuration.
    *
    *  ### Example
    *
    *     <dom-module id="x-app">
    *        <template>
    *        </template>
    *        <script>
    *           Polymer({
    *             is: "x-app",
    *
    *             behaviors: [
    *               RUFBehaviors.UIBehavior
    *             ],
    *
    *             properties: {
    *              
    *             }
    *           });
    *        &lt;/script>
    *     </dom-module>
    *
    * @polymerBehavior RUFBehaviors.UIBehavior
    */

    window.RUFBehaviors = window.RUFBehaviors || {};
    RUFBehaviors.UIBehavior = {

        properties: {
            /**
            * Indicates html identification of the element. If it is not given, then unique identification 
            * gets created.
            */
            id: {
                type: String,
                value: ""
            },
            /**
            * Indicates the tenant identification. It reads the tenant identification from the main App.
            */
            tenantId: {
                type: String,
                notify: true,
                value: function () {
                    var mainApp = document.querySelector("main-app");
                    if (mainApp) {
                        return mainApp.tenantId;
                    }
                    return "";
                }
            },

            /**
            * Indicates the role identification of the currently logged-in user. It reads the role identification 
            * from the main App.
            */
            roleId: {
                type: String,
                notify: true,
                value: function () {
                    var mainApp = document.querySelector("main-app");
                    if (mainApp) {
                        return mainApp.roleId;
                    }
                    return "";
                }
            },

            /**
            * Indicates the user identification of the currently logged-in user. It reads the user identification 
            * from the main App.
            */
            userId: {
                type: String,
                notify: true,
                value: function () {
                    var mainApp = document.querySelector("main-app");
                    if (mainApp) {
                        return mainApp.userId;
                    }
                    return "";
                }
            },

            /**
            * Indicates an App identification. There is no need to pass this value when you use it.
            */
            appId: {
                type: String,
                value: function () {
                    return this._getAppId();
                }
            },
            /**
            * Specifies whether or not the component is Riversand UI Framework's element or component.
            */
            isRufComponent: {
                type: Boolean,
                value: true,
                reflectToAttribute: true
            },

            /*
            * Indicates data context
            */
            dataContext: {
                type: Object,
                value: function () {
                    return {};
                }
            },
             getConfig: {
                type: Function,
                computed: '_getConfig(_componentConfig)'
            },
            applicationConfig: {
                type: Object,
                notify: true
            },
            _componentConfig: {
                type: Object,
                notify: true,
                value: function () {
                    var activeApp = ComponentHelper.getCurrentActiveApp();
                    if (activeApp) {
                        return activeApp.applicationConfig;
                    }
                    return {};
                }
            }
           
        },

        attached: function () {
            if (this && (!this.id || this.id == "")) {
                this.id = ElementHelper.getRandomId();
            }
            if (this && (!this.appId || this.appId == "")) {
                this.appId = this._getAppId();
            }
            var activeApp = ComponentHelper.getCurrentActiveApp();
            if (activeApp && activeApp != null) {
                this.removeEventListener("application-config-changed", this._mainConfigChanged);
                this.addEventListener("application-config-changed", this._mainConfigChanged);
            }
        },

        /**
        * Fires the bedrock event.
        *
        * @method fireBedrockEvent
        * @param {(String)} name The name of the event
        * @param {(Object)} data The detail object for the event
        */
        fireBedrockEvent: function (name, data, settings) {
            ComponentHelper.fireBedrockEvent(name, data, settings, this);
        },

        _getConfig: function (config) {
            return function () {
                var component = arguments[0];
                var componentName = arguments[1];
                if (component) {
                    var configValue = config[component];
                    if (configValue) {
                        if (componentName) {
                            return configValue[componentName].config;
                        }
                        else {
                            return configValue.config;
                        }
                    }
                    return undefined;
                }
                return undefined;
            };

        },

        _getAppId: function () {
            var appId = "";
            var viewComponent = ComponentHelper.getCurrentActiveApp();
            if(viewComponent){
                appId = viewComponent.id;
            }
            return appId;
        },

        _mainConfigChanged: function (newValue) {
            this._componentConfig = newValue.detail.value;
        }
    };

</script>