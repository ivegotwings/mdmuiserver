<link rel="import" href="../../../bower_components/polymer/polymer.html">
<link rel="import" href="../../../bower_components/iron-ajax/iron-ajax.html">
<link rel="import" href="../../../bower_components/iron-flex-layout/iron-flex-layout-classes.html">

<link rel="import" href="../pebble-icon/pebble-icon.html">
<link rel="import" href="../pebble-icons/pebble-icons.html">
<link rel="import" href="../pebble-image-viewer/pebble-image-viewer.html">
<link rel="import" href="../pebble-styles-shared/pebble-styles-shared.html">

<!--
`<rock-entity-todo>` Represents an element that displays entity to-do as a list.

### Example

    <template is="dom-bind">
        <iron-ajax url="entities.json" last-response="{{response}}" auto></iron-ajax>
		<rock-entity-todo entities="{{response}}"></rock-entity-todo>                
	</template>

### Styling

The following custom properties and mixins are available for styling:

Custom property | Description | Default
----------------|-------------|----------
`--entity-todo-icon-outer` | Mixin applied to icon outer circle | {}
`--entity-todo-container` | Mixin applied to entity item container | {}
`--entity-todo-content` | Mixin applied to entity item content | {}
`--entity-todo-icon-width` | The width of icon | ``
`--entity-todo-icon-height` | The height of icon | ``

@group rock Elements
@element rock-entity-todo
@demo demo/index.html
-->

<dom-module id="rock-entity-todo">    
    <template>
        <style is="custom-style" include="iron-flex iron-flex-alignment"> 

       .container{
            @apply(--layout-horizontal);             
            align-items: center;
            max-height: 250px;
            max-width: 288px;
            padding: 5px 0;
            cursor: pointer;            
            @apply(--entity-todo-container);
        }

        .entity-icon-outer{
            @apply(--layout);
            @apply(--layout-center-center);
            @apply(--paper-font-common-base); 
            border-radius: 50%;            
            width: 30px;
            height: 30px;
            margin-right: 10px;                       
            @apply(--entity-todo-icon-outer);
        }
        .entity-icon-outer::shadow iron-icon{
            width: 30px;
            height: 30px;
        }

        .entity-content{
            align-self: flex-center;
            @apply(--entity-todo-content);
        }

        pebble-icon {
            --pebble-icon-width: var(--entity-todo-icon-width, 30px);
            --pebble-icon-height: var(--entity-todo-icon-height, 30px);
        }
        .entity-content {
            font-size: 12px !important;
        }
                       
        </style>

        <template is="dom-repeat" items="[[data.todos]]"> 
            <div class="container" id="[[_getId(item.data.name, index)]]" data="[[item.data]]" on-tap="_onTap">
                <div class="entity-icon-outer">
                    <pebble-icon icon="[[item.icon.name]]"></pebble-icon>
                </div>    
                <div class="entity-content">
                    [[item.data.label]]
                </div>
            </div>
            [[_applyStyle(item, index)]]       
        </template>
        <iron-ajax id="todo-ajax" auto url="[[_url]]" handle-as="json" last-response="{{data}}"></iron-ajax>        
    </template>      

    <script>
        Polymer({
            is: 'rock-entity-todo',

            properties: {

                /**
                *  Indicates the list of entities in JSON format.
                */
                data: {
                    type: Object,
                    notify: true,
                    value: function() { return {}; }
                },

                /**
                * Indicates an url to fetch an ajax request.
                */
                _url: {
                    type: String,
                    value: "/src/data/EntityManageApp/entity-summary-todo-data.json"                                
                }
            },

            /**
             * Can be used to raise on-tap events as per the configuration.
             */
            _onTap: function (e) {
                var eventDetail = {
                    name: e.currentTarget.data.eventName,
                    data: e.currentTarget.data
                }

                this.fire('bedrock-event', eventDetail);
            },

            _getId: function(name, index){
                return name + '_' + index;
            },

            _applyStyle: function(item, index)
            {
                this.async(function(){                    
                    var container = this.$$('#' + this._getId(item.data.name, index));
                    var outerdiv = container.querySelector('.entity-icon-outer');
                    var icon = container.querySelector('pebble-icon');

                    outerdiv.style['background-color'] = item.icon.backgroundColor;
                    icon.style['color'] = item.icon.stroke;
                    icon.style['background-color'] = item.icon.fill;
                }, 150); //Delayed to capture dom elements
            }

        });   
    </script>
</dom-module>