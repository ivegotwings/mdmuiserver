<link rel="import" href="../../../bower_components/polymer/polymer.html">
<link rel="import" href="../../../bower_components/iron-demo-helpers/demo-pages-shared-styles.html">
<link rel="import" href="../../../bower_components/iron-ajax/iron-ajax.html">
<link rel="import" href="../bedrock-pubsub/bedrock-pubsub.html">
<link rel="improt" href="../bedrock-helpers/data-helper.html">
<link rel="import" href="../liquid-entity-get/liquid-entity-get.html">
<link rel="import" href="../liquid-entity-data-get/liquid-entity-data-get.html">
<link rel="import" href="../liquid-entity-data-save/liquid-entity-data-save.html">
<link rel="import" href="../pebble-horizontal-divider/pebble-horizontal-divider.html">
<link rel="import" href="../pebble-button/pebble-button.html">
<link rel="import" href="../pebble-styles-shared/pebble-styles-shared.html">
<link rel="import" href="../rock-relationship-grid/rock-relationship-grid.html">
<!--
`rock-relationship-manage` Represents relationship component in the framework.
It renders the list of attributes based on the specified relationship type.

@group rock Elements
@element rock-relationship-manag4e
@demo demo/index.html
-->
<dom-module id="rock-relationship-manage">
    <template>
        <style include="pebble-styles-shared">
            .button {
                --pebble-button: {
                    height: 30px;
                    width: 100px;
                    border: 1px solid #bbc1d2;
                    font-size: 15px;
                }
            }
            
            #buttonContainer {
                height: 50px;
                background: #fff;
                position: fixed;
                bottom: 0px;
                width: 75%;
            }
        </style>
        <iron-ajax auto url="../../data/EntityManageApp/relationship-grid-config.json" handle-as="json" last-response="{{relationshipGridConfigs}}"></iron-ajax>
        <liquid-entity-get name="attributeModelGetService" request="{{_attributeModelRequest}}" response="{{_attributeModelResponse}}"></liquid-entity-get>
        <rock-relationship-grid id="entityRelationshipGrid" relationship-type="[[context.relationshipTypeName]]" rel-req="[[requestObj]]"
            relationship-grid-config="{{relationshipGridConfigs}}" attribute-models="[[_attributeModelResponse.returnValue.attributeModels]]"
            page-size="100" dimensions="[[_dimensions]]"></rock-relationship-grid>
        <bedrock-pubsub event-name="grid-selecting-item" handler="onSelectingGridItem" target-id="entityRelationshipGrid"></bedrock-pubsub>
    </template>
    <script>
        (function () {
            'use strict';

            Polymer({
                is: "rock-relationship-manage",

                properties: {
                    context: {
                        type: Object,
                        value: function () {
                            return {};
                        }
                    },

                    requestObj: {
                        type: Object,
                        value: function () {
                            return {};
                        }
                    },

                    /**
                     * Indictaes Id of the entity for which the attributes have to be managed.
                     */
                    entityId: {
                        type: String
                    },
                    /**
                     * Indictaes the locale dimension for which the attributes have to be managed.
                     */
                    locale: {
                        type: String
                    },
                    /**
                     * Indictaes the list for which the attributes have to be managed.
                     */
                    list: {
                        type: String
                    },
                    /**
                     * Indictaes the source dimension for which the attributes have to be managed.
                     */
                    source: {
                        type: String
                    },

                    _attributeModelRequest: {
                        type: Object,
                        value: function () {
                            return {
                                action: "getAttributeModels",
                                "attributeNames": ["csapDescriptionOfNart", "cpimProductName",
                                    "rpimIsMaster"
                                ]
                            };

                        }
                    },

                    _dimensions: {
                        type: Object,
                        value: function() {
                            return {};
                        }
                    }
                },

                observers: [
                    '_prepareRequest(relationshipGridConfigs)'
                ],

                _prepareRequest: function (config) {
                    var req = {
                        "params": {
                            "query": {
                                "ctx": [{
                                    "list": this.list,
                                    "classification": "nivea/niveaBodyCare/niveaBody/nbodyEssential/nbody/ess/nourishingMilkDry"
                                }],
                                "valCtx": [{
                                    "source": this.source,
                                    "locale": this.locale
                                }],
                                "id": this.entityId,
                                "filters": {
                                    "attributesCriterion": [],
                                    "relationshipsCriterion": [],
                                    "typesCriterion": ["nart"]
                                }
                            },
                            "fields": {
                                "ctxTypes": [
                                    "properties"
                                ],
                                "relationships": [],
                                "relationshipAttributes": [],
                                "relatedEntityAttributes": []
                            },
                            "options": {
                                "from": 0,
                                "to": 0
                            }
                        }
                    };

                    this.requestObj = req;
                    this._dimensions = {
                        "source": this.source,
                        "locale": this.locale,
                        "list": this.list
                    }
                }
            });
        })();
    </script>
</dom-module>