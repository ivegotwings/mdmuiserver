<!doctype html>

<html>

<head>
  <title>pebble-textbox-collection tests</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, minimum-scale=1.0, initial-scale=1, user-scalable=yes">
  <script src="../../../../bower_components/webcomponentsjs/webcomponents-lite.js"></script>
  <script src="../../../../bower_components/web-component-tester/browser.js"></script>
  
  <link rel="import" href="../pebble-textbox-collection.html">
</head>

<body>

  <test-fixture id="basic">
    <template>
      <pebble-textbox-collection values='[{"name":"color"}, {"name":"size"}]'></pebble-textbox-collection>
    </template>
  </test-fixture>

  <script>

      suite('pebble-textbox-collection testcases', function() {
        
        test('instantiating the element works', function() {
           var pebbleElement = fixture('basic');
           assert.equal(pebbleElement.is, 'pebble-textbox-collection');
        });
        
        test('Should show initialized tags', function() {
           var pebbleElement = fixture('basic');
           Polymer.dom.flush();
           var tags = pebbleElement.querySelector('.tags-container').querySelectorAll('.tag-content');
           assert.equal(tags.length, 2);
           assert.equal(tags[0].querySelector('.tag-value').innerHTML, 'color');
           assert.equal(tags[1].querySelector('.tag-value').innerHTML, 'size');
        });
        
        test('Should show add popover on on-click dropdown icon', function() {
           var pebbleElement = fixture('basic');
           Polymer.dom.flush();
           var dropdown = pebbleElement.querySelector('.dropdown-icon');
           dropdown.click();
           Polymer.dom.flush();
           var containers = pebbleElement.querySelector('#tagPopover').querySelectorAll('.tag-container');
           assert.notEqual(window.getComputedStyle(containers[0]).display, 'none'); //Visible check
           assert.notEqual(containers[0].querySelector('#txtAddTag'), null); //Element check                            
        });
        
        test('Should show update popover on on-click tag value', function() {
           var pebbleElement = fixture('basic');
           Polymer.dom.flush();
           var tags = pebbleElement.querySelector('.tags-container').querySelectorAll('.tag-content');
           tags[0].querySelector('.tag-value').click();           
           Polymer.dom.flush();
           var containers = pebbleElement.querySelector('#tagPopover').querySelectorAll('.tag-container');
           assert.notEqual(window.getComputedStyle(containers[1]).display, 'none'); //Visible check
           assert.notEqual(containers[1].querySelector('#txtUpdateTag'), null); //Element check
        });
        
        test('Should add a tag on on-click add icon', function() {
           var pebbleElement = fixture('basic');
           Polymer.dom.flush();
           var dropdown = pebbleElement.querySelector('.dropdown-icon');
           dropdown.click();
           Polymer.dom.flush();
           var containers = pebbleElement.querySelector('#tagPopover').querySelectorAll('.tag-container');
           containers[0].querySelector('#txtAddTag').value = "Add Text";
           containers[0].querySelector('pebble-icon').click();
           Polymer.dom.flush();
           var tags = pebbleElement.querySelector('.tags-container').querySelectorAll('.tag-content');
           assert.equal(tags.length, 3);
           assert.equal(tags[2].querySelector('.tag-value').innerHTML, 'Add Text');
        });
        
        test('Should update tag on on-click save icon', function() {
           var pebbleElement = fixture('basic');
           Polymer.dom.flush();
           var tags = pebbleElement.querySelector('.tags-container').querySelectorAll('.tag-content');
           tags[0].querySelector('.tag-value').click();           
           Polymer.dom.flush();
           var containers = pebbleElement.querySelector('#tagPopover').querySelectorAll('.tag-container');
           containers[1].querySelector('#txtUpdateTag').value = "Color Changed";
           containers[1].querySelector('pebble-icon').click();
           Polymer.dom.flush();
           var tags = pebbleElement.querySelector('.tags-container').querySelectorAll('.tag-content');           
           assert.equal(tags[0].querySelector('.tag-value').innerHTML, 'Color Changed');

        });
        
        test('Should remove tag on on-click tag close icon', function() {
           var pebbleElement = fixture('basic');
           Polymer.dom.flush();
           var tags = pebbleElement.querySelector('.tags-container').querySelectorAll('.tag-content');
           tags[0].querySelector('.tag-close').querySelector('pebble-icon').click();           
           Polymer.dom.flush();
           var tags = pebbleElement.querySelector('.tags-container').querySelectorAll('.tag-content');
           assert.equal(tags.length, 1);
        });

     });
    </script>
</body>

</html>