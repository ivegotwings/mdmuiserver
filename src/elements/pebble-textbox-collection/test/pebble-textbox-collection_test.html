<!doctype html>

<html>

<head>
  <title>pebble-textbox-collection tests</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, minimum-scale=1.0, initial-scale=1, user-scalable=yes">
  <script src="../../../../bower_components/webcomponentsjs/webcomponents-lite.js"></script>
  <script src="../../../../bower_components/web-component-tester/browser.js"></script>
  
  <link rel="import" href="../pebble-textbox-collection.html">
</head>

<body>

  <test-fixture id="basic">
    <template>
      <pebble-textbox-collection label='Hashtags' values='[{"name":"color", "color": "green"}, {"name":"size", "color": "blue"}]'></pebble-textbox-collection>
    </template>
  </test-fixture>

  <script>

      suite('pebble-textbox-collection testcases', function() {
        
        test('instantiating the element works', function() {
           var pebbleElement = fixture('basic');
           assert.equal(pebbleElement.is, 'pebble-textbox-collection');
        });
        
        test('Should show initialized tags', function() {
           var pebbleElement = fixture('basic');
           Polymer.dom.flush();
           var tags = pebbleElement.querySelector('pebble-tags').querySelectorAll('pebble-tag-item');
           assert.equal(tags.length, 2);           
           assert.equal(tags[0].querySelector('.name').innerHTML, 'color');
           assert.equal(tags[1].querySelector('.name').innerHTML, 'size');
        });
        
        test('Should show add popover on on-click dropdown icon', function() {
           var pebbleElement = fixture('basic');
           Polymer.dom.flush();
           var dropdown = pebbleElement.querySelector('.dropdown-icon');
           dropdown.click();
           Polymer.dom.flush();
           var container = pebbleElement.querySelector('#tagPopover').querySelector('.tag-container');
           assert.notEqual(container.querySelector('#txtInputTag'), null); //Element check           
           assert.equal(container.querySelector('#txtInputTag').value, null);  //Value check                          
        });
        
        test('Should show update popover on on-click tag value', function() {
           var pebbleElement = fixture('basic');
           Polymer.dom.flush();
           var tags = pebbleElement.querySelector('.tags-container').querySelectorAll('pebble-tag-item');
           tags[0].querySelector('.name').click();           
           Polymer.dom.flush();
           var container = pebbleElement.querySelector('#tagPopover').querySelector('.tag-container');
           assert.notEqual(container.querySelector('#txtInputTag'), null); //Element check           
           assert.equal(container.querySelector('#txtInputTag').value, 'color'); //Value check
        });
        
        test('Should add a tag on on-click add icon', function() {
           var pebbleElement = fixture('basic');
           Polymer.dom.flush();
           var dropdown = pebbleElement.querySelector('.dropdown-icon');
           dropdown.click();
           Polymer.dom.flush();
           var container = pebbleElement.querySelector('#tagPopover').querySelector('.tag-container');           
           container.querySelector('#txtInputTag').value = "Add Text";
           container.querySelector('pebble-icon').click();
           Polymer.dom.flush();
           var tags = pebbleElement.querySelector('.tags-container').querySelectorAll('pebble-tag-item');
           assert.equal(tags.length, 3);
           assert.equal(tags[2].querySelector('.name').innerHTML, 'Add Text');
        });
        
        test('Should update tag on on-click save icon', function() {
           var pebbleElement = fixture('basic');
           Polymer.dom.flush();
           var tags = pebbleElement.querySelector('.tags-container').querySelectorAll('pebble-tag-item');
           tags[0].querySelector('.name').click();           
           Polymer.dom.flush();
           var container = pebbleElement.querySelector('#tagPopover').querySelector('.tag-container');
           container.querySelector('#txtInputTag').value = "Color Changed";
           container.querySelector('pebble-icon').click();
           Polymer.dom.flush();
           var tags = pebbleElement.querySelector('.tags-container').querySelectorAll('pebble-tag-item');           
           assert.equal(tags[0].querySelector('.name').innerHTML, 'Color Changed');
        });
        
        test('Should remove tag on on-click tag close icon', function() {
           var pebbleElement = fixture('basic');
           Polymer.dom.flush();
           var tags = pebbleElement.querySelector('.tags-container').querySelectorAll('pebble-tag-item');
           tags[0].querySelector('paper-icon-button').click();           
           Polymer.dom.flush();
           var tags = pebbleElement.querySelector('.tags-container').querySelectorAll('pebble-tag-item');
           assert.equal(tags.length, 1);
        });

     });
    </script>
</body>

</html>