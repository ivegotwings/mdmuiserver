<link rel="import" href="../../../bower_components/polymer/polymer.html">
<link rel="import" href="../../../bower_components/paper-input/paper-input.html">
<link rel="import" href="../../../bower_components/iron-flex-layout/iron-flex-layout-classes.html">

<link rel="import" href="../bedrock-ui-behavior/bedrock-ui-behavior.html">
<link rel="import" href="../bedrock-pubsub/bedrock-pubsub.html">

<link rel="import" href="../pebble-icon/pebble-icon.html">
<link rel="import" href="../pebble-icons/pebble-icons.html">
<link rel="import" href="../pebble-popover/pebble-popover.html">
<link rel="import" href="../pebble-textbox/pebble-textbox.html">
<link rel="import" href="../pebble-styles-shared/pebble-styles-shared.html">

<!--
`<pebble-textbox-collection>` Represents an element which contains dimension selection.

### Example:

    <pebble-textbox-collection id="guideme" selected-items="{{selectedItems}}"></pebble-textbox-collection>

@group rock Elements
@element pebble-textbox-collection
@demo demo/index.html
-->

<dom-module id="pebble-textbox-collection">
    <template>
        <style include="pebble-styles-shared"></style>
        <style is="custom-style" include="iron-flex iron-flex-alignment">
            pebble-textbox::shadow paper-input {
                margin-top: -25px;               
            }
            .text-collection-container {
                width: 400px;
                @apply(--text-collection-container)
            }
            .text-collection-label {
                text-transform: uppercase;
                @apply(--text-collection-label)
            }
            .tags-container {
                max-height: 75px;                
                overflow-y: scroll; 
                margin-right: 20px;
                display: block;                
                @apply(--layout-horizontal);
                @apply(--layout-wrap);
                @apply(--tags-container)
            }
            .tag-content{
                border: 1px solid #cacaca;
                border-left: 4px solid #cacaca;
                border-radius: 4px;
                margin: 4px;
                padding: 4px;                                
                @apply(--layout-horizontal);
                @apply(--tags-content)                
            }
            .tag-close {
                margin-left: 10px;
            }
            .tag-close > pebble-icon {
                --pebble-icon-width: 14px;
                --pebble-icon-height: 14px;
            }
            pebble-icon {
                cursor: pointer;
            }
            pebble-popover {                
                --pebble-popover-width: 300px;
                @apply(--text-collection-popover)                
            }
            .add-tag-container {
                margin: 20px 0 10px 0;                
                @apply(--text-collection-add-tag-container)
            }
            .add-tag-container > pebble-textbox::shadow pebble-icon {
                --pebble-icon-fill-color: green;
            }
            
        </style>
        <div class="text-collection-container">
            <div class="text-collection-label">[[label]]</div>
            <div class="tags-container">                
                <template is="dom-repeat" items="[[values]]">
                    <div class="tag-content">
                        <div class="tag-value">[[item.name]]</div>
                        <div class="tag-close">
                            <pebble-icon icon="pebble-md-icons:Clear" on-tap="_removeTag"></pebble-icon>
                        </div>                        
                    </div>
                </template>                
            </div>
            <pebble-textbox id="tagTextCollection" no-Label-Float type="text" readonly>
                <pebble-icon icon="icons:arrow-drop-down" suffix on-tap="_openPopover"></pebble-icon>
            </pebble-textbox>
            <bedrock-pubsub event-name="on-popover-close" handler="_onPopoverClose"></bedrock-pubsub>
            <bedrock-pubsub event-name="on-popover-open" handler="_onPopoverOpen"></bedrock-pubsub>
            <pebble-popover id="tagAddPopover" for="tagTextCollection" horizontal-align="right">            
                <div class="add-tag-container">
                    <pebble-textbox id='txtTag' label="Enter more values here to add" value="{{_tagInputText}}" on-keyup="_onEnterAdd">
                        <pebble-icon icon="add-circle" suffix on-tap="_onTapAdd"></pebble-icon>
                    </pebble-textbox>                
                </div>
            </pebble-popover>
        </div>
    </template>

    <script>
        (function () {
            'use strict';

            Polymer({
                is: 'pebble-textbox-collection',

                properties: {
                    /**
                     * Indicates tag items
                     */
                    values: {
                        type:Array,
                        value:function () {
                            return [];
                        }
                    },

                    label: {
                        type: String,
                        value: 'HASHTAGS'
                    },

                    _tagInputText: {
                        type: String,
                        value: null
                    }

                },
                behaviors: [
                    RUFBehaviors.UIBehavior
                ],                
                _openPopover:function (e) {                    
                    this.$$('#tagAddPopover').show();            
                },                
                _removeTag: function (e) {
                    var tag = e.model.item;
                    this.fireBedrockEvent("on-tag-remove", {"tag": tag}, { ignoreId: true });
                    this.splice('values', this.values.indexOf(tag), 1);
                },
                _onTapAdd: function() {
                    if(!this._tagInputText || (this._tagInputText && !this._tagInputText.trim()) ){
                        return;
                    }

                    this.fireBedrockEvent("on-tag-add", {"text": this._tagInputText}, { ignoreId: true });
                    this._tagInputText = ''; //Clear text
                    this.$$('#txtTag').focus();
                },
                _onEnterAdd: function(e) {
                    if (e.keyCode === 13) {
                        this._onTapAdd();
                    }
                },
                _onPopoverClose: function(){
                    this._tagInputText = '';
                },
                _onPopoverOpen: function(){
                    this.$$('#txtTag').focus();
                }
            });
        })();
    </script>

</dom-module>