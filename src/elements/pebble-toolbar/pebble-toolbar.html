<link rel="import" href="../../../bower_components/polymer/polymer.html" />
<link rel="import" href="../../../bower_components/paper-toolbar/paper-toolbar.html" />
<link rel="import" href="../../../bower_components/paper-button-group/paper-button-group.html" />
<link rel="import" href="../../../bower_components/shadycss/apply-shim.html">
<link rel="import" href="../../../bower_components/polymer/lib/elements/custom-style.html">

<link rel="import" href="../bedrock-ui-behavior/bedrock-ui-behavior.html">
<link rel="import" href="../bedrock-pubsub/bedrock-pubsub.html">

<link rel="import" href="../bedrock-style-manager/styles/bedrock-style-common.html">
<link rel="import" href="../pebble-button/pebble-button.html" />

<!--
`<pebble-toolbar>` Represents a toolbar which has individual buttons or button groups embedded in it.
 All the buttons or button groups are loaded dynamically based on the JSON configurations (config json) which is bound to the `pebble-toolbar` element.
 
 From the "config json", the button properties such as "icon"" and "text" are used for the display. And the `eventName` property 
sends the event information to the event handler. 

### Styling

The following custom properties and mixins are available for styling:

Custom property | Description | Default
----------------|-------------|----------
`--pebble-toolbar-button-icon`          | Mixin applied to toolbar's simple button with icon                | `{}`
`--pebble-toolbar-button-text`          | Mixin applied to toolbar's simple button with text                | `{}`
`--pebble-toolbar-button-icontext`      | Mixin applied to toolbar's simple button with icon and text       | `{}`
`--pebble-toolbar-buttongroup-text`     | Mixin applied to toolbar's button group button with icon          | `{}`
`--pebble-toolbar-buttongroup-icontext` | Mixin applied to toolbar's button group button with icon and text | `{}`
`--pebble-toolbar-menubutton`           | Mixin applied to toolbar's menu button                            | `{}`
`--pebble-toolbar-buttongroup`          | Mixin applied to toolbar's button group                           | `{}`

@group Pebble Elements
@element pebble-toolbar
@demo demo/index.html
-->

<dom-module id="pebble-toolbar">    
  <template>
      
     <custom-style>
        <style include="bedrock-style-common">
            pebble-button.icon{
                --pebble-button: {
                    padding-top: 4.5px;
                    padding-right: 4.5px;
                    padding-bottom:4.5px;
                    padding-left:4.5px;
                    border: 1px solid var(--cloudy-blue-color,#C1CAD4);
                    margin-top: -3px;
                    margin-right: -3px;
                    margin-bottom: -3px;
                    margin-left: -3px;
                    min-width: 2.14em;
                    @apply --pebble-toolbar-button-icon;
                    top: 0px;
                };
                --pebble-button-iron-icon: {
                    height: 20px;
                    width: 20px;                        
                };
            }
            pebble-button.text{
                --pebble-button: {
                    padding-top: 5px;
                    padding-right: 5px;
                    padding-bottom: 5px;
                    padding-left: 5px;
                    border: 1px solid var(--buttontext-color,#616161);
                    min-width: 3.14em;
                    top: -1px;
                };
                 @apply --pebble-toolbar-button-text;                
            }
            pebble-button.iconText{
                --pebble-button: {
                    padding-top: 4.5px;
                    padding-right: 4.5px;
                    padding-bottom: 4.5px;
                    padding-left: 4.5px;
                    border: 1px solid var(--cloudy-blue-color,#C1CAD4);                            
                    min-width: 4.14em;
                    top: 3px;
                    @apply --pebble-toolbar-button-icontext;
                };
                --pebble-button-iron-icon: {
                    height: 20px;
                    width: 20px;
                    top: -2px;
                    padding-right: 2px;
                    @apply --pebble-toolbar-button-iron-icon-icontext;
                };
            }
            pebble-button.buttonGroupText{
                --pebble-button: {    
                    padding-top: 5px;
                    padding-right: 5px;
                    padding-bottom: 5px;
                    padding-left: 5px;
                    border: 1px solid var(--cloudy-blue-color,#C1CAD4);                            
                    min-width: 3.14em;
                    margin-top: -3px;
                    margin-right: -3px;
                    margin-bottom: -3px;
                    margin-left: -3px;
                    top: -1px;
                };
                @apply --pebble-toolbar-buttongroup-text;
            }
            pebble-button.buttonGroupIconText{
                --pebble-button: {    
                    padding-top: 4.5px;
                    padding-right: 4.5px;
                    padding-bottom: 4.5px;
                    padding-left: 4.5px;                        
                    border: 1px solid var(--cloudy-blue-color,#C1CAD4);                            
                    min-width: 3.14em;
                    margin-top: -3px;
                    margin-right: -3px;
                    margin-bottom: -3px;
                    margin-left: -3px;
                    top: 3px;
                };
                --pebble-button-iron-icon: {
                    height: 20px;
                    width: 20px;
                    top: -2px;
                    padding-right: 2px;
                };
                @apply --pebble-toolbar-buttongroup-icontext;
            }
            pebble-button.menu{
                --pebble-menu-button: {
                    padding-left: 0px;
                };
                --pebble-button: {
                    padding-top: 3px;
                    padding-right: 3px;
                    padding-bottom: 2px;
                    padding-left: 3px;
                    margin-top: -10px;
                    margin-right: -10px;
                    margin-bottom: -10px;
                    margin-left: -10px;
                    top: 2px;
                    min-width: 1.14em;                   
                    @apply --pebble-toolbar-menubutton;
                };
                --pebble-button-paper-menu: {
                    border: 1px solid var(--cloudy-blue-color,#C1CAD4);
                };
                --pebble-button-paper-menu-item: {
                    font-size: var(--default-font-size, 14px);                            
                }
                --pebble-button-menu-item-icon: {
                    height: 16px;
                    width: 16px;
                    padding-right: 2px;
                    @apply --pebble-toolbar-pebble-button-menu-item-icon;
                };
            }
            pebble-button[disabled] {
                pointer-events: none;
                background: transparent;                
                cursor: auto;               
            }                     
            .buttonGroup {
                display: flex;
                display: -webkit-flex;
                align-items: center;
            }
            paper-toolbar{
                background: transparent;
                color: var(--primary-icon-color, #75808b);
                @apply --paper-toolbar;
            }
            paper-toolbar pebble-button {
                height: auto;
                --pebble-button: {
                    min-width: 16px!important;
                    padding-top: 0;
                    padding-right: 0;
                    padding-bottom: 0;
                    padding-left: 0;
                    top:3px;
                };
                --iron-icon: {
                    width: 16px!important;
                    height: 16px!important;
                    min-width: 16px;
                    margin-top:0!important;
                    margin-right:0!important;
                    margin-bottom:0!important;
                    margin-left:0!important;
                };
            }
            pebble-button#pageRange{
                 --pebble-button: {
                     border: none;
                     font-size: var(--font-size-sm, 12px);
                 }
            }
            paper-toolbar pebble-button.icon,
            paper-toolbar pebble-button.buttonGroupText{
                --pebble-button-left-icon: {
                    margin-right: 0 !important;
                };
                --pebble-button:{
                    top: 5px !important;
                }
            }
              paper-toolbar pebble-button.icon{
                --pebble-button:{
                    width: 16px;
                    height: 16px !important;
                    padding-top: 5px;
                    padding-right: 5px;
                    padding-bottom: 5px;
                    padding-left: 5px;
                }
              }
              paper-toolbar pebble-button.buttonGroupText{
                --pebble-button:{
                    padding-top: 5px;
                    padding-right: 5px;
                    padding-bottom: 5px;
                    padding-left: 5px;
                    width: auto;
                }
              }
              paper-toolbar pebble-button.menu{
                --pebble-button:{
                    width: 16px;
                    height: 16px !important;
                    padding-top: 3px;
                    padding-right: 3px;
                    padding-bottom: 2px;
                    padding-left: 3px;
                }
              }
        </style>
     </custom-style>
      <paper-toolbar>
          <template is="dom-repeat" items="[[configData.buttonItems]]" as="button">

              <template is="dom-if" if="[[_computeIcon(button)]]">
                  <pebble-button    icon="[[button.icon]]"
                                    on-tap="_onTap"
                                    disabled$="[[readonly]]"
                                    noink
                                    class="icon"
                                    data="[[button]]"
                                    data-tooltip$="[[button.tooltip]]"
                                    id="[[button.name]]"> 
                  </pebble-button>                  
              </template>
              
              <template is="dom-if" if="[[_computeText(button)]]">
                  <pebble-button    button-text="[[button.text]]"
                                    on-tap="_onTap"
                                    disabled$="[[readonly]]"
                                    noink
                                    class="text"
                                    data="[[button]]"
                                    data-tooltip$="[[button.tooltip]]"
                                    id="[[button.name]]"> 
                  </pebble-button>
              </template>

              <template is="dom-if" if="[[_computeIconText(button)]]">
                  <pebble-button    icon="[[button.icon]]"
                                    button-text="[[button.text]]"
                                    on-tap="_onTap"
                                    disabled$="[[readonly]]"
                                    noink
                                    class="iconText"
                                    data="[[button]]"
                                    data-tooltip$="[[button.tooltip]]"
                                    id="[[button.name]]"> 
                  </pebble-button>                  
              </template>

              <template is="dom-if" if="[[_computeMoreButtons(button)]]">
                    <pebble-button   icon="pebble-md-icons:ToolbarMore"
                                        noink
                                        menu-button
                                        item-data="[[_getMoreButtons(button)]]"
                                        disabled$="[[readonly]]"
                                        class="menu"                                 
                                        vertical-offset="-159"                                              
                                        horizontal-offset="-2"
                                        horizontal-align="[[horizontalAlign]]"
                                        vertical-align="[[verticalAlign]]">  
                    </pebble-button>
              </template>

             <template is="dom-if" if="[[!_computeMoreButtons(button)]]">

                 <paper-button-group slot="top" class="buttonGroup">
                    <template is="dom-repeat" items="[[button.buttons]]" as="button"> 
                        <template is="dom-if" if="[[_computeIcon(button)]]">
                            <pebble-button  icon="[[button.icon]]"
                                            on-tap="_onTap"
                                            disabled$="[[readonly]]"
                                            noink
                                            class="icon tooltip-bottom m-r-5 m-l-5"
                                            data="[[button]]" 
                                            data-tooltip$="[[button.tooltip]]"
                                            id="[[button.name]]"> 
                            </pebble-button>
                            
                        </template>
                        
                        <template is="dom-if" if="[[_computeText(button)]]">
                            <pebble-button  button-text="[[button.text]]"
                                            on-tap="_onTap"
                                            disabled$="[[readonly]]"
                                            noink
                                            class="buttonGroupText tooltip-bottom m-r-5 m-l-5"
                                            data="[[button]]"
                                            data-tooltip$="[[button.tooltip]]"
                                            id="[[button.name]]"> 
                            </pebble-button>
                            
                        </template>

                        <template is="dom-if" if="[[_computeIconText(button)]]">
                            <pebble-button    icon="[[button.icon]]"
                                                button-text="[[button.text]]"
                                                on-tap="_onTap"
                                                disabled$="[[readonly]]"
                                                noink
                                                class="buttonGroupIconText"
                                                data="[[button]]"
                                                data-tooltip$="[[button.tooltip]]"
                                                id="[[button.name]]"> 
                            </pebble-button>
                            
                        </template>

                        <template is="dom-if" if="[[_computeMoreButtons(button)]]">
                            <pebble-button   icon="[[button.icon]]"
                                             button-text="[[button.text]]"
                                             disabled$="[[readonly]]"
                                              noink
                                              menu-button
                                              class="menu tooltip-bottom m-r-5 m-l-5"
                                              item-data="[[_getMoreButtons(button)]]"
                                              vertical-offset="-93"                                              
                                              horizontal-offset="-2"
                                              horizontal-align="[[horizontalAlign]]"
                                              vertical-align="[[verticalAlign]]" data-tooltip$="[[button.tooltip]]"
                                              > 
                            </pebble-button>
                        </template>

                    </template>
                </paper-button-group>

             </template>                          
           
          </template>         
      </paper-toolbar>
      <bedrock-pubsub on-bedrock-event-toolbar-more-event="_onToolbarMoreButtonClick"></bedrock-pubsub>
  </template>
<script>
    Polymer({
        is: "pebble-toolbar",
        properties: {
            /**
             * Indicates the list of buttons and button groups which must be placed on the toolbar.
             */
            configData: {
                type: Object,
                value: function() { return {}; }
            },
            /**
             * If set as true , it indicates the component is in read only mode
             */
            readonly: {
                type: Boolean,
                value: false                
            },
            /**
            * Indicates the orientation to align the menu dropdown horizontally relative to the dropdown trigger.
            */
            horizontalAlign: {
                type: String,
                notify: true
            },
            /**
             * Indicates the orientation to align the menu dropdown vertically relative to the dropdown trigger.
             */
            verticalAlign: {
                type: String,
                notify: true
            },
        },
        behaviors: [
				RUFBehaviors.UIBehavior
		],
        _onTap: function(e) {  
            if(e.currentTarget.disabled == true) {
                return;
            }                   
            this.fireBedrockEvent("toolbar-button-event", e.currentTarget.data);
		},
        _onToolbarMoreButtonClick: function(e, detail)
        {
            if(e.currentTarget.disabled == true) {
                return;
            } 
            this.fireBedrockEvent("toolbar-button-event", detail);
        },
        _computeIconText: function(button) {
            var flag = false;
            if(button.visible && button.name != "moreActions"){
                if(button.icon != null && button.icon.length > 0 && button.text != null && button.text.length > 0){
                    flag = true;    
                }
            }            
            return flag;
        },
        _computeIcon : function(button) {
            var flag = false;
            if(button.visible && button.name != "moreActions"){
                if(button.icon != null && button.icon.length > 0 && (button.text == null || !button.text.length > 0) && !(button.buttons && button.buttons.length)){
                    flag = true;      
                }            
            }
            return flag; 
        },
        _computeText: function(button) {            
            var flag = false;
            if(button.visible && button.name != "moreActions" && !(button.buttons && button.buttons.length)){
                if( (button.icon == null || !button.icon.length > 0) && button.text != null && button.text.length > 0){
                    flag = true;  
                }     
            }       
            return flag; 
        },        
        _computeMoreButtons: function(button){
            var flag = false;
             if(button != null && button.name != undefined && ( button.name == "moreActions" || button.buttons && button.buttons.length>0)){
                flag = true;
                if(!button.tooltip){
                    button.tooltip="More";
                }
            }
            return flag;
        },
        _getMoreButtons: function(button){
            var moreButtons = [];            
            var moreActions = button.buttons;
            for(var i=0;i<moreActions.length;i++){
                // check the visible property of button
                moreActions[i]["eventName"] = "toolbar-more-event";
                if(moreActions[i].visible){
                    moreButtons.push(moreActions[i]);
                }                
            }
            return moreButtons;
        }
    });
</script>

</dom-module>