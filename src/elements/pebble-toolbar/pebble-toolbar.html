<link rel="import" href="../../../bower_components/polymer/polymer.html" />
<link rel="import" href="../../../bower_components/paper-toolbar/paper-toolbar.html" />
<link rel="import" href="../../../bower_components/paper-button-group/paper-button-group.html" />
<link rel="import" href="../pebble-button/pebble-button.html" />

<!--
`<pebble-toolbar>` Represents a toolbar which could have individual buttons or button groups embedded in it.
 All the buttons or button groups are loaded dynamically based on the config json bound to the pebble-toolbar element.
 
 From the config json, the button properties like icon and text would be used for the display and the eventName property 
 would be used send the event information to the event handler. 

### Styling

The following custom properties and mixins are available for styling:

Custom property | Description | Default
----------------|-------------|----------
`--pebble-toolbar-button-icon`          | Mixin applied to toolbar's simple button with icon                | `{}`
`--pebble-toolbar-button-text`          | Mixin applied to toolbar's simple button with text                | `{}`
`--pebble-toolbar-button-icontext`      | Mixin applied to toolbar's simple button with icon and text       | `{}`
`--pebble-toolbar-buttongroup-text`     | Mixin applied to toolbar's button group button with icon          | `{}`
`--pebble-toolbar-buttongroup-icontext` | Mixin applied to toolbar's button group button with icon and text | `{}`
`--pebble-toolbar-menubutton`           | Mixin applied to toolbar's menu button                            | `{}`
`--pebble-toolbar-buttongroup`          | Mixin applied to toolbar's button group                           | `{}`

@group Pebble Elements
@element pebble-toolbar
@demo demo/index.html
-->

<dom-module id="pebble-toolbar">    
  <template>
      
     <style is="custom-style">            
            pebble-button.icon{
                    --pebble-button: {
                            padding: 4.5px;
                            border: 1px solid #C1CAD4;
                            margin: -3px;
                            min-width: 2.14em;
                            top: 3px;
                            color: #616161;
                            @apply(--pebble-toolbar-button-icon);
                        }
                    --pebble-button-iron-icon: {
                            height: 20px;
                            width: 20px;
                            color: #616161;
                            
                    }
            }
            pebble-button.text{
                    --pebble-button: {
                            padding: 5px;
                            border: 1px solid #C1CAD4;
                            min-width: 3.14em;
                            top: -1px;
                            color: #616161;
                        }
                 @apply(--pebble-toolbar-button-text);                
            }
             pebble-button.iconText{
                    --pebble-button: {
                            padding: 4.5px;
                            border: 1px solid #C1CAD4;                            
                            min-width: 4.14em;
                            top: 3px;
                            color: #616161;
                            @apply(--pebble-toolbar-button-icontext);
                        }
                     --pebble-button-iron-icon: {
                            height: 20px;
                            width: 20px;
                            top: -2px;
                            padding-right: 2px;
                            color: #616161;
                            @apply(--pebble-toolbar-button-iron-icon-icontext);
                    }
            }
            pebble-button.buttonGroupText{
                    --pebble-button: {    
                            padding: 5px;                        
                            border: 1px solid #C1CAD4;                            
                            min-width: 3.14em;
                            margin: -3px;
                            top: -1px;
                             color: #616161;
                        }
                @apply(--pebble-toolbar-buttongroup-text);
            }
            pebble-button.buttonGroupIconText{
                    --pebble-button: {    
                            padding: 4.5px;                        
                            border: 1px solid #C1CAD4;                            
                            min-width: 3.14em;
                            margin: -3px;
                            top: 3px;
                            color: #616161;
                        }
                    --pebble-button-iron-icon: {
                            height: 20px;
                            width: 20px;
                            top: -2px;
                            padding-right: 2px;
                            color: #616161;
                    }
                @apply(--pebble-toolbar-buttongroup-icontext);
            }
            pebble-button.menu{
                        --pebble-menu-button {
                             height: 20px;
                             top: 5px;
                             padding-left: 0px;
                             width: 100px;
                         }
                         --pebble-button: {
                            padding: 3px 3px 2px 3px;
                            border: 1px solid #C1CAD4;
                            color: #616161;
                            margin: -10px;
                            top: 6px;
                            min-width: 1.14em;
                            @apply(--pebble-toolbar-menubutton);
                        }
                        --pebble-button-paper-menu: {
                            border: 1px solid #C1CAD4;
                        }
                        --pebble-button-paper-menu-item: {   
                            font-size: 14px;                            
                        }
                        --pebble-button-menu-item-icon: {
                            height: 16px;
                            width: 16px;
                            padding-right: 2px;
                            color: #616161; 
                            @apply(--pebble-toolbar-pebble-button-menu-item-icon);
                        }
            }                      
            .buttonGroup {
                padding: 0 8px 0 2px;
                @apply(--pebble-toolbar-buttongroup);
                vertical-align:top;
            }
        </style>

      <paper-toolbar>          
          <template is="dom-repeat" items="[[configData.buttonItems]]" as="button">

              <template is="dom-if" if="[[_computeIcon(button)]]">
                  <pebble-button    icon="[[button.icon]]"
                                    on-tap="_onTap"
                                    noink
                                    class="icon"
                                    data="[[button]]"> 
                  </pebble-button>
                  
              </template>
              
              <template is="dom-if" if="[[_computeText(button)]]">
                  <pebble-button    button-text="[[button.text]]"
                                    on-tap="_onTap"
                                    noink
                                    class="text"
                                    data="[[button]]"> 
                  </pebble-button>
              </template>

              <template is="dom-if" if="[[_computeIconText(button)]]">
                  <pebble-button    icon="[[button.icon]]"
                                    button-text="[[button.text]]"
                                    on-tap="_onTap"
                                    noink
                                    class="iconText"
                                    data="[[button]]"> 
                  </pebble-button>
                  
              </template>

              <template is="dom-if" if="[[_computeMoreButtons(button)]]">
                    <pebble-button   icon="more-horiz"
                                        noink
                                        menu-button
                                        item-data="[[_getMoreButtons(button)]]"
                                        class="menu"                                 
                                        vertical-offset="-159"                                              
                                        horizontal-offset="-2"
                                        horizontal-align="[[horizontalAlign]]"
                                        vertical-align="[[verticalAlign]]">  
                    </pebble-button>
              </template>

             <template is="dom-if" if="[[!_computeMoreButtons(button)]]">

                 <paper-button-group class="buttonGroup">
                    <template is="dom-repeat" items="[[button.buttons]]" as="button"> 
                        <template is="dom-if" if="[[_computeIcon(button)]]">
                            <pebble-button  icon="[[button.icon]]"
                                            on-tap="_onTap"
                                            noink
                                            class="icon"
                                            data="[[button]]"> 
                            </pebble-button>
                            
                        </template>
                        
                        <template is="dom-if" if="[[_computeText(button)]]">
                            <pebble-button  button-text="[[button.text]]"
                                            on-tap="_onTap"
                                            noink
                                            class="buttonGroupText"
                                            data="[[button]]"> 
                            </pebble-button>
                            
                        </template>

                        <template is="dom-if" if="[[_computeIconText(button)]]">
                            <pebble-button    icon="[[button.icon]]"
                                                button-text="[[button.text]]"
                                                on-tap="_onTap"
                                                noink
                                                class="buttonGroupIconText"
                                                data="[[button]]"> 
                            </pebble-button>
                            
                        </template>

                        <template is="dom-if" if="[[_computeMoreButtons(button)]]">
                            <pebble-button   icon="more-horiz"
                                              noink
                                              menu-button
                                              class="menu"
                                              item-data="[[_getMoreButtons(button)]]"
                                              vertical-offset="-159"                                              
                                              horizontal-offset="-2"
                                              horizontal-align="[[horizontalAlign]]"
                                              vertical-align="[[verticalAlign]]"
                                              > 
                            </pebble-button>
                        </template>

                    </template>
                </paper-button-group>

             </template>                          
           
          </template>
      </paper-toolbar>
  </template>
</dom-module>
<script>
    Polymer({
        is: "pebble-toolbar",
        properties: {
            /**
             * Returns the list of buttons and button groups which must be placed in the toolbar.
             */
            configData: {
                type: Object,
                value: function() { return {}; }
            },
            /**
            * Indicates the orientation to align the menu dropdown horizontally relative to the dropdown trigger.
            */
            horizontalAlign: {
                type: String,
                notify: true
            },
            /**
             * Indicates the orientation to align the menu dropdown vertically relative to the dropdown trigger.
             */
            verticalAlign: {
                type: String,
                notify: true
            },
        },
        _onTap: function(e) {
                var eventDetail= {
                    data: e.currentTarget.data,
                    name : e.currentTarget.data.eventName
                }                
                this.fire('bedrock-event', eventDetail);       
		},
        _computeIconText: function(button) {
            var flag = false;
            if(button.visible && button.name != "moreActions"){
                if(button.icon != null && button.icon.length > 0 && button.text != null && button.text.length > 0){
                    flag = true;    
                }
            }            
            return flag;
        },
        _computeIcon : function(button) {
            var flag = false;
            if(button.visible && button.name != "moreActions"){
                if(button.icon != null && button.icon.length > 0 && (button.text == null || !button.text.length > 0)){
                    flag = true;      
                }            
            }
            return flag; 
        },
        _computeText: function(button) {            
            var flag = false;
            if(button.visible && button.name != "moreActions"){
                if( (button.icon == null || !button.icon.length > 0) && button.text != null && button.text.length > 0){
                    flag = true;  
                }     
            }       
            return flag; 
        },        
        _computeMoreButtons: function(button){
            var flag = false;
             if(button != null && button.name != undefined && button.name == "moreActions"){
                flag = true;      
            }  
            return flag;
        },
        _getMoreButtons: function(button){
            var moreButtons = [];            
            var moreActions = button.buttons;
            for(var i=0;i<moreActions.length;i++){
                // check the visible property of button
                if(moreActions[i].visible){
                    moreButtons.push(moreActions[i]);
                }                
            }
            return moreButtons;
        }
    });
</script>