<link rel="import" href="../../../bower_components/polymer/polymer.html">
<link rel="import" href="../../../bower_components/iron-flex-layout/iron-flex-layout-classes.html">
<link rel="import" href="../../../bower_components/shadycss/apply-shim.html">
<link rel="import" href="../../../bower_components/polymer/lib/elements/custom-style.html">

<link rel="import" href="../bedrock-helpers/security-context-helper.html">

<link rel="import" href="../pebble-styles-shared/pebble-styles-shared.html">
<link rel="import" href="../pebble-styles-app/pebble-styles-app.html">
<link rel="import" href="../pebble-popover/pebble-popover.html">
<link rel="import" href="../pebble-button/pebble-button.html">
<!--Will updated as per pebble-image-->
<link rel="import" href="../pebble-image-viewer/pebble-image-viewer.html">
<link rel="import" href="../pebble-icon/pebble-icon.html">

<!--
`<rock-profile>` Represents an element to display a profile with an image.

### Example

    <rock-profile src="person.jpg"
							    alt="Profile"
							    name="John Smith"
							    usertype="User"
							    icon="pebble-icons:expand-more">
	  </rock-profile>

### Styling

The following custom properties and mixins are available for styling:

Custom property | Description | Default
----------------|-------------|---------
`--profile-image-width` | The width of the image | 30px
`--profile-image-height` | The height of the image | 30px
`--profile-container-max-width` | The max width of the profile container | 260px
`--profile-container-max-height` | The max height of the profile container | 60px
`--profile-container-padding` | The padding of the profile container | 2px
`--profile-font-size` | The font size of the container | 12px
`--container-hover-pointertype` | The pointer type shown on container hover | pointer
`--profile-image-box-max-width` | The max width of the image box | 60px
`--profile-image-align` | The profile image verticle align | center
`--image-box-styles` | Mixin applied to image box | {}
`--profile-name-content-align` | The content horizontal alignment for name | right
`--name-box-styles` | Mixin applied to the name box | {}
`--profile-usertype-content-align` | The content horizontal alignment for usertype | right
`--profile-usertype-fontsize` | The font size of usertype | 10px
`--usertype-box-styles` | Mixin applied to the usertype box | {}
`--profile-icon-align` | The icon verticle alignment | center
`--icon-box-styles` | Mixin applied to the icon box | {}
`--profile-flex-verticle-max-width` | The max width of the flex verticle  | 200px

@group rock Elements
@element rock-profile
@demo demo/index.html
-->

<dom-module id="rock-profile">
  <template>
    <custom-style>
      <style include="pebble-styles-shared pebble-styles-app iron-flex iron-flex-alignment">
         :host {
          --profile-image-size: 25px;
        }

        .profile-options pebble-button {
          --pebble-button-left-icon: {
            cursor: default;
            color: var(--palette-steel-grey, #75808b);
          }
          ;
        }

        .profile-style {
          margin-left: 7px;
          margin-top: 5px;
          float: right;
        }
        /*Image style*/

        .thumbImage {
          width: var(--profile-image-size);
          height: var(--profile-image-size);
          /*overflow:hidden;
        border-radius:50%;   */
        }

        pebble-image-viewer {
          --layout-fit: {
            width: var(--profile-image-size);
            height: var(--profile-image-size);
            overflow: hidden;
            border-radius: 50%;
          }
        }
        /*Profile container style*/

        .container {
          max-width: var(--profile-container-max-width, 260px);
          max-height: var(--profile-container-max-height, 60px);
          font-size: var(--profile-font-size, 12px);
          @apply --layout-horizontal;
          @apply --layout-center-justified;
          @apply --container-styles;
        }

        .container:hover {
          cursor: var(--container-hover-pointertype, pointer);
        }
        /*For Image*/

        .img-box {
          max-width: var(--profile-image-box-max-width, 60px);
          margin-right: 10px;
          align-items: var(--profile-image-align, center);
          /*Verticle align*/
          -webkit-align-items: var(--profile-image-align, center);
          /*Verticle align*/
          display: -webkit-box;
          display: -webkit-flex;
          display: -ms-flexbox;
          display: flex;
          @apply --image-box-styles;
        }
        /*For Name*/

        .name-box {
          text-align: var(--profile-name-content-align, right);
          @apply --name-box-styles;
          line-height: 14px;
        }
        /*For Usertype*/

        .usertype-box {
          text-align: var(--profile-usertype-content-align, right);
          font-size: var(--profile-usertype-fontsize, 10px);
          @apply --usertype-box-styles;
        }
        /*For Icon*/

        .icon-box {
          @apply --icon-box-styles;
          /*margin-right: 5px;*/
          align-items: var(--profile-icon-align, center);
          /*Verticle align*/
          -webkit-align-items: var(--profile-icon-align, center);
          /*Verticle align*/
          display: -webkit-box;
          display: -webkit-flex;
          display: -ms-flexbox;
          display: flex;
        }
        /*Profile horizontal div styles*/

        .flex-horizontal {
          @apply --layout-horizontal;
        }
        /*Profile verticle div styles*/

        .flex-vertical {
          max-width: var(--profile-flex-verticle-max-width, 260px);
          margin-top: 2px;
        }

        #popoverProfile {
          --pebble-popover-max-height: 460px;
          border: none;
          margin-top: 5px;
          min-width: 320px;
        }

        #popoverProfile {
          --popover: {
            padding: 0 !important;
          }
        }

        #profile-details-wrap {
          min-width: 300px;
          font-size: var(--default-font-size, 14px);
        }

        #profile-details-wrap .profile-img {
          width: 88px;
          height: 82px;
          float: left;
          overflow: hidden;
        }

        #profile-details-wrap .profile-img img {
          width: 100%;
        }

        #profile-details-wrap .profile-details {
          width: calc(100% - 88px);
          height: 82px;
          display: inline-block;
          color: var(--palette-white, #ffffff);
          background: var(--profile-details-bg, #139ee7);
          padding: 10px;
        }

        #profile-details-wrap ul {
          margin: 0;
          padding: 0;
        }

        #profile-details-wrap .profile-content-wrap {
          padding: 10px;
        }

        #profile-details-wrap .profile-details h5 {
          font-size: var(--default-font-size, 14px);
          margin: 0 0 2px;
          padding: 0;
          font-weight: 500;
        }

        #profile-details-wrap .profile-details .sub-text {
          font-size: var(--font-size-xs, 10px);
          margin: 0;
        }

        #profile-details-wrap table td {
          padding: 0;
        }

        #profile-details-wrap table td:first-child {
          color: var(--secondary-button-text-color, #75808b);
        }

        #profile-details-wrap table td:last-child {
          color: var(--text-primary-color, #1a2028);
        }

        #profile-details-wrap .profile-content {
          padding: 5px 0;
          border-bottom: 1px solid var(--divider-color, #c1cad4);
        }

        #profile-details-wrap .profile-options ul li {
          padding: 5px 0;
        }

        #profile-details-wrap .profile-options ul li a {
          color: var(--link-text-color, #036Bc3);
          display: inline-block;
          vertical-align: middle;
        }

        #profile-details-wrap .profile-options ul li a:hover {
          color: var(--link-text-hover-color, #045aa2);
        }

        #profile-details-wrap .profile-options ul li:last-child {
          padding-bottom: 0;
          cursor: pointer;
        }

        ul li {
          list-style-type: none;
        }
        .icon-box pebble-icon{
          width:8px;
          height:21px;
        }
      </style>
    </custom-style>
    <div class="profile-style">
      <div id="userProfile" class="container" on-tap="_showProfile">
        <!-- Image section -->
        <div class="img-box box">
          <pebble-image-viewer alt="{{alt}}" src="[[src]]" shape="circle" sizing="contain" class="thumbImage"></pebble-image-viewer>
        </div>

        <!-- Name & user type section -->
        <div class="flex-vertical text-ellipsis m-0">
          <div class="name-box text-ellipsis box">
            [[userDetails.userFullName]]
          </div>
          <div class="usertype-box box">
            [[userDetails.roleId]]
          </div>
        </div>

        <!-- Icon section -->
        <div class="icon-box box">
          <pebble-icon icon="{{icon}}" class="iconstyle">
          </pebble-icon>
        </div>
      </div>
      <pebble-popover id="popoverProfile" for="userProfile" auto-fit-on-attach no-overlap horizontal-align="right">
        <div id="profile-details-wrap">
          <div class="prifile-titile">
            <div class="profile-img"><img src$="[[src]]">
            </div>
            <div class="profile-details">
              <h5>[[userDetails.userName]]</h5>
              <p class="sub-text p-b-10">logged in as [[userDetails.roleId]]</p>
              <p class="sub-text">Organization</p>
              <p class="sub-text">[[userDetails.tenantId]] Corporation</p>
            </div>
            <div class="clearfix">
            </div>
            <div class="profile-content-wrap">
              <div class="profile-preferences m-b-5">
                <pebble-button icon="pebble-md-icons:Profilepreferences" class="pebble-md-icons m-r-10"></pebble-button>
                <!--<a href="#" class="btn-link">-->My Preferences
                <!--</a>-->
                <pebble-button icon="pebble-md-icons:Edit" class="pebble-md-icons pull-right"></pebble-button>
              </div>
              <div class="profile-content m-b-5">
                <table cellpadding="0" cellspacing="0">
                  <tr>
                    <td width="53%">Ul Locale:</td>
                    <td>English World Wide</td>
                  </tr>
                  <tr>
                    <td>Data Locale:</td>
                    <td>English World Wide</td>
                  </tr>
                  <tr>
                    <td>Default Taxonamy:</td>
                    <td>EPIM Hierarchy</td>
                  </tr>
                  <tr>
                    <td>Time Zone:</td>
                    <td>UTC 6</td>
                  </tr>
                  <tr>
                    <td>Role:</td>
                    <td>[[userDetails.roleId]]</td>
                  </tr>
                </table>
              </div>
              <div class="profile-options">
                <ul>
                  <li>
                    <pebble-button icon="pebble-md-icons:Profilesttings" class="pebble-md-icons m-r-10">
                    </pebble-button>
                    <!--<a href="#" class="btn-link">-->My Settings
                    <!--</a>-->
                  </li>
                  <li>
                    <pebble-button icon="pebble-md-icons:Password" class="pebble-md-icons m-r-10">
                    </pebble-button>
                    <!--<a href="#" class="btn-link">-->Change Password
                    <!--</a>-->
                  </li>
                  <li on-tap="_logout">
                    <pebble-button icon="pebble-md-icons:Logout" class="pebble-md-icons m-r-10">
                    </pebble-button>
                    <!--<a href="#" class="btn-link">-->Logout
                    <!--</a>-->
                  </li>
                </ul>
              </div>
            </div>
          </div>
        </div>

      </pebble-popover>
    </div>
  </template>

  <script>
    Polymer({
      is: 'rock-profile',

      properties: {

        /**
         * Indicates the URL of an image.
         */
        src: {
          type: String,
          value: null
        },

        /**
         * Indicates a alternative short text for an image.
         */
        alt: {
          type: String,
          value: null
        },

        /**
         * Indicates an icon.
         */
        icon: {
          type: String,
          value: null
        },
        /**
          * <b><i>Content development is under progress... </b></i> 
          */
        userDetails: {
          type: Object
        }

      },
      _showProfile: function () {
        this.shadowRoot.querySelector('#popoverProfile').show();
      },
      _logout: function () {
        SecurityContextHelper.logout();
      }
    });
  </script>
</dom-module>