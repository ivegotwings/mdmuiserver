<link rel="import" href="../../../bower_components/polymer/polymer.html">
<link rel="import" href="../bedrock-i18n/bedrock-i18n.html">
<script>
    /***
     * `RUFBehaviors.LoggerBehavior` provides logging behavior.
     *
     * `RUFBehaviors.LoggerBehavior` has different methods to log information, warning and error.
     *
     *  ### Example
     *
     *     <dom-module id="x-app">
     *        <template>
     *        </template>
     *        <script>
     *           Polymer({
     *             is: "x-app",
     *
     *             behaviors: [
     *               RUFBehaviors.LoggerBehavior
     *             ],
     *
     *             properties: {
     *
     *             }
     *           });
     *        &lt;/script>
     *     </dom-module>
     * @polymerBehavior RUFBehaviors.LoggerBehavior
     */

    window.RUFBehaviors = window.RUFBehaviors || {};
    /** @polymerBehavior RUFBehaviors.LoggerBehavior */
    RUFBehaviors.LoggerBehaviorImpl = {

        properties: {
        },
        /**
         * Content is not appearing - Content development is under progress. 
         */
        attached: function () {
        },

        _getExceptionMessage: function (ex) {
            if (ex.message) {
                return ex.message;
            } else if (ex.description) {
                return ex.description;
            } else {
                return DataHelper.toStr(ex);
            }
        },

        _getUrlFileName: function (url) {
            var lastSlashIndex = Math.max(url.lastIndexOf("/"), url.lastIndexOf("\\"));
            return url.substr(lastSlashIndex + 1);
        },

        _formatException: function (ex) {
            if (ex) {
                var exStr = "Exception: " + this._getExceptionMessage(ex);
                if (ex.lineNumber) {
                    exStr += " on line number " + ex.lineNumber;
                }
                if (ex.fileName) {
                    exStr += " in file " + this._getUrlFileName(ex.fileName);
                }
                if (ex.stack) {
                    exStr += "\r\n" + "Stack trace:" + "\r\n" + ex.stack;
                }
                return exStr;
            }
            return null;
        },

        logWarning: function () {
            var translatedMessage = this.localize().apply(this, arguments);
            RUFUtilities.Logger.warn(translatedMessage);
        },

        logError: function () {
            //var translatedMessage = this.localize().apply(this, arguments);
            // if (arguments.length % 2 == 1) {
            //     console.error(arguments[0]);
            //     //RUFUtilities.Logger.error(translatedMessage);
            // } else {
            //     var exception = this._formatException(arguments[arguments.length - 1]);
            //     console.error(arguments[0], arguments[1]);
            //     //RUFUtilities.Logger.error(translatedMessage + "\r\n" + "Original error: " + exception);
            // }

            //TODO: translated message and formatted exceptions are not proper right now.
            //Hence logging direct message coming in arguments in console.
            this.set('isComponentErrored', true);
            var message = arguments[0];
            var exceptionDetail = arguments[1] || {};
            var isCriticalError = arguments[2];
            //arguments[4] or domContainer is an optional parameter which is sent in special cases only like main-app
            var domContainer = arguments[4] || this.shadowRoot.querySelector("#error-container");
            var UIMessage = arguments[3];
            var errorGUID = DataHelper.generateUUID();
            exceptionDetail["id"] = errorGUID;
            console.error(message, exceptionDetail);
            if(isCriticalError && domContainer) {
                var div = "<div class='default-message'>";
                if(UIMessage) {
                    div = div + UIMessage;
                } else {
                    div = div + "Component could not be loaded";
                }
                div = div + "</div>";
                domContainer.innerHTML = div;
            }
        },

        logInfo: function () {
            var translatedMessage = this.localize().apply(this, arguments);
            RUFUtilities.Logger.info(translatedMessage);
        }
    };

    /** @polymerBehavior */
    RUFBehaviors.LoggerBehavior = [RUFBehaviors.Internationalization, RUFBehaviors.LoggerBehaviorImpl];
</script>