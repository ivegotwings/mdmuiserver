<!doctype html>

<html>

<head>
  <title>pebble-datetime-picker test</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, minimum-scale=1.0, initial-scale=1, user-scalable=yes">
  <link rel="import" href="../../../../bower_components/polymer/polymer.html">
  <script src="../../../../bower_components/webcomponentsjs/webcomponents-lite.js"></script>
  <script src="../../../../bower_components/web-component-tester/browser.js"></script>

  <link rel="import" href="../../../../bower_components/paper-button/paper-button.html">
  <link rel="import" href="../pebble-datetime-picker.html">
</head>

<body>

  <test-fixture id="basic">
    <template is="dom-template">
      <pebble-datetime-picker id="picker" for="datetimePicker" dtp-date-time="{{dtpDateTime}}"></pebble-datetime-picker>
    </template>
  </test-fixture>

  <test-fixture id="datetime">
    <template is="dom-template">
      <paper-button id="datetimePicker" raised onclick="picker.show()">Date Time Picker</paper-button>
      <pebble-datetime-picker id="picker" for="datetimePicker" dtp-date-time="{{dtpDateTime}}"></pebble-datetime-picker>
      <span id="dtpDateTime">{{dtpDateTime}}</span>
    </template>
  </test-fixture>

  <test-fixture id="dateonly">
    <template is="dom-template">
      <paper-button id="datePicker" raised onclick="picker.show()">Date Picker</paper-button>
      <pebble-datetime-picker id="picker" for="datePicker" picker-type="Date" dtp-date="{{dtpDate}}"></pebble-datetime-picker>
      <span id="dtpDate">{{dtpDate}}</span>
    </template>
  </test-fixture>

  <test-fixture id="timeonly">
    <template is="dom-template">
      <paper-button id="timePicker" raised onclick="picker.show()">Time Picker</paper-button>
      <pebble-datetime-picker id="picker" for="timePicker" picker-type="Time" dtp-time="{{dtpTime}}"></pebble-datetime-picker>
      <span id="dtpTime">{{dtpTime}}</span>
    </template>
  </test-fixture>

  <script>

      suite('pebble-datetime-picker testcases', function() {
        
        test('instantiating the element works', function() {
          var pebbleElement = fixture('basic');
          assert.equal(pebbleElement.is, 'pebble-datetime-picker');
        });

        test('Should open date time picker dialog with date picker as default', function() {
          var pebbleElement = fixture('datetime');

          flush(function () {
                    var btnPicker = Polymer.dom(pebbleElement.root).querySelector('#datetimePicker');
                    var datetimeDialog = Polymer.dom(pebbleElement.root).querySelector('#picker');

                    btnPicker.click();                                                      
                    assert.equal(datetimeDialog.attributes['aria-hidden'], undefined); //dialog opened & not hidden
                    assert.notEqual(datetimeDialog.querySelector("paper-date-picker"), ''); //currently date picker available
              });
        });  


        test('Should close the date time picker dialog when date picker cancel clicked', function() {
          var pebbleElement = fixture('datetime');

          flush(function () {
                    var btnPicker = Polymer.dom(pebbleElement.root).querySelector('#datetimePicker');
                    var datetimeDialog = Polymer.dom(pebbleElement.root).querySelector('#picker');

                    btnPicker.click();
                    datetimeDialog.querySelector(".paper-date-picker-dialog").querySelectorAll("paper-button")[0].click(); //cancel clicked
                    assert.equal(datetimeDialog.attributes['aria-hidden'].value, "true"); //dialog hidden now
              });
        });

        test('Should open time picker when date picker ok clicked', function() {
          var pebbleElement = fixture('datetime');

          flush(function () {
                    var btnPicker = Polymer.dom(pebbleElement.root).querySelector('#datetimePicker');
                    var datetimeDialog = Polymer.dom(pebbleElement.root).querySelector('#picker');

                    btnPicker.click();
                    datetimeDialog.querySelector(".paper-date-picker-dialog").querySelectorAll("paper-button")[1].click(); //cancel clicked
                    flush(function(){
                       assert.notEqual(datetimeDialog.querySelector(".paper-date-picker-dialog").attributes['style'].value.indexOf("display: none"), '-1');
                       assert.notEqual(datetimeDialog.querySelector("paper-time-picker"), ''); //now time picker available
                    });
              });
        });  

        test('Should open date picker when time picker cancel clicked', function() {
          var pebbleElement = fixture('datetime');

          flush(function () {
                    var btnPicker = Polymer.dom(pebbleElement.root).querySelector('#datetimePicker');
                    var datetimeDialog = Polymer.dom(pebbleElement.root).querySelector('#picker');

                    btnPicker.click();
                    datetimeDialog.querySelector(".paper-date-picker-dialog").querySelectorAll("paper-button")[1].click(); //ok clicked
                    flush(function(){
                       datetimeDialog.querySelector(".paper-time-picker-dialog").querySelectorAll("paper-button")[0].click(); //time picker cancel clicked
                       flush(function(){
                         assert.notEqual(datetimeDialog.querySelector(".paper-time-picker-dialog").attributes['style'].value.indexOf("display: none"), '-1'); 
                       });
                    });
              });
        }); 

        test('Should show the date and time when time picker ok clicked', function() {
          var pebbleElement = fixture('datetime');          

          flush(function () {
                    var btnPicker = Polymer.dom(pebbleElement.root).querySelector('#datetimePicker');
                    var datetimeDialog = Polymer.dom(pebbleElement.root).querySelector('#picker');
                    var lblDateTime = Polymer.dom(pebbleElement.root).querySelector('#dtpDateTime');

                    document.addEventListener('iron-overlay-opened', function(){
                      console.log('overlay opened');
                    });

                    btnPicker.click();
                    datetimeDialog.querySelector(".paper-date-picker-dialog").querySelectorAll("paper-button")[1].click(); //ok clicked
                    
                    flush(function(){
                       datetimeDialog._datetimePickerOpened(); //overlay opened triggers
                       datetimeDialog.querySelector(".paper-time-picker-dialog").querySelectorAll("paper-button")[1].click(); //time picker ok clicked
                       datetimeDialog._datetimePickerClosed(); ///overlay closed triggers
                       assert.notEqual(lblDateTime.innerHTML, '');
                    });
              });
        }); 
     });

     suite('date picker testcases', function() {

          test('Should open date dialog', function() {
          var pebbleElement = fixture('dateonly');

          flush(function () {
                    var btnPicker = Polymer.dom(pebbleElement.root).querySelector('#datePicker');
                    var dateDialog = Polymer.dom(pebbleElement.root).querySelector('#picker');

                    btnPicker.click();                                                      
                    assert.equal(dateDialog.attributes['aria-hidden'], undefined); //dialog opened & not hidden
                    assert.notEqual(dateDialog.querySelector("paper-date-picker"), ''); //currently date picker available
              });
          });

          test('Should close date dialog on cancel click', function() {
          var pebbleElement = fixture('dateonly');

          flush(function () {
                    var btnPicker = Polymer.dom(pebbleElement.root).querySelector('#datePicker');
                    var dateDialog = Polymer.dom(pebbleElement.root).querySelector('#picker');

                    btnPicker.click();                                                      
                    dateDialog.querySelector(".paper-date-picker-dialog").querySelectorAll("paper-button")[0].click(); //cancel clicked
                    assert.equal(dateDialog.attributes['aria-hidden'].value, "true"); //dialog hidden now
              });
          });

          test('Should provide date on ok click', function() {
          var pebbleElement = fixture('dateonly');

          flush(function () {
                    var btnPicker = Polymer.dom(pebbleElement.root).querySelector('#datePicker');
                    var dateDialog = Polymer.dom(pebbleElement.root).querySelector('#picker');
                    var lblDate = Polymer.dom(pebbleElement.root).querySelector('#dtpDate');

                    btnPicker.click(); 
                    flush(function(){
                       dateDialog._datetimePickerOpened(); //overlay opened triggers
                       dateDialog.querySelector(".paper-date-picker-dialog").querySelectorAll("paper-button")[1].click(); //ok clicked
                       dateDialog._datetimePickerClosed(); //overlay closed triggers                      
                       assert.equal(dateDialog.querySelector("paper-time-picker"), null);                     
                       assert.notEqual(lblDate.innerHTML, '');
                    });
              });
          });

      });
       
    
    suite('time picker testcases', function() {

          test('Should open time dialog', function() {
          var pebbleElement = fixture('timeonly');

          flush(function () {
                    var btnPicker = Polymer.dom(pebbleElement.root).querySelector('#timePicker');
                    var timeDialog = Polymer.dom(pebbleElement.root).querySelector('#picker');

                    btnPicker.click();
                    flush(function(){
                        timeDialog._datetimePickerOpened(); //overlay opened triggers                                                                                                    
                        assert.equal(timeDialog.attributes['aria-hidden'], undefined); //dialog opened & not hidden
                        assert.notEqual(timeDialog.querySelector("paper-time-picker"), ''); //currently date picker available
                        Polymer.dom.flush();
                        assert.notEqual(timeDialog.querySelector(".paper-date-picker-dialog").attributes['style'].value.indexOf("display: none"), '-1'); //Hidden
                    });
              });
          });

          test('Should close time dialog on cancel click', function() {
          var pebbleElement = fixture('timeonly');

          flush(function () {
                    var btnPicker = Polymer.dom(pebbleElement.root).querySelector('#timePicker');
                    var timeDialog = Polymer.dom(pebbleElement.root).querySelector('#picker');

                   btnPicker.click();                    
                   timeDialog._datetimePickerOpened(); //overlay opened triggers
                   Polymer.dom.flush();                                                     
                   timeDialog.querySelector(".paper-time-picker-dialog").querySelectorAll("paper-button")[0].click(); //cancel clicked
                   timeDialog._datetimePickerClosed(); //overlay closed triggers
                   assert.equal(timeDialog.attributes['aria-hidden'].value, "true"); //dialog hidden now
                    
              });
          });

          test('Should provide time on ok click', function() {
          var pebbleElement = fixture('timeonly');

          flush(function () {
                    var btnPicker = Polymer.dom(pebbleElement.root).querySelector('#timePicker');
                    var timeDialog = Polymer.dom(pebbleElement.root).querySelector('#picker');
                    var lblTime = Polymer.dom(pebbleElement.root).querySelector('#dtpTime');

                    btnPicker.click();
                    timeDialog._datetimePickerOpened(); //overlay opened triggers
                    Polymer.dom.flush();
                    timeDialog.querySelector(".paper-time-picker-dialog").querySelectorAll("paper-button")[1].click(); //ok clicked
                    timeDialog._datetimePickerClosed(); //overlay closed triggers
                    assert.notEqual(lblTime.innerHTML, '');
              });
          });

      });
      
    </script>
</body>

</html>