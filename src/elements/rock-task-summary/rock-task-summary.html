<link rel="import" href="../../../bower_components/polymer/polymer.html" />

<link rel="import" href="../bedrock-ui-behavior/bedrock-ui-behavior.html" />

<link rel="import" href="../liquid-rest/liquid-rest.html" />

<link rel="import" href="../pebble-button/pebble-button.html" />

<dom-module id="rock-task-summary">
    <template>
        <style include="pebble-styles-shared"></style>
        <style include="iron-flex"></style>
        <style is="custom-style">
            .attributes-container {
                display: -webkit-box;
                display: -webkit-flex;
                display: -ms-flexbox;
                display: flex;
                flex-wrap: wrap;
                -webkit-flex-wrap: wrap;
                /* Safari 6.1+ */
                @apply(--layout-horizontal);
                width: calc(70% - 90px);
                float: left;
            }

            .attribute {
                width: 24%;
                height: 50px;
                line-height: 20px;
            }

            .attribute-label {
                width: 30%;
                height: 35%;
                font-family: var(--default-font-family);
                font-size: var(--default-font-size, 14px);
                font-weight: normal;
                font-style: normal;
                font-stretch: normal;
                color: var(--attrpanel-color-text, #1a2028);
                opacity: 0.7;
            }

            .attribute-value {
                font-size: var(--font-size-sm, 12px);
                font-weight: var(--font-medium, 500);
                color: var(--buttontext-color, #616161);
                width: 75%;
            }

            .trim {
                text-overflow: ellipsis;
                overflow: hidden;
                white-space: nowrap;
            }

            pebble-image-viewer {
                padding: 2%;
            }
        </style>
        <liquid-rest id="taskDetailsGet" url="/data/eventservice/getTaskDetails" method="POST" request-data={{_taskDetailSummaryGetRequest}}
            on-liquid-response="_onTaskDetailSummaryGetResponse" on-liquid-error="_onTaskDetailSummaryGetError"></liquid-rest>
        <template is="dom-if" if="[[_isTaskDetailsLoaded]]">
            <div class="row-wrap">
                <div class="col-7 attributes-container">
                    <div class="attribute trim">
                        <div class="attribute-label">File Name</div>
                        <div class="attribute-value trim" title="[[_taskDetails.fileName]]">[[_taskDetails.fileName]]</div>
                    </div>

                    <div id="attribute" class="attribute trim">
                        <div class="attribute-label">Task ID</div>
                        <div class="attribute-value trim" title="[[_taskDetails.taskId]]">[[_taskDetails.taskId]]</div>
                    </div>

                    <div id="attribute" class="attribute trim">
                        <div class="attribute-label">Task Type</div>
                        <div class="attribute-value trim" title="[[_taskDetails.taskType]]">[[_taskDetails.taskType]]</div>
                    </div>

                    <div id="attribute" class="attribute trim">
                        <div class="attribute-label">Task Status</div>
                        <div class="attribute-value trim" title="[[_taskDetails.taskStatus]]">[[_taskDetails.taskStatus]]</div>
                    </div>

                    <div id="attribute" class="attribute trim">
                        <div class="attribute-label">Start Time</div>
                        <div class="attribute-value trim" title="[[_taskDetails.startTime]]">[[_taskDetails.startTime]]</div>
                    </div>

                    <div id="attribute" class="attribute trim">
                        <div class="attribute-label">End Time</div>
                        <div class="attribute-value trim" title="[[_taskDetails.endTime]]">[[_taskDetails.endTime]]</div>
                    </div>

                    <div id="attribute" class="attribute trim">
                        <div class="attribute-label">Submitted By</div>
                        <div class="attribute-value trim" title="[[_taskDetails.submittedBy]]">[[_taskDetails.submittedBy]]</div>
                    </div>
                </div>
                <div class="col-5">
                    <pebble-button class="btn btn-primary m-r-5" button-text="In Progress" on-tap="_onInProgressClick"></pebble-button>
                    <pebble-button class="btn btn-primary m-r-5" button-text="Completed" on-tap="_onCompletedClick"></pebble-button>
                    <pebble-button class="btn btn-primary m-r-5" button-text="Errors" on-tap="_onErrorsClick"></pebble-button>
                </div>
            </div>
        </template>
    </template>
    <script>
        (function () {
            'use strict';

            Polymer({
                is: "rock-task-summary",

                properties: {
                    showInProgress: {
                        type: Boolean,
                        value: false
                    },
                    showCompleted: {
                        type: Boolean,
                        value: false
                    },
                    showErrors: {
                        type: Boolean,
                        value: false
                    },
                    taskId: {
                        type: String,
                        value: ""
                    },
                    _taskDetailSummaryGetRequest: {
                        type: Object,
                        value: function () {
                            return { "taskId" : this.taskId };
                        }
                    },
                    _taskDetails: {
                        type: Object,
                        value: function () {
                            return {};
                        }
                    },
                    _isTaskDetailsLoaded: {
                        type: Boolean,
                        value: false
                    },
                },

                behaviors: [
                    RUFBehaviors.UIBehavior,
                ],

                ready: function() {
                    this._taskDetailSummaryGetRequest = { "taskId" : DataHelper.getParamValue("id")}
                },

                attached: function () {
                    var taskDetailsGet = this.$$("#taskDetailsGet");
                    if (taskDetailsGet) {
                        taskDetailsGet.generateRequest();
                    }
                },

                _onTaskDetailSummaryGetResponse: function (e, detail) {
                    this._taskDetails = detail.response;
                    this._isTaskDetailsLoaded = true;
                    if (this.showInProgress) {
                        this._onInProgressClick();
                    }

                    if (this.showCompleted) {
                        this._onCompletedClick();
                    }

                    if (this.showErrors) {
                        this._onErrorsClick();
                    }
                },

                _onTaskDetailSummaryGetError: function (e, detail) {
                },

                _onInProgressClick: function () {
                    var eventDetail = {
                        "taskStats": this._taskDetails.taskStats
                    };
                    this.fireBedrockEvent("show-inprogress", eventDetail);
                },

                _onCompletedClick: function () {
                    var eventDetail = {
                        "taskStats": this._taskDetails.taskStats
                    };
                    this.fireBedrockEvent("show-completed", eventDetail);
                },

                _onErrorsClick: function () {
                    var eventDetail = {
                        "taskStats": this._taskDetails.taskStats
                    };
                    this.fireBedrockEvent("show-errors", eventDetail);
                }
            });
        })();
    </script>
</dom-module>