<link rel="import" href="../../../bower_components/polymer/polymer.html">
<link rel="import" href="../../../bower_components/paper-dropdown-menu/paper-dropdown-menu.html">
<link rel="import" href="../../../bower_components/paper-listbox/paper-listbox.html">
<link rel="import" href="../../../bower_components/paper-item/paper-item.html">

<!--
`pebble-dropdown` Represents a dropdown form field that contains a list of items in a form.
It is similar to a native browser select element. It works with selectable content. 
Currently, the selected item is displayed in the control. The label is displayed, if no item is selected.

@demo demo/index.html 
-->

<dom-module id="pebble-dropdown">
  <template>
    <style include="pebble-styles-shared"></style>

    <paper-dropdown-menu id="dropdown" label="{{label}}">
      <paper-listbox id="listbox" class="dropdown-content" selected="{{selectedIndex}}">
        <template is="dom-repeat" items="{{itemsArray}}">
          <paper-item>{{item}}</paper-item>
        </template>
      </paper-listbox>
    </paper-dropdown-menu>

  </template>

  <script>
    (function () {
      'use strict';

      Polymer({
        is: 'pebble-dropdown',
        ready: function () {
          for (var i = 0; i < this.itemsArray.length; i++) {
            if (this.itemsArray[i] == this.selectedValue) {
              this.selectedIndex = i;
              break;
            }
          }
        },
        properties: {
          /**
            * Indicates the title of the dropdown control, which gets displayed in UI.
            */
          label: {
            type: String,
            value: ""
          },
          /**
            * Indicates the list of comma seperated values to represent list of values in String.
            */
          items: {
            type: String,
            value: ""
          },
          /**
            * Indicates the list of comma seperated values to represent list of values in an Array.
            */
          itemsArray: {
            type: Array,
            computed: "_splitItems(items)",
            observer: "_itemsChanged"
          },
          /**
            * Indicates the index number of the item. This starts with -1.
            */
          selectedIndex: {
            type: Number,
            value: -1,
            observer: "_selectedIndexChanged"
          },
          /**
            * Indicates the selected value from the list.
            */
          selectedValue: {
            type: String,
            value: "",
            notify: true,
            observer: "_selectedValueChanged"
          }
        },
        _splitItems: function (i) {
          return i.split(",");
        },
        _selectedIndexChanged: function (newValue, oldValue) {
          if (newValue !== undefined && this.itemsArray) {
            if (this.selectedValue != this.itemsArray[newValue]) {
              this.selectedValue = this.itemsArray[newValue];
              var eventParams = { 'newValue': newValue, 'oldValue': oldValue };
              this.fire('change', eventParams);              
            }
          }
        },
        _selectedValueChanged: function (newValue, oldValue) {
          this._setNewIndex(this.itemsArray, newValue);
        },
        _itemsChanged: function (newValue, oldValue) {
          this._setNewIndex(newValue, this.selectedValue);
        },
        _setNewIndex(newItemsArray, newSelectedValue) {
          var newIndex = -1;
          if (newItemsArray !== undefined && newSelectedValue !== undefined) {
            for (var i = 0; i < newItemsArray.length; i++) {
              if (newItemsArray[i] == newSelectedValue) {
                newIndex = i;
                break;
              }
            }
            if (this.selectedIndex != newIndex) {
              this.selectedIndex = newIndex;
            }
          }
        }
      });
    })();
  </script>

</dom-module>