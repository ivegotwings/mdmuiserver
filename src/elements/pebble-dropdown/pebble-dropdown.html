<link rel="import" href="../../../bower_components/polymer/polymer.html">
<link rel="import" href="../../../bower_components/paper-dropdown-menu/paper-dropdown-menu.html">
<link rel="import" href="../../../bower_components/paper-listbox/paper-listbox.html">
<link rel="import" href="../../../bower_components/paper-item/paper-item.html">

<!--
`pebble-dropdown`
Dropdown control for riversand ui framework

@demo demo/index.html 
-->

<dom-module id="pebble-dropdown">
  <template>
    <style include="shared-styles"></style>
    
<paper-dropdown-menu id="dropdown" label="{{label}}">
  <paper-listbox id="listbox" class="dropdown-content" selected="{{selectedIndex}}">
    <template is="dom-repeat" items="{{itemsArray}}">
      <paper-item>{{item}}</paper-item>  
    </template>
  </paper-listbox>
  </paper-dropdown-menu>

  </template>

  <script>
    (function() {
      'use strict';

      Polymer({
        is: 'pebble-dropdown',
        ready: function(){
          for(var i=0; i<this.itemsArray.length;i++){
            if(this.itemsArray[i] == this.selectedValue){
              this.selectedIndex = i;
              break;
            }
          }
        },
        properties: {
          label: {
            type: String,
            value: ""
          },
          items: {
            type: String,
            value: ""
          },
          itemsArray: {
            type: Array,
            computed: "_splitItems(items)",
            observer: "_itemsChanged"
          },
          selectedIndex: {
            type: Number,
            value: -1,
            observer: "_selectedIndexChanged"
          },
          selectedValue: {
            type: String,
            value: "",
            notify: true,
            observer: "_selectedValueChanged"
          }
        },
        _splitItems: function(i) {
          return i.split(",");
        },
        _selectedIndexChanged: function(newValue, oldValue){
          console.log("_selectedIndexChanged"+ newValue);
          if(newValue !== undefined && this.itemsArray) {
            if(this.selectedValue != this.itemsArray[newValue]) {
              this.selectedValue = this.itemsArray[newValue];
            }
          }
        },
        _selectedValueChanged: function(newValue, oldValue){
          console.log("_selectedValueChanged"+ newValue);
          this._setNewIndex(this.itemsArray, newValue);
        },
        _itemsChanged: function(newValue, oldValue){
          console.log("_itemsChanged"+ newValue);
          this._setNewIndex(newValue, this.selectedValue);
        },
        _setNewIndex(newItemsArray, newSelectedValue) {
          var newIndex = -1;
          if(newItemsArray !== undefined && newSelectedValue !== undefined) {
            for(var i=0;i<newItemsArray.length;i++) {
              if(newItemsArray[i] == newSelectedValue) {
                newIndex = i;
                break;
              }  
            }
            if(this.selectedIndex != newIndex) {
              this.selectedIndex = newIndex;
            }
          }
        }
      });
    })();
  </script>

</dom-module>