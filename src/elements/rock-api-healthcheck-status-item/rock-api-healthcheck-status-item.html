<link rel="import" href="../../../bower_components/polymer/polymer.html">
<link rel="import" href="../../../bower_components/iron-flex-layout/iron-flex-layout-classes.html">
<link rel="import" href="../pebble-styles-shared/pebble-styles-shared.html">
<link rel="import" href="../pebble-styles-app/pebble-styles-app.html">
<link rel="import" href="../liquid-rest/liquid-rest.html">
<link rel="import" href="../../../bower_components/iron-icons/iron-icons.html">
<link rel="import" href="../../../bower_components/iron-icons/social-icons.html">
<link rel="import" href="../../../bower_components/iron-icons/communication-icons.html"> 
<link rel="import" href="../pebble-dialog/pebble-dialog.html"> 
<link rel="import" href="../pebble-icon/pebble-icon.html">

<dom-module id="rock-api-healthcheck-status-item">
  
  <template>
    <style is="custom-style" include="pebble-styles-shared pebble-styles-app iron-flex iron-flex-alignment">
       :host {
          margin-bottom: 2px;
          display: table;
          width: 100%;
       }
       paper-button {
        margin-top: 20px;
       }
       .statusRow {
          background-color: #eaeaea;
          padding: 10px 0px 0px 0px;
          cursor: pointer;
        }

        .statusRow .row {
          background: #eaeaea;
          padding-bottom: 10px;
        }

        #descriptionRow {
          padding: 10px;
          background-color: rgb(245, 245, 245);
          width: 100%;
          border-left: 2px white solid;
          border-right: 2px white solid;
        }

        #descriptionRow div {
          width: 100%;
        }
       
    </style>

    <div class="statusRow row">
      <div class="row col-12" on-click="_handleRowClick">
        <div class="col-1">
          <pebble-icon icon="pebble-md-icons:AccessTime" id="statusIcon" class="iconstyle">
        </div>
        <div class="col-10">
          {{name}}
        </div>
        <div class="col-1">
          <pebble-icon icon="pebble-sm-icons:Collapse" id="descriptionIcon">
        </div>
      </div>
      <div id="descriptionRow" class="row" hidden$="{{!collapse}}">          
          <div><strong>Url: </strong>{{url}}</div>                  
          
          <paper-button raised on-click="_handleModalOpen" class="btn btn-success">view response</paper-button>

          <pebble-dialog id="pebbleDialog" show-close-icon dialog-title="Internal response detail">
            <p>{{message}}</p>
              <div class="buttons">
                <paper-button dialog-confirm class="btn btn-secondary">Ok</paper-button>      
              </div>
          </pebble-dialog>

      </div>
      
    </div>
    
    <liquid-rest id="mycall" url="{{url}}" method="GET" request-data="{{request}}"
          on-response="_onResponseReceived" on-error="_onResponseFailed">              
    </liquid-rest>    
    
  </template>

  <script>
    Polymer({
      is: 'rock-api-healthcheck-status-item',
      ready: function(){        
        this.$.mycall.generateRequest()
      },
      _onResponseReceived: function(e){
        var response = e.detail.response;
        
        if(response.status == "success") {
          this.$.statusIcon.icon = "pebble-sm-icons:successCheck";        
        }
        else if(response.status == "error") {
          this.$.statusIcon.icon = "pebble-sm-icons:errorcheck";  
        }
        else if(response.status == "warning") {
          this.$.statusIcon.icon = "pebble-sm-icons:indeterminate";  
        }

        this.message = response.msg;
      },
      _onResponseFailed: function(event,response){
        this.collapse = true;
        this.$.statusIcon.icon = "pebble-sm-icons:errorcheck";
      },
      _handleRowClick: function(){
        this.collapse = !this.collapse;
        if(this.collapse) {
          this.$.descriptionIcon.icon = "pebble-sm-icons:Expand";
        } else {
          this.$.descriptionIcon.icon = "pebble-sm-icons:Collapse";   
        }
      },
      _handleModalOpen: function() {
        this.$.pebbleDialog.open();
      },
      
      properties: {
        name: {
          type: String
        },
        collapse: {
          type: Boolean,
          value: false 
        
        },        
        url: {
          name: {
            type: String
          }
        },        
        message: {
          type: String,
          value: null
        }
      }
    });
  </script>
</dom-module>