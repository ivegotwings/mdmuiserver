<link rel="import" href="../../../bower_components/polymer/polymer.html">
<link rel="import" href="../../../bower_components/iron-flex-layout/iron-flex-layout.html">
<link rel="import" href="../../../bower_components/iron-behaviors/iron-button-state.html">
<link rel="import" href="../../../bower_components/iron-behaviors/iron-control-state.html">
<link rel="import" href="../../../bower_components/paper-behaviors/paper-ripple-behavior.html">
<link rel="import" href="../../../bower_components/paper-icon-button/paper-icon-button.html">
<link rel="import" href="../../../bower_components/iron-dropdown/iron-dropdown.html">
<link rel="import" href="../../../bower_components/paper-menu/paper-menu.html">
<link rel="import" href="../../../bower_components/paper-item/paper-item.html">

<link rel="import" href="../pebble-styles-shared/pebble-styles-shared.html">
<!--
` <pebble-tab>` Represents a tab with material design styling. It is used in conjunction with the `<pebble-tab-group>`.

### Accessibility

See the docs for `Polymer.IronControlState`, `Polymer.IronButtonState` and `Polymer.PaperRippleBehavior` for accessibility features implemented by this element.

@demo demo/index.html
-->
<dom-module id="pebble-tab">
    <template>
        <style include="pebble-styles-shared">
             :host {
                display: inline-block;
                position: relative;
                overflow: hidden;
                cursor: pointer;
                vertical-align: middle;
                @apply(--paper-font-common-base);
                @apply(--paper-tab);
            }
            
             :host(:focus) {
                outline: none;
            }
            
             :host([link]) {
                padding: 0;
            }
            
            .tab-content {
                height: 100%;
                transform: translateZ(0);
                -ms-transform: translateZ(0);
                -webkit-transform: translateZ(0);
                transition: opacity 0.1s cubic-bezier(0.4, 0.0, 1, 1);
                -webkit-transition: opacity 0.1s cubic-bezier(0.4, 0.0, 1, 1);
                @apply(--layout-horizontal);
                @apply(--layout-center-center);
                @apply(--layout-flex-auto);
                @apply(--paper-tab-content);
                position: relative;
            }
            
             :host(:not(.iron-selected))>.tab-content {
                opacity: 0.8;
                @apply(--paper-tab-content-unselected);
            }
            
             :host(:focus) .tab-content {
                opacity: 1;
                font-weight: 700;
            }
            
            paper-ripple {
                color: var(--paper-tab-ink, --paper-yellow-a100);
            }            
            
            .tab-title-content {
                display: flex;
                display: -webkit-flex; /* Safari */
                flex-direction: column;
                -webkit-flex-direction: column;
            }
            
            .tab-title-content>.tab-subtitle {
                display: flex;
                display: -webkit-flex; /* Safari */
                flex-direction: row;
                -webkit-flex-direction: row;
                font-weight: 100;
                margin-left: 29%;
            }
            
            .tab-title-content>.tab-title {
                display: flex;
                display: -webkit-flex; /* Safari */
                flex-direction: row;
                -webkit-flex-direction: row;
                padding-top: 5%;
            }
            
            pebble-badge {
                --pebble-badge-background: orange;
                --pebble-badge-margin-left: 10px;
                --pebble-badge-margin-bottom: 10px;
            }
            :host(:not(.iron-selected))>.tab-content paper-icon-button{
                color: var(--palette-dark,#1a2028);
            }
            content::content paper-item:hover{
                background-color:var(--bgColor-hover,#e8f4f9);
            }
            paper-icon-button{
                color: var(--palette-cerulean,#036bc3);
            }
            .error-circle {
                 height: 22px;
                 width: 22px;
                 line-height: 22px;
                 text-align: center;
                 border-radius: 50%;
                 background: var(--error-color,#ed204c);
                 font-size: var(--font-size-xs, 10px);
                 color:var(--palette-white,#fff);
                 margin-bottom: 15px;
                 position: relative;
                 top: -4px;
                 display: inline-block;
             }

             #dropdown-wrapper .dropdown-trigger{
                padding: 0;
                width: 20px;
             }
             
             #dropdown-wrapper .dropdown-trigger::shadow iron-icon {
                width: 50% !important;
                height: 50% !important;                
                margin-top: 13px;
                margin-left: 10px;
             }

             .tab-content> ::content>*  {
                overflow: hidden;
                text-overflow: ellipsis;
                white-space: nowrap;
             }
        </style>
        <div class="tab-content">
            <slot select=".tab-title-content">
                <div class="tab-subtitle-wrapper">
                    <slot select=".tab-subtitle"></slot>
                    <slot select=".tab-badge"></slot>
                </div>
                <div class="tab-title-wrapper">
                    <slot select=".tab-title"></slot>
                </div>
            </slot>
            <div id="dropdown-wrapper">
                <template is="dom-if" if="{{displayMenu}}">
                    <paper-icon-button class="dropdown-trigger pebble-xs-icons" icon="pebble-xs-icons:ExpandMore"  on-tap="_toggle" noink>
                    </paper-icon-button>
                </template>
            </div>
            <span class="error-circle" hidden></span>
        </div>
        <iron-dropdown opened="{{_opened}}" focus-target="[[_dropdownContent]]">
            <div class="dropdown-content">
                <slot select=".dropdown-content"></slot>
            </div>
        </iron-dropdown>
    </template>
    <script>

        (function() {
            'use strict';

            Polymer({
                is: 'pebble-tab',

                properties: {
                    /**
                     * Indicates the identification of an `element`.
                     */
                    id: {
                        type: String,
                        reflectToAttribute: true,
                    },

                    /**
                     * Indicates whether or not the tab has a dropdown menu icon. 
                     */
                    displayMenu: {
                        type: Boolean,
                        value: false,
                    },

                    /**
                     * Indicates whether or not the tab can forward keyboard clicks like `enter` or `space`
                     * to the first anchor `element` found in its descendants.
                     */
                    link: {
                        type: Boolean,
                        value: false,
                        reflectToAttribute: true
                    },

                    /**
                     * Indicates whether or not the ink ripple effect is disabled. 
                     * <b>Noink</b> property of all descendant <paper-tab> elements updates 
                     * to the new value when this property is modified.
                     */
                    noink: {
                        type: Boolean,
                        value: false
                    },

                    _opened: {
                        type: Boolean,
                        value: false,
                        notify: true,
                        observer: '_openedChanged'
                    },

                     _dropdownId: {
                        type: String
                    },
                    
                    _dropdownContentId: {
                        type: String
                    },
                    
                    _dropdownContent: {
                        type: Object
                    }
                },

                behaviors: [
                    Polymer.IronControlState,
                    Polymer.IronButtonState,
                    Polymer.PaperRippleBehavior
                ],

                listeners: {
                    down: '_updateNoink',
                    'iron-select': '_onIronSelect'
                },

                /** 
                 * Can be used to process once the `element` and its parents are inserted
                 * into a document.
                 *
                 * This is a good place to perform any work related to your element's
                 * visual state or active behavior like measuring sizes, beginning animations, and
                 * loading resources.
                 */
                attached: function() {
                    this._updateNoink();
                },
                
                /**
                 * Can be used to return the host attributes of an `element`.
                 */
                hostAttributes: {
                    role: 'tab'
                },

                /**
                 * Can be used to return the boolean value which indicates whether ripple effect 
                 * can be applied on an `element` or not.
                 *
                 * @return Returns boolean
                 */
                get _parentNoink () {
                    var parent = Polymer.dom(this).parentNode;
                    return !!parent && !!parent.noink;
                },

                _updateNoink: function() {
                    this.noink = !!this.noink || !!this._parentNoink;
                },
                
                _onIronSelect: function() {
                    this._toggle();
                },

                _openedChanged: function(opened, oldOpened) {
                    this._dropdownContent = this._contentElement;
                },

                get _contentElement() {
                    return Polymer.dom(this.$$("#" + this._dropdownContentId)).getDistributedNodes()[0];
                },

                _toggle: function(e) {
                    if (!this._opened) {
                        var eventDetail= {
                            name: "menu-open",
                            data: e
                        }
                        this.fire('bedrock-event', eventDetail);
                        this.$$("iron-dropdown").open();
                    } else {
                        var eventDetail= {
                            name: "menu-close",
                            data: e
                        }
                        this.fire('bedrock-event', eventDetail);
                        this.$$("iron-dropdown").close();
                    }
                }
            });
        })();

    </script>
</dom-module>
