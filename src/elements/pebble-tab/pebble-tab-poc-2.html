<link rel="import" href="../../../bower_components/polymer/polymer.html">

<link rel="import" href="../../../bower_components/iron-icon/iron-icon.html">
<link rel="import" href="../../../bower_components/paper-tabs/paper-tab.html">
<link rel="import" href="../../../bower_components/paper-icon-button/paper-icon-button.html">

<link rel="import" href="../../../bower_components/iron-dropdown/iron-dropdown.html">
<link rel="import" href="../../../bower_components/paper-menu/paper-menu.html">
<link rel="import" href="../../../bower_components/paper-item/paper-item.html">

<dom-module id="pebble-tab">
    <template>
        <paper-tab id="[[id]]" noink>
            <content select=".tab-content"></content>
            <paper-icon-button id="[[id]]-[[_suffix.dropdownButton]]" class="dropdown-trigger" icon="icons:more-vert" style="margin-left: 0.4em"
                on-tap="toggle">
            </paper-icon-button>
        </paper-tab>

        <iron-dropdown id="[[id]]-[[_suffix.dropdown]]" opened="{{opened}}" focus-target="[[_dropdownContent]]">
            <div class="dropdown-content">
                <content id="[[id]]-[[_suffix.dropdownContent]]" select=".dropdown-content"></content>
            </div>
        </iron-dropdown>
        <!--<paper-tab><content select=".pebble-tab-content"></content></paper-tab>-->
    </template>

    <script>

        (function() {
        'use strict';

        Polymer({
            is: 'pebble-tab',
            properties: {
                id: {
                    type: String
                },
                noink: {
                    type: Boolean,
                    value: false
                },
                opened: {
                    type: Boolean,
                    value: false,
                    notify: true,
                    observer: '_openedChanged'
                },
                _suffix: {
                    type: Object,
                    value: { dropdownButton: "dropdownButton", dropdown: "dropdown", dropdownContent: "dropdownContent" } ,
                    readOnly: true
                },
                _dropdownContentId: {
                    type: String
                },
                _dropdownContent: {
                    type: Object
                },
                _dropdownId: {
                    type: String
                },
            },

            _openedChanged: function(opened, oldOpened) {
                if (opened) {
                    this._dropdownContent = this.contentElement;
                    this.fire('paper-dropdown-open');
                } else if (oldOpened != null) {
                    this.fire('paper-dropdown-close');
                }
            },

            get contentElement() {
                return Polymer.dom(this.$$("#" + this._dropdownContentId)).getDistributedNodes()[0];
            },

            toggle: function(e) {
                console.log(e);
                var dropdownButtonId = e.currentTarget.id;
                this._dropdownId = dropdownButtonId.replace(this._suffix.dropdownButton, this._suffix.dropdown);
                this._dropdownContentId = dropdownButtonId.replace(this._suffix.dropdownButton, this._suffix.dropdownContent);

                if (this.opened) {
                    this.close(this._dropdownId);
                } else {
                    this.open(this._dropdownId);
                }
            },

            open: function(dropdownId) {
                if (this.disabled) {
                    return;
            }
            
            this.$$("#" + dropdownId).open();
            },

            close: function(dropdownId) {
                this.$$("#" + dropdownId).close();
            }

        });
        })();

    </script>

</dom-module>
<script>
        
</script>