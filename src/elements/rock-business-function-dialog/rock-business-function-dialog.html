<link rel="import" href="../../../bower_components/polymer/polymer.html">
<link rel="import" href="../bedrock-ui-behavior/bedrock-ui-behavior.html">
<link rel="import" href="../bedrock-business-function-behavior/bedrock-business-function-behavior.html">
<link rel="import" href="../bedrock-helpers/component-helper.html">
<link rel="import" href="../pebble-styles-shared/pebble-styles-shared.html">
<link rel="import" href="../rock-wizard/rock-wizard.html">
<link rel="import" href="../rock-layout/rock-layout.html">
<link rel="import" href="../pebble-styles-shared/pebble-styles-shared.html">

<!--
`rock-business-function-dialog` Represents a component that 
renders the "rock-wizard" component in a dialog along with the functionalities of 
business function framework.

@demo demo/index.html
-->

<dom-module id="rock-business-function-dialog">
    <template>
        <style include="pebble-styles-shared">
            pebble-dialog {
                @apply(--dialog-component);
            }

            rock-wizard {
                --wizard-container: {
                    margin: 0!important;
                }
            }
        </style>
        <div id="stepProviders"></div>
        <pebble-dialog id="businessFunctionDialog" horizontal-align="auto" vertical-align="auto" show-close-icon no-cancel-on-outside-click
            no-cancel-on-esc-key dialog-title="[[title]]" o>
            <div style="max-height:90vh;overflow-y: auto">
                <rock-wizard config="{{wizardConfig}}" shared-data="{{sharedData}}" on-first-step-cancelled="_onFirstStepCancelled" on-next-step="_onNextStep" on-cancel-event = "_onCancel"></rock-wizard>
            </div>
        </pebble-dialog>
    </template>
    <script>
        (function () {
            'use strict';

            Polymer({
                is: 'rock-business-function-dialog',
                behaviors: [
                    RUFBehaviors.UIBehavior,
                    RUFBehaviors.BusinessFunctionBehavior
                ],
                properties: {
                    /**
                      * <b><i>Content development is under progress... </b></i> 
                      */
                    config: {
                        type: Object,
                        value: function () { return {}; },
                        observer: '_setLabelAsTitle'
                    },
                    title: {
                        type: String,
                        value: function () { return ""; }
                    }
                },
                /**
                  * <b><i>Content development is under progress... </b></i> 
                  */
                attached: function () {
                    this.dialog = this.$$("#businessFunctionDialog");
                },
                /**
                  * <b><i>Content development is under progress... </b></i> 
                  */
                open: function () {
                    this.config = {};
                    this.config = this.configName ? this.getParentAppConfig(this.name, '', this.configName) : this.getParentAppConfig(this.name);
                    this.dialog.open();
                },
                _onFirstStepCancelled: function () {
                    this.dialog.close();
                },
                _onCancel: function () {
                    this.dialog.close();
                },
                _onNextStep: function (e, detail) {
                    if (detail) {
                        if (detail.dataRoute && detail.dataRoute != "") {
                            this.dialog.close();
                            var mainApp = document.querySelector("main-app");
                            if (!detail.queryParams) {
                                detail.queryParams = {};
                            }
                            ComponentHelper.setQueryParamsWithoutEncode(detail.queryParams);
                            mainApp.changePageRoutePath(detail.dataRoute, detail.action);
                        } else {
                            if (detail.action) {
                                this.fireBedrockEvent(detail.action.name, detail.action);
                            }
                            if (detail.closeBusinessFunction) {
                                this.dialog.close();
                            }
                        }
                    }
                },
                /**
                  * <b><i>Content development is under progress... </b></i> 
                  */
                getTitle: function () {
                    return this.config.label;
                },

                _setLabelAsTitle: function () {
                    if (this.config && this.config.label) {
                        this.setTitle(this.config.label);
                    }

                },
                /**
                  * <b><i>Content development is under progress... </b></i> 
                  */
                setTitle: function (title) {
                    this.set("title", title);
                }
            });
        })();
    </script>
</dom-module>