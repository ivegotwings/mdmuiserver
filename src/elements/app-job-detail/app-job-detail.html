<link rel="import" href="../../../bower_components/polymer/polymer.html">

<link rel="import" href="../bedrock-ui-behavior/bedrock-ui-behavior.html">
<link rel="import" href="../bedrock-app-context-behavior/bedrock-app-context-behavior.html">
<link rel="import" href="../bedrock-pubsub/bedrock-pubsub.html">

<link rel="import" href="../liquid-config-aggregate-get/liquid-config-aggregate-get.html">

<link rel="import" href="../pebble-icons/pebble-icons.html">
<link rel="import" href="../pebble-styles-shared/pebble-styles-shared.html">
<link rel="import" href="../pebble-icon/pebble-icon.html">

<link rel="import" href="../rock-layout/rock-layout.html">
<link rel="import" href="../rock-layout/rock-titlebar/rock-titlebar.html">
<link rel="import" href="../rock-widget-panel/rock-widget-panel.html">
<link rel="import" href="../rock-footer/rock-footer.html">
<link rel="import" href="../rock-job-attribute-detail/rock-job-attribute-detail.html">
<link rel="import" href="../rock-job-entity-detail/rock-job-entity-detail.html">
<dom-module id="app-job-detail">
    <template>
        <style>
            pebble-icon::shadow iron-icon {
                margin-right: 10px;
                width: 16px;
                height: 16px;
                color: var(--sub-header-icon-color);
            }

            pebble-button::shadow paper-button {
                min-width: 0px;
                color: var(--sub-header-icon-color);
                padding: 5px;
                width: 26px;
            }

            rock-layout {
                --rock-footer-background-color: #f5f7f9;
            }
            .jobAttributeDetailContainer {
                height: auto;
                width: 50%;
            }
            .container {
                width: 100%;
            }

        </style>
        <rock-layout>
            <liquid-config-aggregate-get id="getAppConfig" verbose operation="getbyids" request-id="req1" app-name="app-job-detail"
                                         context-data="[[contextData]]" on-config-get-response="_onApplicationConfigReceived"></liquid-config-aggregate-get>
            <bedrock-pubsub event-name="component-creating" handler="_onComponentCreating"></bedrock-pubsub>
            <rock-titlebar icon="pebble-md-icons:UserIcon" class="pebble-md-icons" title="Job Detail">
            </rock-titlebar>
            <div class="layout horizontal">
                <div class$="[[_computeClass(selectedEntity)]]">
                    <rock-job-entity-detail selected-entity="{{selectedEntity}}"></rock-job-entity-detail>
                </div>
                <template is="dom-if" if="[[_entitySelected(selectedEntity)]]">
                <div class="jobAttributeDetailContainer">
                    <rock-job-attribute-detail></rock-job-attribute-detail>
                </div>
                </template>
            </div>
            <!--<rock-widget-panel config="[[getConfig('rock-widget-panel')]]"></rock-widget-panel>-->
        </rock-layout>
   </template>
    <script>
        (function () {
            'use strict';

            Polymer({
                is: 'app-job-detail',
                attached: function () {
                    var userContext = {
                        "role": this.roleId,
                        "user": this.userId
                    };

                    this.contextData[this.CONTEXT_TYPE_USER] = [userContext];
                },
                properties: {
                    selectedEntity:{
                        type:Object,
                        value:function () {
                            return {};
                        }
                    }
                },
                behaviors: [
                    RUFBehaviors.UIBehavior,
                    RUFBehaviors.AppContextBehavior
                ],
                _onApplicationConfigReceived: function (e) {
                    //console.log('Received configs ', JSON.stringify(e, null, 2));
                    this.set('applicationConfig', e.detail);
                },
                _onComponentCreating: function (e, detail, sender) {
                    var component = detail.data;
                    component.properties["context-data"] = this.contextData;
                },
                _computeClass:function (selectedEntity) {
                    return _.isEmpty(selectedEntity)?'container':'jobAttributeDetailContainer';
                },
                _entitySelected:function (selectedEntity) {
                    return !_.isEmpty(selectedEntity);
                }
            });
        })();
    </script>
</dom-module>