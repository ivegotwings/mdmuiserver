<link rel="import" href="../../../bower_components/polymer/polymer.html">
<script src="../../shared/dataobject-falcor-util.js"></script>

<script>
    /***
     * Provides common utilities for data objects
     */
    LiquidDataObjectUtils = {};
    //required for gulp script parsing
    //files with window.RUFBehaviors in them are not delayed for loading
    window.RUFBehaviors = window.RUFBehaviors || {};

    (function () {
        LiquidDataObjectUtils.invalidateDataObjectCache = function (dataObject, dataIndex) {
            let pathKeys = SharedUtils.DataObjectFalcorUtil.getPathKeys();

            if (dataObject && pathKeys) {
                dataIndex = dataIndex || "entityData";
                let governDataIndex = "entityGovernData";

                let dataObjectId = dataObject.id;
                let dataObjectType = dataObject.type;

                let dataFalcorModel = RUFBehaviors.DataChannel.getModel(dataIndex);
                let governDataFalcorModel = RUFBehaviors.DataChannel.getModel(governDataIndex);

                if (dataFalcorModel) {
                    let subIndices = [];

                    if (dataIndex == "entityData") {
                        subIndices = ["data", "coalescedData"];
                    } else if (dataIndex == "entityModel") {
                        subIndices = ["entityModel", "coalescedEntityModel"];
                    }

                    subIndices.forEach(subIndex => {
                        dataFalcorModel.invalidate([pathKeys.root, dataIndex, subIndex, dataObjectType, pathKeys.byIds, dataObjectId]);
                    });
                }

                if (governDataFalcorModel && dataIndex == "entityData") {
                    governDataFalcorModel.invalidate([pathKeys.root, governDataIndex, dataObjectType, pathKeys.byIds, dataObjectId]);
                }
            }
        };

        LiquidDataObjectUtils.invalidateAllCache = function () {
            RUFBehaviors.DataChannel.clearAllCache();
        };
    })();
</script>