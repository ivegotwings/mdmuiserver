<link rel="import" href="../../../bower_components/polymer/polymer.html">
<script src="../../shared/dataobject-falcor-util.js"></script>

<script>
  /***
  * Provides common utilities for data objects
  */
  LiquidDataObjectUtils = {};
  //required for gulp script parsing
  //files with window.RUFBehaviors in them are not delayed for loading 
  window.RUFBehaviors = window.RUFBehaviors || {};

  (function () {
    LiquidDataObjectUtils.invalidateDataObjectCache = function (dataObject, dataIndex) {
      var pathKeys = SharedUtils.DataObjectFalcorUtil.getPathKeys();

      if (dataObject && pathKeys) {
        var dataIndex = dataIndex || "entityData";
        var governDataIndex = "entityGovernData";

        var dataObjectId = dataObject.id;
        var dataObjectType = dataObject.type;

        var dataFalcorModel = RUFBehaviors.DataChannel.getModel(dataIndex);
        var governDataFalcorModel = RUFBehaviors.DataChannel.getModel(governDataIndex);

        if (dataFalcorModel) {
          let subIndieces = [];
          
          if (dataIndex == "entityData") {
            subIndieces = ["data", "coalescedData"];
          } else if (dataIndex == "entityModel") {
            subIndieces = ["entityModel", "coalescedEntityModel"];
          }

          subIndieces.forEach(subIndex => {
            dataFalcorModel.invalidate([pathKeys.root, dataIndex, subIndex, dataObjectType, pathKeys.byIds, dataObjectId]);
          });
        }

        if (governDataFalcorModel && dataIndex == "entityData") {
          governDataFalcorModel.invalidate([pathKeys.root, governDataIndex, dataObjectType, pathKeys.byIds, dataObjectId]);
        }
      }
    };

    LiquidDataObjectUtils.invalidateAllCache = function (dataObject) {
      RUFBehaviors.DataChannel.clearAllCache();
    };
  })();
</script>