<link rel="import" href="../../../bower_components/polymer/polymer.html">
<script src="../../shared/dataobject-falcor-util.js"></script>

<script>
  /***
  * Provides common utilities for data objects
  */
  LiquidDataObjectUtils = {};
  //required for gulp script parsing
  //files with window.RUFBehaviors in them are not delayed for loading 
  window.RUFBehaviors = window.RUFBehaviors || {};

  (function () {
    LiquidDataObjectUtils.invalidateDataObjectCache = function (dataObject) {
      var pathKeys = SharedUtils.DataObjectFalcorUtil.getPathKeys();

      if (dataObject && pathKeys) {
        var entityDataIndex = "entityData";
        var entityGovernDataIndex = "entityGovernData";

        var dataObjectId = dataObject.id;
        var dataObjectType = dataObject.type;

        var entityDataFalcorModel = RUFBehaviors.DataChannel.getModel(entityDataIndex);
        var entityGovernDataFalcorModel = RUFBehaviors.DataChannel.getModel(entityGovernDataIndex);

        if (entityDataFalcorModel) {
          entityDataFalcorModel.invalidate([pathKeys.root, entityDataIndex, 'data', dataObjectType, pathKeys.byIds, dataObjectId]);
          entityDataFalcorModel.invalidate([pathKeys.root, entityDataIndex, 'coalescedData', dataObjectType, pathKeys.byIds, dataObjectId]);
        }

        if (entityGovernDataFalcorModel) {
          entityGovernDataFalcorModel.invalidate([pathKeys.root, entityGovernDataIndex, dataObjectType, pathKeys.byIds, dataObjectId]);
        }
      }
    };

    LiquidDataObjectUtils.setDataSubIndexInPath = function (path, dataIndex, dataSubIndex) {
      if (!_.isEmpty(path) && !_.isEmpty(dataIndex)) {
        if (!_.isEmpty(dataSubIndex)) {
          var indexOfDataIndex = path.indexOf(dataIndex);
          if (indexOfDataIndex > -1) {
            path.splice(indexOfDataIndex + 1, 0, dataSubIndex)
          }
        }
      }
      return path;
    };
  })();
</script>