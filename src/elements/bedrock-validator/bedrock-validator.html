<link rel="import" href="../../../bower_components/polymer/polymer.html">


<dom-module id="rock-tag-item">
    <template>
        [[errorMessage]]
    </template>
<script>
    /**
     * `bedrock-validator` validates user input against a specified validation condition.
     *
     * @demo demo/index.html
     */
    Polymer({
        is: 'bedrock-validator',

        properties: {
            pattern:{
                type: String,
                notify:true
            },
            input:{
                type: String,
                notify:true,
                observer: 'input_changed'
            },
            type:{
                type:String,
                notify:true
            },
            typeArray:{
                type:String,
                notify:true
            },
            invalid:{
                type:Boolean,
                value:false,
                notify:true,
                reflectToAttribute:true
            },
            errorMessage:{
                type: String,
                notify:true,
                reflectToAttribute:true,
                value:''
            },
            min:{
                type: Number,
                notify:true
            },
            max:{
                type: Number
            },
            minLength:{
                type: Number,
                notify:true
            },
            maxLength:{
                type: Number,
                notify:true,
                reflectToAttribute:true
            }
        },
        input_changed: function (input) {
           this.validate(input);
        },

        validate: function(input) {
            this.errorMessage='';
            this.invalid=false;
            var types;
            if(this.type) {
                types = this.type.split(",");
            } else if(this.typeArray) {
                types=this.typeArray;
            }
            if(types && types.length>0){
                for (var i = 0; i < types.length; i++) {
                    var invalid = false;
                    var errorMessage='';
                    switch (types[i]) {
                        case 'required':
                            invalid = !this.requiredValidator(input);
                            errorMessage = "Required.\t";
                            break;
                        case 'minLength':
                            console.log(this.minLength);
                            invalid = !this.minLengthValidator(input, this.minLength);
                            errorMessage = "Length shouldn't be smaller than "+ this.minLength +" .\t";
                            break;
                        case 'maxLength':
                            invalid = !this.maxLengthValidator(input, this.maxLength);
                            errorMessage = "Length shouldn't be greater than "+ this.maxLength +" .\t";
                            break;
                        case 'range':
                            invalid = !this.numberRangeValidator(input, this.min, this.max);
                            errorMessage ="Value should be between  "+ this.min+ " and "+ this.max+ ".\t";
                            break;
                        case 'rangeTo':
                            invalid = !this.numberRangeValidator(input, '', this.max);
                            errorMessage ="Value should be smaller than "+ this.max+ "\t";
                            break;
                        case 'rangeFrom':
                            invalid = !this.numberRangeValidator(input, this.min, '');
                            errorMessage = "Value should be greater than "+ this.min+ "\t";
                            break;
                        case 'email':
                            invalid = !this.emailValidator(input);
                            errorMessage = "Invalid Email.\t";
                            break;
                        case 'pattern':
                            invalid = !this.regexValidator(input, this.pattern);
                            errorMessage = "Text doesn't match the required pattern.\t";
                            break;
                    }
                    if (invalid) {
                        this.errorMessage+=errorMessage;
                        this.invalid = true;
                    }
                }
            }
        },
        requiredValidator: function (input) {
            return (input !=undefined && input !="") ;
        },
        minLengthValidator: function (input,length) {
            return input.length>= length;
        },
        maxLengthValidator:function (input,length) {
            return input.length<= length;
        },
        numberRangeValidator: function (value,min,max) {
            if(isNaN(value)){
                if(this.isFraction(value)){
                    var split = value.split('/');
                    if(!isNaN(split[0]) && !isNaN(split[1])){
                        value=parseInt(split[0])/parseInt(split[1]);
                    }
                } else{
                    return false;
                }
            }
            if(isNaN(min)){
                return value<max;
            } else if(isNaN(max)){
                return value>min;
            }
            return value>min && value< max;
        },
        emailValidator:function(input) {
        var regex = /^([a-zA-Z0-9_.+-])+\@(([a-zA-Z0-9-])+\.)+([a-zA-Z0-9]{2,4})+$/;
        return regex.test(input);
        },
        regexValidator: function (input,pattern) {
            var regExp= new RegExp(pattern);
            return regExp.test(input);
        },
        isFraction: function(value){
            if(isNaN(value)){
                var split = value.split('/');
                return split.length == 2 && !isNaN(split[0]) && !isNaN(split[1]) && parseInt(split[1]) != 0;
            }
            return false;
        },
        attached: function() {
//            alert(this.input);
           this.validate(this.input);
        }

        




    });
</script>
</dom-module>