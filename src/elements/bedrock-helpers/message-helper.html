<link rel="import" href="../../../bower_components/polymer/polymer.html">

<script>
    MessageHelper = {};

    (function() {
        MessageHelper.getAttributeMessages= function(attributes, attributeModels, messageCodeMapping) {
            var attrMessages = {};
            for (var attributeName in attributes) {
                if(attributeModels[attributeName]) {
                    var messageCodes = MessageHelper.getMessageCodes(attributes[attributeName]);
                    var messages = MessageHelper.getMessagesFromCodes(messageCodes, messageCodeMapping);
                    if (messages && messages.length) {
                        attrMessages[attributeName] = messages;
                    }
                }
            }
            return attrMessages; 
        };
        
        MessageHelper.getRelationshipMessages= function(relationship, messageCodeMapping) {
            var messageCodes = MessageHelper.getMessageCodes(relationship[0]);
            var messages = MessageHelper.getMessagesFromCodes(messageCodes, messageCodeMapping);
            return messages;
        };

        MessageHelper.getMessageCodes = function (attribute) {
            var messageCodes = [];
            var properties = attribute.properties;
            if (properties) {
                var messages = properties.messages;
                if(messages && messages.length > 0) {
                    for (var i=0; i< messages.length; i++) {
                        messageCodes.push(messages[i].messageCode);
                    }
                }
            }
            return messageCodes;
        };

        MessageHelper.getMessagesFromCodes= function (messageCodes, messageCodeMapping) {
            var messages=[];
            if(messageCodes && messageCodes.length > 0) {
                for(var i=0; i<messageCodes.length; i++){
                    var code = messageCodes[i];
                    if(code != 'SYS001') {
                        var mes= messageCodeMapping[code];
                        if(mes){
                            messages.push(mes);
                        } else{
                            messages.push("Error with Code: " + code);
                        }
                    }
                }
            }
            return messages;
        };

        MessageHelper.getErrorsFromAttrMessages= function(attrMessages, attributeModels) {
            var messageObjects = [];
            for(var attributeName in attrMessages) {
                var externalName = attributeModels[attributeName].externalName;
                var currentAttributeMessages = attrMessages[attributeName];
                if(currentAttributeMessages && currentAttributeMessages.length > 0) {
                    var firstErrorMessage = currentAttributeMessages[0];//TODO: what if there are more messages for an attribute
                    var messageObject = {
                        "attributeName": attributeName,
                        "attributeExternalName": externalName,
                        "message": firstErrorMessage
                    };
                    messageObjects.push(messageObject);
                }
            }
            return messageObjects;
        };

        MessageHelper.getErrorsFromRelMessages= function(relMessages, messageCodeMapping) {
            var errorMessages = [];
            for(var i in relMessages) {
               var relObj = relMessages[i];
               var attrMessages = MessageHelper.getAttributeMessages(relObj.relAttributes, relObj.attrModels, messageCodeMapping);
               var attributeErrors = MessageHelper.getErrorsFromAttrMessages(attrMessages, relObj.attrModels);
               var errorMessage = {
                   "attributeName": relObj.relTitle,
                   "message": relObj.relMessage
               };
               attributeErrors.push(errorMessage);
               errorMessages.push.apply(errorMessages, attributeErrors);
            }
            return errorMessages;
        };

        MessageHelper.getErrorsFromWhereUsedMessages= function(relMessages, messageCodeMapping) {
            var errorMessages = [];
            for(var i in relMessages) {
               var relObj = relMessages[i];
               var attrMessages = MessageHelper.getAttributeMessages(relObj.relAttributes, relObj.attrModels, messageCodeMapping);
               var attributeErrors = MessageHelper.getErrorsFromAttrMessages(attrMessages, relObj.attrModels);
               var errorMessage = {
                   "fromEntity": relObj.fromEntityId,
                   "fromEntityType": relObj.fromEntityType,
                   "attrErrorMessages": attributeErrors
               };
               errorMessages.push(errorMessage);
            }
            return errorMessages;
        };

    })();
</script>