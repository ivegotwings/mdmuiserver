<link rel="import" href="../../../bower_components/polymer/polymer.html">

<script>
    MessageHelper = {};

    (function() {
        MessageHelper.getAttributeMessages= function(attributes, attributeModels, messageCodeMapping) {
            var attrMessages = {};
            for (var i in attributes) {
                if(attributeModels[i]) {
                    var messageCodes = MessageHelper.getMessageCodes(attributes[i]);
                    var messages = MessageHelper.getMessagesFromCodes(messageCodes, messageCodeMapping);
                    if (messages && messages.length) {
                        attrMessages[i] = messages;
                    }
                }
            }
            return attrMessages; 
        };
        
        MessageHelper.getRelationshipMessages= function(relationship, messageCodeMapping) {
            var messageCodes = MessageHelper.getMessageCodes(relationship[0]);
            var messages = MessageHelper.getMessagesFromCodes(messageCodes, messageCodeMapping);
            return messages;
        };

        MessageHelper.getMessageCodes = function (attribute) {
            var messageCodes = [];
            var properties = attribute.properties;
            if (properties) {
                var messages = properties.messages;
                if(messages && messages.length > 0) {
                    for (var i=0; i< messages.length; i++) {
                        messageCodes.push(messages[i].messageCode);
                    }
                }
            }
            return messageCodes;
        };

        MessageHelper.getMessagesFromCodes= function (messageCodes, messageCodeMapping) {
            var messages=[];
            if(messageCodes && messageCodes.length > 0) {
                for(var i=0; i<messageCodes.length; i++){
                    var mes= messageCodeMapping[messageCodes[i]];
                    if(mes){
                        messages.push(mes);
                    } else{
                        messages.push("Error with Code: "+messageCodes[i])
                    }
                }
            }
            return messages;
        };

        MessageHelper.getErrorsFromAttrMessages= function(attrMessages, attributeModels) {
            var errorMessages = [];
            for(var i in attrMessages) {
                var attrLongName = attributeModels[i].externalName;
                var errorMessage = attrMessages[i][0];
                var errorMessage = {
                    "attributeName": attrLongName,
                    "message": errorMessage
                };
                errorMessages.push(errorMessage);
            }
            return errorMessages;
        };

        MessageHelper.getErrorsFromRelMessages= function(relMessages, messageCodeMapping) {
            var errorMessages = [];
            for(var i in relMessages) {
               var relObj = relMessages[i];
               var attrMessages = MessageHelper.getAttributeMessages(relObj.relAttributes, relObj.attrModels, messageCodeMapping);
               var attributeErrors = MessageHelper.getErrorsFromAttrMessages(attrMessages, relObj.attrModels);
               var errorMessage = {
                   "attributeName": relObj.relTitle,
                   "message": relObj.relMessage
               };
               attributeErrors.push(errorMessage);
               errorMessages.push.apply(errorMessages, attributeErrors);
            }
            return errorMessages;
        };

    })();
</script>