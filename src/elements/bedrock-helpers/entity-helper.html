<!--
`bedrock-helpers` Represents a bunch of helpers that any bedrock, pebble, rock or app can use. 
-->
<link rel="import" href="../../../bower_components/polymer/polymer.html">
<link rel="import" href="../bedrock-helpers/data-helper.html">
<link rel="import" href="../bedrock-helpers/data-merge-helper.html">
<link rel="import" href="../liquid-dataobject-utils/liquid-dataobject-utils.html">

<script>
    EntityHelper = {};

    (function () {

        EntityHelper.getAllAttributes = function (entity) {
            var attributes = {};
            if (entity) {
                if (entity.data) {
                    if (entity.data.attributes) {
                        attributes = DataMergeHelper.mergeAttributes(attributes, entity.data.attributes, true);
                    }

                    if (entity.data.contexts) {
                        entity.data.contexts.forEach(function (element) {
                            if (element && element.attributes) {
                                attributes = DataMergeHelper.mergeAttributes(attributes, element.attributes, true);
                            }
                        }, this);
                    }
                }
            }

            return attributes;
        };

        EntityHelper.getRelationshipsBasedOnContext = function (entity, dataContext, isSelfContext) {
            var relationships = {};
            if (entity && entity.data) {
                if (isSelfContext) {
                    if (entity.data.relationships) {
                        relationships = entity.data.relationships;
                    }
                } else {
                    if (!_.isEmpty(dataContext)) {
                        if (entity.data.contexts) {
                            relationships = SharedUtils.DataObjectFalcorUtil.getRelationshipsByCtx(entity, dataContext);
                        }

                    }
                }
            }

            return relationships;
        };

        EntityHelper.getRelationshipByType = function (entity, dataContext, relationshipType, isSelfContext) {
            var relationships = {};
            if (entity) {
                if (isSelfContext) {
                    if (!entity.data) {
                        entity.data = DataHelper.getEmptyRelationshipDataObject(undefined, relationshipType);
                    }

                    if (entity.data.relationships) {
                        if (entity.data.relationships[relationshipType]) {
                            relationships = entity.data.relationships[relationshipType];
                        }
                    } else {
                        relationships = entity.data.relationships = {};
                    }

                } else {
                    if (!entity.data) {
                        entity.data = DataHelper.getEmptyRelationshipDataObject(dataContext, relationshipType);
                    }

                    var contexts = entity.data.contexts;
                    if (contexts && contexts.length) {
                        contexts.forEach(function (item) {
                            if (item) {
                                item.attributes = {};
                                relationships = item.relationships[relationshipType];
                            }
                        }, this);
                    } else {
                        entity.data.contexts = [];
                        entity.data.contexts.push({ "context": dataContext });
                        relationships = entity.data.contexts[0].relationships = {};
                    }
                }
            }
            return relationships;
        }

    })();

</script>