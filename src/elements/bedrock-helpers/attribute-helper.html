<!--
`bedrock-helpers` Represents a bunch of helpers that any bedrock, pebble, rock or app can use. 
-->
<link rel="import" href="../../../bower_components/polymer/polymer.html">
<link rel="import" href="../bedrock-helpers/context-helper.html">
<link rel="import" href="../bedrock-helpers/data-helper.html">
<link rel="import" href="../liquid-dataobject-utils/liquid-dataobject-utils.html">

<!--<script type="text/javascript" src="data-helper.js" />-->
<script>
    AttributeHelper = {};

    (function () {
    
        AttributeHelper.getDisplayType = function (dataType) {
            var displayType = 'textbox';

            switch (dataType) {
                case 'boolean': {
                        displayType = 'boolean';
                        break;
                    }
                case 'date': {
                        displayType = 'date';
                        break;
                    }
                case 'datetime': {
                        displayType = 'datetime';
                        break;
                    }
                case 'decimal': {
                        displayType = 'textbox';
                        break;
                    }
            }

            return displayType;
        };

        AttributeHelper.getCurrentValue = function (values, valueContext, model) {
            if ((model.displayType == "textbox" || model.displayType == "referenceList") && model.isCollection) {
                return this.getCurrentValues(values, valueContexts, model);
            }

            var value;
            if (values) {
                for (var i = 0; i < values.length; i++) {
                    var currentValue = values[i];
                    value = DataHelper.cloneObject(currentValue);
                    break;
                }
            }

            return value;
        };
        
        AttributeHelper.populateValueContext = function (val, valueContext) {
            for(var valueContextField in valueContext) {
                val[valueContextField] = valueContext[valueContextField];
            }
        };

        AttributeHelper.getCurrentValues = function (values, valueContext, model) {
            if (!((model.displayType == "textbox" || model.displayType == "referenceList") && model.isCollection)) {
                return;
            }

            var _values = [];

            if (values) {
                for (var i = 0; i < values.length; i++) {
                    var currentValue = values[i];
                  
                    if (Array.isArray(currentValue.value)) {
                        //When save, already array, then no change
                        _values = _values.concat(currentValue.value);
                    } else if (model.displayType == "referenceList") {
                        _values.push(currentValue.value);
                    } else {
                        //TODO: Clean this up once text collection supports string array as values
                        _values.push(this.getTextCollectonSupportedFormat(currentValue));
                    }
                }
            }

            var val = { "value": _values };
            this.populateValueContext(val, valueContext);
        };

        AttributeHelper.getEmptyValue = function (valueContext) {
            var val = { "value": "" };
            this.populateValueContext(val, valueContext);
            return val;
        };

        AttributeHelper.getFirstAttributeValue = function (attribute) {
            if (attribute && attribute.values && attribute.values.length > 0) {
                return attribute.values[0].value;
            }
            return null;
        };

        AttributeHelper.getTextCollectonSupportedFormat = function (obj) {
            return {
                "name": obj.value,
                "longName": obj.value
            };
        };

    })();

</script>