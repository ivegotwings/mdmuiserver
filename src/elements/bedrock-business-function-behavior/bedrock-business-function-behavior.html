<link rel="import" href="../../../bower_components/polymer/polymer.html">

<link rel="import" href="../bedrock-helpers/component-helper.html">
<link rel="import" href="../bedrock-helpers/data-helper.html">
<script>
    /***
     * `RUFBehaviors.BusinessFunctionBehavior` provides common properties and methods 
     * that must be implemented for all the business functions in the framework.
     *
     *
     *  ### Example
     *
     *     <dom-module id="x-app">
     *        <template>
     *        </template>
     *        <script>
     *           Polymer({
    *             is: "x-app",
    *
    *             behaviors: [
    *               RUFBehaviors.BusinessFunctionBehavior
    *             ],
    *
    *             properties: {
    *
    *             }
    *           });
     *        &lt;/script>
     *     </dom-module>
     * @demo demo/index.html
     * @polymerBehavior RUFBehaviors.BusinessFunctionBehavior
     */

    window.RUFBehaviors = window.RUFBehaviors || {};

    RUFBehaviors.BusinessFunctionBehavior = {
        properties: {
            /**
               * Content is not appearing - Content development is under progress. 
               */
            name: {
                type: String
            },
            /**
              * Content is not appearing - Content development is under progress. 
              */
            configName: {
                type: String
            },
            /**
              * Content is not appearing - Content development is under progress. 
              */
            config: {
                type: Object,
                value: function () { return {}; }
            },
            /**
              * Content is not appearing - Content development is under progress. 
              */
            context: {
                type: Object,
                value: function () { return {}; }
            },
            /**
              * Content is not appearing - Content development is under progress. 
              */
            properties: {
                type: Object,
                value: function () { return {}; }
            },
            wizardConfig: {
                type: Object,
                value: function () { return {}; }
            },
            sharedData: {
                type: Object,
                value: function () {
                    return {};
                }
            },
        },
        observers: [
            '_configChanged(config)'
        ],
        /**
          * Content is not appearing - Content development is under progress. 
          */
        getIsDirty: function () {
            var wizard = this.$$('rock-wizard') || document.querySelector('rock-wizard');
            if (wizard) {
                return wizard.getIsDirty();
            }
        },

        _configChanged: function() {
                if(this.config.stepProviderComponent) {
                    this._importStepProvider(this.config.stepProviderComponent);
                } else {
                    this.set("wizardConfig", {});
                    this.set("wizardConfig", this.config);
                }
        },
        _importStepProvider: function (component) {
            var stepProviders = this.$$("#stepProviders");
            ComponentHelper.loadContent(stepProviders, component, this, this._stepProviderCreated.bind(this));
        },
        _stepProviderCreated: function (stepProviderElement) {
            if (stepProviderElement && stepProviderElement.getSteps) {
                stepProviderElement.getSteps(this.sharedData, this._stepProviderCallback.bind(this));
            }
        },
        _stepProviderCallback: function (steps) {
            if (!_.isEmpty(steps)) {
                var wizardConfig = DataHelper.cloneObject(this.config);
                wizardConfig.steps = steps;
                this.set("wizardConfig", wizardConfig);
            }
        },
    };

</script>