<link rel="import" href="../../../bower_components/paper-menu/paper-menu.html">
<link rel="import" href="../../../bower_components/iron-iconset-svg/iron-iconset-svg.html">

<link rel="import" href="../pebble-icons/pebble-icons.html">

<dom-module id="rock-navmenu">
	<template>
		<style include="shared-styles"></style>
		<style>
			iron-icon {
				margin-right: 33px;
				opacity: 0.54;
				color: #ffffff;
			}
			
			.iron-selected {
				color: #ffffff;
				opacity: 1;
			}
			
			.iron-selected iron-icon {
				opacity: 1;
			}
			
			a {
				text-decoration: none;
				color: #ffffff;
				opacity: 0.54;
				display: -ms-flexbox;
				display: -webkit-flex;
				display: flex;
				-ms-flex-direction: row;
				-webkit-flex-direction: row;
				flex-direction: row;
				-ms-flex-align: center;
				-webkit-align-items: center;
				align-items: center;
				font-family: 'Roboto', 'Noto', sans-serif;
				-webkit-font-smoothing: antialiased;
				text-rendering: optimizeLegibility;
				font-size: 14px;
				font-weight: 400;
				line-height: 24px;
				min-height: 48px;
				padding: 0 16px;
				white-space: nowrap;
				box-sizing: border-box;
				cursor: pointer;
			}
			
			a[hide] {
				display: none;
			}
			
			paper-submenu paper-item {
				font-size: 14px;
				cursor: pointer;
				outline: none;
				white-space: nowrap;
				width: 255px;
				box-sizing: border-box;
				@apply(--layout);
				@apply(--layout-horizontal);
			}
			
			.arow-down {
				margin-right: 0;
			}
			
			paper-submenu paper-menu {
				background: var(--drawer-submenu-background);
				padding: 0;
				height: 0;
				max-height: 0;
				overflow: hidden;
				transition: max-height 0.3s ease-in-out;
			}
			
			paper-submenu .submenu-expanded + paper-menu {
				height: auto;
				max-height: 300px;
			}

		</style>

		<paper-menu id="mainMenu" class="list" attr-for-selected="data-route" selected="{{page}}">
			<template is="dom-repeat" items="{{menuItems}}">
				<a item="[[item]]" on-click="onDataRouteClick" is-landing-page="[[item.isLandingPage]]">
					<iron-icon icon="{{item.icon}}"></iron-icon>
					<span>{{item.title}}</span>
					<template is="dom-if" if="[[item.closable]]">
						<paper-icon-button name="close" icon="icons:clear" title="Close" on-tap="_onCloseClick"></paper-icon-button>
					</template>
				</a>
			</template>
		</paper-menu>
	</template>

	<script>
    (function() {
      'use strict';

      Polymer({
        is: 'rock-navmenu',

        properties: {
          menuItems:
          {
            type: Array,
            notify: true
          },
					route: {
            type: Object,
            notify: true
          },
					page: {
            type: String,
            reflectToAttribute: true
					}
        },
        
				attached: function(){
         var menuItem = this.$.mainMenu.querySelector('a');
         if(menuItem){
					 menuItem.click();
				 }
				},

        toggleSubmenu: function(e) {
          e.target.parentNode.classList.toggle('submenu-expanded');
        },

        onDataRouteClick: function(e) {
					//TODO: temp condition till we get proper styling for icons
					if(e.target.tagName == "PAPER-ICON-BUTTON") {
						return;
					}
					this.fire("menu-click", {"item": e.currentTarget.item} );
          // Close drawer after menu item is selected if drawerPanel is narrow
          //var drawerLayout = this.parentNode.parentNode.parentNode;
				  //if (drawerLayout.forceNarrow || !drawerLayout.narrow) {
		      //   drawerLayout.forceNarrow = !drawerLayout.forceNarrow;
          //} else {
          //  drawerLayout.drawer.toggle();
				//	}
				},
				_onCloseClick: function(e) {
					this.fire("menu-close-click", {"item": e.target.parentElement.item} );
					
				}
      });
    })();
  </script>

</dom-module>