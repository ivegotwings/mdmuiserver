<link rel="import" href="../../../bower_components/polymer/polymer.html">

<link rel="import" href="../pebble-button/pebble-button.html">
<link rel="import" href="../pebble-icon/pebble-icon.html">
<link rel="import" href="../pebble-icons/pebble-icons.html">
<link rel="import" href="../pebble-styles-shared/pebble-styles-shared.html">
<link rel="import" href="../pebble-checkbox/pebble-checkbox.html">
<link rel="import" href="../pebble-data-table/pebble-data-table.html">


<!--
`pebble-split-list`

@demo demo/index.html 
-->

<dom-module id="pebble-split-list">
    <template>
        <style include="pebble-styles-shared">
            .container{
                /*width: 600px;*/
                /*height: 600px;*/
                padding-right: 15px;
                padding-left: 15px;
                margin-right: auto;
                margin-left: auto;
            }
            .leftContainer{
                width:40%;
                float: left;
                border: 2px solid black;
            }
            .centerContainer{
                width: 10%;
                float: left;
                padding-top: auto;
                vertical-align: middle;
            }
            .rightContainer{
                width: 40%;
                float: left;
                border: 2px solid black;
            }
            .row{
                margin-right: -15px;
                margin-left: -15px;
            }
            .iconButton{
                margin:15%;
                width: 70%;
            }
            /*.check-filter{*/
                /*padding:0;*/
                /*width: auto;*/
            /*}*/

        </style>

        <div class="container">
            <div class="row">
                <div class="leftContainer">
                    <pebble-data-table id="leftDataTable" page-size="[[pageSize]]"  selection-enabled="[[selectionEnabled]]"
                                       multi-selection="[[config.tabular.settings.isMultiSelect]]" data-source="[[dataSource]]" items="{{items}}" selected-item="{{selectedItem}}"
                                       selected-items="{{selectedItems}}" sort-order="{{sortOrder}}">
                            <template is="dom-repeat" items="[[config.tabular.columns]]" as="col" index-as="colIndex">
                                <data-table-column name="[[col.header]]" column-index="{{colIndex}}" filter-by$="[[_isFilterEnabled(col)]]" sort-by$="[[_isSortable(col)]]"
                                                   icon="pebble-md-icons:Edit" class="pebble-md-icons" column-object="[[col]]">
                                    <template>
                                                <div class="cell">
                                                    [[_columnValue(item, column.columnIndex)]]
                                                </div>
                                    </template>
                                </data-table-column>
                            </template>
                    </pebble-data-table>
                </div>
                <div class="centerContainer">
                    <pebble-button class="iconButton btn btn-outline-primary m-r-5" icon="icons:last-page" on-tap="_moveRightAll"></pebble-button>
                    <pebble-button class="iconButton btn btn-outline-primary m-r-5" icon="icons:chevron-right" on-tap="_moveRight"></pebble-button>
                    <pebble-button class="iconButton btn btn-outline-primary m-r-5" icon="icons:first-page" on-tap="_moveLeftAll"></pebble-button>
                    <pebble-button class="iconButton btn btn-outline-primary m-r-5" icon="icons:chevron-left" on-tap="_moveLeft"></pebble-button>
                </div>
                <div class="rightContainer">
                    <pebble-data-table id="rightDataTable"   selection-enabled="[[selectionEnabled]]"
                                       multi-selection="[[config.tabular.settings.isMultiSelect]]"  items="{{rightItems}}" selected-item="{{selectedItem}}"
                                       selected-items="{{selectedItems}}" sort-order="{{sortOrder}}">
                        <template is="dom-repeat" items="[[config.tabular.columns]]" as="col" index-as="colIndex">
                            <data-table-column name="[[col.header]]" column-index="{{colIndex}}" filter-by$="[[_isFilterEnabled(col)]]" sort-by$="[[_isSortable(col)]]"
                                               icon="pebble-md-icons:Edit" class="pebble-md-icons" column-object="[[col]]">
                                <template>
                                    <div class="cell">
                                        [[_columnValue(item, column.columnIndex)]]
                                    </div>
                                </template>
                            </data-table-column>
                        </template>
                    </pebble-data-table>
                </div>
            </div>
        </div>

    </template>

    <script>
        (function () {
            'use strict';

            Polymer({
                is: 'pebble-split-list',
                properties: {
                    rightItems:{
                        type:Array,
                        value:function () {
                            return [];
                        },
                        notify:true
                    },
                    keepSelectedItemsInLeft: {
                        type:Boolean,
                        value:false
                    }
                },
                behaviors:[],
                _columnValue: function (gridData, index) {
                    var cellData;
                    var columnName = this.config.tabular.columns[index].name;
                    if (this.config.schemaType == undefined || this.config.schemaType == "simple" || this.config.schemaType ==
                        "colModel") {
                        cellData = gridData[columnName];
                    } else if (this.config.schemaType == "attribute") {
                        if (gridData.attributes && gridData.attributes.hasOwnProperty(columnName)) {
                            cellData = this._formatValue(gridData.attributes[columnName].value, columnName);
                        }
                    }
                    if (cellData != undefined) {
                        index++;
                    }
                    if (typeof (cellData) === "boolean") {
                        return cellData.toString();
                        //Had to manually convert to string because pebble-boolean is not working when you pass boolean.
                    }
                    return cellData;
                },
                _moveRight:function () {
                    var leftGrid=this.$.leftDataTable;
                    if(leftGrid){
                        var selectedItems=leftGrid.getSelectedItems();
                        for(var i=0;i<selectedItems.length;i++) {
                            if(this.rightItems.indexOf(selectedItems[i])==-1) {
                                this.push("rightItems", selectedItems[i]);
                            }
                        }
                        if(!this.keepSelectedItemsInLeft){
                            for(var i=0;i<selectedItems.length;i++) {
                                var index=this.items.indexOf(selectedItems[i]);
                                this.splice("items",index,1 );
                            }
                        }
                        this.fireBedrockEvent("moveToRight",selectedItems);
                    }
                },
                _moveRightAll:function () {
                    var leftGrid=this.$.leftDataTable;
                    if(leftGrid){
                        var items=leftGrid.getData();
                        for(var i=0;i<items.length;i++) {
                            if(this.rightItems.indexOf(items[i])==-1) {
                                this.push("rightItems", items[i]);
                            }
                        }
                        if(!this.keepSelectedItemsInLeft){
                            this.set("items",[]);
                        }
                        this.fireBedrockEvent("moveAllToRight",items);
                    }
                },
                _moveLeft:function () {
                    var rightGrid=this.$.rightDataTable;
                    if(rightGrid){
                        var selectedItems=rightGrid.getSelectedItems();
                        for(var i=0;i<selectedItems.length;i++) {
                            if(this.items.indexOf(selectedItems[i])==-1) {
                                this.push("items", selectedItems[i]);
                            }
                        }
                        for(var i=0;i<selectedItems.length;i++) {
                            var index=this.items.indexOf(selectedItems[i]);
                            this.splice("rightItems",index,1 );
                        }
                        this.fireBedrockEvent("moveToLeft",items);
                    }
                },
                _moveLeftAll:function () {
                    var items=this.rightItems;
                    for(var i=0;i<items.length;i++) {
                        if(this.items.indexOf(items[i])==-1) {
                            this.push("items", items[i]);
                        }
                    }
                    this.set("rightItems",[]);

                }


            });
        })();
    </script>

</dom-module>