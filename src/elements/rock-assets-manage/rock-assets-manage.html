<link rel="import" href="../../../bower_components/polymer/polymer.html">
<link rel="import" href="../../../bower_components/iron-flex-layout/iron-flex-layout.html">
<link rel="import" href="../../../bower_components/iron-icons/iron-icons.html">

<link rel="import" href="../bedrock-helpers/data-helper.html">
<link rel="import" href="../bedrock-helpers/data-request-helper.html">
<link rel="import" href="../bedrock-ui-behavior/bedrock-ui-behavior.html">
<link rel="import" href="../bedrock-component-context-behavior/bedrock-component-context-behavior.html">

<link rel="import" href="../pebble-button/pebble-button.html">
<link rel="import" href="../pebble-styles-shared/pebble-styles-shared.html">
<link rel="import" href="../pebble-icons/pebble-icons.html">
<link rel="import" href="../pebble-accordion/pebble-accordion.html">

<!--
`rock-assets-manage` Manage assets entity
-->
<dom-module id="rock-assets-manage">
    <template>
        <style is="custom-style" include="pebble-styles-shared"></style>
            <template is="dom-repeat" items="{{assetTypeList}}" as="asset" index-as="colIndex" notify-dom-change>
                <div id="assetContainer_[[asset]]">
                    <pebble-accordion header-text="[[_getAssetTypeTitle(asset)]]" default-icon="expand-less" open-icon="expand-more">
                        <div class="asset-name-container">
                            <pebble-button icon="pebble-sm-icons:Add" id="[[asset]]" class="pebble-sm-icons btn btn-primary m-r-10" button-text="Add"
                                           on-click="_onAddAssetClick"></pebble-button>
                        </div>
                    </pebble-accordion>
                </div>
            </template>
    </template>
    <script>
        Polymer({
                is: 'rock-assets-manage',
                ready: function() {
                },
                attached: function() {
                    //console.log('attribute attached');
                },
                properties: {
                    /*
                     *  Indicates context data
                     */
                    contextData: {
                        type: Object,
                        value: function() {
                            return {};
                        }
                    },
                    configContext: {
                        type: Object,
                        value: function () {
                            return {};
                        }
                    },
                },
                observers: [
                    '_assetsConfigChanged(assetsGridConfigs,configContext)'
                ],
                behaviors: [
                    RUFBehaviors.UIBehavior,
                    RUFBehaviors.ComponentContextBehavior
                ],
                ready:function () {
                    this.assetsGridConfigs = this.getParentAppConfig('rock-relationship-manage', '', 'relationshipGridConfig');
                },
            _getAssetTypeTitle: function (asset) {
                if (asset) {
                    var config = this.assetsGridConfigs[asset];
                    if (config && config.title && config.title != "") {
                        return config.title;
                    }
                }
                return asset;
            },
            _assetsConfigChanged: function () {
                if (this.assetsGridConfigs && Object.keys(this.assetsGridConfigs).length) {
                    this._assets = Object.keys(this.assetsGridConfigs);
                    this.assetTypeList = undefined;
                    var assetType=this.configContext.assetTypeName;
                    if (assetType=="Assets") {
                        this.assetTypeList = this._assets;
                    } else {
                        this.assetTypeList = [assetType];
                    }
                }
            }
            });
    </script>
</dom-module>