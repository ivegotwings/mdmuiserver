<link rel="import" href="../../../bower_components/iron-icon/iron-icon.html">
<link rel="import" href="../../../bower_components/iron-icons/iron-icons.html">
<link rel="import" href="../../../bower_components/paper-icon-button/paper-icon-button.html">
<link rel="import" href="../rock-tag-item/rock-tag-item.html">

<!--
`rock-tags` Represents a group of tag items which together can form a selection.

@demo demo/index.html
-->
<dom-module id="rock-tags">
  <template>
    <style include="pebble-styles-shared"></style>
    <style>
       :host {
        display: inline-flex;
        /*padding: 1%;*/
        /*box-sizing: border-box;
        font-family: 'Roboto', 'Noto', sans-serif;*/
      }
      
      .clearfix:after {
        content: " ";
        display: block;
        height: 0;
        clear: both;
      }
    </style>
    <div>
      <template is="dom-repeat" items="{{tags}}" >
        <rock-tag-item  size="{{size}}" disable-delete="{{disableDelete}}" index="{{index}}" tag-color$="{{getTagColor(index)}}" options="{{item.options}}"
          name="{{item.name}}" long-name="{{item.longName}}" value="{{item.value}}" edit-mode="{{item.editMode}}" is-non-editable="{{isNonEditable}}"  icon="[[item.icon]]" src="[[item.src]]" display-type="{{item.displayType}}"></rock-tag-item>
      </template>
      <!--<template is="dom-if" if="{{enableAdd}}">
       <paper-input on-focusout="_focusOut" error-message="{{emptyErrorMessage}}" label="{{placeholder}}" on-keydown="_keyDown" value="{{input_value}}"></paper-input>
     </template>-->
    </div>
  </template>
  <script>

  Polymer({

    is: 'rock-tags',

    properties: {

      /**
       * Indicates the list of strings that holds tags. Values in this array must be identical. Avoid duplicates due to the definition of tags. Icons for individual tag can also be passed in this list.
       */
      tags:{
        type:Array,
        notify: true,
        value:function(){return []},
      },
      /**
        * Specifies whether or not the deletion of a tag is allowed.
       */
      disableDelete: {
        type: Boolean,
        value: false
      },
      /**
        * Specifies whether or not the value of the tag is editable.
       */
      isNonEditable: {
        type: Boolean,
        value: false
      },
       /**
        * Specifies whether or not adding more tags is allowed.
       */
      disableAdd: {
        type: Boolean,
        value: false
      },
      /**
        * Indicates the list of colors to be used in the tag. Order of color used is based on the index.
       */
      tagColors:{
       type: Array,
       notify: true,
       value: function(){return []}
      }
    },
    listeners: {
        'tag-item-remove': '_onTagItemRemove'
    },

    // Element Lifecycle

    ready: function() {
      // `ready` is called after all elements have been configured, but
      // propagates bottom-up. This element's children are ready, but parents
      // are not.
      //
      // This is the point where you should make modifications to the DOM (when
      // necessary), or kick off any processes the element wants to perform.
    },

    attached: function() {
      // `attached` fires once the element and its parents have been inserted
      // into a document.
      //
      // This is a good place to perform any work related to your element's
      // visual state or active behavior (measuring sizes, beginning animations,
      // loading resources, etc).
    },

    detached: function() {
      // The analog to `attached`, `detached` fires when the element has been
      // removed from a document.
      //
      // Use this to clean up anything you did in `attached`.
    },

    // Element Behavior
    /**
     * Used to add a new tag to the list.
     *
     * @param {JSON} the tag that needs to be added.
     */
    addTag: function(tag){
      if(!this.disableAdd) {
        if (typeof(this.tags) == 'undefined'){
          this.tags = [];
        }
        if (typeof tag != "object"){
          alert('bad tag object');
          return;
        }
        else {
          for(var i=0;i<this.tags.length;i++) {
            if(this.tags[i].name == tag.name) {
              alert(tag.name + ': tag alerady added');
              return;
            }
          }
        }

        this.push('tags', tag);
        // this.async(function() {
        //   if(tag.editMode) {
        //     var tagItem = this.$$('rock-tag-item[name='+tag.name+']');
        //     if(tagItem.$.input) {
        //       tagItem.$.input.$.inputElement.focus();
        //     }
        //   }
        //});
        // this.input_value = "";
      }
      
    },
    
    /**
     * Handler for 'tag-item-remove' event, which is fired when a <tag-item> is being removed.
     *
     * @param {Object} event object.
     */
    _onTagItemRemove: function(e) {
         this.splice('tags', e.detail.index, 1);
    },
    /**
     * Can be used to choose a colour to a tag.
     */
    getTagColor: function(index){
      var length=this.tagColors.length;
      if(length>0){
      var colorIndex= index % length;
      return this.tagColors[colorIndex];
      } else{
        return '';
      }
    }

  });

</script>
</dom-module>
