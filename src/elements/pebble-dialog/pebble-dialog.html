<link rel="import" href="../../../bower_components/polymer/polymer.html">
<link rel="import" href="../../../bower_components/paper-dialog/paper-dialog.html">
<link rel="import" href="../pebble-styles-shared/pebble-styles-shared.html">
<link rel="import" href="../bedrock-ui-behavior/bedrock-ui-behavior.html">

<!--
`<pebble-dialog>` Represents a dialog with material design styling and optional animations when it is
opened or closed. It provides styles for a header, content area, and an action area for buttons.

The following code implements a dialog with a header, scrolling content area, and
buttons. The focus is on the `dialog-confirm` button when the dialog is opened.

### Example
    <pebble-dialog>
      <h2>Header</h2>
        Lorem ipsum...
      <div class="buttons">
        <paper-button dialog-dismiss>Cancel</paper-button>
        <paper-button dialog-confirm autofocus>Accept</paper-button>
      </div>
    </pebble-dialog>

### Styling

Custom property    | Description              | Default
-------------------|-------------|-------------
`--dialog-layout`  | Mixin applied to #dialog | `{}`


@group pebble Elements
@element pebble-dialog
@demo demo/index.html
-->

<dom-module id="pebble-dialog">
    <template>
        <style include="pebble-styles-shared">
            #dialog {
                position: fixed;
                top: 25% !important;
                right: 0 !important;
                left: 0 !important;
                max-width: 70% !important;
                max-height: 100% !important;
                border-radius: 3px;
                border-top-left-radius: none;
                border-top-right-radius: none;
                box-shadow: 0 0 8px 0 rgba(0, 0, 0, 0.22);
                background-color: var(--popup-background-color);
                margin: 0 auto 30px auto !important;
                padding: 0 !important;
            }          

            .dialogTitle {
                position: relative;
                color: var(--popup-header-text-color, #ffffff);                
                background-color: var(--popup-header-color, #036bc3);                
                font-family: var(--default-font-family);
                height: 40px;
                font-size: var(--default-font-size, 14px) !important;       
                margin-top: 0!important;
                padding: 0 20px!important;
                line-height: 3.1!important;
            }
            
            #closeIcon {
                position: relative;
                color: var(--popup-header-text-color, #ffffff);
                float: right;
                right: 16px;
                top: -27px;
                margin-top: 0!important;
                padding: 0 !important;
                width: 16px;
            }

            #closeIcon pebble-button::shadow paper-button{
                min-width: auto;
            }

            .dialogContent {
                padding: 30px!important;
                margin: 0!important;
            }

            .buttons-wrap{
                padding: 0 30px 30px 30px!important;
                margin: 0!important;
                text-align: center;
            }
            :host(.opened){
                opacity: 0.4;
            }
        </style>
        <paper-dialog id="dialog" role="alertdialog" modal="[[modal]]" position-target="[[positionTarget]]" horizontal-align="[[horizontalAlign]]" vertical-align="[[verticalAlign]]"
            dynamic-align="[[dynamicAlign]]" no-overlap="[[noOverlap]]" vertical-offset="[[verticalOffset]]" horizontal-offset="[[horizontalOffset]]"
            no-cancel-on-outside-click="[[noCancelOnOutsideClick]]" no-cancel-on-esc-key="[[noCancelOnEscKey]]">
            <h2 class="dialogTitle">[[dialogTitle]]</h2>
            <!-- Close Dialog -->
            <template is="dom-if" if="[[showCloseIcon]]">
                <div id="closeIcon">
                    <pebble-button id="close" name="close" icon="pebble-md-icons:Clear" title="Remove" on-tap="_close" title="Close" class="icon pebble-md-icons"
                        role="button" tabindex="0" aria-disabled="false"></pebble-button>
                </div>
            </template>
            <div class="dialogContent"><slot></slot></div>                      
            <div class="buttons-wrap">
                <!-- Cancel Button -->
                <template is="dom-if" if="[[showCancel]]">
                    <pebble-button button-text="[[buttonCancelText]]" class="btn btn-secondary m-r-10" on-tap="_cancel" raised elevation="0"></pebble-button>                    
                </template> 
                 <!-- Ok Button -->
                <template is="dom-if" if="[[showOk]]">               
                    <pebble-button button-text="[[buttonOkText]]" class="btn btn-success" on-tap="_confirm" raised elevation="0"></pebble-button>                
                </template>                
            </div>          
        </paper-dialog>
    </template>
<script>
    Polymer({
        is: "pebble-dialog",

        properties: {
            /** 
            * Indicates the title of the dialog.
            */
            dialogTitle: {
                type: String,
                value: 'Title'
            },

            /**
              * Indicates whether or not the dialog is modal.
              * If it is set to <b>true</b>, then this implies no-cancel-on-outside-click, no-cancel-on-esc-key, and with-backdrop.
              */
            modal: {
                type: Boolean
            },

            /**
            * Indicates the orientation against which the element are aligned horizontally relative to the positionTarget.
            * The possible values are left, right, and auto.
            */
            horizontalAlign: {
                type: String
            },

            /**
            * Indicates the orientation against which the element are aligned vertically relative to the positionTarget.
            * The possible values are top, bottom, and auto.
            */
            verticalAlign: {
                type: String
            },

            /**
             * Indicates the alignment of dialog dynamically.
             * If it is set to <b>true</b>, then it uses horizontalAlign and verticalAlign values as preferred alignment.
             * If there is not enough space, then it picks the values which minimizes the cropping.
             */
            dynamicAlign: {
                type: Boolean,
            },


            /**
            * Indicates whether or not to position the element around the positionTarget without overlapping it.
            */
            noOverlap: {
                type: Boolean
            },

            /**
            * Indicates the element that is used to position the dialog control. If it is not set, then it defaults to the parent node.
            */
            positionTarget: {
                type: Element,
                observer: '_positionTargetChanged'
            },

            /**
            * Indicates the vertical positioning. It is same as setting margin-top and margin-bottom css properties. 
            */
            verticalOffset: {
                type: Number
            },

            /**
            * Indicates horizontal positioning. It is same as setting margin-left and margin-right css properties.
            */
            horizontalOffset: {
                type: Number
            },
            /**
            * Indicates property to disable cancelling the overlay by clicking outside it.
            */
            noCancelOnOutsideClick: {
                type: Boolean,
                value: false
            },
            /**
            * Indicates property to disable cancelling the overlay with the ESC key.
            */
            noCancelOnEscKey: {
                type: Boolean,
                value: false
            },

            /* Specifies whether or not the dailog close button can be shown.
             * If it is set to <b>true</b>, then the dialog close button is shown.
             */
            showCloseIcon: {
                type: Boolean,
                value: false
            },
            /* Specifies whether or not the `Ok` button is displayed on dailog.
             * If it is set to <b>true</b>, `Ok` button is displayed.
             */
            showOk: {
                type: Boolean,
                value: false
            },
            /**
            * Indcates the `Ok` button text if `showOk` is set to true.
            */
            buttonOkText: {
                type: String,
                value:'Yes'
            },
            /* Specifies whether or not the `Cancel` button is displayed on dailog.
             * If it is set to <b>true</b>, `Cancel` button is displayed.
             */
            showCancel: {
                type: Boolean,
                value: false
            },
            /**
            * Indcates the `Cancel` button text if `showCancel` is set to true.
            */
            buttonCancelText:{
                type: String,
                value: 'Cancel'
            },
            close:{
                notify:true,
                value: function () {
                    return this._close.bind(this);
                }
            }
        },

        behaviors: [
            RUFBehaviors.UIBehavior
        ],

        /*
         * Can be used to open the overlay.
         */
        open: function () {
            if(this.modal) {
                var body = document.querySelector('body');
                this.oldParentNode=this.parentNode;
                Polymer.dom(body).appendChild(this);
            }
            this.$.dialog.open();
        },

        _close: function () {
            if(this.modal) {
                this.oldParentNode.appendChild(this);
            }
            this.$.dialog.close();
        },

        _confirm: function (event) {
            var eventDetail = event;
            this.fireBedrockEvent("on-buttonok-clicked", eventDetail);
            this._close();
        },

        _cancel: function(event) {
            var eventDetail = event;
            this.fireBedrockEvent("on-buttoncancel-clicked", eventDetail);
            this._close();
        },
        _positionTargetChanged: function () {
            this.$.dialog.style.margin = "0px";
        },
    });
</script>
</dom-module>