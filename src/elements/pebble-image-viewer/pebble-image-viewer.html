<link rel="import" href="../../../bower_components/polymer/polymer.html">
<link rel="import" href="../../../bower_components/iron-image/iron-image.html">
<link rel="import" href="../pebble-dialog/pebble-dialog.html">
<link rel="import" href="../../../bower_components/paper-icon-button/paper-icon-button.html">

<!--
`pebble-image-viewer` represents an element for displaying an image that provides useful sizing and
preloading options not found on the standard `<img>` tag.

The `sizing` option allows the image to be either cropped (`cover`) or
letterboxed (`contain`) to fill a fixed user-size placed on the element.

The `preload` option prevents the browser from rendering the image until the
image is fully loaded.  In the interim, either the element's CSS `background-color`
can be be used as the placeholder, or the `placeholder` property can be
set to a URL (preferably a data-URI, for instant rendering) for an
placeholder image.

The `fade` option (only valid when `preload` is set) will cause the placeholder
image/color to be faded out once the image is rendered.

Examples:

  Basically identical to `<img src="...">` tag:

    <pebble-image-viewer src="http://lorempixel.com/400/400"></pebble-image-viewer>

  Will letterbox the image to fit:

    <pebble-image-viewer style="width:400px; height:400px;" sizing="contain"
      src="http://lorempixel.com/600/400"></pebble-image-viewer>

  Will crop the image to fit:

    <pebble-image-viewer style="width:400px; height:400px;" sizing="cover"
      src="http://lorempixel.com/600/400"></pebble-image-viewer>

  Will show light-gray background until the image loads:

    <pebble-image-viewer style="width:400px; height:400px; background-color: lightgray;"
      sizing="cover" preload src="http://lorempixel.com/600/400"></pebble-image-viewer>

  Will show a base-64 encoded placeholder image until the image loads:

    <pebble-image-viewer style="width:400px; height:400px;" placeholder="data:image/gif;base64,..."
      sizing="cover" preload src="http://lorempixel.com/600/400"></pebble-image-viewer>

  Will fade the light-gray background out once the image is loaded:

    <pebble-image-viewer style="width:400px; height:400px; background-color: lightgray;"
      sizing="cover" preload fade src="http://lorempixel.com/600/400"></pebble-image-viewer>

Custom property | Description | Default
----------------|-------------|----------
`--iron-image-placeholder` | Mixin applied to #placeholder | `{}`
`--pebble-image-width` | Sets the width of the wrapped image | `auto`
`--pebble-image-height` | Sets the height of the wrapped image | `auto`

@group pebble Elements
@element pebble-image-viewer
@demo demo/index.html
-->

<dom-module id="pebble-image-viewer">
  <template>
    <style>
      :host {
        display: inline-block;
        overflow: hidden;
        position: relative;
        --iron-image-width: var(--pebble-image-width);
        --iron-image-height: var(--pebble-image-height);
      }

      --iron-image-placeholder: {
        apply(--pebble-image-plcaeholder);
      }

      #img {
          width: var(--pebble-image-width, 100%);
          height: var(--pebble-image-height, 100%);
      }

      #img:hover {opacity: 0.7;}

      /* Modal Content (image) */
      .modal-content {
          margin: auto;
          display: block;
          width: 80%;
          max-width: 700px;
          max-height: auto;
      }

      @-webkit-keyframes zoom {
          from {-webkit-transform:scale(0)}
          to {-webkit-transform:scale(1)}
      }

      @keyframes zoom {
          from {transform:scale(0)}
          to {transform:scale(1)}
      }

      /* The Close Button */
      .close {
          position: absolute;
          top: 2px;
          right: 2px;
          color: #f1f1f1;
          font-size: 40px;
          font-weight: bold;
          transition: 0.3s;
      }

      .close:hover,
      .close:focus {
          color: #bbb;
          text-decoration: none;
          cursor: pointer;
      }

      /* 100% Image Width on Smaller Screens */
      @media only screen and (max-width: 700px){
          .modal-content {
              width: 100%;
          }
      }
    </style>

      <iron-image id='img'


      alt="[[alt]]" error="{{error}}" fade="[[fade]]" height="[[height]]" loaded="{{loaded}}" loading="{{loading}}" 
      placeholder="[[placeholder]]" position="[[position]]" preload="[[preload]]" prevent-load="[[preventLoad]]" 
      sizing="[[sizing]]" src="[[src]]" width="[[width]]"></iron-image>

      <pebble-dialog id="pebbleModal">
        <!--<paper-icon-button icon="close" dialog-confirm></paper-icon-button>-->
        <span class="close" dialog-confirm>Ã—</span>
        <img class="modal-content" id="bigImage" sizing="contain">
    </pebble-dialog>
  </template>

  <script>
    Polymer({
      is: 'pebble-image-viewer',

      properties: {
        /**
         * Represents the URL of a primary image.
         * @type String
         * @default null
         */
        src: {
          type: String,
          value: null
        },

        /**
         * Represents a short text alternative for the image.
         * @type String
         * @default null
         */
        alt: {
          type: String,
          value: null
        },

        /**
         * Indicates preventing image from loading.
         * When true, the image is prevented from loading and any placeholder is
         * shown.  This may be useful when a binding to the src property is known to
         * be invalid, to prevent 404 requests.
         * @type Boolean
         * @default false
         */
        preventLoad: {
          type: Boolean,
          value: false
        },

        /**
         * Indicates sizing option for the image. Valid values are `contain` (full
         * aspect ratio of the image is contained within the element and
         * letterboxed) or `cover` (image is cropped in order to fully cover the
         * bounds of the element), or `null` (default: image takes natural size).
         * @type String
         * @default null
         */
        sizing: {
          type: String,
          value: null,
          reflectToAttribute: true
        },

        /**
         * Indicates property to enable preloading of image.
         * When `true`, any change to the `src` property will cause the `placeholder`
         * image to be shown until the new image has loaded.
         * @type Boolean
         * @default false
         */
        preload: {
          type: Boolean,
          value: false
        },

        /**
         * Represents a place holder to place a background image.
         * This image will be used as a background/placeholder until the src image has
         * loaded.  Use of a data-URI for placeholder is encouraged for instant rendering.
         * @type String
         * @default null
         */
        placeholder: {
          type: String,
          value: null
        },

        /**
         * Represents an animation kind effect during image loads.
         * When `preload` is true, setting `fade` to true will cause the image to
         * fade into place.
         * @type Boolean
         * @default false
         */
        fade: {
          type: Boolean,
          value: false
        },

        /**
         * Represents value that is true when the image is loaded.
         * @type Boolean
         * @default false 
         */
        loaded: {
          notify: true,
          type: Boolean,
          value: false
        },

        /**
         * Represents value that tracks the loading state of the image when the `preload`
         * option is used.
         * @type Boolean
         * @default false
         */
        loading: {
          notify: true,
          type: Boolean,
          value: false
        },

        /**
         * Represents value that indicates that the last set `src` failed to load.
         * @type Boolean
         * @default false
         */
        error: {
          notify: true,
          type: Boolean,
          value: false
        },

        /**
         * Property can be used to set the width of image (e.g. via binding); size may also be
         * set via CSS.
         * @type number
         * @default null
         */
        width: {
          type: Number
        },

        /**
         * Property can be used to set the height of image (e.g. via binding); size may also be
         * set via CSS.
         *
         * @attribute height
         * @type number
         * @default null
         */
        height: {
          type: Number
        },

        /**
         * This Property can be used to set the outline of the image thumbnail e.g circle or box.
         * only "circle" is valid value for this. default is null.
         * if it is null, out line would be box based on the thumbnail dimensions and element style.
         *
         * @attribute shape
         * @type String
         * @default null
         */
        shape: {
            type: String,
            value: null,
            observer: '_shapeChanged'
        },

        /**
         * Indicates the URL of the background image for primary image.
         * once clicked on thumbnail, Back ground image pops up
         * thumbnail is clickable if and only is background image source is provided.
         *
         * @attribute shape
         * @type String
         * @default null
         */
        bigImageSrc: {
            observer: '_bigImageSrcChanged',
            type: String,
            value: null
        },

        /**
         * Represents the supposed alignment of background image with the primary image place holder. 
         * Valid values are "topleft", "topright", "bottomleft", "bottomright".
         * Position will be set as value implies.
         * If null, image will popup at center with no-cancel-on-outside-click, no-cancel-on-esc-key and with-backdrop.
         * Use `--dailog-layout` mixin to set the back ground image size & styles.
         * @attribute alignment
         * @type String
         * @default null
         */
        alignment: {
          type: String,
          value: 'null',
          observer: '_alignmentChanged'
        }
      },

      _shapeChanged: function() {
          if(this.shape == "circle"){
              this.style.borderRadius = "50%"
              this.$.img.style.borderRadius = "50%";
            }
         else{
            this.style.borderRadius = "";
            this.$.img.style.borderRadius = "";
            }
        },

        _bigImageSrcChanged: function() {
            if(this.bigImageSrc){
                var modal = this.$.pebbleModal;
                this.$.bigImage.src = this.bigImageSrc;
                this.$.img.style.cursor = "pointer";
                this.$.img.onclick = function() {
                    modal.open();
                }
            }
        },

        _alignmentChanged: function() {
          var modal = this.$.pebbleModal;
          modal.noOverlap = true;
          modal.positionTarget = this
          if(this.alignment == "bottomleft"){
            modal.verticalAlign = "top";
            modal.horizontalAlign = "left";
          }
          else if(this.alignment == "bottomright"){
            modal.verticalAlign = "top";
            modal.horizontalAlign = "right";
          }
          else if(this.alignment == "topleft"){
            modal.verticalAlign = "bottom";
            modal.horizontalAlign = "left";
          }
          else if(this.alignment == "topright"){
            modal.verticalAlign = "bottom";
            modal.horizontalAlign = "right";
          }
          else{
            modal.positionTarget = null;
            modal.modal = true;
          }
        }
    });
  </script>
</dom-module>
