<link rel="import" href="../../../bower_components/polymer/polymer.html">
<link rel="import" href="../../../bower_components/iron-image/iron-image.html">
<link rel="import" href="../../../bower_components/paper-icon-button/paper-icon-button.html">
<link rel="import" href="../pebble-dialog/pebble-dialog.html">

<!--
`pebble-image-viewer` Represents an element for displaying an image that provides useful sizing and
preloading options that are not found on the standard `<img>` tag.

The `sizing` option allows the image to be either cropped (`cover`) or
letterboxed (`contain`) to fill a fixed user-size placed on the element.

The `preload` option prevents the browser from rendering the image until the
image is fully loaded.  In the interim, for an
placeholder image, either the element's CSS `background-color` can be used 
or the `placeholder` property can be set to a URL.
Preferably a data-URI can be used for instant rendering.

The `fade` option, which is valid only when `preload` is set, causes the placeholder's
image or color to be faded out once the image is rendered.

### Example

  Following example is identical to `<img src="...">` tag:

    <pebble-image-viewer src="http://lorempixel.com/400/400"></pebble-image-viewer>

  Following example letterboxes the image to fit:

    <pebble-image-viewer style="width:400px; height:400px;" sizing="contain"
      src="http://lorempixel.com/600/400"></pebble-image-viewer>

  Following example crops the image to fit:

    <pebble-image-viewer style="width:400px; height:400px;" sizing="cover"
      src="http://lorempixel.com/600/400"></pebble-image-viewer>

  Following example shows the background with light-gray color until the image loads:

    <pebble-image-viewer style="width:400px; height:400px; background-color: lightgray;"
      sizing="cover" preload src="http://lorempixel.com/600/400"></pebble-image-viewer>

  Following example shows a base-64 encoded placeholder image until the image loads:

    <pebble-image-viewer style="width:400px; height:400px;" placeholder="data:image/gif;base64,..."
      sizing="cover" preload src="http://lorempixel.com/600/400"></pebble-image-viewer>

  Following example fades the light-gray background out once the image is loaded:

    <pebble-image-viewer style="width:400px; height:400px; background-color: lightgray;"
      sizing="cover" preload fade src="http://lorempixel.com/600/400"></pebble-image-viewer>

### Styling

Custom property | Description | Default
----------------|-------------|----------
`--iron-image-placeholder` | Mixin applied to #placeholder | `{}`
`--pebble-image-width` | Sets the width of the wrapped image | `auto`
`--pebble-image-height` | Sets the height of the wrapped image | `auto`

@group pebble Elements
@element pebble-image-viewer
@demo demo/index.html
-->

<dom-module id="pebble-image-viewer">
  <template>
    <style>
      :host {
        display: inline-block;
        overflow: hidden;
        position: relative;
        --iron-image-width: var(--pebble-image-width);
        --iron-image-height: var(--pebble-image-height);
      }

      --iron-image-placeholder: {
        apply(--pebble-image-plcaeholder);
      }

      #img {
          width: var(--pebble-image-width, 100%);
          height: var(--pebble-image-height, 100%);
      }

      #img:hover {opacity: 0.7;}

      /* Modal Content (image) */
      .modal-content {
          margin: auto;
          display: block;
          width: 80%;
          max-width: 700px;
          max-height: auto;
      }

      @-webkit-keyframes zoom {
          from {-webkit-transform:scale(0)}
          to {-webkit-transform:scale(1)}
      }

      @keyframes zoom {
          from {transform:scale(0)}
          to {transform:scale(1)}
      }

      /* The Close Button */
      .close {
          position: absolute;
          top: 2px;
          right: 2px;
          color: #f1f1f1;
          font-size: 40px;
          font-weight: var(--font-bold, bold);
          transition: 0.3s;
      }

      .close:hover,
      .close:focus {
          color: #bbb;
          text-decoration: none;
          cursor: pointer;
      }

      /* 100% Image Width on Smaller Screens */
      @media only screen and (max-width: 700px){
          .modal-content {
              width: 100%;
          }
      }
    </style>

      <iron-image id='img'
      alt="[[alt]]" error="{{error}}" fade="[[fade]]" height="[[height]]" loaded="{{loaded}}" loading="{{loading}}" 
      placeholder="[[placeholder]]" position="[[position]]" preload="[[preload]]" prevent-load="[[preventLoad]]" 
      sizing="[[sizing]]" src="[[src]]" width="[[width]]"></iron-image>

      <pebble-dialog id="pebbleModal" show-ok show-cancel show-close-icon> 
        <!--<paper-icon-button icon="close" dialog-confirm></paper-icon-button>-->
        <span class="close" dialog-confirm>Ã—</span>
        <img class="modal-content" id="bigImage" sizing="contain">
    </pebble-dialog>
  </template>

  <script>
    Polymer({
      is: 'pebble-image-viewer',

      properties: {
        /**
         * Indicates the URL of a primary image.
         * @type String
         * @default null
         */
        src: {
          type: String,
          value: null
        },

        /**
         * Indicates a short text that is alternative for an image.
         * @type String
         * @default null
         */
        alt: {
          type: String,
          value: null
        },

        /**
         * Specifies whether or not image is prevented from loading.
         * If it is set to <b>true</b>, then the image is prevented from loading and any placeholder is
         * shown. This may be useful to prevent 404 requests when binding to the src property that is 
         * known to be invalid.
         * @type Boolean
         * @default false
         */
        preventLoad: {
          type: Boolean,
          value: false
        },

        /**
         * Indicates the sizing option for the image. Valid values are `contain` or `cover` or `null`. 
         * If the value is `contain`,then the full aspect ratio of the image is contained within the 
         * element and is letterboxed. If the value is `cover`, then the image is cropped in order to 
         * fully cover the bounds of the element. If the value is `null`, then the image takes natural size.
         * @type String
         * @default null
         */
        sizing: {
          type: String,
          value: null,
          reflectToAttribute: true
        },

       /**
         * Specifies whether or not preloading of image is enabled.
         * If it is set to <b>true</b>, then any change to the `src` property causes the `placeholder`
         * image to be shown until the new image is loaded.
         * @type Boolean
         * @default false
         */
        preload: {
          type: Boolean,
          value: false
        },

        /**
         * Indicates a placeholder to place a background image.
         * This image is used as a background or placeholder until the src image is
         * loaded.  Use of a data-URI for placeholder is encouraged for instant rendering.
         * @type String
         * @default null
         */
        placeholder: {
          type: String,
          value: null
        },

        /**
         * Specifies whether or not image load has an animation.
         * If it is set to <b>true</b>, then it causes an image to
         * fade into place.
         * @type Boolean
         * @default false
         */
        fade: {
          type: Boolean,
          value: false
        },

        /**
         * Specifies whether or not an image is loaded.
         * If it is set to <b>true</b>, then the image is loaded.
         * @type Boolean
         * @default false 
         */
        loaded: {
          notify: true,
          type: Boolean,
          value: false
        },

        /**
         * Indicates a value that tracks the loading state of the image when the `preload`
         * option is used.
         * @type Boolean
         * @default false
         */
        loading: {
          notify: true,
          type: Boolean,
          value: false
        },

        /**
         * Specifies that the last set `src` is failed to load.
         * @type Boolean
         * @default false
         */
        error: {
          notify: true,
          type: Boolean,
          value: false
        },

        /**
         * Indicates the width of image. It can be specified via binding or via CSS.
         * @type number
         * @default null
         */
        width: {
          type: Number
        },

        /**
         * Indicates the height of image. It can be specified via binding or via CSS. 
         * set via CSS.
         *
         * @attribute height
         * @type number
         * @default null
         */
        height: {
          type: Number
        },

        /**
         * Indicates the outline of the image thumbnail.
         * Only `circle` is valid value for this.
         * If it is set to <b>null</b>, then the outline is box based on the thumbnail dimensions and element style.
         * @attribute shape
         * @type String
         * @default null
         */
        shape: {
            type: String,
            value: null,
            observer: '_shapeChanged'
        },

        /**
         * Indicates the URL of the background image for primary image.
         * Background image pops up once thumbnail is clicked. 
         * Thumbnail is clickable if background image source is provided.
         * @attribute shape
         * @type String
         * @default null
         */
        bigImageSrc: {
            observer: '_bigImageSrcChanged',
            type: String,
            value: null
        },

        /**
         * Indicates the expected alignment of background image with the primary image place holder. 
         * Valid values are `topleft`, `topright`, `bottomleft`, and `bottomright`.
         * Position is set according to the implied value.
         * If it is set to <b>null</b>, then the image pop-ups at center with `no-cancel-on-outside-click`, `no-cancel-on-esc-key`, and `with-backdrop`.
         * Use `--dailog-layout` mixin to set the background image size & styles.
         * @attribute alignment
         * @type String
         * @default null
         */
        alignment: {
          type: String,
          value: 'null',
          observer: '_alignmentChanged'
        }
      },

      _shapeChanged: function() {
          if(this.shape == "circle"){
              this.style.borderRadius = "50%"
              this.$.img.style.borderRadius = "50%";
            }
         else{
            this.style.borderRadius = "";
            this.$.img.style.borderRadius = "";
            }
        },

        _bigImageSrcChanged: function() {
            if(this.bigImageSrc){
                var modal = this.$.pebbleModal;
                this.$.bigImage.src = this.bigImageSrc;
                this.$.img.style.cursor = "pointer";
                this.$.img.onclick = function() {
                    modal.open();
                }
            }
        },

        _alignmentChanged: function() {
          var modal = this.$.pebbleModal;
          modal.noOverlap = true;
          modal.positionTarget = this
          if(this.alignment == "bottomleft"){
            modal.verticalAlign = "top";
            modal.horizontalAlign = "left";
          }
          else if(this.alignment == "bottomright"){
            modal.verticalAlign = "top";
            modal.horizontalAlign = "right";
          }
          else if(this.alignment == "topleft"){
            modal.verticalAlign = "bottom";
            modal.horizontalAlign = "left";
          }
          else if(this.alignment == "topright"){
            modal.verticalAlign = "bottom";
            modal.horizontalAlign = "right";
          }
          else{
            modal.positionTarget = null;
            modal.modal = true;
          }
        }
    });
  </script>
</dom-module>
