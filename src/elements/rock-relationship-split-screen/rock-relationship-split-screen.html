<link rel="import" href="../../../bower_components/polymer/polymer.html">

<link rel="import" href="../pebble-button/pebble-button.html">
<link rel="import" href="../pebble-icon/pebble-icon.html">
<link rel="import" href="../pebble-vertical-divider/pebble-vertical-divider.html">
<link rel="import" href="../pebble-styles-shared/pebble-styles-shared.html">

<link rel="import" href="../rock-relationship-manage/rock-relationship-manage.html">

<dom-module id="rock-relationship-split-screen">
	<template>
		<style>
			.relationship-grid {
				display: inline-flex;
				display: -webkit-inline-flex;
				/*border: 1px solid black;*/
			}
			
			.relationship-grid-1 {
				width: 100%;
			}
			
			.relationship-grid-2 {
				width: 49%;
			}
			
			.relationship-grid-3 {
				width: 33%;
			}
			
			.relationship-grid-4 {
				width: 24%;
			}
			
			.dimension {
				width: 100%;
				@apply(--layout);
				@apply(--layout-horizontal);
				border-bottom: 1px solid #ccc;
			}
			
			#actions {
				--pebble-button: {
					height: 30px;
					padding: 1em 0em 1em 0.2em;
					color: #212121;
					border: 1px solid #C1CAD4;
					font-size: small;
					margin-left: -3px;
				}
			}
			
			#dimensionValueContainer {
				margin-left: 20px;
				margin-top: auto;
			}
			
			pebble-icon {
				color: #ff4081;
			}
			
			.relationshipGrid {
				width: 100%;
			}
			
			.divider {
				width: 2%;
			}
			
			pebble-vertical-divider {
				--pebble-vertical-divider-color: #1a2028;
				height: 100%;
				border: 0px;
				min-height: 0px;
			}
		</style>
		<template is="dom-if" if="[[_showListTitles]]">
			<div class="dimension" style$="[[_getStyle(noOfScreens)]]">
				<template is="dom-repeat" items="[[lists]]" as="list">
					<div id="catalogDimensionValueContainer" class$="[[_getRelationshipListClass(noOfScreens)]]">
						<pebble-icon icon="pebble-icons:Language"></pebble-icon>
						[[list.title]]
					</div>
				</template>
			</div>
			<div align="right">
				<pebble-button id="actions" icon="pebble-icons:Done" button-text="Actions" noink elevation="2" dropdown-icon on-tap="_onActionsTap"></pebble-button>
			</div>
		</template>
		<template is="dom-if" if="[[_showSourceTitles]]">
			<template is="dom-repeat" items="[[sources]]" as="source">
				<div id="sourceDimensionValueContainer" class$="[[_getRelationshipListClass(noOfScreens)]]">
					<pebble-icon icon="pebble-icons:Language"></pebble-icon>
					[[source.title]]
				</div>
			</template>
			<div align="right">
				<pebble-button id="actions" icon="pebble-icons:Done" button-text="Actions" noink elevation="2" dropdown-icon on-tap="_onActionsTap"></pebble-button>
			</div>
		</template>
		<template is="dom-if" if="[[_showLocaleTitles]]">
			<template is="dom-repeat" items="[[locales]]" as="locale">
				<div id="localeDimensionValueContainer" class$="[[_getRelationshipListClass(noOfScreens)]]">
					<pebble-icon icon="pebble-icons:Language"></pebble-icon>
					[[locale.title]]
				</div>
			</template>
			<div align="right">
				<pebble-button id="actions" icon="pebble-icons:Done" button-text="Actions" noink elevation="2" dropdown-icon on-tap="_onActionsTap"></pebble-button>
			</div>
		</template>
		<template is="dom-if" if="[[_showLists]]">
			<template is="dom-repeat" items="[[lists]]" as="list">
				<div class$="[[_getRelationshipListClass(noOfScreens)]]">
					<div class="relationshipGrid">
						<rock-relationship-manage entity-id="[[entityId]]" mode="[[mode]]" no-of-columns="[[noOfColumns]]" locale="[[locale]]" context="[[context]]" source="[[source]]"
										list="[[list.value]]"></rock-relationship-manage>
					</div>
					<div class="divider" style$="[[_getStyle(noOfScreens)]]" align="right">
						<pebble-vertical-divider></pebble-vertical-divider>
					</div>
				</div>
			</template>
		</template>
		<template is="dom-if" if="[[_showSources]]">
			<template is="dom-repeat" items="[[sources]]" as="source">
				<div class$="[[_getRelationshipListClass(noOfScreens)]]">
					<div class="relationshipGrid">
						<rock-relationship-manage entity-id="[[entityId]]" mode="[[mode]]" no-of-columns="[[noOfColumns]]" locale="[[locale]]" context="[[context]]" source="[[source.value]]"
										list="[[list]]"></rock-relationship-manage>
					</div>
					<div class="divider" style$="[[_getStyle(noOfScreens)]]" align="right">
						<pebble-vertical-divider></pebble-vertical-divider>
					</div>
				</div>
			</template>
		</template>
		<template is="dom-if" if="[[_showLocales]]">
			<template is="dom-repeat" items="[[locales]]" as="locale">
				<div class$="[[_getRelationshipListClass(noOfScreens)]]">
					<div class="relationshipGrid">
						<rock-relationship-manage entity-id="[[entityId]]" mode="[[mode]]" no-of-columns="[[noOfColumns]]" locale="[[locale.value]]" context="[[context]]" source="[[source]]"
										list="[[list]]"></rock-relationship-manage>
					</div>
					<div class="divider" style$="[[_getStyle(noOfScreens)]]" align="right">
						<pebble-vertical-divider></pebble-vertical-divider>
					</div>
				</div>
			</template>
		</template>
	</template>
	<script>
		Polymer({
			is: "rock-relationship-split-screen",
			created: function () {
				if (this.verbose){
					console.log('relationship split screen created');
				}
			},
			attached: function () {
				if (this.verbose){
					console.log('relationship split screen attached');
				}
			},
			ready: function () {
				if (this.verbose){
					console.log('relationship split screen ready');
				}
			},
			properties: {
				/**
				 * Indicates the context parameters for which the relationship data has to be managed.
				 * JSON sample to be added here.
				 */
				context: {
					type: Object,
					value: function () {
						return {};
					}
				},
				/**
				 * Indictaes Id of the entity for which the relationship have to be managed.
				 */
				entityId: {
					type: String
				},
				/**
				 * Indicates whether the relationship should be rendered in edit mode or view mode. 
				 * The two possible values are <b>view</b> and <b>edit</b>.
				 */
				mode: {
					type: String,
				},
				/**
				 * Indicates the number of screens in which the relationship grid should be rendered. Possible values are 1, 2 and 3.
				 */
				noOfScreens: {
					type: Number,
					computed: '_computeScreens(lists, sources, locales)'
				},
				/**
				 * Indicates the number of columns in which the relationship should be rendered. Possible values are 1, 2 and 3.
				 */
				noOfColumns: {
					type: Number,
					value: 2,
					computed: '_computeColumns(noOfScreens)'
				},
				/**
				 * Indictaes the list for which the relationship have to be managed.
				 */
				list: {
					type: String
				},
				/**
				 * Indictaes the array of list values selected from dimension selector.
				 */
				lists: {
					type: Array,
					value: function () {
						return [];
					}
				},
				 /**
				 * Indictaes the source dimension for which the relationship have to be managed.
				 */
				source: {
					type: String
				},
				 /**
				 * Indictaes the array source values selected from dimension selector.
				 */
				sources: {
					type: Array,
					value: function () {
						return [];
					}
				},
				/**
				 * Indictaes the locale dimension for which the relationship have to be managed.
				 */
				locale: {
					type: String
				},
				/**
				 * Indictaes the array locale values selected from dimension selector.
				 */
				locales: {
					type: Array,
					value: function () {
						return [];
					}
				},

				_showLists: {
					type: Boolean,
					value: false
				},

				_showListTitles: {
					type: Boolean,
					value: false
				},

				_showSources: {
					type: Boolean,
					value: false
				},

				_showSourceTitles: {
					type: Boolean,
					value: false
				},

				_showLocales: {
					type: Boolean,
					value: false
				},

				_showLocaleTitles: {
					type: Boolean,
					value: false
				},
				/**
				 * Indicates whether to write logs or not.
				 */
				verbose: {
					type: Boolean,
					value: false
				}
			},
			/**
			 * Can be used to get if the element is dirty
			 */
			getIsDirty: function () {
				var relManage = this.$$("rock-relationship-manage");
				if (relManage && relManage.getIsDirty) {
					return relManage.getIsDirty();
				}
			},
			_getStyle: function (n) {
				if (n == 1) {
					return "display: none";
				} else {
					return "";
				}
			},
			_getRelationshipListClass: function (n) {
				return "relationship-grid relationship-grid-" + n;
			},
			_computeScreens: function (lists, sources, locales) {
				if (lists && lists.length > 1) {
					this._showLists = true;
					this._showSources = !this._showLists;
					this._showLocales = !this._showLists;
					this._showListTitles = this._showLists;
					return lists.length;
				}

				if (sources && sources.length > 1) {
					this._showSources = true;
					this._showLists = !this._showSources;
					this._showLocales = !this._showSources;
					this._showSourceTitles = this._showSources;
					return sources.length;
				}

				if (locales && locales.length > 1) {
					this._showLocales = true;
					this._showLists = !this._showLocales;
					this._showSources = !this._showLocales;
					this._showLocaleTitles = this._showLocales;
					return locales.length;
				}

				this._showLists = true;
			},
			_computeColumns: function (noOfScreens) {
				if (noOfScreens > 1) {
					return 1;
				} else {
					return this.noOfColumns;
				}
			},
			_getStyle: function (n) {
				if (n == 1) {
					return "display: none";
				} else {
					return "";
				}
			},
			_isHidden: function (item) {
				var index = this.locales.indexOf(item);
				if (index == this.noOfScreens - 1) {
					return true;
				}
				return false;
			},
			_onActionsTap: function () {
				alert("actions tapped");
			}
		});
	</script>
</dom-module>