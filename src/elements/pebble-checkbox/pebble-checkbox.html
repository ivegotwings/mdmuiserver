
<link rel="import" href="../../../bower_components/polymer/polymer.html">
<link rel="import" href="../../../bower_components/paper-styles/default-theme.html">
<link rel="import" href="../../../bower_components/paper-behaviors/paper-checked-element-behavior.html">

<!--

`pebble-checkbox` is a button that can be either checked or unchecked. There is an indeterminate state also which can be shown by passing attribute indeterminate as true.

Example:

    <pebble-checkbox>label</pebble-checkbox>

    <pebble-checkbox checked> label</pebble-checkbox>

    <pebble-checkbox indeterminate> label</pebble-checkbox>

### Styling

The following custom properties and mixins are available for styling:

Custom property | Description | Default
----------------|-------------|----------
`--pebble-checkbox-unchecked-background-color` | Checkbox background color when the input is not checked | `transparent`
`--pebble-checkbox-unchecked-color` | Checkbox border color when the input is not checked | `--primary-text-color`
`--pebble-checkbox-unchecked-ink-color` | Selected/focus ripple color when the input is not checked | `--primary-text-color`
`--pebble-checkbox-checked-color` | Checkbox color when the input is checked | `--primary-color`
`--pebble-checkbox-checked-ink-color` | Selected/focus ripple color when the input is checked | `--primary-color`
`--pebble-checkbox-checkmark-color` | Checkmark color | `white`
`--pebble-checkbox-label-color` | Label color | `--primary-text-color`
`--pebble-checkbox-label-checked-color` | Label color when the input is checked | `--pebble-checkbox-label-color`
`--pebble-checkbox-label-spacing` | Spacing between the label and the checkbox | `8px`
`--pebble-checkbox-label` | Mixin applied to the label | `{}`
`--pebble-checkbox-label-checked` | Mixin applied to the label when the input is checked | `{}`
`--pebble-checkbox-error-color` | Checkbox color when invalid | `--error-color`
`--pebble-checkbox-size` | Size of the checkbox | `18px`
`--pebble-checkbox-ink-size` | Size of the ripple | `48px`
`--pebble-checkbox-margin` | Margin around the checkbox container | `initial`
`--pebble-checkbox-vertical-align` | Vertical alignment of the checkbox container | `middle`


@demo demo/index.html
-->

<dom-module id="pebble-checkbox">
    <template strip-whitespace>
        <style>
            :host {
                display: inline-block;
                white-space: nowrap;
                cursor: pointer;
                --calculated-pebble-checkbox-size: var(--pebble-checkbox-size, 18px);
                /* -1px is a sentinel for the default and is replaced in `attached`. */
                --calculated-pebble-checkbox-ink-size: var(--pebble-checkbox-ink-size, -1px);
                @apply(--paper-font-common-base);
                line-height: 0;
                -webkit-tap-highlight-color: transparent;
            }

            :host([hidden]) {
                display: none !important;
            }

            :host(:focus) {
                outline: none;
            }

            .hidden {
                display: none;
            }

            #checkboxContainer {
                display: inline-block;
                position: relative;
                width: var(--calculated-pebble-checkbox-size);
                height: var(--calculated-pebble-checkbox-size);
                min-width: var(--calculated-pebble-checkbox-size);
                margin: var(--pebble-checkbox-margin, initial);
                vertical-align: var(--pebble-checkbox-vertical-align, middle);
                background-color: var(--pebble-checkbox-unchecked-background-color, transparent);
            }

            #ink {
                position: absolute;

                /* Center the ripple in the checkbox by negative offsetting it by
                 * (inkWidth - rippleWidth) / 2 */
                top: calc(0px - (var(--calculated-pebble-checkbox-ink-size) - var(--calculated-pebble-checkbox-size)) / 2);
                left: calc(0px - (var(--calculated-pebble-checkbox-ink-size) - var(--calculated-pebble-checkbox-size)) / 2);
                width: var(--calculated-pebble-checkbox-ink-size);
                height: var(--calculated-pebble-checkbox-ink-size);
                color: var(--pebble-checkbox-unchecked-ink-color, var(--primary-text-color));
                opacity: 0.6;
                pointer-events: none;
            }

            :host-context([dir="rtl"]) #ink {
                right: calc(0px - (var(--calculated-pebble-checkbox-ink-size) - var(--calculated-pebble-checkbox-size)) / 2);
                left: auto;
            }

            #ink[checked] {
                color: var(--pebble-checkbox-checked-ink-color, var(--primary-color));
            }

            #checkbox {
                position: relative;
                box-sizing: border-box;
                height: 100%;
                border: solid 2px;
                border-color: var(--pebble-checkbox-unchecked-color, var(--primary-text-color));
                border-radius: 2px;
                pointer-events: none;
                -webkit-transition: background-color 140ms, border-color 140ms;
                transition: background-color 140ms, border-color 140ms;
            }

            /* checkbox checked animations */
            #checkbox.checked #checkmark {
                -webkit-animation: checkmark-expand 140ms ease-out forwards;
                animation: checkmark-expand 140ms ease-out forwards;
            }

            @-webkit-keyframes checkmark-expand {
                0% {
                    -webkit-transform: scale(0, 0) rotate(45deg);
                }
                100% {
                    -webkit-transform: scale(1, 1) rotate(45deg);
                }
            }

            @keyframes checkmark-expand {
                0% {
                    transform: scale(0, 0) rotate(45deg);
                }
                100% {
                    transform: scale(1, 1) rotate(45deg);
                }
            }

            #checkbox.checked {
                background-color: var(--pebble-checkbox-checked-color, var(--primary-color));
                border-color: var(--pebble-checkbox-checked-color, var(--primary-color));
            }

            #checkmark {
                position: absolute;
                width: 36%;
                height: 70%;
                border-style: solid;
                border-top: none;
                border-left: none;
                border-right-width: calc(2/15 * var(--calculated-pebble-checkbox-size));
                border-bottom-width: calc(2/15 * var(--calculated-pebble-checkbox-size));
                border-color: var(--pebble-checkbox-checkmark-color, white);
                -webkit-transform-origin: 97% 86%;
                transform-origin: 97% 86%;
                box-sizing: content-box; /* protect against page-level box-sizing */
            }

            :host-context([dir="rtl"]) #checkmark {
                -webkit-transform-origin: 50% 14%;
                transform-origin: 50% 14%;
            }

            /* label */
            #checkboxLabel {
                position: relative;
                display: inline-block;
                vertical-align: middle;
                padding-left: var(--pebble-checkbox-label-spacing, 8px);
                white-space: normal;
                line-height: normal;
                color: var(--pebble-checkbox-label-color, var(--primary-text-color));
                @apply(--pebble-checkbox-label);
            }

            :host([checked]) #checkboxLabel {
                color: var(--pebble-checkbox-label-checked-color, var(--pebble-checkbox-label-color, var(--primary-text-color)));
                @apply(--pebble-checkbox-label-checked);
            }

            :host-context([dir="rtl"]) #checkboxLabel {
                padding-right: var(--pebble-checkbox-label-spacing, 8px);
                padding-left: 0;
            }

            #checkboxLabel[hidden] {
                display: none;
            }

            /* disabled state */

            :host([disabled]) #checkbox {
                opacity: 0.5;
                border-color: var(--pebble-checkbox-unchecked-color, var(--primary-text-color));
            }

            :host([disabled][checked]) #checkbox {
                background-color: var(--pebble-checkbox-unchecked-color, var(--primary-text-color));
                opacity: 0.5;
            }

            :host([disabled]) #checkboxLabel  {
                opacity: 0.65;
            }

            /* invalid state */
            #checkbox.invalid:not(.checked) {
                border-color: var(--pebble-checkbox-error-color, var(--error-color));
            }
            /* checkbox indeterminate animations */
            #checkbox.checked #indeterminatemark {
                -webkit-animation: indeterminatemark-expand 140ms ease-out forwards;
                animation: indeterminatemark-expand 140ms ease-out forwards;
            }

            @-webkit-keyframes indeterminatemark-expand {
                0% {
                    -webkit-transform: scale(0, 0) rotate(180deg);
                }
                100% {
                    -webkit-transform: scale(1, 1) rotate(180deg);
                }
            }
            @keyframes indeterminatemark-expand {
                0% {
                    transform: scale(0, 0) rotate(180deg);
                }
                100% {
                    transform: scale(1, 1) rotate(180deg);
                }
            }
            #indeterminatemark {
                position: absolute;
                width: 60%;
                height: 0;
                border-style: solid;
                border-top: none;
                border-left: none;
                border-right-width: calc(2/15 * var(--calculated-pebble-checkbox-size));
                border-bottom-width: calc(2/15 * var(--calculated-pebble-checkbox-size));
                border-color: var(--pebble-checkbox-checkmark-color, white);
                -webkit-transform-origin: 60% 200%;
                transform-origin: 60% 200%;
                box-sizing: content-box; /* protect against page-level box-sizing */
            }

            :host-context([dir="rtl"]) #indeterminatemark {
                -webkit-transform-origin: 50% 14%;
                transform-origin: 50% 14%;
            }
        </style>

        <div id="checkboxContainer">
            <div id="checkbox" class$="[[_computeCheckboxClass(checked, invalid,indeterminate)]]">
                <div id="checkmark" class$="[[_computeCheckmarkClass(checked)]]"></div>
                <div id="indeterminatemark" class$="[[_computeIndeterminatemarkClass(checked, indeterminate)]]" ></div>
            </div>
        </div>

        <div id="checkboxLabel" hidden$="[[isLabelHidden()]]"><content></content></div>
    </template>

    <script>
        Polymer({
            is: 'pebble-checkbox',

            behaviors: [
                Polymer.PaperCheckedElementBehavior
            ],

            hostAttributes: {
                role: 'checkbox',
                'aria-checked': false,
                tabindex: 0
            },

            properties: {
                /**
                 * Fired when the checked state changes due to user interaction.
                 *
                 * @event change
                 */

                /**
                 * Fired when the checked state changes.
                 *
                 * @event iron-change
                 */
                ariaActiveAttribute: {
                    type: String,
                    value: 'aria-checked'
                },
                indeterminate:{
                    type:Boolean,
                    value:false,
                    notify:true
                }
            },
            listeners:{
              'tap':'_checkBoxTapped'
            },
            isLabelHidden: function() {
                return this.getContentChildren().length == 0;
            },
            attached: function() {
                var inkSize = this.getComputedStyleValue('--calculated-pebble-checkbox-ink-size').trim();
                // If unset, compute and set the default `--pebble-checkbox-ink-size`.
                if (inkSize === '-1px') {
                    var checkboxSize = parseFloat(this.getComputedStyleValue('--calculated-pebble-checkbox-size').trim());
                    var defaultInkSize = Math.floor((8 / 3) * checkboxSize);

                    // The checkbox and ripple need to have the same parity so that their
                    // centers align.
                    if (defaultInkSize % 2 !== checkboxSize % 2) {
                        defaultInkSize++;
                    }

                    this.customStyle['--pebble-checkbox-ink-size'] = defaultInkSize + 'px';
                    this.updateStyles();
                }
            },
            _computeCheckboxClass: function(checked, invalid, indeterminate) {
                var className = '';
                if (checked || indeterminate) {
                    className += 'checked ';
                }
                if (invalid) {
                    className += 'invalid';
                }
                return className;
            },

            _computeCheckmarkClass: function(checked) {
                return checked ? '' : 'hidden';
            },
            _computeIndeterminatemarkClass: function (checked, indeterminate) {
              if(checked){
                  return 'hidden';
              }
                return indeterminate ? '' : 'hidden';
            },
            // create ripple inside the checkboxContainer
            _createRipple: function() {
                this._rippleContainer = this.$.checkboxContainer;
                return Polymer.PaperInkyFocusBehaviorImpl._createRipple.call(this);
            },
            _checkBoxTapped: function () {
                this.indeterminate=false;
            }
        });
    </script>
</dom-module>
