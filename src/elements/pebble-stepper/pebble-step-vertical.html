<link rel="import" href="../../../bower_components/iron-flex-layout/iron-flex-layout.html">
<link rel="import" href="../../../bower_components/polymer/polymer.html">
<link rel="import" href="../../../bower_components/iron-collapse/iron-collapse.html">
<link rel="import" href="../../../bower_components/paper-badge/paper-badge.html">
<link rel="import" href="pebble-step-shared-styles.html">
<link rel="import" href="pebble-step-vertical-child.html">
<!--
  `pebble-step-vertical` represents a material design `pebble-step` element in vertical layout.
-->

<dom-module id="pebble-step-vertical">
  <template>
    <style include="pebble-step-shared-styles">
      :host {
        @apply(--layout-vertical);
      }
      #connectedBadge, #textWrapper {
        /* to be above paper-ripple*/
        z-index: 1;
      }
      #collapse {
        --iron-collapse-transition-duration: var(--pebble-vertical-step-transition-duration, 500ms);
        /*@apply(--layout-horizontal);*/
      }
      /**
       * Content
       */
      #connectedStep {
        @apply(--layout-horizontal);
      }
      #contentConnectorLine {
        width: var(--connectorLine-width, 1px);
        background: var(--divider-color, --paper-grey-300);
        margin-left: 36px;
        margin-right: 24px;
      }
      #textWrapper {
        @apply(--layout-horizontal);
        padding: 12px 0 12px 12px;
      }
      #textWrapper > paper-badge {
        --paper-badge-background: #f5f0f0;
        --paper-badge-text-color: #616161;
        padding: 18px 0px 0px 24px;
        margin-left:5px;
        --paper-badge: {
            border: 1px solid #616161;
        }
      }
      :host([opened]) #textWrapper > paper-badge {
          visibility: hidden;
      }
      #label {
        @apply(--layout-horizontal);
      }
      #connectedBadge {
        @apply(--layout-vertical);
        @apply(--layout-center);
        margin-left: 24px;
      }
      #beforeConnectorLine, #afterConnectorLine {
        width: var(--connectorLine-width, 1px);
        background: var(--divider-color, --paper-grey-300);
      }
      #beforeConnectorLine {
        height: 10px;
      }
      #afterConnectorLine {
        @apply(--layout-flex);
      }
      :host(.first-step) #beforeConnectorLine, :host(.last-step) #contentConnectorLine{
        visibility: hidden;
      }
      :host(.last-step:not([opened])) #afterConnectorLine {
        display: none;
      }
    </style>

    <div id="label">
      <div id="connectedBadge">
        <div id="beforeConnectorLine"></div>
        <div id="badge" on-click="_selectStep">
          <span>{{data.index}}</span>
        </div>
        <div id="afterConnectorLine" class="connectorLine"></div>
      </div>
      <div id="textWrapper" on-click="_selectStep">
        <span id="textLabel">[[data.label]]</span>
        <paper-badge id="itemsBadge" for="textLabel" label="+{{_badgeLabel(data)}}"></paper-badge>
      </div>
    </div>
    <iron-collapse id="collapse" opened="[[opened]]">
      <div id="contentConnectorLine"></div>
      <template is="dom-repeat" items={{data.items}}>
        <pebble-step-vertical-child id="stepLabel" label="[[item.label]]" opened="[[opened]]" data="{{item}}">
          <content></content>
        </pebble-step-vertical-child>
      </template>
    </iron-collapse>
  </template>
  <script>

    Polymer({
      is: 'pebble-step-vertical',

      properties: {
         /**
         * Represents opened/closed state of the step.
         */
        opened: {
          type: Boolean,
          value: false,
          reflectToAttribute: true
        },
        /**
        * Represents data model given to the step.
        */
        data: {
          type: Array,
          value: null
        },
      },

       _selectStep: function() {
          this.fire('select-step');
        },
      _badgeLabel: function() {
        return this.data.items.length;
      },
    });
  </script>
</dom-module>
