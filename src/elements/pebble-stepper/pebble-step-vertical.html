<link rel="import" href="../../../bower_components/polymer/polymer.html">
<link rel="import" href="../../../bower_components/iron-flex-layout/iron-flex-layout.html">
<link rel="import" href="../../../bower_components/iron-collapse/iron-collapse.html">
<link rel="import" href="../../../bower_components/paper-badge/paper-badge.html">

<link rel="import" href="pebble-step-vertical-child.html">
<!--
  `pebble-step-vertical` Represents a material design `pebble-step` element in the vertical layout.
-->

<dom-module id="pebble-step-vertical">
  <template>
    <style>
      :host {
        @apply(--layout-vertical);
        @apply(--paper-font-common-base);
        @apply(--layout-flex);
      }
      #connectedBadge {
        z-index: 1;
      }
       #textWrapper {
        z-index: 1;
        color: var(--paper-grey-400);
      }
       #textLabel {
        font-size: 14px;
      }
      #collapse {
        --iron-collapse-transition-duration: var(--pebble-vertical-step-transition-duration, 500ms);
      }
      #connectedStep {
        @apply(--layout-horizontal);
      }
      #contentConnectorLine {
        width: var(--connectorLine-width, 1px);
        background: var(--divider-color, --paper-grey-300);
        margin-left: 36px;
        margin-right: 24px;
      }
      #textWrapper {
        @apply(--layout-horizontal);
        margin-top: 10px;
        padding-left: 12px;
      }
      #textWrapper > paper-badge {
        --paper-badge-background: #f5f0f0;
        --paper-badge-text-color: #616161;
        padding: 18px 0px 0px 24px;
        margin-left:5px;
        --paper-badge: {
            border: 1px solid #616161;
        }
        .badge{
          background-color: #0abf21;
        }
      }
      #label {
        @apply(--layout-horizontal);
        @apply(--layout-center);
        position: relative;
      }
      #connectedBadge {
        @apply(--layout-vertical);
        @apply(--layout-center);
        margin-left: 19px;
      }
      #outerBadge {
        width: var(--pebble-connected-badge-width, 26px);
        height: var(--pebble-connected-badge-height, 26px);
        background: var(--pebble-step-outer-badge-background, white);
        border-radius: 50%;
        border: 2px solid;
        border-color:  var(--outer-badge-color, --paper-grey-300);
        @apply(--layout);
        @apply(--layout-center-center);
      }
      #badge {
          width: calc(var(--pebble-connected-badge-width, 26px) - 4px);
          height: calc(var(--pebble-connected-badge-height, 26px) - 4px);
          background: var(--pebble-step-closed-badge-background, --paper-grey-300);
          border-radius: 50%;
          color:var(--connected-badge-color, white);
          font-size: var(--pebble-connected-badge-fontSize, 12px);
          text-shadow: 0 1px 1px rgba(137, 147, 159, 0.57);
          @apply(--layout);
          @apply(--layout-center-center);
          cursor: pointer;
          pointer-events: auto;
      }      
      
      #beforeConnectorLine, #afterConnectorLine {
        width: var(--connectorLine-width, 1px);
        background: var(--connectorLine-color, --paper-grey-300);
      }
      #beforeConnectorLine {
        height: var(--connectorLine-height, 10px);
      }
      #afterConnectorLine {
        @apply(--layout-flex);
      }
      :host(.first-step) #beforeConnectorLine, :host(.last-step) #contentConnectorLine{
        display: none;
      }
      :host(.last-step:not([opened])) #afterConnectorLine {
        display: none;
      }
      :host #textWrapper {
        color: var(--paper-grey-600);
        cursor: pointer;
        pointer-events: auto;
      }
      :host([opened]) #textLabel {
        color: var(--palette-water-blue);
        font-weight: 500;
      }
      :host([opened]) #badge{
        background-color: var(--pebble-step-opened-badge, --paper-blue-500);
      }
      :host([opened]) #outerBadge {
        border-color: var(--pebble-step-opened-outer-badge, --paper-blue-500);
        background-color: var(--pebble-step-opened-outer-badge-background, #fff);
      }
      :host :not([opened]) #label:hover #badge {
        background-color: var(--pebble-step-closed-badge-background, --paper-grey-500);
      }
      :host([opened]) #textWrapper > paper-badge {
          visibility: hidden;
      }
      [hidden] {
        display: none;
      }
    </style>
    <div id="label">
      <div id="connectedBadge">
        <div id="beforeConnectorLine"></div>
        <div id="outerBadge">
          <div id="badge" on-tap="_selectStep">
            <span>{{data.index}}</span>
          </div>
        </div>
        <div id="afterConnectorLine" class="connectorLine"></div>
      </div>
      <div id="textWrapper" on-tap="_selectStep">
        <span id="textLabel">[[data.label]]</span>
        <template is="dom-if" if="{{_isBadgeLabel(data)}}">
          <paper-badge id="itemsBadge" for="textLabel" label="+{{_badgeLabel(data)}}"></paper-badge>
        </template>
      </div>
    </div>
    <iron-collapse id="collapse" opened="[[opened]]">
      <div id="contentConnectorLine"></div>
      <template is="dom-repeat" items={{data.items}}>
        <pebble-step-vertical-child id="stepLabel" label="[[item.label]]" data="{{item}}">
          <content></content>
        </pebble-step-vertical-child>
      </template>
    </iron-collapse>
  </template>
  <script>

    Polymer({
      is: 'pebble-step-vertical',

      properties: {
         /**
         * Indicates the open or closed state of the step.
         */
        opened: {
          type: Boolean,
          value: false,
          reflectToAttribute: true
        },
        /**
        * Indicates the data model given to the step.
        */
        data: {
          type: Array,
          value: null
        },
      },

       _selectStep: function() {
          this.fire('select-step');
        },
      _badgeLabel: function() {
        if(this.data && this.data.items) {
          return this.data.items.length;
        }
      },
      _isBadgeLabel: function() {
        if(this.data && this.data.items && this.data.items.length > 0) {
          return true;
        }
        return false;
      }
    });
  </script>
</dom-module>
