<link rel="import" href="../../../bower_components/iron-flex-layout/iron-flex-layout.html">
<link rel="import" href="../../../bower_components/paper-button/paper-button.html">
<link rel="import" href="../../../bower_components/polymer/polymer.html">
<link rel="import" href="../../../bower_components/iron-collapse/iron-collapse.html">
<link rel="import" href="pebble-step-shared-styles.html">

<!--
  `pebble-step-vertical-child` represents a material design element to show child actions or content of
  `pebble-step` child element in vertical layout.
-->

<dom-module id="pebble-step-vertical-child">
  <template>
    <style include="pebble-step-shared-styles">
      :host {
        @apply(--layout-vertical);
      }
      #connectedBadge, #textWrapper {
        /* to be above paper-ripple*/
        z-index: 1;
      }
      #collapse {
        --iron-collapse-transition-duration: var(--pebble-vertical-step-transition-duration, 500ms);
        @apply(--layout-horizontal);
      }
      /**
       * Content
       */
      #connectedStep {
        @apply(--layout-horizontal);
      }
      #childContentConnectorLine {
        width: var(--child-connectorLine-width, 1px);
        background: var(--divider-color, --paper-grey-300);
        margin-left: calc(24px + (var(--connected-childBadge-width,12px))/2 + (var(--connected-badge-width,24px) - var(--connected-childBadge-width,12px))/2 );
        margin-right: 18px;
      }
      #stepWrapper {
        @apply(--layout-flex);
        /*should be 48px on large screen?*/
        /*padding-left: 24px;*/
      }
      #paperStepWrapper {
        max-height: calc(var(--pebble-vertical-step-max-height, 400px) - 92px);
        @apply(--layout-scroll);
      }

      /**
       * Buttons
       */
      #buttonsWrapper {
        /*height: 48px;*/
        padding-top: 0px;
        padding-bottom: 8px;
        @apply(--layout-horizontal);
        @apply(--layout-center);
        @apply(--layout-flex-none);
      }
      #buttonsWrapper > paper-button {
        margin-right: 8px;
        margin-left: 0;
        border: 1px solid black;
        font-size: 12px;
        padding: 0.5em 0.2em;
        text-transform: none;
      }
      /**
       * Label
       */
      #textWrapper {
        @apply(--layout-vertical);
        padding: 12px 0 12px 12px;
      }
      #label {
        @apply(--layout-horizontal);
      }
      #connectedBadge {
        @apply(--layout-vertical);
        @apply(--layout-center);
        margin-left: 24px;
      }
      #connectedChildBadge {
        @apply(--layout-vertical);
        @apply(--layout-center);
        margin-left: calc(24px + (var(--connected-badge-width,24px) - var(--connected-childBadge-width,12px))/2 );
      }
      #beforeConnectorLine, #afterConnectorLine {
        width: var(--child-connectorLine-width, 1px);
        background: var(--divider-color, --paper-grey-300);
      }
      #beforeConnectorLine {
        height: 15px;
      }
      #afterConnectorLine {
        @apply(--layout-flex);
      }
    </style>

    <div id="label">
      <div id="connectedChildBadge">
        <div id="beforeConnectorLine"></div>
        <div id="childBadge" on-tap="_expand"></div>
        <div id="afterConnectorLine" class="connectorLine"></div>
      </div>
      <div id="textWrapper" on-tap="_expand">
        <span id="textLabel">[[label]]</span>
      </div>
    </div>
    <iron-collapse id="collapse" opened="[[!opened]]">
        <div id="childContentConnectorLine"></div>
        <div id="stepWrapper">
          <div id="paperStepWrapper"></div>
          <div id="buttonsWrapper">
            <template is="dom-repeat" items="{{data.actions}}">
              <paper-button on-tap="_buttonTap">[[item.action]]</paper-button>
            </template>
          </div>
        </div>
      </template>
    </iron-collapse>
  </template>
  <script>

    Polymer({
      is: 'pebble-step-vertical-child',

      properties: {
         /**
         * Represents opened/closed state of the step.
         */
        opened: {
          type: Boolean,
          value: false,
          reflectToAttribute: true
        },
        /**
        * Represents data model given to the step.
        */
        data: {
          type: Array,
          value: null
        },
      },
       _expand: function() {
           if(this.$.collapse.opened){
               this.$.collapse.toggle();
           }
           else{
               this.$.collapse.show();
           }
       },
       _buttonTap: function(e) {
            var eventDetail= {
              name : 'pebble-step-child-button',
              data: e.model.get('item.event')
            }
              this.fire('bedrock-event', eventDetail);
        },
    });
  </script>
</dom-module>
