<link rel="import" href="../../../bower_components/iron-flex-layout/iron-flex-layout.html">
<link rel="import" href="../../../bower_components/paper-button/paper-button.html">
<link rel="import" href="../../../bower_components/polymer/polymer.html">
<link rel="import" href="../../../bower_components/iron-collapse/iron-collapse.html">

<!--
  `pebble-step-vertical-child` represents a material design element to show child actions or content of
  `pebble-step` child element in vertical layout.
-->

<dom-module id="pebble-step-vertical-child">
  <template>
    <style>
      :host {
        @apply(--layout-vertical);
        @apply(--paper-font-common-base);
        @apply(--layout-flex);
      }
      #connectedBadge {
        z-index: 1;
      }
       #textWrapper {
        z-index: 1;
        color: var(--paper-grey-400);
      }
       #textLabel {
        font-size: 12px;
      }
      #collapse {
        --iron-collapse-transition-duration: var(--pebble-vertical-step-transition-duration, 500ms);
        @apply(--layout-horizontal);
      }
      #connectedStep {
        @apply(--layout-horizontal);
      }
      #childContentConnectorLine {
        width: var(--child-connectorLine-width, 1px);
        background: var(--divider-color, --paper-grey-300);
        margin-left: calc(25.5px + (var(--connected-childBadge-width,12px))/2 + (var(--connected-badge-width,26px) - var(--connected-childBadge-width,12px))/2 );
        margin-right: 18px;
      }
      #stepWrapper {
        @apply(--layout-flex);
      }
      #paperStepWrapper {
        max-height: calc(var(--pebble-vertical-step-max-height, 400px) - 92px);
        @apply(--layout-scroll);
      }

      /**
       * Buttons
       */
      #buttonsWrapper {
        /*height: 48px;*/
        padding-top: 12px;
        padding-bottom: 8px;
        @apply(--layout-horizontal);
        @apply(--layout-center);
        @apply(--layout-flex-none);
      }
      #buttonsWrapper > paper-button {
        margin-right: 8px;
        margin-left: 0;
        border: 1px solid black;
        font-size: 12px;
        padding: 0.5em 0.2em;
        text-transform: none;
      }
      /**
       * Label
       */
      #textWrapper {
        @apply(--layout-vertical);
        margin-top: 15px;
        padding-left: 12px;
      }
      #label {
        @apply(--layout-horizontal);
        @apply(--layout-center);
        position: relative;
      }
      #connectedChildBadge {
        @apply(--layout-vertical);
        @apply(--layout-center);
        margin-left: calc(26px + (var(--connected-badge-width,26px) - var(--connected-childBadge-width,12px))/2 );
      }
      #childBadge {
        width: var(--connected-childBadge-width,12px);
        height: var(--connected-childBadge-height,12px);
        background: var(--connected-childBadge-background,--paper-grey-300);
        border-radius: 50%;
        color: var(--connected-childBadge-color,white);
        font-size: var(--connected-childBadge-fontSize,12px);
        @apply(--layout);
        @apply(--layout-center-center);
      }
      #beforeConnectorLine, #afterConnectorLine {
        width: var(--child-connectorLine-width, 1px);
        background: var(--divider-color, --paper-grey-300);
      }
      #beforeConnectorLine {
        height: 17px;
      }
      #afterConnectorLine {
        @apply(--layout-flex);
      }
      :host #textWrapper {
        color: var(--paper-grey-600);
        cursor: pointer;
        pointer-events: auto;
      }
      :host([opened]) #textLabel {
        color: var(--paper-grey-900);
        font-weight: 500;
      }
      :host([opened]) #childBadge{
        background-color: var(--primary-color, --paper-blue-500);
      }
      :host :not([opened]) #label:hover #childBadge {
        background-color: var(--paper-grey-500);
      }
      [hidden] {
        display: none;
      }
    </style>

    <div id="label">
      <div id="connectedChildBadge">
        <div id="beforeConnectorLine"></div>
        <div id="childBadge" on-tap="_expand"></div>
        <div id="afterConnectorLine" class="connectorLine"></div>
      </div>
      <div id="textWrapper" on-tap="_expand">
        <span id="textLabel">[[label]]</span>
      </div>
    </div>
    <iron-collapse id="collapse">
        <div id="childContentConnectorLine"></div>
        <div id="stepWrapper">
          <div id="paperStepWrapper"></div>
          <div id="buttonsWrapper">
            <template is="dom-repeat" items="{{data.actions}}">
              <paper-button on-tap="_buttonTap">[[item.action]]</paper-button>
            </template>
          </div>
        </div>
      </template>
    </iron-collapse>
  </template>
  <script>

    Polymer({
      is: 'pebble-step-vertical-child',

      properties: {
        /**
         * Represents opened/closed state of the step.
         */
        opened: {
          type: Boolean,
          value: false,
          reflectToAttribute: true
        },
        /**
        * Represents data model given to the step.
        */
        data: {
          type: Array,
          value: null
        },
      },
       _expand: function() {
           if(this.$.collapse.opened){
               this.opened = false;
               this.$.collapse.toggle();
           }
           else{
               this.opened = true;
               this.$.collapse.show();
           }
       },
       _buttonTap: function(e) {
            var eventDetail= {
              name : 'pebble-step-child-button',
              data: e.model.get('item.event')
            }
              this.fire('bedrock-event', eventDetail);
        },
    });
  </script>
</dom-module>
