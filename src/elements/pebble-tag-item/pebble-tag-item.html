<link rel="import" href="../../../bower_components/polymer/polymer.html">
<link rel="import" href="../../../bower_components/shadycss/apply-shim.html">

<link rel="import" href="../bedrock-ui-behavior/bedrock-ui-behavior.html">
<link rel="import" href="../bedrock-style-manager/styles/bedrock-style-common.html">

<link rel="import" href="../pebble-icons/pebble-icons.html">
<link rel="import" href="../pebble-icon/pebble-icon.html">

<!--
`pebble-tag-item` Represents a tag item which is used in the filters. It indicates the selections performed.

### Example

        <pebble-tag-item id="ex1" 
                         name="Brand" 
                         show-icon 
                         icon="settings" 
                         show-expand-icon 
                         show-remove-icon 
                         index="0">
        </pebble-tag-item>

### Styling
The following custom properties and mixins are available for styling:

Custom property | Description | Default
----------------|-------------|----------
`--tag-container` | Mixin applied to tag container | {}
`--tag-name` | Mixin applied to tag display name | {}
`--tag-value` | Mixin applied to tag display value | {}
`--expand-more-icon-styles` | Mixin applied to expand icon | {}
`--close-icon-styles` | Mixin applied to close icon | {}
`--expand-icon-section` | Mixin applied to expand section | {}
`--close-icon-section` | Mixin applied to close section | {}

@group Pebble Elements
@element pebble-tag-item
@demo demo/index.html
-->
<dom-module id="pebble-tag-item">
    <template>
        <style include="bedrock-style-common"></style>
        <style>
            :host {
                display: inline-flex;
                display: -webkit-inline-flex;
                box-sizing: border-box;
                margin-right:var(--default-margin-right,6px);
                vertical-align: top;  
                font-size: var(--default-font-size, 14px);
            }           
            .tag-value {
                font-size:var(--font-size-sm, 12px);
                line-height: var(--default-tag-height,21px);
                display:inline-flex;
                @apply --pebble-tag-value;
            }
            .tag-item-container {              
                @apply --tag-style;
                background: var(--palette-white, #fff);
                float:left;
                margin-bottom: 4px;
                border-left-color: var(--tag-color);
                @apply --tag-container;
            }           
                       
            .name {
                color:var(--text-primary-color, #1a2028);
                font-style: var(--text-font-style, normal);
                overflow: hidden;
                text-overflow: ellipsis;
                white-space: nowrap;
                @apply --tag-name;                 
            }
            .value {
                padding-left: 4px;
                color:var(--text-primary-color, #1a2028);                
                @apply --tag-value;                
            }            
            .expand-more {
                padding-left: 4px;
                @apply --expand-icon-section;
            }
            .expand-more pebble-icon {
                cursor: pointer;
                @apply --expand-more-icon-styles;
            }
            .close-icon {
                margin-left: 8px;
                @apply --close-icon-section;
            }
            .close-icon pebble-icon {
                cursor: pointer;
                @apply --close-icon-styles;
            }
        </style>
        <div id="pebble-tag" class="tag-item-container border">
            <template is="dom-if" if="{{_displayIcon(showIcon)}}">
                <pebble-icon id="icon" src="[[src]]" icon="[[icon]]"></pebble-icon>
            </template>
            <span class="tag-value" on-tap="_onTapEvent">
                <span class="name" title$="[[longName]]">{{longName}}</span>
                <template is="dom-if" if="{{value}}">
                    <span class="value">
                       : {{displayValue}}
                    </span>
                </template>
                <template is="dom-if" if="{{showExpandIcon}}">
                    <span class="expand-more">
                        <pebble-icon icon="pebble-icon:navigation-action-down" class="pebble-icon-size-10 m-l-5"></pebble-icon>
                    </span>
                </template>
            </span>
            <template is="dom-if" if="{{showRemoveIcon}}">
                <span class="close-icon">                    
                    <pebble-icon on-tap="_removeItem" icon="pebble-icon:window-action-close" class="pebble-icon-size-8"></pebble-icon>
                </span>
            </template>
        </div>        
    </template>
    <script>
        Polymer({
            is: 'pebble-tag-item',
            properties: {
                /**
                 * Fired when the tag is removed from the tag list.
                 *
                 * @event tag-item-remove
                 */

                /**
                 * Fired when the tag is not editable and on tap of the tag.
                 *
                 * @event tag-item-tap
                 */
                               
                /**
                 * Indicates the value of the attribute shown in the tag.
                 */
                index: {
                    type: Number,                    
                    notify: true
                },                

                /**
                 * Indicates the display value of the attribute.
                 */
                displayValue: {
                    type: String,
                    value: "",
                    notify: true
                },

                /**
                 * Indicates the display value of the parameters.
                 */
                displayParams: {
                    type: Array,
                    value: function() { return []; },
                    notify: true
                },

                /**
                 * Indicates the value of the attributes shown in the tag.
                 */
                value: {
                    type: Object,
                    value: function(){ return {}; },
                    notify: true
                },

                /**
                 * Indicates the name of the attribute shown in the tag.
                 */
                name: {
                    type: String,
                    value: null,
                    notify: true
                },
                /**
                 * Indicates the long name of the attribute shown in the tag.
                 */
                longName: {
                    type: String,
                    value: null,
                    notify: true
                },
                /**
                 * Indicates the color of the tag.
                 */
                tagColor: {
                    type: String,
                    notify: true,
                    observer: '_colorChanged'
                },
                /**
                 * Indicates "more options".
                 */
                options: {
                    type: Object,
                    value: function() { return {}; }
                },

                /**
                * Specifies whether or not to show the remove icon on the tag.
                */
                showRemoveIcon: {
                    type: Boolean,
                    value: false
                },                
                /**
                 * Specifies the icon name or index in the set of icons available in
                 * the icon set. Note that you must not specify the `src` property when the `icon` property is specified.
                 */
                icon: {
                    type: String,
                    value: ''
                },
                /**
                 * Indicates the URL of an image for the icon. Note that you must not specify the `src` property when the `icon` property is specified.
                 */
                src: {
                    type: String,
                    value: ''
                },
                /**
                * Specifies whether or not to show an icon on the tag.
                */
                showIcon: {
                    type: Boolean,
                    value: false
                },
                /**
                * Specifies whether or not to show an expand icon on the tag.
                */
                showExpandIcon: {
                    type: Boolean,
                    value: false
                },
                textColor: {
                    type: String,
                    observer: '_textColorChanged'
                },
                fontStyle: {
                    type: String,
                    observer: '_fontStyleChanged'
                }
            },

            behaviors: [
                RUFBehaviors.UIBehavior
            ],

            attached: function () {
                if (!this.longName && this.name) {
                    this.longName = this.name;
                }

                if (!this.displayType) {
                    this.displayType = "textArea";
                }
                this.fireBedrockEvent('tag-item-attached', this._getCurrentTag(), { ignoreId: true });

            },

            /**
             * This method is called when someone taps on the tag. If tag is editable, then the tag is switched to edit mode otherwise tag-item-select event is fired
             */
            _onTapEvent: function (e) {
                this.fireBedrockEvent('tag-item-tap', this._getCurrentTag(), { ignoreId: true });
            },

            /**
             * Handler for removing the tag item
             */
            _removeItem: function () {
                this.fireBedrockEvent('tag-item-remove', this._getCurrentTag(), { ignoreId: true });
            },

            _getCurrentTag: function(){
                return {                    
                    "name": this.name,
                    "longName": this.longName,
                    "value": this.value,
                    "index": this.index,
                    "options": this.options                    
                };
            },
                      
            /**
             * Handler for checking if tagColor attribute is changed and if changed, change the color of the tag to the new color
             */
            _colorChanged: function () {
                if (this.tagColor) {
                    this.updateStyles({'--tag-color':this.tagColor});                  
                }                           
            },

            /**
             * Handler for checking if tagColor attribute is changed and if changed, change the color of the tag to the new color
             */
            _textColorChanged: function () {
                if (this.textColor) {
                    this.updateStyles({'--text-primary-color':this.textColor});                  
                } else {
                    this.updateStyles({'--text-primary-color':""});
                }
            },

            _fontStyleChanged: function() {
                if (this.fontStyle) {
                    this.updateStyles({'--text-font-style':this.fontStyle});                  
                } else {
                    this.updateStyles({'--text-font-style':"normal"});
                }
            },

            _displayIcon: function() {
                if(this.showIcon && (this.icon || this.src))
                {
                    return true;
                }

                return false;
            }

        });
    </script>
</dom-module>