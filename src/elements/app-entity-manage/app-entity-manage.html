<link rel="import" href="../rock-layout/rock-layout.html">
<link rel="import" href="../rock-layout/rock-header/rock-header.html">
<link rel="import" href="../rock-layout/rock-sidebar/rock-sidebar.html">
<link rel="import" href="../rock-layout/rock-titlebar/rock-titlebar.html">
<link rel="import" href="../rock-tabs/rock-tabs.html">
<link rel="import" href="../rock-layout/rock-titlebar/rock-titlebar.html">
<link rel="import" href="../pebble-stepper/pebble-stepper.html">
<link rel="import" href="../pebble-stepper/pebble-step.html">
<link rel="import" href="../rock-entity-header/rock-entity-header.html">
<link rel="import" href="../rock-dimension-selector/rock-dimension-selector.html">
<link rel="import" href="../pebble-vertical-divider/pebble-vertical-divider.html">
<link rel="import" href="../bedrock-pubsub/bedrock-pubsub.html">
<link rel="import" href="../pebble-dialog/pebble-dialog.html">
<link rel="import" href="../pebble-button/pebble-button.html">
<link rel="import" href="../bedrock-ui-behavior/bedrock-ui-behavior.html">

<dom-module id="app-entity-manage">
    <template>
        <style include="pebble-styles-shared">
</style>
<style>      
      .content{
          padding: 5px;
      }
      .stepper-style {
        --connected-badge-width: 50px;
        --connected-badge-height: 50px;
        --connected-badge-background: #c1cad4;
        --connected-childBadge-width: 18px;
        --connected-childBadge-height: 18px;
        --connected-childBadge-background: #0abf21;
        --connectorLine-width: 3px;
        --divider-color: #212121;
      }
      .sidebar-title {
        font-weight: 500;
        font-family: var(--default-font-family);
        clear: both;
        padding: 10px;
        margin: 10px;
        font-size: var(--default-font-size);
        font-weight: bold;
        font-style: normal;
        font-stretch: normal;
        color: var(--sidebar-text-color);
        width: 161px;
        height: 19px;
      }
      rock-dimension-selector {
        --dimesion-selector-catalog-dropdown: {
          width: 70px;
        };
        --dimesion-selector-source-dropdown: {
          width: 55px;
        };
        --dimesion-selector-date-dropdown: {
          width: 60px;
        };
        --dimesion-selector-locale-dropdown: {
          width: 65px;
        };
      }
      
      #dimensionContainer {
        align-self: center;
        width: 100%;
      }
      
      pebble-vertical-divider {
        --pebble-vertical-divider-color: var(--divider-color);
        min-width: 0px;
        margin: 10px 5px;
        min-height: 18px;
      }
      .divmargin{
        margin: 19px 0 0 0;
      }
       
      </style>

<rock-layout>
    <rock-titlebar icon="dashboard" title="" sub-title="" closable minimizable>
        <div id="dimensionContainer" align="right">
            <iron-ajax auto url="../../data/EntityManageApp/dimensionData.json" handle-as="json" last-response="{{dimensionData}}"></iron-ajax>
            <rock-dimension-selector id="dimensionSelector" config-data="{{dimensionData}}"></rock-dimension-selector>
            <bedrock-pubsub event-name="dimension-selector-catalog" handler="onCatalogChangeEvent" target-id="dimensionSelector"></bedrock-pubsub>
            <bedrock-pubsub event-name="dimension-selector-source" handler="onSourceChangeEvent" target-id="dimensionSelector"></bedrock-pubsub>
            <bedrock-pubsub event-name="dimension-selector-locale" handler="onLocaleChangeEvent" target-id="dimensionSelector"></bedrock-pubsub>
        </div>
        <pebble-vertical-divider></pebble-vertical-divider>
    </rock-titlebar>
    <rock-header frozen>
        <div class="fixed-content">
            <bedrock-pubsub on-bedrock-event-search="_searchEvent"></bedrock-pubsub>
            <bedrock-pubsub on-bedrock-event-refresh="_refreshEvent"></bedrock-pubsub>
            <bedrock-pubsub on-bedrock-event-copy="_copyEvent"></bedrock-pubsub>
            <bedrock-pubsub on-bedrock-event-paste="_pasteEvent"></bedrock-pubsub>
            <bedrock-pubsub on-bedrock-event-clone="_cloneEvent"></bedrock-pubsub>
            <bedrock-pubsub on-bedrock-event-add="_addEvent"></bedrock-pubsub>
            <bedrock-pubsub on-bedrock-event-delete="_deleteEvent"></bedrock-pubsub>
            <bedrock-pubsub on-bedrock-event-cut="_cutEvent"></bedrock-pubsub>
            <bedrock-pubsub on-bedrock-event-route-chamged="onRouteChange"></bedrock-pubsub>
            <iron-ajax url="../../data/EntityManageApp/header-config.json" last-response="{{headerConfig}}" auto></iron-ajax>
            <iron-ajax url="../../data/EntityManageApp/toolbar-config.json" last-response="{{toolbarConfig}}" auto></iron-ajax>
            <iron-ajax url="../../data/EntityManageApp/entity-summary-tofix-data.json" last-response="{{fixes}}" auto></iron-ajax>
            <iron-ajax url="../../data/EntityManageApp/entity-summary-widgets-config.json" last-response="{{summaryConfig}}" auto></iron-ajax>
            <rock-entity-header header-config="[[headerConfig]]" buttons="[[toolbarConfig]]" to-fix-data="[[fixes]]" locale="{{locale}}"
                list="{{list}}" source="{{source}}"></rock-entity-header>
        </div>
        <!--<div class="shrunk-content">
                <img src="../../images/entity-manage-header-small.png" />
            </div>-->
    </rock-header>
    <rock-sidebar id="rockSideBar" position="right">
        <div class="divmargin">
            <span class="sidebar-title">Create & Manage Variants</span>
            <iron-ajax auto url="../../data/EntityManageApp/app-entity-manage-stepper-data.json" handle-as="json" last-response="{{_stepItems}}"></iron-ajax>
            <pebble-stepper vertical selected-step="1" child-selected-step="0">
                <template is="dom-repeat" items="{{_stepItems.items}}" as="item">
                    <pebble-step class="stepper-style" data="{{item}}"></pebble-step>
                </template>
            </pebble-stepper>
        </div>
    </rock-sidebar>
    <div class="content">
        <template is="dom-if" if="true" id="tabsTemplate">
            <rock-tabs id="rockTabs" config="{{_tabConfig}}">
            </rock-tabs>
            <iron-ajax auto url="../../data/EntityManageApp/app-entity-manage-tab-config.json" handle-as="json" on-response="_handleResponse"></iron-ajax>
            <bedrock-pubsub event-name="component-creating" handler="onComponentCreating" target-id="rockTabs"></bedrock-pubsub>
            <bedrock-pubsub on-bedrock-event-todotap="summaryTodoTap"></bedrock-pubsub>
			<bedrock-pubsub on-bedrock-event-tofixtap="summaryTofixTap"></bedrock-pubsub>
        </template>
    </div>
    <pebble-dialog id="pebbleDialog" dialog-title="Dirty Check">
        <p>There are unsaved changes. You want to discard those changes and continue?</p>
   </pebble-dialog>
</rock-layout>

</template>

<script>
    (function () {
        'use strict';

        Polymer({
            is: 'app-entity-manage',
            ready: function () {

            },
            properties: {

                _tabConfig: {
                    type: Object,
                    value: function () {
                        return {};
                    }
                },
                _stepItems: {
                    type: Object,
                    value: function () {
                        return {};
                    },
                },
                locale: {
                    type: String,
                    notify: true
                },
                list: {
                    type: String,
                    notify: true
                },
                source: {
                    type: String,
                    notify: true
                },
                locales: {
                    type: Array
                },
                summaryConfig: {
                    type: Object
                }
            },
            behaviors: [
                RUFBehaviors.UIBehavior
            ],
            onLocaleChangeEvent: function (e, detail, sender) {
                var locales = [];
                if (detail.data.text != "All") {
                    var locale = { "locale": detail.data.text, "language": detail.data.language };
                    locales.push(locale);
                }
                else {
                    locales = [{ "locale": "en-US", "language": "English" },
                    { "locale": "de-DE", "language": "German" },
                    { "locale": "es-ES", "language": "Spanish" },
                    { "locale": "fr-FR", "language": "French" }];
                }
                this._toggleStepper(locales);
                this.locale = locales[0].locale;
                this.locales = locales;
                this.$$('rock-tabs').reloadCurrentTab();
            },
            onCatalogChangeEvent: function (e, detail, sender) {
                this.list = detail.data.value;
                this.$$('rock-tabs').reloadCurrentTab();
            },
            onSourceChangeEvent: function (e, detail, sender) {
                this.source = detail.data.value;
                this.$$('rock-tabs').reloadCurrentTab();
            },
            onComponentCreating: function (e, detail, sender) {
                var component = detail.data;
                
                if(component.name.indexOf("attribute") !=-1 && component.properties) {
                    if(this.source) {
                        component.properties.source = this.source;
                    }
                    if( this.list) {
                        component.properties.list = this.list;
                    }
                    if(this.locales) {
                        component.properties.locales = this.locales;
                    }
                }
                else if(component.name == 'rock-entity-summary'){                    
                    component.properties.config = this.summaryConfig;                    
                }
            },
            
             _searchEvent: function (e, detail, sender) {

            },
            _refreshEvent: function (e, detail, sender) {
                console.log(this.$.pebbleDialog);
                this.$.pebbleDialog.open();
            },
            _copyEvent: function (e, detail, sender) {
                document.querySelector('#app').$.pebbleAppToast.fitInto = document.querySelector('#app').$.toastArea;
                document.querySelector('#app').toastText = "Attribute Data Copied successfully!!";
                document.querySelector('#app').$.pebbleAppToast.show();
            },
            _pasteEvent: function (e, detail, sender) {
                alert("event triggered: " + detail.eventName);
            },
            _cloneEvent: function (e, detail, sender) {
                alert("event triggered: " + detail.eventName);
            },
            _addEvent: function (e, detail, sender) {
                alert("event triggered: " + detail.eventName);
            },
            _deleteEvent: function (e, detail, sender) {
                alert("event triggered: " + detail.eventName);
            },
            _cutEvent: function (e, detail, sender) {
                alert("event triggered: " + detail.eventName);
            },
            _toggleStepper: function (locales) {
                if (locales && locales.length > 1) {
                    this.$.rockSideBar.style.display = "none";
                }
                else {
                    this.$.rockSideBar.style.display = "block";
                }
            },
            _handleResponse: function(e) {
                this._setTabConfigData(e.currentTarget.lastResponse);
            },
            _setTabConfigData: function(data) {
                //can alter the data before setting it to tabConfig for rock-tabs
                this.set("_tabConfig", data);
            },
            summaryTodoTap: function(e, detail, sender){
                alert("event triggered: " + detail.eventName + ' >> ' + detail.label);
            },
            summaryTofixTap: function(e, detail, sender){
                alert("event triggered: " + detail.type + ' >> ' + detail.eventName + ' >> ' + detail.label);
            }
        });
    })();
</script>

</dom-module>