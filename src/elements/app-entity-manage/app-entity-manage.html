<link rel="import" href="../rock-layout/rock-layout.html">
<link rel="import" href="../rock-layout/rock-header/rock-header.html">
<link rel="import" href="../rock-layout/rock-sidebar/rock-sidebar.html">
<link rel="import" href="../rock-layout/rock-titlebar/rock-titlebar.html">
<link rel="import" href="../rock-tabs/rock-tabs.html">
<link rel="import" href="../rock-layout/rock-titlebar/rock-titlebar.html">
<link rel="import" href="../pebble-stepper/pebble-stepper.html">
<link rel="import" href="../pebble-stepper/pebble-step.html">
<link rel="import" href="../rock-entity-header/rock-entity-header.html">
<link rel="import" href="../rock-dimension-selector/rock-dimension-selector.html">
<link rel="import" href="../pebble-vertical-divider/pebble-vertical-divider.html">
<link rel="import" href="../bedrock-pubsub/bedrock-pubsub.html">
<link rel="import" href="../pebble-dialog/pebble-dialog.html">
<link rel="import" href="../pebble-button/pebble-button.html">

<dom-module id="app-entity-manage">
    <template>
        <style include="pebble-styles-shared">
</style>
<style>
      .content {
        padding: 5px;
      }
      .stepper-style {
        --connected-badge-width: 50px;
        --connected-badge-height: 50px;
        --connected-badge-background: #c1cad4;
        --connected-childBadge-width: 18px;
        --connected-childBadge-height: 18px;
        --connected-childBadge-background: #0abf21;
        --connectorLine-width: 3px;
        --divider-color: #212121;
      }
      .sidebar-title {
        font-weight: 500;
        font-family: var(--default-font-family);
        clear: both;
        padding: 10px;
        margin: 10px;
        font-size: var(--default-font-size);
        font-weight: bold;
        font-style: normal;
        font-stretch: normal;
        color: var(--sidebar-text-color);
        width: 161px;
        height: 19px;
      }
      rock-dimension-selector {
        --dimesion-selector-catalog-dropdown: {
          width: 80px;
        }
        ;
        --dimesion-selector-source-dropdown: {
          width: 55px;
        }
        ;
        --dimesion-selector-date-dropdown: {
          width: 60px;
        }
        ;
        --dimesion-selector-locale-dropdown: {
          width: 65px;
        }
        ;
      }
      
      #dimensionContainer {
        align-self: center;
        width: 100%;
      }
      
      pebble-vertical-divider {
        --pebble-vertical-divider-color: var(--divider-color);
        min-width: 0px;
        margin: 10px 5px;
        min-height: 18px;
      }
      .divmargin{
        margin: 19px 0 0 0;
      }
    </style>

<rock-layout>
    <rock-titlebar icon="dashboard" title="" sub-title="" closable minimizable>
        <div id="dimensionContainer" align="right">
            <bedrock-pubsub on-bedrock-event-dimension-selector-locale="onLocaleChangeEvent"></bedrock-pubsub>
            <bedrock-pubsub on-bedrock-event-dimension-selector-catalog="onCatalogChangeEvent"></bedrock-pubsub>
            <bedrock-pubsub on-bedrock-event-dimension-selector-source="onSourceChangeEvent"></bedrock-pubsub>
            <iron-ajax auto url="../../data/EntityManageApp/dimensionData.json" handle-as="json" last-response="{{dimensionData}}"></iron-ajax>
            <rock-dimension-selector config-data="{{dimensionData}}"></rock-dimension-selector>
        </div>
        <pebble-vertical-divider></pebble-vertical-divider>
    </rock-titlebar>
    <rock-header frozen>
        <div class="fixed-content">
            <bedrock-pubsub on-bedrock-event-search="_searchEvent"></bedrock-pubsub>
            <bedrock-pubsub on-bedrock-event-refresh="_refreshEvent"></bedrock-pubsub>
            <bedrock-pubsub on-bedrock-event-copy="_copyEvent"></bedrock-pubsub>
            <bedrock-pubsub on-bedrock-event-paste="_pasteEvent"></bedrock-pubsub>
            <bedrock-pubsub on-bedrock-event-clone="_cloneEvent"></bedrock-pubsub>
            <bedrock-pubsub on-bedrock-event-add="_addEvent"></bedrock-pubsub>
            <bedrock-pubsub on-bedrock-event-delete="_deleteEvent"></bedrock-pubsub>
            <bedrock-pubsub on-bedrock-event-cut="_cutEvent"></bedrock-pubsub>
            <bedrock-pubsub on-bedrock-event-route-chamged="onRouteChange"></bedrock-pubsub>
            <iron-ajax url="../../data/EntityManageApp/header-config.json" last-response="{{headerConfig}}" auto></iron-ajax>
            <iron-ajax url="../../data/EntityManageApp/toolbar-config.json" last-response="{{toolbarConfig}}" auto></iron-ajax>
            <iron-ajax url="../../data/EntityManageApp/data-quality-info.json" last-response="{{warnings}}" auto></iron-ajax>
            <rock-entity-header header-config="[[headerConfig]]" buttons="[[toolbarConfig]]" profile="[[warnings]]" locale="{{locale}}"
                list="{{list}}" source="{{source}}"></rock-entity-header>
        </div>
        <!--<div class="shrunk-content">
                <img src="../../images/entity-manage-header-small.png" />
            </div>-->
    </rock-header>
    <rock-sidebar id="rockSideBar" position="right">
        <div class="divmargin">
            <span class="sidebar-title">Create & Manage Variants</span>
            <iron-ajax auto url="../../data/EntityManageApp/app-entity-manage-stepper-data.json" handle-as="json" last-response="{{_stepItems}}"></iron-ajax>
            <pebble-stepper vertical selected-step="1" child-selected-step="0">
                <template is="dom-repeat" items="{{_stepItems.items}}" as="item">
                    <pebble-step class="stepper-style" data="{{item}}"></pebble-step>
                </template>
            </pebble-stepper>
        </div>
    </rock-sidebar>
    <div class="content">
        <template is="dom-if" if="true" id="tabsTemplate">
            <rock-tabs config="{{_tabConfig}}">
            </rock-tabs>
            <iron-ajax auto url="../../data/EntityManageApp/app-entity-manage-tab-config.json" handle-as="json" last-response="{{_tabConfig}}"></iron-ajax>
        </template>
    </div>
    <pebble-dialog id="pebbleDialog">
        <p>There are unsaved changes. You want to discard those changes and contiue?</p>
        <div class="buttons">
            <pebble-button button-text="Yes" on-tap="_confirm" raised elevation="1"></pebble-button>
            <pebble-button button-text="Cancel" dialog-dismiss raised elevation="1"></pebble-button>
        </div>
    </pebble-dialog>
</rock-layout>

</template>

<script>
    (function () {
        'use strict';

        Polymer({
            is: 'app-entity-manage',
            ready: function () {

            },
            properties: {

                _tabConfig: {
                    type: Object,
                    value: function () {
                        return {};
                    }
                },
                _stepItems: {
                    type: Object,
                    value: function () {
                        return {};
                    },
                },
                locale: {
                    type: String,
                    notify: true
                },
                list: {
                    type: String,
                    notify: true
                },
                source: {
                    type: String,
                    notify: true
                }
            },
            onLocaleChangeEvent: function (e, detail, sender) {
                var originalTabConfig = this._tabConfig;
                this._tabConfig = null;
                var locales = [];
                if (detail.text != "All") {
                    var locale = { "locale": detail.text, "language": detail.language };
                    locales.push(locale);
                }
                else {
                    locales = [{ "locale": "en-US", "language": "English" },
                    { "locale": "de-DE", "language": "German" },
                    { "locale": "es-ES", "language": "Spanish" },
                    { "locale": "fr-FR", "language": "French" }];
                }
                this._toggleStepper(locales);
                var dimensionValue = locales;
                this.locale = locales[0].locale;
                this._tabConfig = this._updateTabConfig(originalTabConfig, "locales", dimensionValue, "attributes");
            },
            onCatalogChangeEvent: function (e, detail, sender) {
                var originalTabConfig = this._tabConfig;
                this._tabConfig = null;
                var dimensionValue = detail.value;
                this.list = dimensionValue;
                this._tabConfig = this._updateTabConfig(originalTabConfig, "list", dimensionValue, "attributes");
            },
            onSourceChangeEvent: function (e, detail, sender) {
                var originalTabConfig = this._tabConfig;
                this._tabConfig = null;
                var dimensionValue = detail.value;
                this.source = dimensionValue;
                this._tabConfig = this._updateTabConfig(originalTabConfig, "source", dimensionValue, "attributes");
            },
            _confirm: function () {
                var contentView = document.querySelector("main-app").$$("rock-content-view-manager").$$("rock-content-view:not([hidden])");
                this.$.pebbleDialog.close();
                contentView.render();

            },
            _searchEvent: function (e, detail, sender) {

            },
            _refreshEvent: function (e, detail, sender) {
                console.log(this.$.pebbleDialog);
                this.$.pebbleDialog.open();
            },
            _copyEvent: function (e, detail, sender) {
                document.querySelector('#app').$.pebbleAppToast.fitInto = document.querySelector('#app').$.toastArea;
                document.querySelector('#app').toastText = "Attribute Data Copied successfully!!";
                document.querySelector('#app').$.pebbleAppToast.show();
            },
            _pasteEvent: function (e, detail, sender) {
                alert("event triggered: " + detail.eventName);
            },
            _cloneEvent: function (e, detail, sender) {
                alert("event triggered: " + detail.eventName);
            },
            _addEvent: function (e, detail, sender) {
                alert("event triggered: " + detail.eventName);
            },
            _deleteEvent: function (e, detail, sender) {
                alert("event triggered: " + detail.eventName);
            },
            _cutEvent: function (e, detail, sender) {
                alert("event triggered: " + detail.eventName);
            },
            _updateTabConfig: function (originalConfig, dimensionName, dimensionValue, tabItemName) {
                if (originalConfig && originalConfig.tabItems && originalConfig.tabItems.length > 0) {
                    for (var i = 0; i < originalConfig.tabItems.length; i++) {
                        if (originalConfig.tabItems[i].name == tabItemName) {
                            var item = originalConfig.tabItems[i];
                            for (var property in item.component.properties) {
                                if (item.component.properties.hasOwnProperty(property)) {
                                    if (property == dimensionName) {
                                        var val = dimensionValue;
                                        item.component.properties[property] = val;
                                    }
                                }
                            }
                            if (item.menuItems && item.menuItems.length > 0) {
                                for (var j = 0; j < item.menuItems.length; j++) {
                                    var menuItem = item.menuItems[j];
                                    for (var property in menuItem.component.properties) {
                                        if (menuItem.component.properties.hasOwnProperty(property)) {
                                            if (property == dimensionName) {
                                                var val = dimensionValue;
                                                menuItem.component.properties[property] = val;
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
                return originalConfig;
            },

            _toggleStepper: function (locales) {
                if (locales && locales.length > 1) {
                    this.$.rockSideBar.style.display = "none";
                }
                else {
                    this.$.rockSideBar.style.display = "block";
                }
            }
        });
    })();
</script>

</dom-module>