<link rel="import" href="../../../bower_components/polymer/polymer.html">
<link rel="import" href="../pebble-button/pebble-button.html">
<dom-module id="rock-saved-searches-tags">
    <template>
        <style include="pebble-styles-shared">
            pebble-button.action {
                display: inline-block;

                --pebble-button: {  
                    height: 35px !important;                
                    border-left: 1px solid #036BC3;
                    border-top: 1px solid #036BC3;
                    border-bottom: 1px solid #036BC3;
                    color: #036BC3;                                       
                    font-size: 14px;   
                }
                --pebble-button-iron-icon: {
                    padding: 0 5px 0 0;
                }
                --pebble-menu-button: {
                    height: 33px !important;
                    border-top: 1px solid #036BC3;
                    border-right: 1px solid #036BC3;
                    border-bottom: 1px solid #036BC3;
                    background: #FFFFFF;   
                    top: -8px !important;               
                }
                --actions-icon-button:{
                     height: 32px;
                     width: 32px;                    
                     background: #FFFFFF;
                     color: #036BC3;
                     padding: 6px !important;
                }
                --pebble-button-paper-menu:{
                    background: #FFFFFF;
                }
                --pebble-button-paper-menu-item: {
                    background: #FFFFFF;
                    color: #036BC3;
                    padding: 0px 8px;
                }
            }

        </style>
        <template is="dom-repeat" items="{{_savedSearchesButtons}}" as="savedSearch">
           <pebble-button class="action" noink raised action-menu elevation="0" horizontal-align="right" vertical-align="top"
                  icon="[[savedSearch.icon]]" button-text="[[savedSearch.name]]" data="[[savedSearch]]" actions-data="{{actionsData}}">
            </pebble-button>
        </template>
        <iron-ajax auto url="/src/data/saved-searches.json" handle-as="json" last-response="{{_savedSearches}}"></iron-ajax>
        <iron-ajax auto url="/src/data/savedSearchActions.json" handle-as="json" last-response="{{actionsData}}"></iron-ajax>
        <bedrock-pubsub on-bedrock-event-actions-parent-button-tap="_onSavedSearchTap"></bedrock-pubsub>
    </template>
    <script>
        (function() {
            'use strict';

            Polymer({
                
                is: 'rock-saved-searches-tags',

                properties: {
                    /*
                     * This property represents the name of the saved search category for which the tags has to be loaded
                     */
                    savedSearchCategory: {
                        type: String
                    },
                    _savedSearches: {
                        type : Object,
                        notify : true,
                        value : function(){return {}},
                        observer: '_loadSavedSearches'
                    },
                    _savedSearchesButtons: {
                        type: Array,
                        notify: true,
                        value:function(){return []},
                    }
                },
                _loadSavedSearches: function() {
                    if (this._savedSearches) {
                        this._savedSearchesButtons = this._savedSearches[this.savedSearchCategory];
                    }
                },
                /*
                 * Fired whenever the users tap/clicks on any saved search from either dashboard or entity discovery
                 */
                _onSavedSearchTap: function(e, detail, sender) {
                    var baseURI = Polymer.dom(this).node.baseURI;
                    if (detail) {
                        if(baseURI.includes("entity-discovery")) {
                            var contentView = document.querySelector("main-app").$$("rock-content-view-manager").$$("rock-content-view:not([hidden])");
                            var entityDiscovery = contentView.root.querySelector('app-entity-discovery');
                            entityDiscovery.savedSearchId = detail.id;
                            entityDiscovery._savedSearches = this._savedSearches;
                        }
                        else {                            
                            document.querySelector("main-app").set('route.__queryParams', {"savedSearchId": detail.id });
                            document.querySelector("main-app").set('route.path', "/entity-discovery");
                        }
                    }
                }
            });

        })();
    </script>
</dom-module>