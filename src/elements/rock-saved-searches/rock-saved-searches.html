<link rel="import" href="../rock-elements/rock-elements.html">

<dom-module id="rock-saved-searches">
    <template>
        <style include="shared-styles"></style>
        <style>
			:host {
				margin-right: -15px;
				padding-bottom: 12px;
				@apply(--layout);
				@apply(--layout-horizontal);
			}


        </style>

        <rock-widget id="savedSearchWidget" config="{{_widgetConfig}}" non-maximizable="true"
                     non-closable="true" non-draggable="true" icon-buttons="[[iconButtons]]">

        </rock-widget>

    </template>

    <script>
    (function() {
      'use strict';

      Polymer({
        is: 'rock-saved-searches',

        properties: {
         /**
        * Fired when any of the saved search is tapped in saved search widget with name: "rock-saved-search-click" and data is the data of the clicked saved search
        *
        * @event bedrock-event
        */

        /**
         *   This is a private property, indicates the current active tab under saved searches
        */
        _selectedTab : {
            type:String,
            notify: true,
            value : "favourites",
            observer: '_tabOrDataChanged'
        },

        /**
         * Contains the data of saved searches
        */
        savedSearches : {
            type : Object,
            notify : true,
             value : function(){return {}},
             observer: '_tabOrDataChanged'
        },
        /**
         * This is a private property. Contains the computed tags from active tab of saved searches
        */
         _tags:{
            type:Array,
            notify: true,
            value:function(){return []},
         },
         /**
          * This is a private property. Indicates the config that needs to be passed to rock-widget.
         */
         _widgetConfig:{
            type:Object,
            notify: true,
            value:function(){
                return {
                    "heading": "Saved Searches",
                    "headerIcon": "icons:assignment",
                    "component": {
                        "name": "rock-filter-tags",
                        "path": "../../rock-filter-tags/rock-filter-tags.html",
                        "properties": {
                            "style": "min-height:150px;min-width:720px;",
                            "disable-delete" : "false"
                        }
                    }
                }
            }
         },
          			/**
          * Indicates the list of actions available in "more" icon on top right corner of the card.
          *
					*/
          iconButtons: {
            type: Array,
            value: function() { return [
            {"name" : "settings","label" : "Settings"},{"name" : "help","label" : "Help"}] }
          }
        },

        listeners: {
            'tag-item-select': '_onTagItemSelect'
        },

        /**
         * This is a private function. It is responsible for computing tags when saved searches or tab changed.
        */
        _tabOrDataChanged : function() {
            this._tags=[];
            if(this.savedSearches && this._selectedTab && this.savedSearches[this._selectedTab]) {
            for(var i =0; i < this.savedSearches[this._selectedTab].length; i++) {
                var tag = JSON.parse(JSON.stringify(this.savedSearches[this._selectedTab][i]));
                tag["editMode"] = false,
                this.push('_tags',tag);
            }
            this._widgetConfig.component.properties.tags=this._tags;
            }
        },


        /**
            This is called when filter tag fires a tag-item-select event
        */
        _onTagItemSelect : function(e) {
            var eventData = {
                name : "rock-saved-search-click",
                data : this.savedSearches[this._selectedTab][e.detail.index]
            }
            this.fire('bedrock-event',eventData)
        }
      });
    })();

    </script>

</dom-module>