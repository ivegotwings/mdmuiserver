<link rel="import" href="../../../bower_components/polymer/polymer.html">
<link rel="import" href="../../../bower_components/iron-ajax/iron-ajax.html">
<link rel="import" href"../../../bower_components/iron-flex-layout/iron-flex-layout.html">
<link rel="import" href="../../../bower_components/paper-input/paper-input.html">
<link rel="import" href="../../../bower_components/iron-icon/iron-icon.html">
<link rel="import" href="../../../bower_components/paper-checkbox/paper-checkbox.html">
<link rel="import" href="../pebble-icons/pebble-icons.html">
<link rel="import" href="../rock-tabs/rock-tabs.html">

<!--
`rock-saved-searches` Represents an element that displays the saved searches.

@demo demo/index.html
-->
<dom-module id="rock-saved-searches">
    <template>
        <style include="pebble-styles-shared"></style>
        <style is="custom-style" include="iron-flex">
                .savedSearchIcon {
                        color: #036BC3;
                        height: 20px;
                        width: 20px;
                    }
                    .title {
                        color: black;
                        font-size: 16px;
                    }
                    .required{
                        color:red;
                    }
                    paper-checkbox.blue {
                        --paper-checkbox-checked-color: #036BC3;
                        --paper-checkbox-unchecked-color: #7D8690;
                        --paper-checkbox-label-color: #7D8690;
                        --paper-checkbox-label-checked-color: #7D8690;
                        --paper-checkbox-size: 14px;
                    }
                    .cancel {               
                        --pebble-button: {
                                height: 40px;
                                color: #7D8690;
                                border: 1px solid #C1CAD4;
                                font-size: 14px;
                        }
                    }
                    .save {               
                        --pebble-button: {
                                height: 40px;
                                background: #0ABF21;
                                color: #FFFFFF;
                                border: 1px solid #0ABF21;
                                font-size: 14px;
                        }
                    }            
                    .buttons{
                        margin-top: 5px;
                        text-align:center;
                    }
                    .container {
                        margin: 5px 10px;
                    }
                    .marginTop5{
                        margin-top: 5px;
                    }
        </style>
        
        <template is="dom-if" if="[[!createMode]]">
            <rock-tabs id="rock-saved-searches-tabs" config="{{_tabConfig}}"></rock-tabs>
        </template>
        <template is="dom-if" if="[[createMode]]">
            <div class="veritical layout container">
                <div>
                    <iron-icon class="savedSearchIcon" icon="pebble-icons:Icons/SavedSearch"></iron-icon>
                    <span class="title">Create New Saved Search</span>
                </div>
                <div>
                    <paper-input id="savedSearchName" label="Saved Search Name" required auto-validate
                        always-float-label error-message="required"></paper-input>
                </div>
                <div class="veritical layout marginTop5">
                    <div>
                        <span>Who can use this saved search?</span>
                    </div>
                    <div>
                        <paper-checkbox data-id="self" class="blue" noink on-change="_checkChanged">
                            <span>Only I can use this</span>
                        </paper-checkbox>
                    </div>
                    <div>
                        <paper-checkbox  data-id="allUsersSameRole" class="blue" noink on-change="_checkChanged">
                            <span>All Others with my role can use this</span>
                        </paper-checkbox>
                    </div>
                    <div>
                        <paper-checkbox data-id="allUsersAllRole" class="blue" noink on-change="_checkChanged">
                            <span>Everybody in my enterprise can use this</span>
                        </paper-checkbox>
                    </div>
                </div>
                <div class="buttons">
                    <pebble-button class="cancel" button-text="Cancel" noink raised elevation="2" on-tap="_onCancelTap"></pebble-button>
                    <pebble-button class="save" button-text="Save" noink raised elevation="2" on-tap="_onSaveTap"></pebble-button>
                </div>
            </div>
        </template>
        
    </template>
    <script>
        (function() {
            'use strict';

            Polymer({

                is: 'rock-saved-searches',
                /**
                * Fired when any of the saved search is tapped in 
                * saved search widget with name: "rock-saved-search". Here, data is the data of the clicked saved search.
                *
                * @event bedrock-event
                */

                /**
                * Fired when user taps/clicks on save button inside Create New Saved Search popover 
                * with the name: "create-savedsearch-save".
                *
                * @event bedrock-event	
                */ 
                properties: {
                    /**
                    * Indicates the config for tabs.
                    */
                    _tabConfig: {
                        type: Object,
                        notify: true,
                        value: function(){
                            return {
                                    "scrollable": false,
                                    "tabItems": [
                                        {
                                            "name": "favourites",
                                            "title": "Favourites",
                                            "enableDropdownMenu": false,
                                            "component": {
                                                "name": "rock-saved-searches-tags",
                                                "path": "/src/elements/rock-saved-searches/rock-saved-searches-tags.html",
                                                "properties": {
                                                    "saved-search-category": "favourites"
                                                }
                                            }
                                        },
                                        {
                                            "name": "my-searches",
                                            "title": "My Searches",
                                            "enableDropdownMenu": false,
                                            "selected" : true,
                                            "component": {
                                                "name": "rock-saved-searches-tags",
                                                "path": "/src/elements/rock-saved-searches/rock-saved-searches-tags.html",
                                                "properties": {
                                                    "saved-search-category": "my-searches"
                                                }
                                            }
                                        },
                                    ]
                                }
                            }
                        },
                        createMode:{
                            type: Boolean,
                            value: false,
                            reflectToAttribute: true
                        }
                    },
                    ready: function() {
                        if(this.createMode){
                            // clear all the check boxes
                            var checkBoxes = Polymer.dom(this.root).querySelectorAll('paper-checkbox');
                            if(checkBoxes != undefined){
                                for(var i=0;i<checkBoxes.length;i++){
                                    checkBoxes[i].checked = false;
                                }
                            }
                        }            
                    },
                    listeners: {
                        'tag-item-select': '_onTagItemSelect',
                    },
                    /**
                    * Fired when filter tag triggers a tag-item-select event.
                    */
                    _onTagItemSelect: function(e) {
                        var eventData = {
                            name : "rock-saved-search-click",
                            data : e.detail
                        };
                        this.fire('bedrock-event', eventData);
                    },
                    _checkChanged: function(e) {
                        if(this.createMode){
                                var currentCheckBoxId = e.target.getAttribute('data-id');
                                
                                // disable the other checkboxes when any one checkbox is checked
                                var checkBoxes = Polymer.dom(this.root).querySelectorAll('paper-checkbox');
                                if(checkBoxes != undefined){
                                    for(var i=0;i<checkBoxes.length;i++){
                                        if(checkBoxes[i].getAttribute('data-id') != undefined 
                                            && checkBoxes[i].getAttribute('data-id') != currentCheckBoxId){
                                                if(e.target.checked == true){
                                                    checkBoxes[i].disabled = true;
                                                }
                                                else{
                                                    checkBoxes[i].disabled = false;
                                                }                        
                                        }
                                    }
                                }
                            }
                    },
                    _onCancelTap: function(e) {
                        if(this.createMode){
                                //clear all the control values
                                var inputElement = this.$$('paper-input');
                                if(inputElement != undefined){
                                    inputElement.value = "";
                                    inputElement.removeAttribute("required");
                                    inputElement.validate();
                                    inputElement.setAttribute("required", true);
                                }                    

                                var checkBoxes = Polymer.dom(this.root).querySelectorAll('paper-checkbox');
                                if(checkBoxes != undefined){
                                    for(var i=0;i<checkBoxes.length;i++){
                                        checkBoxes[i].disabled = false;
                                        checkBoxes[i].checked = false;
                                    }
                                }
                        }
                    },
                    _onSaveTap: function(e) {
                        if(this.createMode){
                                // fire the validation to check if name is given or not. If given, get the saved search name
                                var inputElement = this.$$('paper-input');
                                var flag = inputElement.validate();
                                if(!flag){
                                    return;
                                }
                                var savedSearchName = inputElement.value;

                                // checkbox info
                                var checkBoxId = "";
                                var checkBoxes = Polymer.dom(this.root).querySelectorAll('paper-checkbox');
                                if(checkBoxes != undefined){
                                    for(var i=0;i<checkBoxes.length;i++){
                                        if(checkBoxes[i].checked){
                                            checkBoxId = checkBoxes[i].getAttribute('data-id');
                                            break;
                                        }
                                    }
                                }

                                if(savedSearchName != undefined && checkBoxId != undefined 
                                        && savedSearchName != "" && checkBoxId != ""){

                                    var info = { name: savedSearchName, optionChecked: checkBoxId }

                                    var eventDetail= {
                                        name: 'create-savedsearch-save',
                                        data: info
                                    }      
                                    this.fire('bedrock-event', eventDetail);
                                }             
                        }
                    }
            });
        })();
    </script>
</dom-module>