<link rel="import" href="../../../bower_components/polymer/polymer.html">
<link rel="import" href="../../../bower_components/iron-ajax/iron-ajax.html">
<link rel="import" href="../pebble-icons/pebble-icons.html">
<link rel="import" href="../rock-tabs/rock-tabs.html">
<link rel="import" href="../pebble-horizontal-divider/pebble-horizontal-divider.html">
<link rel="import" href="rock-create-edit-saved-searches.html">
<link rel="import" href="../bedrock-ui-behavior/bedrock-ui-behavior.html">

<!--
`rock-saved-searches` Represents an element that displays the saved searches.

@demo demo/index.html
-->
<dom-module id="rock-saved-searches">
    <template>
        <style include="pebble-styles-shared"></style>
        <style is="custom-style" include="iron-flex">
                #savedSearchButton {
                    --pebble-button: {
                    height: 34px;
                    padding: 1em 0em 1em 0.3em;
                    color: #2068BD;
                    border: 1px solid #2068BD;
                    font-size: small;
                    top: -7px;
                    }
                    --pebble-button-dropdown-icon: {
                        height: 20px !important;
                        width: 20px !important;
                    }
                }
                #newSavedSearch {
                    font-weight: bold;
                    font-size: 16px;
                }
                .marginLeft-9 {
                    margin-left: -9px;
                }
                #createEditSavedSearch {
                    --pebble-button: {
                        font-size: 14px !important;
                        color: #036BC3;
                    }
                    --pebble-button-iron-icon: {
                        height: 16px !important;
                        width: 16px !important;
                        color: #036BC3 !important;
                    }
                } 
                pebble-horizontal-divider {
                    --pebble-horizontal-divider-color: #ccc;
                }
                #savedSearchPopover {
                    margin-top: -3px;
                    width: 550px;
                }
                .savedSearchLabel {
                    color: black;
                    font-weight: bold;
                    font-size: 16px;
                }   
                :root {
                    --pebble-popover-max-width: 100%;
                }
                rock-tabs::shadow pebble-tab-group {
                    margin-bottom: 10px;
                }
        </style>
<iron-ajax auto url="/src/data/saved-searches.json" handle-as="json" last-response="{{createEditModel}}"></iron-ajax>
<template is="dom-if" if="[[!viewMode]]">
    <pebble-button id="savedSearchButton" icon="{{icon}}" button-text="{{buttonText}}" noink raised dropdown-icon="{{dropdownIcon}}"
        on-tap="_onSavedSearchTap"></pebble-button>
    <pebble-popover id="savedSearchPopover" for="savedSearchButton" auto-fit-on-attach no-overlap horizontal-align="right">
        <template is="dom-if" if="[[!editMode]]">
            <template is="dom-if" if="[[!viewMode]]">
                <div id="newSavedSearch">
                    <div class="savedSearchLabel">Saved Searches</div>
                    <pebble-button id="createEditSavedSearch" icon="icons:add" button-text="Create or Edit Saved Search" noink class="createEditSavedSearch marginLeft-9 icon"
                        on-tap="_onCreateEditSavedSearchTap"></pebble-button>
                    <pebble-horizontal-divider></pebble-horizontal-divider>
                </div>
            </template>
            <rock-tabs id="rock-saved-searches-tabs" config="{{_tabConfig}}"></rock-tabs>
        </template>
        <template is="dom-if" if="[[editMode]]">
            <rock-create-edit-saved-searches edit-mode="{{editMode}}" create-edit-model="[[createEditModel.my-searches]]">
                </create-edit-saved-searches>
        </template>
    </pebble-popover>
</template>
<template is="dom-if" if="[[viewMode]]">
    <template is="dom-if" if="[[!editMode]]">
        <template is="dom-if" if="[[!viewMode]]">
            <div id="newSavedSearch">
                <div class="savedSearchLabel">Saved Searches</div>
                <pebble-button id="createEditSavedSearch" icon="icons:add" button-text="Create or Edit Saved Search" noink class="createEditSavedSearch marginLeft-9"
                    on-tap="_onCreateEditSavedSearchTap"></pebble-button>
                <pebble-horizontal-divider></pebble-horizontal-divider>
            </div>
        </template>
        <rock-tabs id="rock-saved-searches-tabs" config="{{_tabConfig}}"></rock-tabs>
    </template>
    <template is="dom-if" if="[[editMode]]">
        <rock-create-edit-saved-searches id="createEditSavedSearch" edit-mode="{{editMode}}" create-edit-model="[[createEditModel.my-searches]]">
            </create-edit-saved-searches>
    </template>
</template>
</template>
<script>
        (function () {
            'use strict';

            Polymer({

                is: 'rock-saved-searches',
                /**
                * Fired when any of the saved search is tapped in 
                * saved search widget with name: "rock-saved-search-click". Here, data is the data of the clicked saved search.
                *
                * @event bedrock-event
                */

                /**
                * Fired when user taps/clicks on save button inside Create New Saved Search popover 
                * with the name: "saved-search-save".
                *
                * @event bedrock-event	
                */
                properties: {
                    /**
                    * Indicates the config for tabs.
                    */
                    _tabConfig: {
                        type: Object,
                        notify: true,
                        value: function () {
                            return {
                                "scrollable": false,
                                "tabItems": [
                                    {
                                        "name": "favourites",
                                        "title": "Favourites",
                                        "enableDropdownMenu": false,
                                        "component": {
                                            "name": "rock-saved-searches-tags",
                                            "path": "/src/elements/rock-saved-searches/rock-saved-searches-tags.html",
                                            "properties": {
                                                "saved-search-category": "favourites"
                                            }
                                        }
                                    },
                                    {
                                        "name": "my-searches",
                                        "title": "My Searches",
                                        "enableDropdownMenu": false,
                                        "selected": true,
                                        "component": {
                                            "name": "rock-saved-searches-tags",
                                            "path": "/src/elements/rock-saved-searches/rock-saved-searches-tags.html",
                                            "properties": {
                                                "saved-search-category": "my-searches"
                                            }
                                        }
                                    },
                                    {
                                        "name": "shared-searches",
                                        "title": "Shared Searches",
                                        "enableDropdownMenu": false,
                                        "component": {
                                            "name": "rock-saved-searches-tags",
                                            "path": "/src/elements/rock-saved-searches/rock-saved-searches-tags.html",
                                            "properties": {
                                                "saved-search-category": "shared-searches"
                                            }
                                        }
                                    }
                                ]
                            }
                        }
                    },
                    /**
                    * Indicates the create/edit mode for saved search.
                    */
                    editMode: {
                        type: Boolean,
                        value: false,
                        reflectToAttribute: true,
                        notify: true
                    },
                    /**
                    * Indicates the read-only mode for saved search. Create/Edit options will not be available for dashboard users.
                    */
                    viewMode: {
                        type: Boolean,
                        value: false,
                        reflectToAttribute: true
                    },
                    /**
                    * Indicates load saved search button icon.
                    */
                    icon: {
                        type: String,
                        value: function () { return null; }

                    },
                    /**
                    * Indicates the load saved search button text.
                    */
                    buttonText: {
                        type: String,
                        value: function () { return null; },
                        reflectToAttribute: true,
                        notify: true
                    },
                    /**
                    * Indicates that the menu button will have the dropdown arrow icon
                    * if the value is set <b>true<\b>.
                    */
                    dropdownIcon: {
                        type: Boolean,
                        value: false
                    }
                },
                behaviors: [
                    RUFBehaviors.UIBehavior
                ],
                listeners: {
                    'tag-item-select': '_onTagItemSelect'
                },
                _onSavedSearchTap: function (e) {
                    this.$$('#savedSearchPopover').show();
                },
                _onCreateEditSavedSearchTap: function (e) {
                    this.editMode = true;
                },
                /**
                * Fired when filter tag triggers a tag-item-select event.
                */
                _onTagItemSelect: function (e) {
                    var eventData = {
                        name: "rock-saved-search-click",
                        data: e.detail
                    };
                    this.fire('bedrock-event', eventData);
                }
            });
        })();
    </script>
</dom-module>