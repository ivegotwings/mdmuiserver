<link rel="import" href="../../../bower_components/polymer/polymer.html">

<link rel="import" href="../liquid-entity-model-get/liquid-entity-model-get.html">

<dom-module id="attribute-tab-menu-provider">
    <template>
        <liquid-entity-model-get id="liquidModeleGet" operation="getbyids" request-data={{_request}} 
         on-response="_onModelReceived" on-error="_onModelGetFailed"></liquid-entity-model-get>
    </template>
    <script>
        Polymer({
            is: 'attribute-tab-menu-provider',
            properties: {
               _callback: {
                   type: Function
               },
               _request: {
                    type: Object,
                    value: function() {
                        return {};
                    }
               }
            },
            behaviors: [
                RUFBehaviors.UIBehavior,
                RUFBehaviors.ComponentContextBehavior
            ],
            getMenu: function(tabItem, callback) {
                this._callback = callback;
                this._setRequestObject();
                var liquid = this.$.liquidModeleGet;
                if(liquid) {
                    liquid.generateRequest();
                }
                // this.async(function () {
                //     var m = [
                //                 {
                //                     "name": "Advanced",
                //                     "title": "Advanced",
                //                     "component": {
                //                         "name": "rock-attribute-split-screen",
                //                         "path": "/src/elements/rock-attribute-split-screen/rock-attribute-split-screen.html",
                //                         "properties": {
                //                             "mode": "view"
                //                         }
                //                     }
                //                 }
                //             ];
                //             callback(tabItem, m);
                //     }, 6000);
            },
            _onModelReceived: function(e) {
                if(e && e.detail && e.detail.response && e.detail.response.entityModels)
                var attributeNames = DataHelper.getAttributeNamesFromEntities(e.detail.response.entityModels);
                //TBD>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>
            },
            _onModelGetFailed: function(e) {
                //
            },
            _setRequestObject: function() {
                var firstDataContext = this.getFirstDataContext();
                var firstItemContext = this.getFirstItemContext();

                var entityType = firstItemContext.type;
                
                var req = {
                    "params": {
                        "query": {
                            "name": entityType,
                            "filters": {
                                "typesCriterion": ["entityManageModel"]
                            }
                        },
                        "fields": {
                            "properties": [
                                "_ALL"
                            ],
                            "attributes": ["_ALL"]
                        }
                    }
                };

                if(firstDataContext) {
                    req.params.query.contexts = [firstDataContext];
                }

                this._request = req;
            }
        });
    </script>
</dom-module>