<link rel="import" href="../../../bower_components/iron-icon/iron-icon.html">
<link rel="import" href="../../../bower_components/iron-icons/iron-icons.html">
<link rel="import" href="../../../bower_components/paper-input/paper-input.html">
<link rel="import" href="../../../bower_components/paper-icon-button/paper-icon-button.html">

<!--
`rock-search-bar`
 tag item which can be used in filters or for representing some selection

@demo demo/index.html
-->
<dom-module id="rock-tag-item">
  <template>
    <style include="shared-styles"></style>
    <style>
      :host {
        display: inline-block;
        box-sizing: border-box;
      }    
      .tag-value{
        font-size: 12px;
        height: 24px;
        display:inline-block;
        padding-top: 4px;
      }
      .tag-item-container{
        /*border: #D2D7DD 1px solid;*/
        border-radius: 3px;
        float:left;
        /*margin-left:6px;
        margin-bottom:3px;*/
        padding:5px 5px 0 5px;
        border-left-width: 5px!important;

      }
      
      paper-icon-button {
        height: 24px;
        padding: 4px;
        width: 25px;
      }

      paper-icon-button::shadow #icon{
        /*color: #333;*/
        height: 14px;
      }
      paper-input {
        width: 90%;
      }

      .border {
        border:  var(--tag-color, #2068BD) 1px solid;
        color:  var(--tag-color, #2068BD);
      }

    </style>
    
      <div class="tag-item-container border">
        <template is="dom-if" if="{{!editMode}}">
          <template is="dom-if" if="{{_isIconEnabled}}" >
            <iron-icon  id="icon" src="[[src]]" icon="[[icon]]" ></iron-icon>
          </template>
          <template is="dom-if" if="{{_hasValue}}">
            <span class="tag-value" on-tap="_onTapEvent">{{name}}: {{value}}</span>
          </template>
          <template is="dom-if" if="{{!_hasValue}}">
            <span class="tag-value" on-tap="_onTapEvent">{{name}}</span>
          </template>
          <template is="dom-if" if="{{!disableDelete}}">
            <paper-icon-button on-tap="_removeItem" icon="icons:cancel"></paper-icon-button>
          </template>
        </template>
        <template is="dom-if" if="{{editMode}}">
          <paper-input id="input" label="{{name}}" value="{{value}}" on-blur="_makeNonEditable"></paper-input>
        </template>

      </div>
  </template>
  <script>

    Polymer({
      is: 'rock-tag-item',
      properties: {
        /**
        * Fired when the tag is to be removed from the tag list
        *
        * @event tag-item-remove
        */

        /**
        * Fired when the tag is not editable and on tap of tag
        *
        * @event tag-item-select
        */

        /**
        * index of the tag
        */
        index:{
         type:Number,
         value:0
        },
        /**
        * size of the tags, possible values: small, medium, large
        */
        size:{
          type:String,
          value:'small'
        },
        /**
         * Boolean flag to indicate if delete of tag should be allowed
         */
        disableDelete:{
          type:Boolean,
          value: false
        },
        /**
        * value of the attribute shown in the tag
        */
        value: {
          type: String,
          notify: true
        },
        /**
        * name of the attribute shown in the tag
        */
        name:String,
        /**
         * Boolean flag to indicate if the tag is in view or edit mode
         */
        editMode: {
          type: Boolean,
          value: false
        },
        /**
         * Boolean flag which will become true when user passes icon( name of icon present in icons set) or src(image path).
        */
        _isIconEnabled: {
          type: Boolean,
          value:false,
          notify : true
        },
        /**
         * Specifies the icon name or index in the set of icons available in
         * the icon's icon set. If the icon property is specified,
         * the src property should not be.
         */
        icon: {
          type: String,
          value:'',
          notify:true,
          observer:'_iconPassed'
         },
        /**
        * The URL of an image for the icon. If the src property is specified,
        * the icon property should not be.
        */
        src: {
          type: String,
          value:'',
          notify:true,
          observer:'_iconPassed'
        },
        /**
         * Boolean flag to indicate if the value of the tag is editable or not
        */
        isNonEditable: {
          type: Boolean,
          value: false
        },
        /**
         * Boolean flag to check if the attribute only has both name and value or only name
         */
        _hasValue: {
          type: Boolean,
          value:false,
          notify : true,
          computed: '_isValueDefined(value)'
        },
        /**
         * Color of the tag
         */
         tagColor:{
           type:String,
           notify:true,
           observer:'_colorChanged'
         }
       },
      /**
        * Change the tag from view  mode to edit mode
      */
      _makeEditable: function(e) {
          this.editMode = true;
          //need to give some time to polymer to reflect the property change, thus async
          this.async(function() {
              this.$$('#input').inputElement.focus();//TODO: focus() on paper-input should have worked
            });
      },
      /**
        * Change the tag from edit  mode to view mode
      */
      _makeNonEditable: function(e) {
        this.editMode = false;
      },
      /**
        * This method is called when someone taps on the tag. If tag is editable, then the tag is switched to edit mode otherwise tag-item-select event is fired
      */
      _onTapEvent : function(e) {
         if(!this.isNonEditable) {
            this._makeEditable(e);
         } else {
            this.fire('tag-item-select', {index: this.index});
         }
      },
      /**
       * Handler for removing the tag item
       */
      _removeItem: function() {
        if (!this.disableDelete) {
          this.fire('tag-item-remove', {index: this.index});
        }
      },
      /**
       * Handler for checking if value exists
       */
      _isValueDefined : function(value) {
        if(value) {
          return true;
        } else {
          return false;
        }
      },
       /**
       * Handler for checking if any icon name is passed or any path for an icon is provided
       */
      _iconPassed: function(){
        if(this.icon || this.src) {
             this._isIconEnabled=true;
          } else {
             this._isIconEnabled=false;
          }
      },
      /**
       * Handler for checking if tagColor attribute is changed and if changed, change the color of the tag to the new color
       */
      _colorChanged:function(){
        if(this.tagColor){
          this.customStyle['--tag-color'] = this.tagColor;
        }
         this.updateStyles();
      }
    });

  </script>
</dom-module>