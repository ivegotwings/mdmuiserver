<link rel="import" href="../../../bower_components/iron-data-table/iron-data-table.html">
<link rel="import" href="../../../bower_components/paper-radio-button/paper-radio-button.html">
<link rel="import" href="../../../bower_components/paper-checkbox/paper-checkbox.html">
<link rel="import" href="../pebble-button/pebble-button.html">
<link rel="import" href="../pebble-vertical-divider/pebble-vertical-divider.html">


<!--
`pebble-grid`
Grid control for riversand ui framework

The following JSON object is a sample of data to be used in data property/attribute

```json
{
	"config": {
		"viewMode": "Tabular", //Indicates type of the mode (other possible values: tile, list)
		"isMultiSelect": true, //Indicates whether the multi selection enabled in grid
		"title": "Simple Data Table" //Indicates title for the grid element, which appears in header
	},
	"tabular": {
		"columns": [
			{
				"header": "Short Name", //Represents column header
				"name": "shortName", //Reperesents the property of dataItems mapped with column
				"sortable": true, //Indicates whether the column is sortable or not
				"filterable": false, //Indicates whether the filtering is enabled for the column
				"editType":"text" //Edit type of control
			},
			{
				"header": "Long Name",
				"name": "longName",
				"sortable": false,
				"filterable": true,
				"editType":""
			} 
		]
	},
	"dataItems": [
		{
			"shortName": "web Price",
			"longName": "Web Price",
			"productType": "Electronics",
			"description": "product web price",
			"isNew": false,
			"isApproved": true
		},
		{
			"shortName": "catalog",
			"longName": "Catalog",
			"productType": "Toys",
			"description": "catalog information",
			"isNew": true,
			"isApproved": false
		}
	]
} 
```

@demo demo/index.html
-->

<dom-module id="pebble-grid">
	<template>
		<style include="shared-styles">
			#viewMode {
				padding: 0 20px 0 0;
				width: 110px;
			}
			
			h1 {
				text-align: center;
				font-family: var(--default-font-family);
			}
			
			div.clearboth {
				clear: both;
			}
			

		</style>
		<style is="custom-style">
			iron-data-table {
				height: var(pebble-grid-height, 255px);
				--iron-data-table-row: {
					align-items: center;
					font-family:var(--default-font-family);
				}
				--iron-data-table-header: {
					background-color: #139DE6;
					height: 45px;
					color: white;
					font-family:var(--default-font-family);
				}
				--iron-data-table-row-odd: {
					background-color: #FFFFFF;
					font-family:var(--default-font-family);
				}
				--iron-data-table-row-even: {
					background-color: #F9FBFD;
					font-family:var(--default-font-family);
				}
			}
			
			#pebbleGridContainer {
				border: 1px solid #D0D7DE;
				font-family: var(--default-font-family);
				font-size: 15px;
			}
			
			#gridHeader {
				border-color: #D0D7DE;
				border-style: solid;
				border-width: 1px 1px 0px 1px;
				font-family: var(--default-font-family);
				font-size: 14px;
			}
			
			#gridHeader > span {
				float: left;
				margin-top: 10px;
				margin-left: 5px;
			}
			
			pebble-button {
				--pebble-button: {
					height: 30px;
					padding: 0.5em 0em 0.5em 0em;
					background-color:var(--default-icon-selected);
					min-width: 2.14em;
					margin: 0px;

				}
				--pebble-button-iron-icon: {
					height: 24px;
					width: 24px;
					padding: 0 5px 0 0;
					
				}
				--pebble-button-paper-menu: {
					background: #ffffff;
					color: #000000;
				}
				--pebble-button-paper-menu-item: {
					background: #ffffff;
					color: #000000;
					font-size: 14px;
				}
			}
			
			pebble-vertical-divider {
				--pebble-vertical-divider-color: black;
			}
			
			.input-content.paper-input-container .paper-input-label {
				color: white !important;
				font-family: var(--default-font-family);
			}
			
		</style>
		<template is="dom-if" if="{{_dataIsNotNull(data)}}">
			<div id="gridHeader" align="right">
				<span>[[data.config.title]]</span>
				<pebble-button icon="refresh" on-tap="_onRefresh" noink raised></pebble-button>
				<pebble-vertical-divider></pebble-vertical-divider>
				<pebble-button icon="file-download" on-tap="_onDownload" noink raised></pebble-button>
				<pebble-vertical-divider></pebble-vertical-divider>
				<pebble-button icon="file-upload" on-tap="_onUpload" noink raised></pebble-button>
				<pebble-vertical-divider></pebble-vertical-divider>
				<pebble-button items="Tabular,Tile,List" class="dropdownIcon" icon="view-list" menu-button button-text="{{data.config.viewMode}}"
					selected-value="{{data.config.viewMode}}" noink raised no-overlap vertical-offset="-200" horizontal-offset="10"></pebble-button>
			</div>
			<div id="pebbleGridContainer">
				<template is="dom-if" if="{{_isTabularMode(data.config.viewMode)}}">
					<iron-data-table page-size="10" selection-enabled multi-selection$="{{data.config.isMultiSelect}}" items="{{data.dataItems}}">
						<template is="dom-repeat" items="[[data.tabular.columns]]" as="col" index-as="colIndex">
							<template is="dom-if" if="[[_isCheckBox(col)]]">
								<data-table-column name="[[col.header]]" column-index="{{colIndex}}" filter-by$="[[_isFilterEnabled(col)]]" sort-by$="[[_isSortable(col)]]">
									<template>
										<paper-checkbox checked$="{{_columnValue(item, column.columnIndex)}}"></paper-checkbox>
									</template>
								</data-table-column>
							</template>
							<template is="dom-if" if="[[_isTextArea(col)]]">
								<data-table-column name="[[col.header]]" column-index="{{colIndex}}" filter-by$="[[_isFilterEnabled(col)]]" sort-by$="[[_isSortable(col)]]">
									<template>
										<paper-textarea value="{{_columnValue(item, column.columnIndex)}}"></paper-textarea>
									</template>
								</data-table-column>
							</template>
							<template is="dom-if" if="[[_isRadioButton(col)]]">
								<data-table-column name="[[col.header]]" column-index="{{colIndex}}" filter-by$="[[_isFilterEnabled(col)]]" sort-by$="[[_isSortable(col)]]">
									<template>
										<paper-radio-button checked$="{{_columnValue(item, column.columnIndex)}}"></paper-radio-button>
									</template>
								</data-table-column>
							</template>
							<template is="dom-if" if="[[_isTextBox(col)]]">
								<data-table-column name="[[col.header]]" column-index="{{colIndex}}" filter-by$="[[_isFilterEnabled(col)]]" sort-by$="[[_isSortable(col)]]">
									<template>
										<paper-input value="{{_columnValue(item, column.columnIndex)}}"></paper-input>
									</template>
								</data-table-column>
							</template>
							<template is="dom-if" if="[[_isNotEditable(col)]]">
								<data-table-column name="[[col.header]]" column-index="{{colIndex}}" filter-by$="[[_isFilterEnabled(col)]]" sort-by$="[[_isSortable(col)]]">
									<template>{{_columnValue(item, column.columnIndex)}}</template>
								</data-table-column>
							</template>
						</template>
					</iron-data-table>
				</template>
				<template is="dom-if" if="{{_isTileMode(data.config.viewMode)}}">
					<h1>Under Design</h1>
				</template>
				<template is="dom-if" if="{{_isListMode(data.config.viewMode)}}">
					<h1>Under Design</h1>
				</template>
			</div>
		</template>
	</template>
	<script> 
      (function() {
            'use strict';
            
            Polymer( {
                is: 'pebble-grid', 
				/**
				* Fired when user clicks on a item to select it.
				*
				* @event grid-selecting-item (pub-sub event)
				* @param {Object} detail
				* @param {Object} detail.item item to be selected
				*/

				/**
				* Fired when user clicks on a item to deselect it.
				*
				* @event grid-deselecting-item (pub-sub event)
				* @param {Object} detail
				* @param {Object} detail.item item to be deselected
				*/

				/**
				* Fired when user clicks on the select all checkbox to select items.
				*
				* @event grid-selecting-all-items (pub-sub event)
				* @param {Object} detail
				* @param {Object} detail.items currently selected items
				*/

				/**
				* Fired when user clicks on the select all checkbox to deselect items.
				*
				* @event grid-deselecting-all-items (pub-sub event)
				* @param {Object} detail
				* @param {Object} detail.items currently selected items
				*/

				/**
				* Fired when user clicks on a item to expand it.
				*
				* @event grid-expanding-item (pub-sub event)
				* @param {Object} detail
				* @param {Object} detail.item item to be expanded
				*/

				/**
				* Fired when user clicks on a item to collapse it.
				*
				* @event grid-collapsing-item (pub-sub event)
				* @param {Object} detail
				* @param {Object} detail.item item to be collapsed
				*/
                properties: {
					/**
					 * The format for the JSON object is given in above description
					 */					
					data: {
						type: Object
					}
                },

				listeners: {
					'selecting-item': '_onSelectingItem',
					'deselecting-item': '_onDeselectingItem',
					'selecting-all-items': '_onSelectingAllItems',
					'deselecting-all-items':'_onDeselectingAllItems',
					'expanding-item':'_onExpandingItem',
					'collapsing-item':'_onCollapsingItem'
				},

				/**
				* Clears the cached pages and reloads data from datasource when needed.
				*/
				clearCache: function() {
				    var ironDataTable = this._getIronDataTable();
					ironDataTable.clearCache();
				},

				/**
				* Clears the cache for a page and reloads the data from datasource.
				*/
				refreshPage: function(page) {
					var ironDataTable = this._getIronDataTable();
					ironDataTable.refreshPage(page);
				},

				/*
				* Selects all the items in the list.
				*/
				selectAll: function(){
					var ironDataTable = this._getIronDataTable();
					ironDataTable.selectAll();
				},

				/**
				* Clears the current selection state.
				*/
				clearSelection: function() {
					var ironDataTable = this._getIronDataTable();
					ironDataTable.clearSelection();
				},

				/**
				* Select the list item at the given index.
				*
				* @method selectItem
				* @param {(Object|number)} item The item object or its index
				*/
				selectItem: function(item) {
					var ironDataTable = this._getIronDataTable();
					ironDataTable.selectItem(item);
				},

				/**
				* Deselects the given item list if it is already selected.
				*
				* @method deselect
				* @param {(Object|number)} item The item object or its index
				*/
				deselectItem: function(item){
					var ironDataTable = this._getIronDataTable();
					ironDataTable.deselectItem(item);
				},

				/**
				* Expands the row details for this item, if available.
				*/
				expandItem: function(item) {
					var ironDataTable = this._getIronDataTable();
					ironDataTable.expandItem(item);
				},

				/**
				* Collapses the row details for this item, if expanded.
				*/
				collapseItem: function(item) {
					var ironDataTable = _getIronDataTable();
					Polymer.dom(this).node.root.querySelector("iron-data-table").collapseItem(item);
				},

                _columnValue: function(gridData, index) {
                    var cellData = gridData[this.data.tabular.columns[index].name];
                    if(cellData != undefined) {
                       index++;
                    }
                    return cellData;
				},
				_isTabularMode: function(viewMode){
					return viewMode == 'Tabular';
				},
				_isTileMode: function(viewMode){
					return viewMode == 'Tile';
				},
				_isListMode: function(viewMode){
					return viewMode == 'List';
				},
				_isTextBox: function(col){
					return col.editType == 'text';
				},
				_isCheckBox: function(col){
					return col.editType == 'checkbox';
				}, 
				_isTextArea: function(col){
					return col.editType == 'textarea';
				},
				_isRadioButton: function(col){
					return col.editType == 'radio';
				},
				_isNotEditable: function(col){
					return col.editType == '';
				},
				_isFilterEnabled: function(col){
					return col.filterable ? col.name : undefined;
				},
				_isSortable: function(col){
					return col.sortable ? col.name : undefined;
				},
				_dataIsNotNull: function(){
					return typeof(this.data) == "object";
				},

				_onRefresh: function(e) {
					this.clearCache(); 
				},

				_onDownload: function(e) {
					this.selectAll();
				},

				_onUpload: function(e) {
					this.clearSelection();
				},

				_getIronDataTable: function(){
					 return Polymer.dom(this.root).node.querySelector("iron-data-table")
				   || Polymer.dom(this).node.querySelector("iron-data-table");
				},

				_onSelectingItem: function(e){

				},

				_onDeselectingItem: function(e){

				},

				_onSelectingAllItems: function(e){

				},

				_onDeselectingAllItems: function(e){

				},

				_onExpandingItem: function(e){

				},

				_onCollapsingItem: function(e){
					
				}
            });
        })();
    </script>
</dom-module>