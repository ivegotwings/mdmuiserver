<link rel="import" href="./grid-list-item.html">
<link rel="import" href="/bower_components/iron-list/iron-list.html">
<link rel="import" href="/bower_components/iron-scroll-threshold/iron-scroll-threshold.html">
<link rel="import" href="/bower_components/paper-spinner/paper-spinner.html">

<!--
`grid-list-view`
Element displaying the items in grid-list-view.

@demo demo/index.html
-->

<dom-module id="grid-list-view">
    <template>
        <style include="shared-styles">
            .loadingIndicator {
                text-align: center;
                height: 40px;
            }
            
            .loadingIndicator paper-spinner {
                width: 20px;
                height: 20px;
                margin-right: 10px;
            }
            
            #scrollingRegion {
                top: 10vh;
                left: 25vh;
                right: 25vh;
                height: 100vh;
                overflow: auto;
                -webkit-overflow-scrolling: touch;
            }
        </style>
        <div id="scrollingRegion">
            <iron-list id="list" items="{{cachedItems}}" as="item" scroll-target="html" multi-selection="{{multiSelection}}" 
                selected-item="{{selectedItem}}" selected-items = "{{selectedItems}}" selection-enabled>
                <template>
                    <grid-list-item item="{{item}}" index = "[[index]]" items-to-display="{{itemsToDisplay}}"></grid-list-item>
                </template>
            </iron-list>
            <template is="dom-if" if="{{loading}}">
                <div class="loadingIndicator">
                    <paper-spinner active="{{loading}}"></paper-spinner>
                </div>
            </template>
            <!-- this element will load more data when the user scrolls down and reached the lower threshold -->
            <iron-scroll-threshold id="scrollTheshold" lower-threshold="500" on-lower-threshold="_loadMoreData" scroll-target="scrollingRegion">
            </iron-scroll-threshold>
        </div>
    </template>
    <script> 
      (function() {
            'use strict';
            
            Polymer( {
                is: 'grid-list-view', 
                 properties: {

                     /**
                      * This property represents the cached-items in the list view. It grows in size as you scroll in the grid-list-view. 
                      */
                     cachedItems : {
                          type : Array,
                          notify:true,
                          reflectToAttribute:true,
                          value :[]
                        },

                     /**
                      * This property represents the data of the items to be displayed in grid-list-view.
                      */   
                     items : {
                         type : Array,
                         value : [],
                          notify:true,
                          reflectToAttribute:true
                         //observer : '_dataChanged'
                     },

                     /**
                      * This property represents the current page in grid-list-view.
                      */
                     currentPage : {
                         type: Number,
                         value : 0,
                         notify : true,
                         reflectToAttribute : true
                     },

                     /**
                      * This property represents the page size in grid-list-view.
                      */
                     pageSize : {
                         type : Number,
                         value : 15,
                         notify : true,
                         reflectToAttribute : true
                     },

                     /**
                      * This property is true if element is trying to fetch data. other wise false.
                      */
                     loading : {
                         type : Boolean,
                         value : false
                     },

                     /**
                      *When true, multiple items may be selected at once (in this case, selected is an array of currently selected items). When false, only one item may be selected at a time.
                      */
                     multiSelection : {
                         type : Boolean,
                         value:false,
                         notify : true,
                         reflectToAttribute : true
                     },

                     /**
					 * When multiSelection is true, this is an array that contains the selected items.
					 */
                     selectedItems : {
                         type : Array,
                         //value : [],
                         notify : true,
                         reflectToAttribute : true                 
                    },

                    /**
					 * When multiSelection is false, this is the currently selected item, or null if no item is selected.
					 */
                     selectedItem : {
                         type : Object,
                         //value : {},
                         notify : true,
                         reflectToAttribute : true
                     },

                     /**
                      * When true, tapping a row will select the item, placing its data model in the set of selected items retrievable via the selection property.
                      */ 
                     selectionEnabled : {
                         type : Boolean,
                         value:false,
                         notify : true,
                         reflectToAttribute : true 
                     },

                     /**
                      * This property represents the config of grid-list-view.
                      */
                     itemsToDisplay : {
                         type:Object
                     }
                 },

                 observers: [
                    //'_selectedItemsChanged(selectedItems.splices)'
                ],

                 _loadMoreData : function() {
                      this.loading=true;
                     if(this.items && this.items.length > 0) { 
                        var newItems = this.items.slice(this.currentPage*this.pageSize,(this.currentPage*this.pageSize)+ this.pageSize);
                        var that = this;
                        newItems.forEach(function(product) {
                            that.push('cachedItems',product);
                        });
                    
                        this.currentPage+=1;
                    }
                     this.$.scrollTheshold.clearTriggers();
                    this.loading=false;
                 }

                 /*
                 _dataChanged : function() {
                    this.loading=true;
                    this.currentPage = 0;
                    this.cachedItems = [];
                    if(this.items && this.items.length > 0 && this.currentPage && this.pageSize) { 
                        var newItems = this.items.slice(this.currentPage*this.pageSize,(this.currentPage*this.pageSize)+ this.pageSize);
                        var that = this;
                        newItems.forEach(function(product) {
                            that.push('cachedItems',product);
                        });
                        this.currentPage+=1;
                    }
                    this.$.scrollTheshold.clearTriggers();
                    this.loading=false;
                 },

                 _selectedItemsChanged : function() {
                     console.log(this.selectedItems)
                 }  */
            });
        })();
    </script>
</dom-module>