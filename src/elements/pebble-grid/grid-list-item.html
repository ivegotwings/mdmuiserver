<link rel="import" href="../../../bower_components/paper-radio-button/paper-radio-button.html">
<link rel="import" href="../../../bower_components/paper-checkbox/paper-checkbox.html">
<link rel="import" href="../../../bower_components/paper-icon-button/paper-icon-button.html">
<link rel="import" href="../pebble-image-viewer/pebble-image-viewer.html">
<dom-module id="grid-list-item">
	<template>
		<style include="shared-styles">
        </style>
        <style>
            .container {
                width: 100%;
                height: 20%;
                display: inline-flex;
                box-sizing: border-box;
                border-bottom: 1px solid #D0D7DE;
            }

            #image-container {
                width: 7%;
                background: #ddd;
                margin-top: 1%;
                margin-bottom:1%;
                margin-right:1%;
            }

            .content1 {
                width: 40%;
                margin : 1% 0%;
            }

            .content2 {
                width: 24%;
                margin : 1% 0%;
            }

            .content3 {
                width: 24%;
                margin : 1% 0%;
            }

            .left {
                width : 3%;
                text-align: center;
            }

            .button-container {
                position:relative;
                top:40%; 
                left:8%;
            }

            .trim {
                display: block;
                width: 100%;
                text-overflow: ellipsis;
                overflow: hidden;
                white-space:nowrap;
            }

            .default {
                margin-right : 5%;
                width : 95%;
            }
            
            .title {
                font-size:18px;
                font-weight: 500;
            }
        </style>
        <div class="container" on-tap="_tapEvent">
            <div class = "left">
                <paper-checkbox class = "button-container" checked$="{{selected}}"></paper-checkbox>
                <!--<paper-radio-button class = "button-container" checked$></paper-radio-button>-->
            </div>
            <!--<div >-->
                <pebble-image-viewer alt="Product image." id = "image-container" sizing="contain" src="[[item.image]]"></pebble-image-viewer>
            <!--</div>-->
            <div class = "content1">
                <div class = "title">
                    [[item.title]]
                </div>
                <div>#[[item.id]]</div>
                <template is="dom-if" if="{{_areFieldsGreaterThan3(item.fields)}}">
                    <br />
                </template>

                <template is="dom-repeat" items="{{firstColFields}}">
                    <div><span class$ = "{{_computeClass(item.noTrim)}}">{{_getDisplayName(item.label,item.name)}}: &nbsp[[item.value]]</span></div>
                </template>    
            </div>
            <div class = "content2">
                 <template is="dom-repeat" items="{{secColFields}}">
                    <div><span class$ = "{{_computeClass(item.noTrim)}}">{{_getDisplayName(item.label,item.name)}}: &nbsp[[item.value]]</span></div>
                </template>  
            </div>
            <div class = "content3">
                <template is="dom-repeat" items="{{thirdColFields}}">
                    <div><span class$ = "{{_computeClass(item.noTrim)}}">{{_getDisplayName(item.label,item.name)}}: &nbsp[[item.value]]</span></div>
                </template> 
            </div>
            <div class = "right">
                <paper-icon-button class="dropdown-trigger" name="more" icon="icons:more-vert" title="More options"></paper-icon-button>
            </div>        
        </div>
    </template>
	<script> 
      (function() {
            'use strict';
            
            Polymer( {
                is: 'grid-list-item', 
                 properties: {
                     selected : {
                         type:Boolean,
                         value:false,
                         notify:true,
                         reflectToAttribute : true
                     },

                     index : {
                         type:Number
                     },

                     item : {
                         type: Object,
                         observer : '_splitIntoCols'
                     },
                     firstColFields : {
                         type:Array,
                         value :[]
                     },
                     secColFields : {
                         type:Array,
                         value :[]
                     },
                     thirdColFields : {
                         type : Array,
                         value :[]
                     }
                 },
                 _splitIntoCols : function() {
                     if(this.item && this.item.fields && this.item.fields.length > 0) {
                         var totalFields = this.item.fields.length;
                         var n = totalFields/3+1;
                         if(totalFields < 3) {
                           this.secColFields = this.item.fields.slice(0,1);
                           this.thirdColFields = this.item.fields.slice(1,totalFields);
                         } else if (totalFields == 3) {
                            this.secColFields = this.item.fields.slice(0,2);
                           this.thirdColFields = this.item.fields.slice(2,totalFields);
                         } else {
                            if(totalFields % 3 == 0) {
                                this.firstColFields = this.item.fields.slice(0,n-3);
                                this.secColFields = this.item.fields.slice(n-3,2*n-3);
                                this.thirdColFields = this.item.fields.slice(2*n-3,totalFields);
                            } else {
                                this.firstColFields = this.item.fields.slice(0,n-2);
                                this.secColFields = this.item.fields.slice(n-2,2*n-2);
                                this.thirdColFields = this.item.fields.slice(2*n-2,totalFields);
                            }
                         }
                     }
                 },
                 _getDisplayName(label,name) {
                     if(label) {
                         return label;
                     }
                     return name;
                 },
                 _computeClass(noTrim) {
                     if(noTrim) {
                         return 'default';
                     }
                     return 'default trim';
                 },
                 _areFieldsGreaterThan3(fields) {
                    if(fields && fields.length > 4) {
                        return true;
                    }
                    return false;
                 },
                 _tapEvent : function() {
                     if(this.selected) {
                        this.fire('deselecting-item',this.item);
                     } else {
                          this.fire('selecting-item',this.item);
                     }
                     this.selected = !this.selected;

                 }
            });
        })();
    </script>
</dom-module>    