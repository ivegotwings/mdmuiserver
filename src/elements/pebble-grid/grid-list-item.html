<link rel="import" href="../../../bower_components/paper-radio-button/paper-radio-button.html">
<link rel="import" href="../../../bower_components/paper-checkbox/paper-checkbox.html">
<link rel="import" href="../../../bower_components/paper-icon-button/paper-icon-button.html">
<link rel="import" href="../pebble-image-viewer/pebble-image-viewer.html">

<!--
`grid-list-item`
Element displaying the item in grid-list-view.

@demo demo/index.html
-->

<dom-module id="grid-list-item">
	<template>
		<style include="shared-styles">
        </style>
        <style>
            .container {
                width: 100%;
                height: 20%;
                display: inline-flex;
                box-sizing: border-box;
                border-bottom: 1px solid #D0D7DE;
            }

            #image-container {
                width: 7%;
                background: #ddd;
                margin-top: 1%;
                margin-bottom:1%;
                margin-right:1%;
            }

            .content1 {
                width: 40%;
                margin : 1% 0%;
            }

            .content2 {
                width: 24%;
                margin : 1% 0%;
            }

            .content3 {
                width: 24%;
                margin : 1% 0%;
            }

            .left {
                width : 3%;
                text-align: center;
            }

            .button-container {
                position:relative;
                top:40%; 
                left:8%;
            }

            .trim {
                display: block;
                width: 100%;
                text-overflow: ellipsis;
                overflow: hidden;
                white-space:nowrap;
            }

            .default {
                margin-right : 5%;
                width : 95%;
            }
            
            .title {
                font-size:18px;
                font-weight: 500;
            }
        </style>
        <div class="container" on-tap="_tapEvent">
            <div class = "left">
                <paper-checkbox class = "button-container" checked$="{{_selected}}"></paper-checkbox>
                <!--<paper-radio-button class = "button-container" checked$></paper-radio-button>-->
            </div>
            <!--<div >-->
                <pebble-image-viewer alt="Product image." id = "image-container" sizing="contain" src="{{_computeImage(item,itemsToDisplay.image)}}"></pebble-image-viewer>
            <!--</div>-->
            <div class = "content1">
                <div class = "title">
                    [[_computeTitle(item,itemsToDisplay.title)]]
                </div>
                <div>#[[_computeId(item,itemsToDisplay.id)]]</div>
                <template is="dom-if" if="{{_areFieldsGreaterThan4(itemsToDisplay.fields)}}">
                    <br />
                </template>

                <template is="dom-repeat" items="{{_firstColFields}}" as="field">
                    <div><span class$ = "{{_computeClass(field.noTrim)}}">{{_getDisplayName(field.label,field.name)}}: &nbsp[[_computeValue(item,field.name)]]</span></div>
                </template>    
            </div>
            <div class = "content2">
                 <template is="dom-repeat" items="{{secColFields}}" as="field">
                    <div><span class$ = "{{_computeClass(field.noTrim)}}">{{_getDisplayName(field.label,field.name)}}: &nbsp[[_computeValue(item,field.name)]]</span></div>
                </template>  
            </div>
            <div class = "content3">
                <template is="dom-repeat" items="{{thirdColFields}}" as="field">
                    <div><span class$ = "{{_computeClass(field.noTrim)}}">{{_getDisplayName(field.label,field.name)}}: &nbsp[[_computeValue(item,field.name)]]</span></div>
                </template> 
            </div>
            <div class = "right">
                <paper-icon-button class="dropdown-trigger" name="more" icon="icons:more-vert" title="More options"></paper-icon-button>
            </div>        
        </div>
    </template>
	<script> 
      (function() {
            'use strict';
            
            Polymer( {
                is: 'grid-list-item', 
                 properties: {
                     /**
                      * This is an internal property, represents if an item is selected.
                      */
                     _selected : {
                         type:Boolean,
                         value:false,
                         notify:true,
                         reflectToAttribute : true
                     },
                    
                    /**
                     * This indicates the index of the item in grid-list-view.
                     */
                     index : {
                         type:Number
                     },

                     /**
                      * This represents the data of item to be displayed in grid-list-view.
                      */
                     item : {
                         type: Object,
                         observer : '_splitIntoCols'
                     },

                     /**
                      * This is an internal property, represents fields to be displayed in first column of grid-list-view.
                      */
                     _firstColFields : {
                         type:Array,
                         value :[]
                     },
                     /**
                      * This is an internal property, represents fields to be displayed in second column of grid-list-view.
                      */
                     secColFields : {
                         type:Array,
                         value :[]
                     },

                     /**
                      * This is an internal property, represents fields to be displayed in third column of grid-list-view.
                      */
                     thirdColFields : {
                         type : Array,
                         value :[]
                     },

                     /**
                      * This property represents the config of grid-list-view.
                      */
                     itemsToDisplay : {
                         type:Object
                     }
                 },

                 /**
                  * This is an internal function, used to split the fields into three columns.
                  */
                 _splitIntoCols : function() {
                     if(this.itemsToDisplay && this.itemsToDisplay.fields && this.itemsToDisplay.fields.length > 0) {
                         var totalFields = this.itemsToDisplay.fields.length;
                         var n = totalFields/3+1;
                         if(totalFields < 3) {
                           this.secColFields = this.itemsToDisplay.fields.slice(0,1);
                           this.thirdColFields = this.itemsToDisplay.fields.slice(1,totalFields);
                         } else if (totalFields == 3) {
                            this.secColFields = this.itemsToDisplay.fields.slice(0,2);
                           this.thirdColFields = this.itemsToDisplay.fields.slice(2,totalFields);
                         } else {
                            if(totalFields % 3 == 0) {
                                this._firstColFields = this.itemsToDisplay.fields.slice(0,n-3);
                                this.secColFields = this.itemsToDisplay.fields.slice(n-3,2*n-3);
                                this.thirdColFields = this.itemsToDisplay.fields.slice(2*n-3,totalFields);
                            } else {
                                this._firstColFields = this.itemsToDisplay.fields.slice(0,n-2);
                                this.secColFields = this.itemsToDisplay.fields.slice(n-2,2*n-2);
                                this.thirdColFields = this.itemsToDisplay.fields.slice(2*n-2,totalFields);
                            }
                         }
                     }
                 },

                  /**
                  * This is an internal function, used to calculate the display name of an attribute.
                  */
                 _getDisplayName(label,name) {
                     if(label) {
                         return label;
                     }
                     return name;
                 },

                  /**
                  * This is an internal function, used to calculate the class to apply trim or not.
                  */
                 _computeClass(noTrim) {
                     if(noTrim) {
                         return 'default';
                     }
                     return 'default trim';
                 },

                  /**
                  * This is an internal function, returns true if number of fields to display is greater than 4.
                  */
                 _areFieldsGreaterThan4(fields) {
                    if(fields && fields.length > 4) {
                        return true;
                    }
                    return false;
                 },

                 /**
                  * This is an internal function to handle the tap event. It fires event 'deselecting-item' if an item was already selected.
                  *  It fires event 'selecting-item' if an item was not selected. The data of the event fired is the data of the item. 
                  */
                 _tapEvent : function() {
                     if(this._selected) {
                        this.fire('deselecting-item',this.item);
                     } else {
                          this.fire('selecting-item',this.item);
                     }
                     this._selected = !this._selected;

                 },

                 /**
                  * This is an internal function, used to compute the image url based on the config.
                  */
                 _computeImage : function(item,image) {
                    return item[image];
                 },

                 /**
                  * This is an internal function, used to compute the title based on the config.
                  */
                 _computeTitle : function(item,title) {
                    return item[title];
                 },
                  /**
                  * This is an internal function, used to compute the id based on the config.
                  */
                 _computeId : function(item,id) {
                    return item[id];
                 },

                  /**
                  * This is an internal function, used to compute the value of the attribute to be displayed.
                  */
                 _computeValue : function(item,field) {
                     return item[field];
                 }
            });
        })();
    </script>
</dom-module>    