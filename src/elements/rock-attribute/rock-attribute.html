<link rel="import" href="../../../bower_components/polymer/polymer.html">
<link rel="import" href="../../../bower_components/paper-icon-button/paper-icon-button.html">
<link rel="import" href="../../../bower_components/iron-icons/iron-icons.html">

<link rel="import" href="../pebble-textbox/pebble-textbox.html">
<link rel="import" href="../pebble-textarea/pebble-textarea.html">
<link rel="import" href="../pebble-dropdown/pebble-dropdown.html">
<link rel="import" href="../pebble-boolean/pebble-boolean.html">
<link rel="import" href="../pebble-icons/pebble-icons.html">

<!--
`rock-attribute`
Attribute component for riversand ui framework. Takes parameters to know details of the attribute 
and renders approproiate UI elements for managing an attribute value.

@demo demo/index.html 
-->

<dom-module id="rock-attribute">
  <template>
    <style include="shared-styles">
      .attribute-main {
        padding-bottom:10px;
        width:70%;
      }
      /*.attribute-edit {
        
      }*/

      .attribute-view {
        clear:both;
      }

      .attribute-icons {
        height:32px;
      }

      .attribute-icons paper-icon-button {
        float:right;
        width:32px;
      }
      
    </style>
    <div class="attribute-main">
      <div class="attribute-icons">
        <template is="dom-if" if="[[!_isEditMode(mode)]]">
          <paper-icon-button name="edit" icon="pebble-icons:create" title="Edit" on-tap="_onEditClick" tabindex="-1"></paper-icon-button>
        </template>
        <template is="dom-if" if="[[_isEditMode(mode)]]">
          <paper-icon-button name="revert" icon="pebble-icons:refresh" title="Revert" on-tap="_onRevertClick" tabindex="-1"></paper-icon-button>
        </template>
      </div>
      <template is="dom-if" if="[[_isEditMode(mode)]]">
        <div class="attribute-edit">
          <template is="dom-if" if="[[_isTextArea(attributeModelObject.displayType)]]">
            <pebble-textarea 
            label="{{attributeModelObject.longName}}" value="{{attributeObject.value}}"
            required="[[attributeModelObject.required]]"
            minlength="[[attributeModelObject.minLength]]" maxlength="[[attributeModelObject.maxLength]]"
            ></pebble-textarea>
          </template>
          <template is="dom-if" if="[[_isDropDown(attributeModelObject.displayType)]]">
            <pebble-dropdown label="{{attributeModelObject.longName}}" items="{{attributeModelObject.allowedValues}}" selected-value="{{attributeObject.value}}"></pebble-dropdown>
          </template>
          <template is="dom-if" if="[[_isBoolean(attributeModelObject.displayType)]]">
            <pebble-boolean label="{{attributeModelObject.longName}}" value="{{attributeObject.value}}"></pebble-boolean>
          </template>
          <!-- If display type is not supported then textbox is used -->
          <template is="dom-if" if="[[_isTextBox(attributeModelObject.displayType)]]">
            <pebble-textbox 
            label="{{attributeModelObject.longName}}" value="{{attributeObject.value}}"
            required="[[attributeModelObject.required]]" 
            minlength="[[attributeModelObject.minLength]]" maxlength="[[attributeModelObject.maxLength]]"
            auto-validate="true"
            ></pebble-textbox>
          </template>
        </div>
      </template>
      <template is="dom-if" if="[[!_isEditMode(mode)]]">
        <br>
        <div class="attribute-view">
          <span style="font-weight:bold">{{attributeModelObject.longName}}:</span><br>
          <span > {{attributeObject.value}}</span><br>
        </div>
      </template>
    </div>
  </template>

  <script>
    (function() {
      'use strict';

      Polymer({
        is: 'rock-attribute',
        properties: {
          // name: {
          //   type: String,
          //   value: ""
          // },
          // displayType: {
          //   type: String,
          //   value: ""
          // },
          // allowedValues: {
          //   type: String,
          //   value: ""
          // },
          /**
          * Indicates whether the attribute should be rendered in edit mode or view. 
            Two possible values are <b>view</b> and <b>edit</b>
          */
          mode: {
            type: String,
            value: "view",
            notify: true
          },
          /**
          * Indicates the JSON for the attribute value object. Changes to the value by user are recorded in this object.
          * Sample: {
                      "value":"Nivea Creme 400 Ml"
                    }
          */
          attributeObject: {
            type: Object,
            value: function (){
              return {};
            },
            notify: true
          },
          /**
          * Indicates the JSON for the attribute model object. 
          * It is used to render appropriate UI element to edit the attribute and to configure validation and other behaviors.
          * Sample: {
                      "name": "name",
                      "longName": "Name",
                      "displayType": "textbox",
                      "minLength": 5,
                      "maxLength": 10 
                    }
          */
          attributeModelObject: {
            type: Object,
            value: function (){
              return {};
            }
          }
        },
        _isEditMode: function(mode) {
          return mode === "edit";
        },
        _onChange: function(event) {
          //todo: this is not working right now, have to find out how to propagate change event up the control hierarchy
          if (this.shadowRoot) {
            this.fire(event.type, {
              sourceEvent: event
            }, {
              node: this,
              bubbles: event.bubbles,
              cancelable: event.cancelable
            });
          }
        },
        _isTextBox: function(displayType) {
          //If display type is not supported then also textbox is used
          return displayType === "textbox" || 
            (!this._isTextArea(displayType) && !this._isDropDown(displayType) && !this._isBoolean(displayType));
        },
        _isTextArea: function(displayType) {
          return displayType === "textarea";
        },
        _isDropDown: function(displayType) {
          return displayType === "dropdown";
        },
        _isBoolean: function(displayType) {
          return displayType === "boolean";
        },
        _onEditClick: function(){
          this.mode = "edit";
        }
      });
    })();
  </script>

</dom-module>