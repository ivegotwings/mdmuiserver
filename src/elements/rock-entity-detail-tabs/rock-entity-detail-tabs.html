<link rel="import" href="../../../bower_components/polymer/polymer-element.html">

<link rel="import" href="../rock-tabs/rock-tabs.html">
<link rel="import" href="../rock-component-config-behavior/rock-component-config-behavior.html">
<link rel="import" href="../bedrock-component-context-behavior/bedrock-component-context-behavior.html">

<!--
@group rock Elements
@element rock-entity-detail-tabs
@demo demo/index.html
-->
<dom-module id="rock-entity-detail-tabs">
    <template>
        <style include="bedrock-style-common">
            :host{
                display:block;
                height:100%;
            }
            rock-tabs {
                --rock-tab-content: {
                    overflow-y: auto;
                    font-size: var(--default-font-size, 14px);
                    height:var(--tab-content-height,300px) !important;
                }
                --tab-error-circle: {
                    margin-bottom: 8px;
                }
            }
        </style>
        <rock-tabs id="rockTabs" view-mode="{{viewMode}}" config="[[_tabsConfig]]" readonly="[[readonly]]" deferred-render></rock-tabs>
    </template>
    <script>
        class RockEntityDetailTabs
            extends Polymer.mixinBehaviors([RUFBehaviors.UIBehavior, RUFBehaviors.ComponentContextBehavior, RUFBehaviors.ComponentConfigBehavior], Polymer.Element) {
            static get is() { return 'rock-entity-detail-tabs' }
            ready() {
                var tabContentHeight= window.innerHeight - 320; 
                this.updateStyles({
                    '--tab-content-height': tabContentHeight+"px"
                });
                super.ready();
            }
            static get properties() {
                return {
                    contextData: {
                        type: Object,
                        value: function() {
                            return {};
                        },
                        observer: '_onContextDataChange'
                    },
                    readonly: {
                        type: Boolean,
                        value: false
                    },
                    _tabsConfig: {
                        type: Object,
                        value: function() {
                            return {};
                        }
                    },
                    viewMode:{
                        type:String,
                        value:""
                    }
                }
            }
            /**
            *
            */
            connectedCallback() {
                super.connectedCallback();
            }
            /**
            *
            */
            disconnectedCallback() {
                super.disconnectedCallback();
            }
            _onContextDataChange() {
                if(!_.isEmpty(this.contextData)) {
                    var context = DataHelper.cloneObject(this.contextData);
                    //App specific
                    var appName = ComponentHelper.getCurrentActiveAppName();
                    if(appName) {
                        context[ContextHelper.CONTEXT_TYPE_APP] = [{
                            "app": appName
                        }];
                    }
                    
                    this.requestConfig('rock-entity-detail-tabs', context);
                }
            }
            onConfigLoaded(componentConfig) {
                if(componentConfig && componentConfig.config) {
                    var config = componentConfig.config;
                    if(!_.isEmpty(config.tabItems)) {
                        config.tabItems = DataHelper.convertObjectToArray(config.tabItems);    
                    }

                    this._tabsConfig = config;
                }
            }
            errorLengthChanged(detail) {
                var rockTabs = this.shadowRoot.querySelector('rock-tabs');
                if(rockTabs) {
                    rockTabs._currentTabErrorLength = detail;
                }
            }
            reloadCurrentTab() {
                var rockTabs = this.shadowRoot.querySelector('rock-tabs');
                if(rockTabs) {
                    rockTabs.reloadCurrentTab(); 
                }
            }
            reloadTabs() {
                var rockTabs = this.shadowRoot.querySelector('rock-tabs');
                if(rockTabs) {
                    rockTabs.reloadTabs();
                }
            }
            readyToRender(ready) {
                var rockTabs = this.shadowRoot.querySelector('rock-tabs');
                if(rockTabs) {
                    rockTabs.readyToRender(ready);
                }   
            }
            refresh(options) {
                var rockTabs = this.shadowRoot.querySelector('rock-tabs');
                if(rockTabs) {
                    rockTabs.refresh(options);
                }    
            }
            getIsDirty() {
                var tabs = this.shadowRoot.querySelector("rock-tabs");
                if (tabs && tabs.getIsDirty) {
                    return tabs.getIsDirty();
                }
            }
            getControlIsDirty() {
                var tabs = this.$$("rock-tabs");
                if (tabs && tabs.getControlIsDirty) {
                    return tabs.getControlIsDirty();
                }
            }
        }
        customElements.define(RockEntityDetailTabs.is, RockEntityDetailTabs);
    </script>
</dom-module>