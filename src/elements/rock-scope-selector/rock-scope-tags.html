<link rel="import" href="../../../bower_components/polymer/polymer.html">
<link rel="import" href="../bedrock-ui-behavior/bedrock-ui-behavior.html">
<link rel="import" href="../bedrock-helpers/data-helper.html">
<link rel="import" href="../pebble-button/pebble-button.html">


<!--
<b><i>Content development is under progress... </b></i>

@demo demo/index.html
-->
<dom-module id="rock-scope-tags">
    <template>
        <style include="pebble-styles-shared">
            pebble-button.action {
                display: inline-block;
                border: 1px solid var(--palette-cerulean, #036bc3);
                border-radius: 3px;
                height: 30px;
                margin: 0px 7px 10px 0px;

            --pebble-button: {
                height: 30px !important;
                color: var(--palette-cerulean);
                font-size: var(--default-font-size, 14px);
            }
            --pebble-button-iron-icon: {
                padding-top: 0px;
                padding-right: 5px;
                padding-bottom: 0px;
                padding-left: 0px;
            }
            --pebble-menu-button: {
                height: 30px !important;
                border-top: 1px solid var(--palette-cerulean);
                border-right: 1px solid var(--palette-cerulean);
                border-bottom: 1px solid var(--palette-cerulean);
                background: #FFFFFF;
                box-sizing: border-box;
            }
            --actions-icon-button: {
                height: 16px;
                width: 16px;
                background: #FFFFFF;
                color: var(--palette-cerulean);
                padding-top:0px !important;
                padding-right:0px !important;
                padding-bottom:0px !important;
                padding-left:0px !important;
                margin-top:0px;
                margin-right:5px;
                margin-bottom:0px;
                margin-left:5px;
                top: -2px;
            }
            --pebble-button-paper-menu: {
                background: #FFFFFF;
            }
            --pebble-button-paper-menu-item: {
                background: #FFFFFF;
                color: var(--palette-cerulean);
                padding-top: 0px;
                padding-right: 8px;
                padding-bottom: 0px;
                padding-left: 8px;
            }
            --paper-button-text:{
                padding: 0px 2px 0px 0px;
                max-width: 225px;
          }
        }

        </style>
        <template is="dom-if" if="[[_scopeButtons.length]]]]">
            <template is="dom-repeat" items="[[_scopeButtons]]" as="scope">
                <pebble-button class="action" noink raised action-menu elevation="0" horizontal-align="right" vertical-align="top" icon="[[scope.icon]]"
                    button-text="[[scope.name]]" data="[[scope]]" actions-data="[[_getActionData(actionsData,scope)]]" enable-ellipsis="true">>
                </pebble-button>
            </template>
        </template>
        <template is="dom-if" if="[[_showMessage(_scopeButtons, loading)]]">
            <div>You don't have any [[scopeCategory]] yet.</div>
        </template>
    </template>
    <script>
        (function () {
            'use strict';

            Polymer({

                is: 'rock-scope-tags',

                properties: {
                    /*
                     * Indicates the name of the scope category for which the tags are loaded.
                     */
                    scopeCategory: {
                        type: String
                    },

                    /**
                     * Indicates the scopes.
                     */
                    scopes: {
                        type: Object,
                        notify: true,
                        value: function () {
                            return {}
                        },
                        observer: '_loadScopes'
                    },

                    loading: {
                        type: Boolean,
                        value: false
                    },

                    _scopeButtons: {
                        type: Array,
                        notify: true,
                        value: function () {
                            return []
                        },
                    },
                    actionsData: {
                        type: Object,
                        notify: true,
                        value: function () {
                            return {
								"favourites": [
									{
										"name": "favourites",
										"icon": "pebble-icons:Star",
										"text": "",
										"visible": true,
										"eventName": "favourite-scope"
									},
									{
										"name": "delete",
										"icon": "pebble-icons:Delete",
										"text": "",
										"visible": true,
										"eventName": "delete-scope"
									},
									{
										"name": "edit",
										"icon": "pebble-icons:Edit",
										"text": "",
										"visible": true,
										"eventName": "edit-scope"
									}
								],
								"my-scopes": [
									{
										"name": "favourites",
										"icon": "pebble-icons:Star",
										"text": "",
										"visible": true,
										"eventName": "favourite-scope"
									},
									{
										"name": "delete",
										"icon": "pebble-icons:Delete",
										"text": "",
										"visible": true,
										"eventName": "delete-scope"
									},
									{
										"name": "edit",
										"icon": "pebble-icons:Edit",
										"text": "",
										"visible": true,
										"eventName": "edit-scope"
									}
								],
								"shared-scopes": [
									{
										"name": "favourites",
										"icon": "pebble-icons:Star",
										"text": "",
										"visible": true,
										"eventName": "favourite-scope"
									},
									{
										"name": "delete",
										"icon": "pebble-icons:Delete",
										"text": "",
										"visible": true,
										"eventName": "delete-scope"
									},
									{
										"name": "edit",
										"icon": "pebble-icons:Edit",
										"text": "",
										"visible": true,
										"eventName": "edit-scope"
									}
								]
							}
                        }
                    }
                },
                behaviors: [
                    RUFBehaviors.UIBehavior
                ],

                /**
                 *   <b><i>Content development is under progress... </b></i>
                 */
                ready: function () {
                    if(this.getParentAppConfig('rock-scope-tags')) {
                        this.actionsData = this.getParentAppConfig('rock-scope-tags');
                    }
                },
                _showMessage: function(_scopeButtons, loading) {
                    return _.isEmpty(_scopeButtons) && !loading;
                },
                _loadScopes: function () {
                    if (this.scopes) {
                        this._scopeButtons = this.scopes[this.scopeCategory];
                    }
                },
                _getActionData: function (e,scopeObj) {
                    //delete functionality made available only to the creator of the scope.
                    var actionsDataArray = DataHelper.cloneObject(this.actionsData[this.scopeCategory]);
                    var currentUser = DataHelper.getUserId();
                    if(actionsDataArray) {
                        for(var i=0; i < actionsDataArray.length; i++) {
                            if((actionsDataArray[i].name.toLowerCase()=='delete' || actionsDataArray[i].name.toLowerCase()=='edit') &&  currentUser != scopeObj.createdby) {
                               this.actionsData[this.scopeCategory].splice(i,1);
                            }
                        }
                    }
                    return this.actionsData[this.scopeCategory];
                }
            });

        })();
    </script>
</dom-module>