<link rel="import" href="../rock-layout/rock-layout.html">
<link rel="import" href="../rock-layout/rock-titlebar/rock-titlebar.html">
<link rel="import" href="../rock-layout/rock-header/rock-header.html">
<link rel="import" href="../rock-layout/rock-header-sidebar/rock-header-sidebar.html">
<link rel="import" href="../pebble-grid/demo/demo-grid-element.html">
<link rel="import" href="../rock-search-bar/rock-search-bar.html">
<link rel="import" href="../rock-search-filter/rock-search-filter.html">
<link rel="import" href="../rock-dimension-selector/rock-dimension-selector.html">
<link rel="import" href="../pebble-vertical-divider/pebble-vertical-divider.html">
<link rel="import" href="../bedrock-pubsub/bedrock-pubsub.html">

<dom-module id="app-entity-discovery">
  <template>
    <style include="pebble-shared-styles"></style>
    <style is="custom-style">
      #savedSearches {
        --pebble-button: {
          height: 30px;
          padding: 1em 0.5em 1em 0.5em;
          vertical-align: middle;
          color: #2068BD;
          border: 1px solid #2068BD;
        }
      }
      
      rock-search-bar {
        display: inline-flex;
        width: 85%;
      }
      
      rock-search-filter::shadow paper-menu-button {
        padding: 4px;
      }
      
      #dimensionContainer {
        align-self: center;
        margin-bottom: 17px;
        width: 100%;
      }
      
      pebble-vertical-divider {
        --pebble-vertical-divider-color: black;
        min-width: 0px;
        margin: 5px 0px;
      }

      #savedSearchPopover {
        margin-top: 10px;
        width: 100%;
      }

      rock-search-filter::shadow paper-menu-button paper-menu{
        background: #ffffff;
      }

      :root{
        --pebble-popover-max-width: 500px;
      }

    </style>
    <rock-layout>
      <rock-titlebar icon="search" title="Entity Search & Discovery" sub-title="Product 1" closable minimizable>
        <div id="dimensionContainer" align="right">
          <iron-ajax auto url="../../data/EntitySearchApp/dimensionData.json" handle-as="json" last-response="{{dimensionData}}"></iron-ajax>
          <rock-dimension-selector config-data="{{dimensionData}}"></rock-dimension-selector>
          <bedrock-pubsub on-bedrock-event-catalogchanged="onCatalogChange"></bedrock-pubsub>
          <bedrock-pubsub on-bedrock-event-sourcechanged="onSourceChange"></bedrock-pubsub>
          <bedrock-pubsub on-bedrock-event-localechanged="onLocaleChange"></bedrock-pubsub>
        </div>
        <pebble-vertical-divider></pebble-vertical-divider>
      </rock-titlebar>
      <rock-header>
        <div class="fixed-content">
          <rock-search-bar id="searchBar" placeholder="Enter Search text"></rock-search-bar>
          <pebble-button id="savedSearches" class="iconTextButton" icon="history" button-text="Saved Searches" 
          noink raised elevation="2" on-tap="_onTap"></pebble-button>
          <pebble-popover id="savedSearchPopover" for="savedSearches" auto-fit-on-attach no-overlap horizontal-align="right">
              <rock-saved-searches id="rockSavedSearches"></rock-saved-searches>                   
          </pebble-popover>
          <rock-search-filter id="search-filter" hide-search-trigger></rock-search-filter>
          <bedrock-pubsub on-bedrock-event-tag-value-change="onSearchTagValueChange"></bedrock-pubsub>
        </div>
        <div class="shrunk-content">
        </div>
      </rock-header>
      <iron-ajax auto url="../../data/EntitySearchApp/gridConfig.json" handle-as="json" last-response="{{gridConfig}}"></iron-ajax>
      <iron-ajax auto url="../../data/EntitySearchApp/gridData.json" handle-as="json" last-response="{{gridData}}"></iron-ajax>
      <pebble-grid id="entityGrid" config="{{gridConfig}}" page-size="10" size="{{gridData.length}}" data="{{gridData}}"></pebble-grid>
    </rock-layout>
  </template>

  <script>
    (function() { 
      'use strict';

      Polymer({
        is: 'app-entity-discovery',
        ready: function(){
          this.$$("#searchBar").searchInput = [
           { "name": "Brand", "value": "Levis" },
           { "name": "Color", "value": "Red"   },
           { "name": "Size", "value": "Medium" },
           { "name": "Name", "value": "Extreme"}
          ];

           this.$$('#search-filter').tags = [
           { "name": "Brand", "value": "Levis", "editMpde": false },
           { "name": "Color", "value": "Red", "editMpde": false  },
           { "name": "Size", "value": "Medium", "editMpde": false },
           { "name": "Name", "value": "Extreme", "editMpde": false}
          ];
          this.$$('#search-filter').filters = [
            "Source", "Locale", "Name"
          ];

         },
         onCatalogChange: function(e, detail, sender) {
            if(detail != undefined){
              //alert("event triggered for catalog Changed and current object is: " + JSON.stringify(detail));
            }                    
         },
         onSourceChange: function(e, detail, sender) {
            if(detail != undefined){
              //alert("event triggered for source Changed and current object is: " + JSON.stringify(detail));
            }                    
         },
         onLocaleChange: function(e, detail, sender) {
            if(detail != undefined){
              alert("event triggered for locale Changed and current object is: " + JSON.stringify(detail));
            }                    
         },
         _onTap: function(e) {
            this.$$('#savedSearchPopover').show();                   
		     },
         onSearchTagValueChange: function(e, detail, sender){
            if(detail != undefined){
              alert("event triggered for search tag value changed and current object is: " + JSON.stringify(detail));
            }                    
         },
         properties: {
          
         }
      });
    })();
  </script>

</dom-module>