<link rel="import" href="../../../bower_components/polymer/polymer-element.html">

<link rel="import" href="../pebble-toolbar/pebble-toolbar.html">

<link rel="import" href="../rock-component-config-behavior/rock-component-config-behavior.html">
<link rel="import" href="../bedrock-component-context-behavior/bedrock-component-context-behavior.html">

<!--
@group rock Elements
@element rock-toolbar-actions
@demo demo/index.html
-->
<dom-module id="rock-toolbar-actions">
    <template>
        <style include="bedrock-style-common"></style>
        <style>
        </style>
        <pebble-toolbar id="toolbar" readonly$="[[readonly]]" config-data="[[_toolbarConfig]]"></pebble-toolbar>
        <bedrock-pubsub event-name="toolbar-button-event" handler="_onToolbarEvent" target-id="toolbar"></bedrock-pubsub>
    </template>
    <script>
        class RockToolbarActions
            extends Polymer.mixinBehaviors([RUFBehaviors.UIBehavior, RUFBehaviors.ComponentContextBehavior, RUFBehaviors.ComponentConfigBehavior], Polymer.Element) {
            static get is() { return 'rock-toolbar-actions' }
            ready() {
                super.ready();
            }
            static get properties() {
                return {
                    contextData: {
                        type: Object,
                        value: function() {
                            return {};
                        },
                        observer: '_onContextDataChange'
                    },
                    readonly: {
                        type: Boolean,
                        value: false
                    },
                    _toolbarConfig: {
                        type: Object,
                        value: function() {
                            return {};
                        }
                    }
                }
            }
            /**
            *
            */
            connectedCallback() {
                super.connectedCallback();
            }
            /**
            *
            */
            disconnectedCallback() {
                super.disconnectedCallback();
            }
            _onContextDataChange() {
                if(!_.isEmpty(this.contextData)) {
                    this.requestConfig('rock-toolbar-actions', this.contextData);
                }
            }
            onConfigLoaded(componentConfig) {
                if(componentConfig && componentConfig.config) {
                    var toolbarConfig = componentConfig.config.toolbarConfig;
                    var buttonItems = DataHelper.convertObjectToArray(toolbarConfig.buttonItems);
                    for(var i = 0; i < buttonItems.length; i++) {
                        buttonItems[i].buttons = DataHelper.convertObjectToArray(buttonItems[i].buttons);
                    }
                    this._toolbarConfig = {"buttonItems": buttonItems};
                }
            }
            setPageRange(range) {
                if (this.shadowRoot && this.shadowRoot.querySelector('pebble-toolbar') && this.shadowRoot.querySelector('pebble-toolbar').shadowRoot.querySelector('pebble-button#pageRange')) {
				    this.shadowRoot.querySelector('pebble-toolbar').shadowRoot.querySelector('pebble-button#pageRange').buttonText = range;
				}
            }
            setAttributeToToolbarButton(btnName, attribute, addAttr) {
                if(!this.shadowRoot) {
                    return;
                }
                var toolBar = this.shadowRoot.querySelector("#toolbar");
                if (!toolBar) {
                    return;
                } else {
                    var deleteButton = toolBar.shadowRoot.querySelector("pebble-button#" + btnName);
                    if (!deleteButton) {
                        return;
                    }
                }
                if (addAttr) {
                    deleteButton.setAttribute(attribute, "");
                } else {
                    deleteButton.removeAttribute(attribute);
                }
            }
            _onToolbarEvent(e, detail) {
                this.fireBedrockEvent("rock-toolbar-button-event", detail);
            }
        }
        customElements.define(RockToolbarActions.is, RockToolbarActions);
    </script>
</dom-module>