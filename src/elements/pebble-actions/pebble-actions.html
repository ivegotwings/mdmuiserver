<link rel="import" href="../../../bower_components/polymer/polymer.html">
<link rel="import" href="../../../bower_components/paper-item/paper-item.html">
<link rel="import" href="../../../bower_components/iron-icon/iron-icon.html">
<link rel="import" href="../../../bower_components/shadycss/apply-shim.html">
<link rel="import" href="../../../bower_components/polymer/lib/elements/custom-style.html">

<link rel="import" href="../bedrock-ui-behavior/bedrock-ui-behavior.html">
<link rel="import" href="../bedrock-pubsub/bedrock-pubsub.html">

<link rel="import" href="../pebble-button/pebble-button.html">
<link rel="import" href="../pebble-popover/pebble-popover.html">
<link rel="import" href="../pebble-icons/pebble-icons.html">
<link rel="import" href="../pebble-icon/pebble-icon.html">


<!--
`pebble-actions` Represents a material design element which contains a button and a list of action items.
You can perform these actions on the page or element based on the given configurations.

### Styling

The following custom properties and mixins are available for styling:

Custom property | Description | Default
----------------|-------------|----------
`--pebble-actions-button`|Mix in applied to the button| {}
`--pebble-actions-button-icon`|Mix in applied to the icon of the button| {}
`--pebble-actions-button-drop-down-icon`|Mix in applied to the drop-down icon of the button| {}

@group Pebble Elements
@element pebble-actions
@demo demo/index.html
-->
<dom-module id="pebble-actions">
    <template>
        <style include="pebble-styles-shared"></style>
        <style include="iron-flex"></style>
        <custom-style>
        <style>
              :host {
                display: inline-block;
                font-weight: 400;
                line-height: 1.25;
                height: 30px;
                text-align: center;
                white-space: nowrap;
                vertical-align: middle;
                -webkit-user-select: none;
                -moz-user-select: none;
                -ms-user-select: none;
                user-select: none;
                font-size: var(--default-font-size);
                border-radius: 3px;
                -webkit-transition: all .2s ease-in-out;
                transition: all .2s ease-in-out;
                box-sizing: border-box;
                text-transform: capitalize;
                --pebble-button: {
                    padding-right: 5px;
                };
            }
            #actions {
                display: inline-block;
                font-weight: 500;
                line-height: 1.25;
                height: 30px;
                text-align: center;
                white-space: nowrap;
                vertical-align: middle;
                -webkit-user-select: none;
                -moz-user-select: none;
                -ms-user-select: none;
                user-select: none;
                font-size: var(--default-font-size, 14px);
                border-radius: 3px;
                -webkit-transition: all .2s ease-in-out;
                transition: all .2s ease-in-out;
                box-sizing: border-box;
                text-transform: capitalize;

                --pebble-button: {
                    height: 30px;
                    margin: 0;
                    background-color:#09c021;
                    font-size: var(--font-size-sm, 12px);
                    font-weight:var(--font-medium,500) !important;
                    @apply --pebble-actions-button;
                    color: var(--palette-white,#fff);
                };
                 --pebble-button-left-icon: {
                    height: 16px;
                    width: 16px ;
                    padding:0px;
                    @apply --pebble-actions-button-icon;
                };
                --pebble-button-dropdown-icon: {
                    height: 24px;
                    width: 24px;
                    color: var(--palette-white,#fff);
                    margin: 0 5px;
                    @apply --pebble-actions-button-drop-down-icon;
                };
            }
            #actionsPopover {
                margin-top: 2px;
                @apply --pebble-manual-actions;
            }

            :host(.dropdown-outline-primary) {
                --pebble-button: {
                    border-color: transparent;
                    color: var(--primary-button-color, #139ee7);
                    background-color: var(--palette-white);
                };                
            }
            :host(.dropdown-outline-primary) {
                --pebble-button-right-icon: {
                    color: var(--primary-button-color, #036bc3);                    
                };
            } 
            :host(#quick-actions) {
                --pebble-button-right-icon: {
                    margin-right: 0;
                };
            }
            
            pebble-popover paper-item iron-icon {
                --iron-icon-width: 18px;
                --iron-icon-height: 18px;
                color: var(--pagetitle-text-color,#034c89);
            }
            .badge {
                @apply --layout;
                @apply --layout-center-center;
                @apply --paper-font-common-base;
                font-weight: normal;
                font-size: var(--font-size-sm,12px);
                border-radius: 50%;
                margin-right: 10px;
                width: 25px;
                height: 25px;
                background-color: var(--success-color,#36b44a);
                opacity: 1.0;
            }
            paper-item{
                padding:0px;
                height:1px;
            }
            paper-item #actionItem{
                line-height: 16px;
            }
            paper-item:hover{   
               color:var(--focused-line, #026bc3);
                background-color:var(--bgColor-hover,#e8f4f9);
            }
            paper-item:focus{
                background-color: #eaf3fc;
            }
            .popup-title{
                text-align:left;
                font-size:var(--font-size-sm, 12px);
                color:var(--text-primary-color,#1a2028);
                font-weight: var(--font-bold, bold);
                line-height: 24px;
                @apply --popup-item;
            }
            .list{
                @apply --layout-vertical;
            }
            .scroller{
                max-height: calc(var(--pebble-popover-height, 268px) - 94px);
                overflow-y: auto;
            }
             pebble-popover paper-item{
                @apply --popover-paper-item;
            } 
            pebble-popover paper-item #actionItem{
                @apply --popover-action-item;
            } 
            pebble-popover paper-item #actionItem:hover{
                @apply --popover-action-item-hover;
            } 
            pebble-popover paper-item #actionItem:focus{
                @apply --popover-action-item-focus;
            }    
         </style>
        </custom-style>
        <pebble-button id="actions" icon="[[buttonIcon]]" button-text="[[buttonText]]" noink dropdown-icon on-tap="_onActionsTap"></pebble-button>
        <pebble-popover id="actionsPopover" for="actions" auto-fit-on-attach no-overlap horizontal-align="right">
            <template is="dom-repeat" items="[[actionsData]]" as="group">
                    <div class="popup-title" hidden="[[!group.title]]">[[group.title]]</div>
                    <div class="scroller">
                        <template is="dom-repeat" items="[[group.actions]]" as="action">
                            <paper-item data="[[action]]" on-tap="_onActionItemTap">
                    <template is="dom-if" if="[[action.icon]]">
                        <pebble-icon icon="[[action.icon]]" class="pebble-xl-icons m-r-10"></pebble-icon>
                    </template>
                    <div id="actionItem">
                        <template is="dom-if" if="[[action.text]]">
                            [[action.text]]
                        </template>
                    </div>
                    </paper-item>
                    </template>
                </div>
            </template>            
        </pebble-popover>
    </template>
    <script>
        (function () {
            'use strict';

            Polymer({
                is: "pebble-actions",

                properties: {
                    /**
                    * Indicates an action items data.
                    */
                    actionsData: {
                        type: Array,
                        value: function () { return []; }
                    },
                    /**
                    * Indicates an optional icon which you can place on the left side to the button text.
                    */
                    buttonIcon: {
                        type: String,
                        value: function () { return null; }
                    },
                    /**
                    * Indicates the text of the button.
                    */
                    buttonText: {
                        type: String,
                        value: function () { return null; }
                    }
                },
                behaviors: [
                    RUFBehaviors.UIBehavior
                ],
                _onActionsTap: function (e) {
                    this.shadowRoot.querySelector('#actionsPopover').show();
                },
                _onActionItemTap: function (e) {
                    var eventName = "pebble-actions-action-click";
                    var eventDetail = {
                        name: eventName,
                        data: e.currentTarget.data
                    }
                    this.fireBedrockEvent(eventName, eventDetail,{ ignoreId: true });
                    this.shadowRoot.querySelector('#actionsPopover').hide();
                },
                getActionItems: function() {
                    var actionsPopover = this.$$("#actionsPopover");
                    if(actionsPopover) {
                        return actionsPopover.querySelectorAll("paper-item");
                    }
                }
            });
        })();
    </script>
</dom-module>