<link rel="import" href="../../../bower_components/polymer/polymer.html">
<link rel="import" href="../../../bower_components/paper-item/paper-item.html">
<link rel="import" href="../../../bower_components/iron-icon/iron-icon.html">
<link rel="import" href="../../../bower_components/shadycss/apply-shim.html">
<link rel="import" href="../../../bower_components/polymer/lib/elements/custom-style.html">

<link rel="import" href="../bedrock-ui-behavior/bedrock-ui-behavior.html">
<link rel="import" href="../bedrock-pubsub/bedrock-pubsub.html">
<link rel="import" href="../bedrock-style-manager/styles/bedrock-style-common.html">
<link rel="import" href="../pebble-button/pebble-button.html">
<link rel="import" href="../pebble-popover/pebble-popover.html">
<link rel="import" href="../pebble-icons/pebble-icons.html">
<link rel="import" href="../pebble-icon/pebble-icon.html">
<link rel="import" href="../bedrock-style-manager/styles/bedrock-styles-scroll-bar.html"/>
<link rel="import" href="../bedrock-style-manager/styles/bedrock-style-common.html">


<!--
`pebble-actions` Represents a material design element which contains a button and a list of action items.
You can perform these actions on the page or element based on the given configurations.

### Styling

The following custom properties and mixins are available for styling:

Custom property | Description | Default
----------------|-------------|----------
`--pebble-actions-button`|Mix in applied to the button| {}
`--pebble-actions-button-icon`|Mix in applied to the icon of the button| {}
`--pebble-actions-button-drop-down-icon`|Mix in applied to the drop-down icon of the button| {}

@group Pebble Elements
@element pebble-actions
@demo demo/index.html
-->
<dom-module id="pebble-actions">
    <template>
        <style include="bedrock-style-common bedrock-styles-scroll-bar"></style>
        <style include="iron-flex"></style>
        <custom-style>
        <style>
              :host, :host(.btn) {
                display: inline-block;
                vertical-align: middle;
                font-weight: 400;
                line-height: 1.25;
                height: 30px;
                text-align: center;
                border: 1px solid transparent;
                font-size: var(--default-font-size, 14px);
                border-radius: 3px;
                -webkit-transition: all .2s ease-in-out;
                transition: all .2s ease-in-out;
                box-sizing: border-box;
                text-transform: capitalize;  
                --pebble-button: {
                    padding-top:5px;
                    padding-left:10px;
                    padding-bottom:5px;
                    padding-right:10px;
                    height: 28px;
                    min-width: 75px;
                    font-weight: 500;
                    border:none;
                    margin-top:0px;
                    margin-right:0px;
                    margin-bottom:0px;
                    margin-left:0px;
                    @apply --pebble-actions-button;
                };
                --pebble-actions-button-icon: {
                    height: 16px;
                    width: 16px ;
                    @apply --pebble-actions-button-icon;
                };
                --pebble-button-dropdown-icon: {
                    height: 24px;
                    width: 24px;
                    color: var(--palette-white,#fff);
                    margin-top: 0;
                    margin-bottom:0;
                    margin-right:5px;
                    margin-left:5px;
                    @apply --pebble-actions-button-drop-down-icon;
                };
            }
            #actionsPopover {
                margin-top: 2px;
                @apply --pebble-manual-actions;
                --popover: {
                     padding-top:15px !important;
                     padding-bottom:15px !important;
                 } 
            }
            pebble-button {
                border: none;
            }            

            :host(.dropdown-outline-primary) {
                --pebble-button: {
                    border-color: transparent;
                    color: var(--primary-button-color, #139ee7);
                    background-color: var(--palette-white);
                };                
            }
            :host(.dropdown-outline-primary) {
                --pebble-button-right-icon: {
                    color: var(--primary-button-color, #036bc3);                    
                };
            }
            .dropdown {
                color: var(--primary-icon-color, #75808b);
                background-color: none;
                border-color: none
            }
            .btn.dropdown {
                --pebble-icon:{
                    color: var(--primary-icon-color, #75808b);
                };
            }

            .dropdownIcon, .dropdown-icon {
                --pebble-button-right-icon: {
                    margin-right: 5px;
                };
            }
            
            :host(.dropdown-secondary) {
                color: var(--secondary-button-text-color, #75808b);
                background-color: var(--secondary-button-color, #ffffff);
                border-color: var(--secondary-button-border-color, #c1cad4);
            }

            :host(.btn.dropdown-secondary) {
                --pebble-icon:{
                    color: var(--secondary-button-text-color, #75808b);
                };
            }
            :host(.dropdown-outline-primary) {
                border-color: var(--primary-border-button-color, #026bc3);
                color: var(--primary-border-button-text-color, #036bc3);
                background-color: var(--palette-white);
                --pebble-button-iron-icon: {
                    color:var(--palette-cerulean, #036bc3);
                }
            }
            
            :host(.dropdown-primary) {
                border-color: var(--primary-button-color, #139ee7);
                background: var(--primary-button-color, #139ee7);
                color: var(--button-text-color, #ffffff);
              }
            :host(.dropdown-success) {
                color: var(--button-text-color, #ffffff);
                background-color: var(--success-button-color, #09c021);
                border-color: var(--success-button-color, #09c021);
            }            
            .btn.dropdownText {
                font-weight:500;
                --pebble-button-left-icon: {
                    width: 16px!important;
                    height: 16px!important;
                }; 
            }
            .btn.dropdown {
                --pebble-button:{
                    padding-left: 5px;
                }
            }

            :host([disabled]) {
                opacity: 0.4;
                cursor: auto !important;
                pointer-events: none !important;
            }   
            
            #actionsPopover {
                margin-top: 2px;
                @apply --pebble-manual-actions;
            }         

            pebble-popover {
                --pebble-popover-width: 260px;
            }

            pebble-popover paper-item iron-icon {
                --iron-icon-width: 18px;
                --iron-icon-height: 18px;
                color: var(--pagetitle-text-color,#034c89);
            }
            .badge {
                @apply --layout;
                @apply --layout-center-center;
                @apply --paper-font-common-base;
                font-weight: normal;
                font-size: var(--font-size-sm,12px);
                border-radius: 50%;
                margin-right: 10px;
                width: 25px;
                height: 25px;
                background-color: var(--success-color,#36b44a);
                opacity: 1.0;
            }
            paper-item{
                padding:0px;
                height:1px;
            }
            paper-item #actionItem{
                line-height: 16px;
            }
            paper-item:hover{   
               color:var(--focused-line, #026bc3);
                background-color:var(--bgColor-hover,#e8f4f9);
            }
            paper-item:focus{
                background-color: #eaf3fc;
            }           
            .popup-title{
                text-align:left;
                font-size:var(--font-size-sm, 12px);
                color:var(--text-primary-color,#1a2028);
                font-weight: var(--font-bold, bold);
                line-height: 24px;
                @apply --popup-item;
            }
            .list{
                @apply --layout-vertical;
            }
            .scroller{
                max-height: calc(var(--pebble-popover-height, 268px) - 94px);
                overflow-y: auto;
            }
             
            pebble-popover paper-item{
                cursor: pointer;
                font-size: var(--font-size-sm, 12px);
                color: var(--palette-steel-grey, #75808b);
                text-align: left;
                transition: all 0.3s;
                -webkit-transition: all 0.3s;
                min-height: 40px;
                padding-left: var(--default-popup-item-l-p, 20px);
                padding-right: var(--default-popup-item-r-p, 20px);
                @apply --popover-action-item;
            } 
            pebble-popover paper-item #actionItem{
                @apply --popover-action-item;
            }
            pebble-popover paper-item #actionItem:hover{
                color:var(--focused-line, #026bc3);
                background-color:var(--bgColor-hover,#e8f4f9);
                @apply --popover-action-item-hover;
            } 
            pebble-popover paper-item #actionItem:focus{
                color: var(--primary-button-color, #036bc3);
                 background-color: var(--bgColor-hover, #e8f4f9);
                @apply --popover-action-item-focus;
            }
            pebble-popover paper-item iron-icon:hover{
                color: var(--focused-line, #026bc3) !important;
            }
         </style>
        </custom-style>
        <pebble-button id="actions" disabled$="[[readonly]]" icon="[[buttonIcon]]" button-text="[[buttonText]]" noink dropdown-icon on-tap="_onActionsTap"></pebble-button>
        <pebble-popover id="actionsPopover" for="actions" auto-fit-on-attach no-overlap horizontal-align="right">
            <template is="dom-repeat" items="[[actionsData]]" as="group">
                    <div class="popup-title" hidden="[[!group.title]]">[[group.title]]</div>
                    <div class="scroller">
                        <template is="dom-repeat" items="[[group.actions]]" as="action">
                            <paper-item data="[[action]]" on-tap="_onActionItemTap">
                    <template is="dom-if" if="[[action.icon]]">
                        <pebble-icon icon="[[action.icon]]" class="pebble-xl-icons m-r-10"></pebble-icon>
                    </template>
                    <div id="actionItem">
                        <template is="dom-if" if="[[action.text]]">
                            [[action.text]]
                        </template>
                    </div>
                    </paper-item>
                    </template>
                </div>
            </template>            
        </pebble-popover>
    </template>
    <script>
        (function () {
            'use strict';

            Polymer({
                is: "pebble-actions",

                properties: {
                    /**
                    * Indicates an action items data.
                    */
                    actionsData: {
                        type: Array,
                        value: function () { return []; }
                    },
                    /**
                     * If set as true , it indicates the component is in read only mode
                     */
                    readonly: {
                        type: Boolean,
                        value: false                       
                    },
                    /**
                    * Indicates an optional icon which you can place on the left side to the button text.
                    */
                    buttonIcon: {
                        type: String,
                        value: function () { return null; }
                    },
                    /**
                    * Indicates the text of the button.
                    */
                    buttonText: {
                        type: String,
                        value: function () { return null; }
                    }
                },
                behaviors: [
                    RUFBehaviors.UIBehavior
                ],
                _onActionsTap: function (e) {
                    if (e.currentTarget.disabled == true) {
                        return;
                    }
                    this.shadowRoot.querySelector('#actionsPopover').show();
                },
                _onActionItemTap: function (e) {
                    var eventName = "pebble-actions-action-click";
                    var eventDetail = {
                        name: eventName,
                        data: e.currentTarget.data
                    }
                    this.fireBedrockEvent(eventName, eventDetail,{ ignoreId: true });
                    this.shadowRoot.querySelector('#actionsPopover').hide();
                },
                getActionItems: function() {
                    var actionsPopover = this.$$("#actionsPopover");
                    if(actionsPopover) {
                        return actionsPopover.querySelectorAll("paper-item");
                    }
                } 
            });
        })();
    </script>
</dom-module>