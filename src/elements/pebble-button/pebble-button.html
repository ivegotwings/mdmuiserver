<link rel="import" href="../../../bower_components/polymer/polymer.html" />
<link rel="import" href="../../../bower_components/paper-button/paper-button.html" />
<link rel="import" href="../../../bower_components/paper-item/paper-item.html" />
<link rel="import" href="../../../bower_components/paper-menu/paper-menu.html" />
<link rel="import" href="../../../bower_components/paper-menu-button/paper-menu-button.html" />
<link rel="import" href="../../../bower_components/iron-icon/iron-icon.html"/>
<link rel="import" href="../../../bower_components/iron-icons/iron-icons.html" />

<!--
`<pebble-button>` Represents a button with Material Design styling. It exhibits bahaviour of a simple button as well a button with dropdown menu. 
 
 In simple button mode, when the user touches the button, a ripple effect emanates from the point of contact. It may be flat or raised. A raised button is styled with a shadow.
  
 Dropdown menu mode, allows the user to compose a designated "trigger" element with another element that represents "content", to create a dropdown menu that displays the "content" when the "trigger" is clicked.
 The child element with the class dropdown-trigger will be used as the "trigger" element. The child element with the class dropdown-content will be used as the "content" element.
 The pebble-button is sensitive to its content's iron-select events. If the "content" element triggers an iron-select event, the pebble-button will close automatically.

### Styling

The following custom properties and mixins are available for styling:

Custom property | Description | Default
----------------|-------------|----------
`--pebble-button-background-color`       | Menu background color                 | `--primary-background-color`
`--pebble-button-foreground-color`       | Menu foreground color                 | `--primary-text-color`
`--pebble-button`                        | Mixin applied to the pebble button    | `{}`
`--pebble-button-hover`                  | Mixin applied to hover                | `{}`
`--pebble-button-iron-icon`              | Mixin applied to the icon             | `{}`
`--pebble-menu-button`                   | Mixin applied to the paper menu button| `{}`
`--pebble-button-paper-menu`             | Mixin applied to the paper menu       | `{}`
`--pebble-button-paper-menu-item`        | Mixin applied to the paper menu item  | `{}`

### Accessibility

`<pebble-button>` by default behaves as a simple button and when button-menu attribute is specified in the markup, button will have dropdown menu.  
 
 To display an icon, use the icon property.
 
 To display text, use the button-text property.
 
 For mouse over, color, ripple, elevation and any other css properties use the available mixins.

@group Pebble Elements
@element pebble-button
@demo demo/index.html
-->

<dom-module id="pebble-button">
  <template>
      <style>

        paper-button{            
            background: var(--pebble-button-background-color);
            color: var(--pebble-button-foreground-color);
            text-transform: none;
            @apply(--pebble-button);          
        }

        paper-button:hover{      
            @apply(--pebble-button-hover);                                 
        }

        paper-button iron-icon{
            @apply(--pebble-button-iron-icon);
        }

        paper-menu-button{
            @apply(--pebble-menu-button);
        }

        paper-menu-button paper-menu{            
            @apply(--pebble-button-paper-menu);
        }

        paper-menu-button paper-menu paper-item {
            @apply(--pebble-button-paper-menu-item);
        }

        paper-menu-button paper-button{
            background: var(--pebble-button-background-color);
            color: var(--pebble-button-foreground-color);
            text-transform: none;
            @apply(--pebble-button);
        }

        paper-menu-button paper-button iron-icon{
            @apply(--pebble-button-iron-icon);
        }

      </style>
        	<template is="dom-if" if="[[!menuButton]]" >
                <paper-button id="simpleButton"                   
                    raised$="[[raised]]" 
                    elevation$="[[elevation]]"
                    noink$= "[[noink]]"
                    toggles$= "[[toggles]]"
                    
                >
                    <template is="dom-if" if="[[icon]]" >
                        <iron-icon icon$="[[icon]]"></iron-icon>   
                    </template>
                    <template is="dom-if" if="[[buttonText]]" >
                       [[buttonText]]   
                    </template>
                </paper-button>
            </template>
            <template is="dom-if" if="[[menuButton]]">
                <paper-menu-button id="menuButton"
                        allow-outside-scroll$="[[allowOutsideScroll]]"
                        dynamic-align$="[[dynamicAlign]]"
                        horizontal-align$="[[horizontalAlign]]"
                        vertical-align$="[[verticalAlign]]"
                        horizontal-offset$="[[horizontalOffset]]"
                        vertical-offset$="[[verticalOffset]]"                        
                        no-animations$="[[noAnimations]]"
                        no-overlap$="[[noOverlap]]"       
                    >
                    <paper-button id="button"
                        class="dropdown-trigger"
                        raised$="[[raised]]" 
                        elevation$="[[elevation]]"
                        noink$= "[[noink]]"
                        toggles$= "[[toggles]]"                                    
                    >
                        <template is="dom-if" if="[[icon]]" >
                            <iron-icon id="pebbleIcon" icon$="[[icon]]"></iron-icon>   
                        </template>
                        <template is="dom-if" if="[[buttonText]]" >
                            [[buttonText]]   
                        </template>                        
                        <iron-icon icon="arrow-drop-down"></iron-icon>
                    </paper-button>

                    <paper-menu id="paperMenu" class="dropdown-content" selected="{{selectedIndex}}">
                        <template is="dom-repeat" items="{{itemsArray}}" >
                            <paper-item>{{item}}</paper-item>
                        </template>
                    </paper-menu>
                </paper-menu-button>
            </template>
  </template>
</dom-module>

<script>   
      Polymer({
        is: 'pebble-button',        
        properties: {
            /**
             * Indicates that the button should be styled with a shadow if the value is true.
             */
            raised: {
                type: Boolean,
                value: false,
                notify: true
            },
            /**
             * Indicates the z-depth of this element, from 0-5. Setting to 0 will remove the shadow, and 
             * each increasing number greater than 0 will be "deeper" than the last.
             */
            elevation: {
                type: Number,
                value: 0,
               notify: true
            },
            /**
             * Indicates that the button toggles the active state with each tap or press of the spacebar if the value is true.
             */
            toggles: {
                type: Boolean,
                value: false,
                notify: true
            },
            /**
             * Indicates that the element will not produce a ripple effect when interacted with via the pointer if the value is true.
             */
            noink: {
                type: Boolean,
                value : false,
                notify: true
            },
            /**
             * Indicates that the element will open a menu on button click if the value is true.
             */
            menuButton: {
                type: Boolean,
                value: false,
                notify: true
            },
            /**
             * Returns icon if the value is set.
             */          
            icon: {
                type: String,
                value: function() { return null; }  

            },
            /**
             * Returns button text if the value is set.
             */
            buttonText: {
                type: String,
                value: function() { return null; },
                reflectToAttribute: true,
                notify: true
            },
            /**
             * Returns the list of items from which a selection can be made.
             */
            items: {
                type: String,
                value: function() { return null; }
            },
            /**
             * Returns the list of items which are ready to be bound to menu.
             */
            itemsArray: {
                type: Array,
                value: function() { return null; },
                computed: "_splitItems(items)",
                observer: "_itemsChanged"
            },
            /**
             * Returns the currently selected index.
             */
            selectedIndex: {
                type: Number,
                value: -1,
                observer: "_selectedIndexChanged"
            },
            /**
             * Returns the currently selected value.
             */
            selectedValue: {
                type: String,
                notify: true,
                observer: "_selectedValueChanged"
            },
            /**
             * Indicates that the dropdown will constrain scrolling on the page to itself when opened by default. 
             * Set to true in order to prevent scroll from being constrained to the dropdown when it opens.
             */
            allowOutsideScroll: {
                type: Boolean,
                value: false,
                notify: true
            },
            /**
             * Indicates that the `horizontalAlign` and `verticalAlign` properties will
             * be considered preferences instead of strict requirements when
             * positioning the dropdown and may be changed if doing so reduces
             * the area of the dropdown falling outside of `fitInto` if the value is set to true.
             */
            dynamicAlign: {
                type: Boolean,
                value: false,
                notify: true
            },
            /**
             * Indicates that the orientation against which to align the menu dropdown
             * horizontally relative to the dropdown trigger.
             */
            horizontalAlign: {
                type: String,
                value: "right",
                notify: true
            },
            /**
             * Indicates that the orientation against which to align the menu dropdown
             * vertically relative to the dropdown trigger.
             */
            verticalAlign: {
                type: String,
                value: "bottom",
                notify: true
            },
           /**
            * Indicates that a pixel value will be added to the position calculated for the
            * given `horizontalAlign`. Use a negative value to offset to the
            * left, or a positive value to offset to the right.
            */
            horizontalOffset: {
                type: Number,
                value: 0,
                notify: true
            },
           /**
            * Indicates that a pixel value that will be added to the position calculated for the
            * given `verticalAlign`. Use a negative value to offset towards the
            * top, or a positive value to offset towards the bottom.
            */
            verticalOffset: {
                type: Number,
                value: 0,
                notify: true
            },
            /**
             * Indicates that animations will be disabled when opening and closing the
             * dropdown if the value is set to true.
             */
            noAnimations: {
                type: Boolean,
                value: false,
                notify: true
            },
            /**
             * Indicates that the dropdown will be positioned so that it doesn't overlap
             * the button if the value is set to true.
             */
            noOverlap: {
                type: Boolean,
                value: false,
                notify: true
            }
        },
        ready: function(){        
         if(this.menuButton){
            if(this.itemsArray != null){
            for(var i=0; i<this.itemsArray.length;i++){
                if(this.itemsArray[i] == this.selectedValue){
                this.selectedIndex = i;
                break;
                }
                }
            }
         }
        },
        _splitItems: function(i) {
            if(i != undefined){
                return i.split(",");
            }else{
                return null;
            }
        },
        _selectedIndexChanged: function(newValue, oldValue){
          if(newValue !== undefined && this.itemsArray) {
            if(this.selectedValue != this.itemsArray[newValue]) {
              this.selectedValue = this.itemsArray[newValue];
              this.fire('change', {"newValue": newValue, "oldValue": oldValue});
            }
          }
        },
        _selectedValueChanged: function(newValue, oldValue){
          this._setNewIndex(this.itemsArray, newValue);
        },
        _itemsChanged: function(newValue, oldValue){
          this._setNewIndex(newValue, this.selectedValue);
        },
        _setNewIndex(newItemsArray, newSelectedValue) {
          var newIndex = -1;
          if(newItemsArray !== undefined && newSelectedValue !== undefined) {
            for(var i=0;i<newItemsArray.length;i++) {
              if(newItemsArray[i] == newSelectedValue) {
                newIndex = i;
                break;
              }  
            }
            if(this.selectedIndex != newIndex) {
              this.selectedIndex = newIndex;
            }
          }
        }
    });
  </script>
