<link rel="import" href="../../../bower_components/polymer/polymer.html">


<link rel="import" href="../liquid-entity-model-composite-get/liquid-entity-model-composite-get.html">

<dom-module id="attribute-model-datasource">
    <template>
        <liquid-entity-model-composite-get name="compositeAttributeModelGet" request-data="{{request}}" on-entity-model-composite-get-response="_onGetResponse" on-error="_onError" exclude-in-progress>
        </liquid-entity-model-composite-get>
    </template>
    <script>
        Polymer({
            is: 'attribute-model-datasource',
            properties: {
                _liquidElement: {
                    type: Object,
                    value: function () {
                        return {};
                    }
                },
                request:{
                    type: Object,
                    observer:'getData',
                    value: function(){
                        return {};
                    }
                }

            },
            ready: function () {
                this._liquidElement = Polymer.dom(this).node.$$("liquid-entity-model-composite-get");
            },
            getData: function () {
                if (_.isEmpty(this.request)) {
                    return;
                }
                this._liquidElement.generateRequest();
            },

            reTriggerRequest: function(){
                    this._liquidElement.generateRequest();
            },

            _onGetResponse: function (e) {
                var response = e.detail.response;
                if (typeof (this.dataFormatter) == 'function') {
                    if (response && response.status === "success") {
                        this.dataFormatter(response);
                    }
                }
            }

        });
    </script>
</dom-module>