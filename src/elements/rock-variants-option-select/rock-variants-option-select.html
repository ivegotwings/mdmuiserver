<link rel="import" href="../../../bower_components/polymer/polymer.html">
<link rel="import" href="../bedrock-ui-behavior/bedrock-ui-behavior.html">
<link rel="import" href="../pebble-icons/pebble-icons.html">
<link rel="import" href="../pebble-icon/pebble-icon.html">
<link rel="import" href="../pebble-button/pebble-button.html">
<link rel="import" href="../pebble-lov/pebble-lov.html">
<link rel="import" href="../pebble-horizontal-divider/pebble-horizontal-divider.html">
<link rel="import" href="../pebble-styles-shared/pebble-styles-shared.html">

<link rel="import" href="../rock-tags/rock-tags.html">


<!--
`rock-variants-option-select`

@demo demo/index.html
-->
<dom-module id="rock-variants-option-select">
    <template>
        <style include="pebble-styles-app"></style>
        <style>
            p{
                text-align: center;
            }
            .flexbox-container {
                display: -ms-flex;
                display: -webkit-flex;
                display: flex;
                padding:20px 10px 20px 10px;
            }

            .box1  {
                width: 12%;
            }
            .box2  {
                margin-right: 10px;
                width: 40%;
            }
            .box3  {
                margin-left: 10px;
                width: 40%;
            }
            pebble-button.removeButton {
                color:#C1CAD4;
                --pebble-button: {
                 min-width: 40px;
                 height: 40px;
                }
            }
            pebble-button.addButton {
                color:#09C021;
                --pebble-button: {
                    min-width: 40px;
                    height: 40px;
                }
            }
            pebble-button.optionButton {
                float:right;
                /*--pebble-button: {*/
                    /*border-bottom: 1px solid #036BC3;*/
                /*}*/
            }
            pebble-horizontal-divider {
                --pebble-horizontal-divider-color: #ccc;
                float:left;
                width:calc(100% - 20px);
            }
            .label{
                color:#C1CAD4;
            }
        </style>
        <div>
            <p>You can select multiple <b>Options</b> to create <b>SKUs</b></p>
        </div>
        <template is="dom-repeat" items="{{selectedOptions}}">
            <div class="flexbox-container" id="row[[index]]">
                <div class="box1">
                    <pebble-button class="removeButton"  icon="pebble-icons:RemoveCircle" item="[[item]]" on-tap="_removeOption"></pebble-button>
                    <span style="vertical-align: super;">[[_getSerialNumber(index)]]</span>
                </div>
                <div class="box2">
                    <div>
                    <div class="label">OPTION</div>
                    <!--ToDO use combo box here to show selected options : item.option-->
                    <pebble-button class="optionButton" icon="icons:arrow-drop-down" ></pebble-button>
                    </div>
                    <pebble-horizontal-divider></pebble-horizontal-divider>
                </div>
                <div class="box3">
                    <div>
                        <div class="label">VALUES</div>
                        <!--ToDO use combo box here to show selected values : item.values-->
                        <pebble-button class="optionButton" icon="icons:arrow-drop-down" ></pebble-button>
                    </div>
                    <pebble-horizontal-divider></pebble-horizontal-divider>
                </div>
            </div>
        </template>
        <div class="flexbox-container">
        <div class="box1">
        <pebble-button class="addButton" icon="icons:add-circle" on-tap="_addNewRow"></pebble-button>
        </div>
        </div>
        <div id="content-actions" align="center">
            <pebble-button class="action-button btn btn-secondary" id="skip" button-text="Cancel" raised on-tap="_onCancelTap"></pebble-button>
            <pebble-button class="action-button-focus dropdownText btn btn-success m-r-5" id="next" button-text="Save" raised on-tap="_onSaveTap"></pebble-button>
        </div>

    </template>
    <script>
        Polymer({
            is: 'rock-variants-option-select',
            properties: {
                /**
                 * Indicates the index of a tag.
                 */
                selectedOptions: {
                    type: Array,
                    value: function () {
                        return [];
                    },
                    notify:true
                }

            },
            behaviors: [
                RUFBehaviors.UIBehavior
            ],
            _addNewRow:function () {
                var newOption={"option":"", values:[]};
                this.push('selectedOptions',newOption);
                //TODO open lov for option
                var newOptionIndex=this.selectedOptions.length-1;
            },
            _getSerialNumber: function (index) {
                return index+1;
            },
            _removeOption:function (e) {
                var item=e.target.item;
                var index=this.selectedOptions.indexOf(item);
                this.splice('selectedOptions',index,1);
            },
            _onCancelTap: function(e) {
                //raise event with name given for onbackAction in configuration
                var eventName = "onCancel";
                var eventDetail = {
                    name: eventName
                };
                this.fireBedrockEvent(eventName, eventDetail,{ ignoreId: true });
            },
            _onSaveTap: function(e) {
                if(this.selectedOptions.length==0){
                    alert("select at least 1 option");
                    return;
                }
                var eventName = "onSave";
                var eventDetail = {
                    name: eventName,
                    data:this.selectedOptions
                };
                this.fireBedrockEvent(eventName, eventDetail,{ ignoreId: true });
            }
        });
    </script>
</dom-module>