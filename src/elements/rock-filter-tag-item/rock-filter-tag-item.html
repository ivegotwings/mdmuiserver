<link rel="import" href="../../../bower_components/iron-icon/iron-icon.html">
<link rel="import" href="../../../bower_components/iron-icons/iron-icons.html">
<link rel="import" href="../../../bower_components/paper-input/paper-input.html">
<link rel="import" href="../../../bower_components/paper-icon-button/paper-icon-button.html">


<dom-module id="rock-filter-tag-item">
  <template>
    <style include="shared-styles"></style>
    <style>
      :host {
        display: block;
        box-sizing: border-box;
      }    
      .tag-value{
        margin-top: 11px;     
      }
      .tag-item-container{
        /*border: #D2D7DD 1px solid;*/
        border-radius: 3px;
        float:left;
        margin-left:6px;
        margin-bottom:3px;
        padding-left:17px;
        border-left-width: 5px!important
      }
      
      paper-icon-button {
        height: 30px;
      }

      paper-icon-button::shadow #icon{
        /*color: #333;*/
        height: 14px;
      }
      paper-input {
        width: 90%;
      }

      .border-0 {
        border: #2068BD 1px solid;
        color: #2068BD;
      }
      .border-1 {
        border: #F5444B 1px solid;
        color: #F5444B;
      }
      .border-2 {
        border: #0BA720 1px solid;
        color: #0BA720;
      }
      
    </style>
    
      <div class$="{{_computeContainerClass(index)}}">
        <template is="dom-if" if="{{!editMode}}">
          <template is="dom-if" if="{{_hasValue}}">
            <span class="tag-value" on-tap="_onTapEvent">{{name}}: {{value}}</span>
          </template>
          <template is="dom-if" if="{{!_hasValue}}">
            <span class="tag-value" on-tap="_onTapEvent">{{name}}</span>
          </template>
          <template is="dom-if" if="{{!disableRemove}}">
          <paper-icon-button on-tap="_removeItem" icon="icons:cancel"></paper-icon-button>
        </template>
        <template is="dom-if" if="{{disableRemove}}">
          <paper-icon-button style="width:0px;visibility:hidden;" on-tap="remove" icon="icons:cancel"></paper-icon-button>
        </template>
        </template>
        <template is="dom-if" if="{{editMode}}">
          <paper-input id="input" label="{{name}}" value="{{value}}" on-blur="_makeNonEditable"></paper-input>
          <!--<paper-input on-blur="_makeNonEditable" id="input" label="{{name}}" value="{{value}}" on-tap="_makeEditable" ></paper-input>-->
        </template>
        
      </div>
  </template>
  <script>

    Polymer({
      is: 'rock-filter-tag-item',
      properties: {
        /**
        * Fired when the tag is to be removed from the tag list
        *
        * @event tag-item-remove
        */

        /**
        * Fired when the tag is not editable and on tap of tag
        *
        * @event tag-item-remove
        */
        
        /**
        * index of the tag
        */
        index:Number,
        /**
        * size of the tags, possible values: small, medium, large
        */
        size:{
          type:String,
          value:'small'
        },
         /**
         * Boolean flag to indicate if enable remove operation
         */
        disableRemove:{
          type:Boolean,
          value:false
        },

        /**
        * value of the tag
        */
        value: {
        type :String,
        notify : true
        },

        name:String,

        editMode: {
          type: Boolean,
          value: false
        },

        isEditable: {
          type: Boolean,
          value: false
        },
        _hasValue: {
          type: Boolean,
          value:false,
          notify : true,
          computed: '_isValueDefined(value)'
        }
        
      },

      _makeEditable: function(e) {
        this.editMode = true;
        //need to give some to polymer to reflect the property change, this async
        this.async(function() {
            this.$$('#input').querySelector('input').focus();//TODO: focus() on paper-input should have worked
          });
      },
      _makeNonEditable: function(e) {
        this.editMode = false;
      },

      _onTapEvent : function(e) {
         if(this.isEditable) {
            this._makeEditable(e);
         } else {
            this.fire('tag-item-select', {index: this.index});
         }
      },
      
      /**
       * Handler for removing the tag item
       */
      _removeItem: function() {
        if (this.disableRemove === false) {
          this.fire('tag-item-remove', {index: this.index});
        }
      },

      _computeContainerClass: function(index) {
        var className = 'border-' + index % 3;
        return 'tag-item-container ' + className;
      },

      _isValueDefined : function(value) {
        if(value) {
          return true;
        } else {
          return false;
        }
      }

    });

  </script>
</dom-module>