<script src="content-types-mappings.js"></script>

<script>

    ContentTypeHelper = {};

    (function() {

        ContentTypeHelper.isLoaded = false;

        ContentTypeHelper.getExtensions = function(mimeTypes) {
            if(!_.isEmpty(mimeTypes)) {
                let extensions = [];
                for(let i=0; i<mimeTypes.length; i++) {
                    let mimeType = mimeTypes[i];
                    let mappedExtensions = ContentTypeHelper.getExtension(mimeType);
                    if(mappedExtensions) {
                        extensions = extensions.concat(mappedExtensions);
                    }
                }
                return extensions;
            }
        };

        ContentTypeHelper.getExtension = function(mimeType) {
            console.log('get extension is called');
            if (!ContentTypeHelper.isLoaded) {
                ContentTypeHelper.load();
            }

            return ContentTypeHelper.Extensions[mimeType];
        };

        ContentTypeHelper.getMimeTypes = function(extensions) {
            if(!_.isEmpty(extensions)) {
                let mimeTypes = [];
                for(let i=0; i<extensions.length; i++) {
                    let extension = extensions[i];
                    let mappedMimeType = ContentTypeHelper.getMimeType(extension);
                    if(mappedMimeType) {
                        mimeTypes.push(mappedMimeType);
                    }
                }
                return mimeTypes;
            }
        };

        ContentTypeHelper.getMimeType = function(extension) {
            console.log('get mime type is called');
            if (!ContentTypeHelper.isLoaded) {
                ContentTypeHelper.load();
            }
            let x = ContentTypeHelper.MimeTypes[extension];
            console.log('mime type returned ', x);
            return x;
        };

        ContentTypeHelper.getContentTypes = function(fileTypes) {
            let mimeTypes = ContentTypeHelper.getMimeTypes(fileTypes);
            let contentTypes = undefined;
            if(!_.isEmpty(mimeTypes)) {
                for(let i=0; i<mimeTypes.length; i++) {
                    let mimeType = mimeTypes[i];
                    if(contentTypes) {
                        contentTypes = contentTypes + "," + mimeType;
                    } else {
                        contentTypes = mimeType
                    }
                }
            }
            return contentTypes;
        }
    
        ContentTypeHelper.load = function () {
            if (!ContentTypeHelper.isLoaded) {
                ContentTypeHelper.Mappings = ContentTypeUtils.PopulateMaps();
                ContentTypeHelper.Extensions = ContentTypeHelper.Mappings.extensions;
                ContentTypeHelper.MimeTypes = ContentTypeHelper.Mappings.mimeTypes;
                ContentTypeHelper.isLoaded = true;
            }
        }
    })();
</script>