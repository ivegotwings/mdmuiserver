<link rel="import" href="../../../bower_components/polymer/polymer.html" />
<link rel="import" href="../rock-layout/rock-layout.html">
<link rel="import" href="../pebble-iframe/pebble-iframe.html">
<link rel="import" href="../bedrock-style-manager/styles/bedrock-style-common.html">
<link rel="import" href="../bedrock-style-manager/styles/bedrock-style-gridsystem.html" />

<dom-module id="rock-analytics-widget">
    <template>
        <style include="bedrock-style-common bedrock-style-gridsystem"></style>
        <div class="base-grid-structure">
            <div class="base-grid-structure-child-1">
                <template is="dom-if" if="{{urlUnavailable}}">
                    <div class="msg default-mressage">
                        Analytics system is unavailable
                    </div>
                </template>
                <template is="dom-if" if="{{!urlUnavailable}}">
                    <pebble-iframe timeout="[[timeout]]" source="[[url]]"></pebble-iframe>
                </template>
            </div>
        </div>
    </template>
    <script>
        (function () {
            'use strict';

            Polymer({
                is: "rock-analytics-widget",

                properties: {
                    url: {
                        type: String,
                        value: ''
                    },
                    timeout: {
                        type: Number,
                        value: 30000
                    }
                },

                ready: function () {
                    this.urlUnavailable = _.isEmpty(this.url);
                    this.addEventListener('iframe-load-failed', function () {
                        this.urlUnavailable = true;
                    })
                }
            });
        })();
    </script>
</dom-module>