<link rel="import" href="../../../bower_components/polymer/polymer.html">
<link rel="import" href="../rock-widget/rock-widget.html">
<!--
`rock-widget-panel` Represents an element which will display `rock-widgets` based on the configuration provided by the user.

@demo demo/index.html
-->
<dom-module id="rock-widget-panel">
    <template>
        <style>
            /*  SECTIONS  */
            
            .section {
                clear: both;
                padding: 0px;
                margin: 0px;
            }
            /*  COLUMN SETUP  */
            
            .col {
                display: block;
                float: left;
                margin: 1% 0.5% 1% 0.5%;
            }
            
            .col:first-child {
                margin-left: 0.5%;
            }
            /*  GROUPING  */
            
            .group:before,
            .group:after {
                content: "";
                display: table;
            }
            
            .group:after {
                clear: both;
            }
            
            .group {
                zoom: 1;
                /* For IE 6/7 */
            }
            
            .colspan-1 {
                width: 100%;
            }
            
            .colspan-2 {
                width: 49%;
            }
            
            .colspan-3 {
                width: 32%;
            }
            
            .colspan:nth-child(1n+1) {
                clear: both;
                margin-left: 0.5%;
            }
            
            .colspan:nth-child(2n+1) {
                clear: both;
                margin-left: 0.5%;
            }
            
            .colspan:nth-child(3n+1) {
                clear: both;
                margin-left: 0.5%;
            }
            /*  GO FULL WIDTH BELOW 480 PIXELS */
            
            @media only screen and (max-width: 480px) {
                .col {
                    margin: 1% 0.5% 1% 0.5%;
                }
                .colspan-1 .colspan-2 .colspan-3 {
                    width: 100%;
                }
            }
        </style>
        <div id="widget-panel" class="section group"></div>
    </template>
</dom-module>
<script>
    (function() {
      'use strict';

      Polymer({
          is: 'rock-widget-panel',
          properties: {
            /*
             * This property is used to hold to configuration information provided by the user
             */
            config: {
              type: Object,
              value: function () { 
                return {}; 
              },
              observer: "_loadWidgets",
              notify: true
            },
            /*
             * This property defines the grid system for the element
             */
            noOfColumns: {
                type: Number,
                value: 2
            }
          },
          _loadWidgets: function() {
            var widgets = this.config;
            var numberOfColumns = this.noOfColumns;
            var widgetPanel = this.$$("#widget-panel");

            if(widgets && widgetPanel && typeof(widgets) == "object" && Object.keys(widgets).length > 0) {

                this._clearWidgetPanel(widgetPanel);
                
                for(var i = 0; i < widgets.length; i++) {
                    if(widgets[i]) {
                        var widget = document.createElement("rock-widget");

                        widget.setAttribute("id", widgets[i].name);
                        widget.setAttribute("icon-buttons", widgets[i].iconButtons);

                        if (widgets[i].nonClosable) {
                            widget.setAttribute("non-closable", "non-closable");
                        }

                        if (widgets[i].nonMaximizable) {
                            widget.setAttribute("non-maximizable", "non-maximizable");
                        }

                        if (widgets[i].nonDraggable) {
                            widget.setAttribute("non-draggable", "non-draggable");
                        }

                        widget.setAttribute("config", JSON.stringify(widgets[i].config));

                        var divElement = document.createElement("div");
                        
                        divElement.append(widget);
                        divElement.classList.add("col");

                        var colspan = "colspan-" + numberOfColumns;
                        divElement.classList.add(colspan);

                        widgetPanel.append(divElement);
                    }
                }
            }
          },
          _clearWidgetPanel: function(widgetPanel) {
            if(widgetPanel) {
                widgetPanel.innerHTML = null;
            }
          }
      });
    })();
</script>