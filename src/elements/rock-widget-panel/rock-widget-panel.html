<link rel="import" href="../../../bower_components/polymer/polymer.html">
<link rel="import" href="../rock-widget/rock-widget.html">
<!--
`rock-widget-panel` Represents an element which will display `rock-widgets` based on the configuration provided by the user.

@demo demo/index.html
-->
<dom-module id="rock-widget-panel">
    <style is="custom-style" include="pebble-styles-shared"></style>
    <template>
        <div id="widget-panel" class="row"></div>
    </template>
</dom-module>
<script>
    (function() {
      'use strict';

      Polymer({
          is: 'rock-widget-panel',
          properties: {
            /*
             * This property is used to hold to configuration information provided by the user
             */
            config: {
              type: Object,
              value: function () { 
                return {}; 
              },
              observer: "_loadWidgets",
              notify: true
            },
            /*
             * This property defines the grid system for the element
             */
            noOfColumns: {
                type: Number,
                value: 2,
                notify: true
            }
          },
          _loadWidgets: function() {
            var widgets = this.config;
            var numberOfColumns = this.noOfColumns;
            var widgetPanel = this.$$("#widget-panel");

            if(widgets && widgetPanel && typeof(widgets) == "object" && Object.keys(widgets).length > 0) {

                this._clearWidgetPanel(widgetPanel);
                
                for(var i = 0; i < widgets.length; i++) {
                    if(widgets[i]) {
                        var widget = document.createElement("rock-widget");

                        widget.setAttribute("id", widgets[i].name);
                        widget.setAttribute("icon-buttons", widgets[i].iconButtons);

                        if (widgets[i].nonClosable) {
                            widget.setAttribute("non-closable", "non-closable");
                        }

                        if (widgets[i].nonMaximizable) {
                            widget.setAttribute("non-maximizable", "non-maximizable");
                        }

                        if (widgets[i].nonDraggable) {
                            widget.setAttribute("non-draggable", "non-draggable");
                        }

                        widget.setAttribute("config", JSON.stringify(widgets[i].config));

                        var divElement = document.createElement("div");
                        divElement.append(widget);
                        if (this.noOfColumns == 1){
                            divElement.classList.add("colspan-1"); 
                        }
                        if (this.noOfColumns == 2){
                            divElement.classList.add("colspan-2"); 
                        }
                        if (this.noOfColumns == 3){
                            divElement.classList.add("colspan-3"); 
                        }
                       
                        widgetPanel.append(divElement);
                    }
                }
            }
          },
          _clearWidgetPanel: function(widgetPanel) {
            if(widgetPanel) {
                widgetPanel.innerHTML = null;
            }
          }
      });
    })();
</script>