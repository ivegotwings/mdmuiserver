<link rel="import" href="../../../bower_components/polymer/polymer.html">
<dom-module id="rock-widget-panel">
    <template>
        <style>
            /*  SECTIONS  */
            
            .section {
                clear: both;
                padding: 0px;
                margin: 0px;
            }
            /*  COLUMN SETUP  */
            
            .col {
                display: block;
                float: left;
                margin: 1% 0.5% 1% 0.5%;
            }
            
            .col:first-child {
                margin-left: 0.5%;
            }
            /*  GROUPING  */
            
            .group:before,
            .group:after {
                content: "";
                display: table;
            }
            
            .group:after {
                clear: both;
            }
            
            .group {
                zoom: 1;
                /* For IE 6/7 */
            }
            
            .colspan-1 {
                width: 100%;
            }
            
            .colspan-2 {
                width: 49%;
            }
            
            .colspan-3 {
                width: 32%;
            }
            
            .colspan:nth-child(1n+1) {
                clear: both;
                margin-left: 0.5%;
            }
            
            .colspan:nth-child(2n+1) {
                clear: both;
                margin-left: 0.5%;
            }
            
            .colspan:nth-child(3n+1) {
                clear: both;
                margin-left: 0.5%;
            }
            /*  GO FULL WIDTH BELOW 480 PIXELS */
            
            @media only screen and (max-width: 480px) {
                .col {
                    margin: 1% 0.5% 1% 0.5%;
                }
                colspan {
                    width: 100%;
                }
            }
        </style>
        <div id="widget-panel" class="section group"></div>
        <iron-ajax auto url="../../data/dashboard-widgets.json" handle-as="json" last-response="{{widgets}}"></iron-ajax>
    </template>
</dom-module>
<script>
    (function() {
      'use strict';

      Polymer({
          is: 'rock-widget-panel',
          properties: {
            widgets: {
              type: Object,
              value: function () { 
                return {}; 
              },
              observer: "loadWidgets"
            },
            noOfColumns: {
                type: Number,
                value: 2
            }
          },
          loadWidgets: function() {
            var widgets = this.widgets;
            var numberOfColumns = this.noOfColumns;

            if(widgets) {
                for(var i = 0; i < widgets.length; i++) {
                    if(widgets[i]) {
                        var widget = document.createElement("rock-widget");

                        widget.setAttribute("id", widgets[i].name);
                        widget.setAttribute("icon-buttons", widgets[i].iconButtons);

                        if (widgets[i].nonClosable) {
                            widget.setAttribute("non-closable", "non-closable");
                        }

                        if (widgets[i].nonMaximizable) {
                            widget.setAttribute("non-maximizable", "non-maximizable");
                        }

                        if (widgets[i].nonDraggable) {
                            widget.setAttribute("non-draggable", "non-draggable");
                        }

                        widget.setAttribute("config", JSON.stringify(widgets[i].config));

                        var divElement = document.createElement("div");
                        
                        divElement.append(widget);
                        divElement.classList.add("col");

                        var colspan = "colspan-" + numberOfColumns;
                        divElement.classList.add(colspan);

                        this.$$("#widget-panel").append(divElement);
                    }
                }
            }
          }
      });
    })();
</script>