<link rel="import" href="../../../bower_components/polymer/polymer.html">
<link rel="import" href="../rock-attribute/rock-attribute.html">
<link rel="import" href="../pebble-horizontal-divider/pebble-horizontal-divider.html">
<link rel="import" href="../liquid-entity-get/liquid-entity-get.html">
<!--
`rock-attribute-list`
Renders the list of attribtes based on given parameters.

@demo demo/index.html 
-->
<dom-module id="rock-attribute-list">
  <template>
    <style include="shared-styles">

      .group-container {
        /*border-top:1px solid black;*/
        /*border-bottom:1px solid black;*/
      }

      .group-name {
        font-weight: 500;
        font-family: 'Roboto', 'Helvetica Neue', Helvetica, Arial, sans-serif;
        clear: both;
        padding-top: 10px;
        margin: 0px;
        font-size: 24px;
      }
      
      .group-name-container {
        clear: left;
        @apply(--layout-horizontal);
      }

      .group-line-box {
        margin-top:16px;
        margin-left:8px;
        margin-right:8px;
        @apply(--layout-flex);
      }
      
      .group-line-container {
        float: right;
        border-bottom: 1px solid black;
      }
      
      .attribute-box {
        display: inline-block;
        /*border: 1px solid black;*/
      }
      
      .attribute-box1 {
        width: 100%;
      }
      
      .attribute-box2 {
        width: 49%;
      }
      
      .attribute-box3 {
        width: 33%;
      }
      pebble-horizontal-divider {
            --pebble-horizontal-divider-color: black;
        }
    </style>
    <template is="dom-repeat" items="[[_getAttributeGroups(attributeModelResponse)]]" as="group">
      <div class="group-container">
        <div class="group-name-container" align="left">
          <div class="group-name-box" style="display:inline-block"><span class="group-name">[[group.longName]]</span></div>
          <div class="group-line-box"> <pebble-horizontal-divider></pebble-horizontal-divider></div>
        </div>
        <template is="dom-repeat" items="[[_toArray(group)]]" as="model">
          <template is="dom-if" if="[[model.displayType]]">
            <div class$="[[_getAttributeClass(noOfColumns)]]">
              <rock-attribute mode="{{mode}}" attribute-model-object="[[model]]" attribute-object="{{_getAttribute(model, attributeResponse)}}"></rock-attribute>
            </div>
          </template>
        </template>
      </div>
    </template>
    <liquid-entity-get name="attributeGetService" request="{{attributeRequest}}" response="{{attributeResponse}}"></liquid-entity-get>
    <liquid-entity-get name="attributeModelGetService" request="{{attributeModelRequest}}" response="{{attributeModelResponse}}"></liquid-entity-get>
  </template>
  <script>
    (function() {
      'use strict';
      console.log('outside polymer of list');
      
      Polymer({
        is: 'rock-attribute-list',
        created: function() {
          console.log('list created');
        },
        attached: function() {
          console.log('list attached');
        },
        ready: function() {
          console.log('list ready');
        },
        properties: {
          /**
          * Indicates whether the attribute should be rendered in edit mode or view. 
            Two possible values are <b>view</b> and <b>edit</b>
          */
          mode: {
            type: String,
            value: "view",
            notify: true
          },
          noOfColumns: {
            type: Number,
            value: 1
          },
          /**
          * Indicates the request object which is passed to the data element to retrive attribute data.
            Sample: { 
                      action: "getAttributes" 
                    }
          */
          attributeRequest: {
            type: Object,
            value: function(){
              return { action: "getAttributes" };
            }
          },
          /**
          * Indicates the response object which is received from the data element for the attribute get request.
          */
          attributeResponse: {
            type: Object,
            value: function(){
              return {};
            }
          },
          /**
          * Indicates the request object which is passed to the data element to retrive attribute model data.
            Sample: { 
                      action: "getAttributeModels" 
                    }
          */
          attributeModelRequest: {
            type: Object,
            value: function(){
              return { action: "getAttributeModels" };
            }
          },
          /**
          * Indicates the response object which is received from the data element for the attribute get request.
          */
          attributeModelResponse: {
            type: Object,
            value: function(){
              return {};
            }
          }
        },
        _getAttributeClass: function(n) {
          return "attribute-box attribute-box" + n;
        },
        _getAttribute: function(attributeModel, attributeResponse) {
          if(attributeResponse && attributeResponse.returnValue 
              && attributeResponse.returnValue.attributes && (attributeModel.name in attributeResponse.returnValue.attributes)){
            return attributeResponse.returnValue.attributes[attributeModel.name];
          }
        },
        _getAttributeModels: function(group) {
          // if(attributeModelResponse && attributeModelResponse.returnValue && attributeModelResponse.returnValue.attributeModels){
          //   var allModels = attributeModelResponse.returnValue.attributeModels;
          //   var groupModels = [];
          //   for(var i=0; i<allModels.length; i++) {
          //     if(allModels[i].attributeGroup.name == group.name) {
          //       groupModels.push(allModels[i]);
          //     }
          //   }
          //   return groupModels;
          // }
        },
        _getAttributeGroups: function(attributeModelResponse) {
          var groups = [];
          if(attributeModelResponse && attributeModelResponse.returnValue && attributeModelResponse.returnValue.attributeModels){
            var groups = attributeModelResponse.returnValue.attributeModels;
            var groupsArray = this._toArray(groups)
            // for(var i =0; i < models.length; i++) {
            //   var group = {
            //                 "name": models[i].attributeGroup.name, 
            //                 "longName": models[i].attributeGroup.longName
            //               };
            //   if(this._arrayExists(groups, group) == false) {
            //     groups.push(group);
            //   }
            // }
            return groupsArray;
          }
          //return groups;
        },
        _arrayExists: function(a, item) {
          for(var i=0; i<a.length;i++) {
            if(a[i].name === item.name) {
              return true;
            }
          }
          return false;
        },
        _toArray: function(obj) {
          return Object.keys(obj).map(function(key) {
            return obj[key];
          });
        }
      });
    })();
  </script>
</dom-module>