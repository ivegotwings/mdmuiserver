<link rel="import" href="../../../bower_components/polymer/polymer.html">

<link rel="import" href="../rock-attribute/rock-attribute.html">
<link rel="import" href="../liquid-entity-get/liquid-entity-get.html">

<!--
`rock-attribute-list` Represents attribute-list component in the framework.
It renders the list of attributes based on the specified parameters.

@demo demo/index.html 
-->

<dom-module id="rock-attribute-list">
  <template>
    <style include="shared-styles"></style>
    <template is="dom-repeat" items="[[_getAttributeModels(attributeModelResponse)]]">
      <rock-attribute mode="{{mode}}" 
         attribute-model-object="[[item]]" attribute-object="{{_getAttribute(item, attributeResponse)}}"></rock-attribute>
    </template>
    <liquid-entity-get name="attributeGetService" request="{{attributeRequest}}" response="{{attributeResponse}}"></liquid-entity-get>
    <liquid-entity-get name="attributeModelGetService" request="{{attributeModelRequest}}" response="{{attributeModelResponse}}"></liquid-entity-get>
  </template>

  <script>
    (function() {
      'use strict';
      console.log('outside polymer of list');
      
      Polymer({
        is: 'rock-attribute-list',
        created: function() {
          console.log('list created');
        },
        attached: function() {
          console.log('list attached');
        },
        ready: function() {
          console.log('list ready');
        },
        properties: {
          /**
          * Indicates whether the attribute should be rendered in edit mode or view mode. 
          * The two possible values are <b>view</b> and <b>edit</b>.
          */
          mode: {
            type: String,
            value: "view"
          },
          /**
          * Indicates the request object that is passed to the data element to retrive attribute data.
            Sample: { 
                      action: "getAttributes" 
                    }
          */
          attributeRequest: {
            type: Object,
            value: function(){
              return { action: "getAttributes" };
            }
          },
        /**
          * Indicates the response object that is received from the data element for the attribute get request.
          */
          attributeResponse: {
            type: Object,
            value: function(){
              return {};
            }
          },
          /**
          * Indicates the request object that is passed to the data element to retrive attribute model data.
            Sample: { 
                      action: "getAttributeModels" 
                    }
          */
          attributeModelRequest: {
            type: Object,
            value: function(){
              return { action: "getAttributeModels" };
            }
          },
          /**
          * Indicates the response object that is received from the data element for the attribute get request.
          */
          attributeModelResponse: {
            type: Object,
            value: function(){
              return {};
            }
          }
        },
        _getAttribute: function(attributeModel, attributeResponse) {
          if(attributeResponse && attributeResponse.returnValue 
              && attributeResponse.returnValue.attributes && (attributeModel.name in attributeResponse.returnValue.attributes)){
            return attributeResponse.returnValue.attributes[attributeModel.name];
          }
        },
        _getAttributeModels: function(attributeModelResponse) {
          if(attributeModelResponse && attributeModelResponse.returnValue && attributeModelResponse.returnValue.attributeModels){
            return attributeModelResponse.returnValue.attributeModels;
          }
        }
      });
    })();
  </script>

</dom-module>