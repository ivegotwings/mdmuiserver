<link rel="import" href="../../../bower_components/polymer/polymer.html">
<link rel="import" href="../../../bower_components/iron-ajax/iron-ajax.html">

<link rel="import" href="../bedrock-ui-behavior/bedrock-ui-behavior.html">
<link rel="import" href="../bedrock-pubsub/bedrock-pubsub.html">

<link rel="import" href="../pebble-button/pebble-button.html">
<link rel="import" href="../pebble-dialog/pebble-dialog.html">
<link rel="import" href="../pebble-image-viewer/pebble-image-viewer.html">
<link rel="import" href="../pebble-vertical-divider/pebble-vertical-divider.html">
<link rel="import" href="../pebble-styles-shared/pebble-styles-shared.html">

<link rel="import" href="../rock-tabs/rock-tabs.html">

<dom-module id="rock-entity-manage-quick">
    <template>
        <style include="pebble-styles-shared"></style>
        <style include="iron-flex"></style>
        <style is="custom-style">
            .thumb-image {
                width: 50px;
                height: 50px;
            }
            .product-head {
                padding-left: 5px; 
                font-size: 13px;               
                color: #cacaca;
            }
            .product-name {
                padding-left: 5px;
                font-weight: bold;
            }
            .product-right {
                text-align: right;
            }
            rock-attribute-manage::shadow #buttonContainer {
                text-align: left;
            }
        </style>
        <bedrock-pubsub event-name="on-attribute-response-change" handler="_attributeResponseChanged"></bedrock-pubsub>
        <template is="dom-if" if="[[_isProductAvailable(_productName)]]">
            <div id="quick-entitymanage-title" class="layout horizontal">                
                <div>
                <pebble-image-viewer src="/src/images/polymer.svg" alt="Product Name" sizing="contain" class="thumb-image"></pebble-image-viewer>
                </div>
                <div class="layout vertical"> 
                    <div class="product-head">Product</div>
                    <div class="product-name">[[_productName]]</div>
                </div>
                <div class="product-right">
                    <!--No. of grid items, on click icon should show grid next/prev item, maximize-->
                </div>
            </div>
        </template>
        <div id="quick-entitymanage-toolbar">
            <iron-ajax url="../../data/EntityManageApp/header-config.json" last-response="{{headerConfig}}" auto></iron-ajax>
            <iron-ajax url="../../data/EntityManageApp/toolbar-config.json" last-response="{{toolbarConfig}}" auto></iron-ajax>
            <iron-ajax url="../../data/EntityManageApp/entity-summary-tofix-data.json" last-response="{{fixes}}" auto></iron-ajax>            
            <rock-entity-header entity-id="[[entityId]]" header-config="[[headerConfig]]" buttons="[[toolbarConfig]]" to-fix-data="[[fixes]]" locale="{{_locale}}"
                                list="{{_list}}" source="{{_source}}"></rock-entity-header>
        </div>
        <rock-tabs id="rockTabs" config="{{_tabConfig}}">
        </rock-tabs>
        <iron-ajax auto url="../../data/EntityManageApp/quick-entity-manage-tab-config.json" handle-as="json" on-response="_handleResponse"></iron-ajax>
        <bedrock-pubsub event-name="component-creating" handler="_onComponentCreating"></bedrock-pubsub>
    </template>
    <script>
        (function () {
            'use strict';

            Polymer({
                is: 'rock-entity-manage-quick',

                properties: {
                    context: {
                        type: Object,
                        value: function () {
                            return {};
                        },
                        observer: '_onContextChange'
                    },
                    /*
                    * Indicates the config for tab element
                    */
                    _tabConfig: {
                        type: Object,
                        value: function () {
                            return {};
                        }
                    },
                    _productName: {
                        type: String,
                        value: null
                    }
                },
                behaviors: [
                    RUFBehaviors.UIBehavior
                ],
                _handleResponse: function (e) {
                    this.set("_tabConfig", e.currentTarget.lastResponse);
                },
                _onComponentCreating: function (e, detail, sender) {
                    var component = detail.data;

                    if (component.name.indexOf("attribute") != -1 && component.properties) {
                        component.properties.list = this.context.list;
                        component.properties.source = this.context.source;
                        component.properties.locale = this.context.locale;
                        component.properties['entity-id'] = this.context.entityId;
                    }
                },
                _onContextChange: function(){
                    if(!this.context.entityId)
                    {
                        this._productName = null;
                    }
                    if(this.$$('#rockTabs'))
                    {
                        this.$$('#rockTabs').reloadCurrentTab();
                    }
                },
                _attributeResponseChanged: function(e, detail, sender){                    
                    for(var i = 0; i < detail.attributeValues.length; i++)
                    {
                        if(detail.attributeValues[i].name == "coreAttributes")
                        {
                            var attributes = detail.attributeValues[i].attributes;
                            if(attributes.length > 0)
                            {
                                this._productName = attributes[0].value;
                            }
                        }
                    }
                },
                _isProductAvailable: function(){                    
                    if(this._productName)
                    {
                        return true;
                    }

                    return false;
                }
            });
        })();
    </script>
</dom-module>