<link rel="import" href="../../../bower_components/polymer/polymer.html">

<link rel="import" href="../bedrock-pubsub/bedrock-pubsub.html">
<link rel="import" href="../bedrock-ui-behavior/bedrock-ui-behavior.html">
<link rel="import" href="../bedrock-helpers/data-helper.html">

<link rel="import" href="../liquid-entity-govern-data-get/liquid-entity-govern-data-get.html">
<link rel="import" href="../liquid-entity-model-get/liquid-entity-model-get.html">
<link rel="import" href="../liquid-rest/liquid-rest.html">

<link rel="import" href="../pebble-stepper/pebble-stepper.html">
<link rel="import" href="../pebble-stepper/pebble-step.html">
<link rel="import" href="../pebble-button/pebble-button.html">
<link rel="import" href="../pebble-image-viewer/pebble-image-viewer.html">
<link rel="import" href="../pebble-textarea/pebble-textarea.html">
<link rel="import" href="../pebble-accordion/pebble-accordion.html">

<dom-module id="rock-workflow-panel">
    <template>
        <style include="pebble-styles-shared"></style>
        <style>
            #workflow-stepper {
                margin-top: 20px;
            }         
            .workflowtext{
                width: 131px;
                height: 14px;
                font-family: Roboto;
                font-size: 12px;
                color:var(--palette-steel-grey); 
            }
            .workflow-stepper {
                --pebble-connected-badge-width: 30px;
                --pebble-connected-badge-height: 30px;
                --connectorLine-width: 2px;
                --content-connectorLine-width: 2px;
                --pebble-connected-badge-fontSize: 14px;
            }
            pebble-step-details {
                margin-left: 5px;
            }
            pebble-stepper::shadow pebble-step::shadow #step-subtitle{
                font-size:var(--default-font-size) !important;
            }
            .step-details {
                color:var(--palette-steel-grey);
                font-size: var(--font-size-sm, 12px)!important; 
            }
             #action-details {
                margin-top: 10px;
            }
            .view-changes {
                margin-top: 15px;
                text-decoration: none;
                float: right;
            }
            .user {
                text-decoration: none;
            }
            #step-comments {
                margin-top: 20px;
            }
            .user-image {
                width: 15px;
                height: 15px;
                background: #ddd;
            }
            pebble-textarea{
                --paper-input-container-label: {
                    font-size: var(--default-font-size, 14px)!important;
                }
                --paper-input-container-input: {
                    font-size: var(--default-font-size, 14px)!important;
                }
            }
             #step-actions {
                padding: 12px 0px 8px 0px;
            }
            pebble-accordion::shadow .header{
                background-color:var(--palette-pale-grey-four);
                border: 0;
                margin:1px;
            }
            pebble-accordion::shadow .header .header-text {
                padding-top: 2px !important;
            }
            pebble-accordion::shadow .header .header-text iron-icon{
                margin: 0 5px 0 10px;
                float: left;
            }
        </style>
        <liquid-rest id="entityStartWorkflow" url="/pass-through/entitygovernservice/startworkflow" 
            method="POST" request-data={{_invokeWorkflowRequest}} last-response={{_invokeWorkflowResponse}} on-response="_onWfStartSuccess" on-error="_onWfStartFailure"></liquid-rest>
        <liquid-entity-model-get id="entityGetWorkflowDefinition" operation="getbyids" request-id="req1" request-data={{workflowDefinitionRequest}} 
                on-response="_onDefinitionReceived" on-error="_onDefinitionGetFailed"></liquid-entity-model-get>
        <!--<liquid-entity-govern-data-get id="entityGetRunningInstance" operation="getbyids" request-id="req2" request-data={{runningInstanceRequest}} 
                on-response="_onRunningInstanceReceived" on-error="_onRunningInstanceGetFailed"></liquid-entity-govern-data-get>-->
        <liquid-rest id="entityGetRunningInstance" url="/pass-through/entitygovernservice/get"  
            method="POST" request-data={{runningInstanceRequest}}
            on-response="_onRunningInstanceReceived" on-error="_onRunningInstanceGetFailed"></liquid-rest>
        <liquid-rest id="entityWfTransition" url="/pass-through/entitygovernservice/transitionWorkflow"  
            method="POST" request-data={{_transitionRequest}}
            on-response="_onTransitionSuccess" on-error="_onTransitionFailure"></liquid-rest>
        <pebble-button id="invokeButton" hidden raised class="iconButton btn btn-outline-primary m-r-5" button-text="Start Workflow" on-tap="_invokeWorkflow"></pebble-button>
        <template id="workflowsTemplate" is="dom-repeat" items="[[_workflowsData]]" as="_workflowstepperData">
            <pebble-accordion header-text="[[_workflowstepperData.workflowName]]" default-icon="chevron-right" open-icon="expand-more">
                <div id="workflow-description">
                    <span class="workflowtext">[[_getWorkFlowDescription(_workflowstepperData)]]</span>
                </div>
                <div id="workflow-stepper">
                    <pebble-stepper id="workflowStepper" stepper-config="[[_workflowstepperData]]">
                        <template is="dom-repeat" items="[[_workflowstepperData.items]]" as="item">
                            <pebble-step class="workflow-stepper" data="{{item}}">
                                <div class="step-badge-content">
                                    <template is="dom-if" if="[[_userHasImage()]]">
                                        <pebble-image-viewer class="user-image" shape="circle" sizing="contain" 
                                            src="../../images/no-photo.jpg"></pebble-image-viewer>
                                    </template>
                                    <template is="dom-if" if="[[!_userHasImage()]]">
                                        <span>[[item.index]]</span>
                                    </template>
                                </div>
                                <div class="step-details">
                                    <div id="step-description">
                                        <span>[[item.stepDetails.description]]</span>
                                    </div>
                                    <template is="dom-if" if="[[_stepHasDetails(item.stepDetails)]]">
                                        <div id="action-details">
                                            <pebble-image-viewer class="user-image" shape="circle" sizing="contain" 
                                                src="../../images/no-photo.jpg"></pebble-image-viewer>
                                            <span><a class="user" href="#">[[item.stepDetails.assignedUser]]</a>[[item.stepDetails.details]]</span>
                                            <a class="view-changes" href="#">View all changes >></a>
                                        </div>
                                    </template>
                                    <template is="dom-if" if="[[_isCommentsEnabled(item)]]">
                                        <div id="step-comments">
                                            <pebble-textarea id="stepComments-[[item.id]]" required="[[_isRequired(item.stepDetails)]]" autofocus label="ADD A COMMENT" invalid="" error-message="Comments Required." value=""></pebble-textarea>
                                        </div>
                                        <div id="step-actions">
                                            <template is="dom-repeat" items="[[item.stepDetails.actions]]" as="button">
                                                <pebble-button class$="[[_getActionButtonClass(button)]]" raised icon="[[button.actionIcon]]" button-text="[[button.action]]" on-tap="_onStepActionTap" data="[[_getDataforButton(button, item.id)]]"></pebble-button>
                                            </template>
                                        </div>
                                    </template>
                                </div> 
                            </pebble-step>
                        </template>
                    </pebble-stepper>
                </div>
            </pebble-accordion>
        </template>
    </template>
    <script>
        (function() {
            'use strict';

            Polymer({
                is: "rock-workflow-panel",
                properties: {
                     /**
                     * Indictaes the identification of the entity for which the workflows are managed.
                     */
                    entityId: {
                        type: String
                    },
                    /**
                     * Indicates the context parameters for which the workflow has to be loaded.
                     * JSON sample to be added here.
                     */
                    context: {
                        type: Object,
                        value: function () {
                            return {};
                        }
                    },
                    /**
                     * Indicates List object for which workflows has to be displayed
                     */
                    list: {
                        type: String
                    },
                    /**
                     * Indicates locale object for which workflows has to be displayed
                     */
                    locale: {
                        type: String
                    },
                    /**
                     * Indicates source object for which workflows has to be displayed
                     */
                    source: {
                        type: String
                    },
                    /**
                     * Indicates source object for which workflows has to be displayed
                     */
                    entityType: {
                        type: String
                    },
                    /*
                    * Indicates the Id of the workflow.
                    */
                    _workflowName: {
                        type: String
                    },
                    _workflowsData: {
                        type: Array,
                        value: function() { return []; }
                    },
                    /*
                    * Indicates the request to fetch the workflow definition based on workflowId.
                    */
                    workflowDefinitionRequest: {
                        type: Object,
                        value: function () {
                            return {
                                "params": {
                                    "query": {
                                        "ctx": [
                                            {
                                                "self": "self/newProductSetup_workflowDefinition"
                                            }
                                        ],
                                        "ids": [],
                                        "filters": {
                                            "typesCriterion": [
                                                "workflowDefinition"
                                            ]
                                        }
                                    },
                                    "fields": {
                                        "properties": [
                                            "_ALL"
                                        ],
                                        "attributes": [
                                            "workflows"
                                        ]
                                    }
                                }   
                            };
                        }
                    },
                    /*
                    * Indicates the request object to fetch current running workflow instances information.
                    */
                    runningInstanceRequest: {
                        type: Object,
                        value: function () {
                            return {
                            "params": {
                                "query": {
                                    "ctx": [
                                        {
                                            "list": "",
                                            "workflow": "newProductSetup"
                                        }
                                    ],
                                    "id": "",
                                    "filters": {
                                        "typesCriterion": []
                                        }
                                    },
                                    "fields": {
                                        "ctxTypes": [
                                            "properties"
                                        ],
                                        "attributes": [
                                            "workflowInstanceId",
                                            "status",
                                            "startDateTime",
                                            "endDateTime",
                                            "activities"
                                        ],
                                        "relationships": [ "_ALL" ]
                                        }
                                    }
                            };
                        }
                    },
                     _invokeWorkflowRequest: {
                        type: Object,
                        value: function() { return {}; }
                    },
                    _runningInstances: {
                        type: Array,
                        value: function() { return []; }
                    },
                    _transitionRequest: {
                        type: Object,
                        value: function() { return {}; }
                    },
                },
                 behaviors: [
                    RUFBehaviors.UIBehavior
                ],
                observers: [
                    '_contextChanged(context)'
                ],
                _contextChanged: function(context) {
                    if(!_.isEmpty(context)) {
                        this.entityId = DataHelper.getParamValue('id');
                        this.entityType = DataHelper.getParamValue('type');
                        this.list = "productMaster";
                        this.source = context.source;
                        this.locale = context.locale;
                        this.runningInstanceRequest.params.query.filters.typesCriterion.push(this.entityType);
                        this.runningInstanceRequest.params.query.id = this.entityId;
                        this.runningInstanceRequest.params.query.ctx[0].list = this.list;
                        this.$$('#entityGetRunningInstance').generateRequest();
                    }
                },
                _onDefinitionReceived: function(e) {
                    var workflowDefinitionResponse = e.detail.response;
                    if(workflowDefinitionResponse && workflowDefinitionResponse.content && workflowDefinitionResponse.content.entityModels && workflowDefinitionResponse.content.entityModels.length > 0) {
                        var workflows = [];
                        for(var i=0; i<workflowDefinitionResponse.content.entityModels.length; i++ ) {
                            var entityModel = workflowDefinitionResponse.content.entityModels[i];
                            var workflowId = entityModel.id;
                            if(entityModel.data && entityModel.data && entityModel.data.attributes) {
                                var wfAttributes = entityModel.data.attributes.workflows.group[0];
                                var riAttributes = this._runningInstances[workflowId].attributes;
                                var _stepperData = this._transformEntityResponseToStepperJson(wfAttributes, riAttributes, workflowId);
                                workflows.push(_stepperData);
                            }
                        }
                        this.set("_workflowsData", workflows);
                        this.$$("#workflowsTemplate").render();
                    }
                },
                _onDefinitionGetFailed: function (e) {
                    Polymer.Base._error('workflow definition get failed with error ', e.detail);
                },
                _onRunningInstanceReceived: function(e) {
                    if(e.detail.response) {
                        var runningInstanceResponse = e.detail.response.entityOperationResponse;
                        if(runningInstanceResponse && runningInstanceResponse.entities && runningInstanceResponse.entities.length>0 && runningInstanceResponse.entities[0].data && runningInstanceResponse.entities[0].data.ctxInfo && 
                        runningInstanceResponse.entities[0].data.ctxInfo.length > 0) {
                            this.$$("#invokeButton").setAttribute("hidden", "");
                            var ctxInfo = runningInstanceResponse.entities[0].data.ctxInfo;
                            var workflowIds = [];
                            var runningInstances = [];
                            for(var i=0; i<ctxInfo.length; i++) {
                                var ctxGroup = ctxInfo[i].ctxGroup;
                                var workflowId = ctxGroup.workflow;
                                workflowId = workflowId + "_workflowDefinition";
                                var runtimeInstance = {
                                    "id": workflowId,
                                    "attributes": ctxInfo[i].attributes
                                };
                                runningInstances[workflowId] = {};
                                runningInstances[workflowId] = runtimeInstance;
                                workflowIds.push(workflowId);
                            }
                            this.set("_runningInstances", runningInstances);
                            this.workflowDefinitionRequest.params.query.ids = workflowIds;
                            this.$$("#entityGetWorkflowDefinition").generateRequest();
                        } else {
                            this.$$("#invokeButton").removeAttribute("hidden");
                        }
                    }
                },
                _onRunningInstanceGetFailed: function(e) {
                    Polymer.Base._error('running instance get failed with error ', e.detail);
                },
                _transformEntityResponseToStepperJson: function(wfAttributes, riAttributes, workflowId) {
                    if(wfAttributes && riAttributes) {
                            var riActivities = riAttributes.activities;
                            var wfActivities = wfAttributes.activities;

                            var attributes = wfAttributes;
                            var keys = Object.keys(riAttributes);
                            for(var i=0; i< keys.length; i++) {
                                var key = keys[i];
                                if(key != "activities") {
                                    attributes[key] = riAttributes[key];
                                }
                            }
                            var activitiesJson = wfActivities;
                            var riActivity = riActivities.group[0];
                            var riActivityGuid = DataHelper.getFirstAttributeValue(riActivity.activityGuid);
                            var riActivityStatus = DataHelper.getFirstAttributeValue(riActivity.status);
                            for(var i=0; i<activitiesJson.group.length; i++) {
                                var wfActivity = activitiesJson.group[i];
                                var wfActivityGuid = DataHelper.getFirstAttributeValue(wfActivity.activityGuid);    
                                if(riActivityGuid == wfActivityGuid) {
                                    riActivity["sequence"] = wfActivity["sequence"];
                                    riActivity["activityName"] = wfActivity["activityName"];
                                    riActivity["activityDescription"] = wfActivity["activityDescription"];
                                    riActivity["actions"] = wfActivity["actions"];
                                    activitiesJson.group[i] = riActivity;
                                    break;
                                }
                                else {
                                    activitiesJson.group[i]["status"] = {
                                        "values": [
                                            {
                                                "value": "Closed"
                                            }
                                        ]
                                    };
                                    activitiesJson.group[i].actions = {};
                                }
                            }
                            attributes["activities"] = activitiesJson;
                            if(attributes) {
                                var config = {
                                    "workflowId": workflowId,
                                    "workflowName": DataHelper.getFirstAttributeValue(attributes.workflowName),
                                    "startDateTime": DataHelper.getFirstAttributeValue(attributes.startDateTime),
                                    "endDateTime": DataHelper.getFirstAttributeValue(attributes.endDateTime),
                                    "status": DataHelper.getFirstAttributeValue(attributes.status),
                                    "items": []
                                };
                                var activities = attributes.activities;
                                var items = [];
                                for(var i=0; i<activities.group.length; i++) {
                                    var k = activities.group.length - 1;
                                    var group = activities.group[k-i];
                                    var actions = [];
                                    if(group && group.actions && group.actions.group && group.actions.group.length) {
                                        for(var j=0; j<group.actions.group.length; j++) {
                                            var actionsGroup = group.actions.group[j];
                                            var action = {
                                                "action": DataHelper.getFirstAttributeValue(actionsGroup.actionText),
                                                "event": DataHelper.getFirstAttributeValue(actionsGroup.actionName),
                                                "commentsMode": DataHelper.getFirstAttributeValue(actionsGroup.commentsMode),
                                                "happyPath": DataHelper.getFirstAttributeValue(actionsGroup.happyPath)
                                            };
                                            actions.push(action);
                                        }
                                    }
                                    var item = {
                                        "id": DataHelper.getFirstAttributeValue(group.activityGuid),
                                        "index": DataHelper.getFirstAttributeValue(group.sequence),
                                        "title": DataHelper.getFirstAttributeValue(group.activityName),
                                        "subtitle": this._getItemSubtitle(group.action, group.endDateTime),
                                        "status": this._getItemStatus(group.status),
                                        "selected": this._getSelected(group.status)
                                    };
                                    item["stepDetails"] = this._getItemFullDetails(item, attributes, actions);
                                    items.push(item);
                                }
                                config.items = items;
                                return config;
                            }
                        }
                },
                _getWorkFlowDescription: function(config) {
                    var description = "";
                    if(config) {
                        if(config.status == "Completed") {
                            description = "The workflow completed on " + this._formatDate(config.endDateTime); 
                        }
                        else if(config.status == "Executing") {
                            description = "The workflow started on " + this._formatDate(config.startDateTime) + " and should complete by " + this._getSLADate(config.startDateTime, 21) + " to complete SLA of 21 days."; 
                        }
                    }
                    return description;
                },
                _getItemSubtitle: function(action, endDateTime) {
                    var lastAction = DataHelper.getFirstAttributeValue(action);
                    var endDate = DataHelper.getFirstAttributeValue(endDateTime);
                    if(lastAction && endDate) {
                        return '"' + lastAction + '"' + " on " + this._formatDate(endDate);
                    }
                    return null;
                },
                _onStepActionTap: function(e) {
                        var data = e.target.data;
                        var commentsEl = this.$$("#stepComments-"+data.id);
                        var currentStepItem = this.$$("#workflowStepper").selectedItem;
                        var stepComments = "";
                        var curretStepDetails;
                        if(currentStepItem) {
                            var currentStepData = currentStepItem.data;
                            curretStepDetails = currentStepData.stepDetails;
                        }
                        var isCommentsRequired;
                        if(curretStepDetails && curretStepDetails.actions && curretStepDetails.actions.length && curretStepDetails.actions.length >0 ) {
                            for(var i=0; i<curretStepDetails.actions.length; i++) {
                                var action = curretStepDetails.actions[i];
                                var actionName =action.event;
                                if(actionName == data.event) {
                                    var commentsMode = action.commentsMode;
                                    if(commentsMode == "Mandatory") {
                                        isCommentsRequired = true;
                                    }
                                    break;
                                }
                            }
                        }
                        if(commentsEl) {
                            stepComments = commentsEl.value;
                            if(isCommentsRequired && stepComments == "") {
                                commentsEl.invalid = true;
                                return;
                            }
                            else {
                                commentsEl.invalid = false;
                            }
                        }
                        var workflowTransitionRequestDataJson = {
                            "params": {
                                "workflow": {
                                    "workflowName": "newProductSetup",
                                    "activity": {
                                        "activityName": currentStepData.title,
                                        "action": data.event,
                                        "comment": stepComments
                                    }
                                }
                            },
                            "entity": {
                                "id": this.entityId,
                                "name": this.entityId,
                                "entityInfo": {
                                    "entityType": this.entityType
                                },
                                "data": {
                                    "ctxInfo": [
                                        {
                                            "ctxGroup": {
                                                "list": this.list
                                            }
                                        }
                                    ]
                                }
                            }
                        };
                        this.set("_transitionRequest", workflowTransitionRequestDataJson);
                        this.$$("#entityWfTransition").generateRequest();
                },
                _onTransitionSuccess: function(e) {
                    var response = e.detail.response;
                    if(response) {
                        this.async(function() {
                            this.$$('#entityGetRunningInstance').generateRequest();
                        }, 6000)
                    }
                },
                _onTransitionFailure: function(e) {
                    Polymer.Base._error('workflow transition failed with error ', e.detail);
                },
                _getItemStatus: function(stepStatus) {
                    var status = DataHelper.getFirstAttributeValue(stepStatus);
                    if(status) {
                        if(status == "Closed") {
                            return "completed";
                        }
                        else if(status == "Executing") {
                            return "inprogress";
                        }
                    }
                    else {
                        return "pending";
                    }
                },
                _getSelected: function(stepStatus) {
                    var status = DataHelper.getFirstAttributeValue(stepStatus);
                    if(status && status == "Executing") {
                        return true;
                    }
                    return false;
                },
                _invokeWorkflow: function() {
                    var invokeWorflowRequest = {
                        "params": {
                            "workflow": {
                                "workflowName": "newProductSetup"
                            }
                        },
                        "entity": {
                            "id": this.entityId,
                            "name": this.entityId,
                            "entityInfo": {
                                "entityType": this.entityType
                            },
                            "data": {
                                "ctxInfo": [
                                    {
                                        "ctxGroup": {
                                            "list": this.list
                                        }
                                    }
                                ]
                            }
                        }
                    };
                    this.set("_invokeWorkflowRequest", invokeWorflowRequest);
                    this.$$("#entityStartWorkflow").generateRequest();
                },
                _onWfStartSuccess: function(e) {
                    var response = e.detail.response;
                    if(response) {
                        this.async(function() {
                            this.$$('#entityGetRunningInstance').generateRequest();
                        }, 3000);
                    }
                },
                _onWfStartFailure: function(e) {
                    Polymer.Base._error('starting workflow failed with error ', e.detail);
                },
                _userHasImage: function() {
                    //To DO: functionality to get assigned user of item, get user preferences what to show in
                    // step badge and get details of the content to be shown.
                },
                _getItemFullDetails: function(stepItem, workflowAttributes, actions) {
                    if(stepItem && workflowAttributes && workflowAttributes.activities && workflowAttributes.activities.group
                        && workflowAttributes.activities.group.length) {
                        var currentActivity;
                        for(var i=0; i<workflowAttributes.activities.group.length; i++) {
                            var group = workflowAttributes.activities.group[i];
                            var activityId = DataHelper.getFirstAttributeValue(group.activityGuid);
                            if(activityId && activityId == stepItem.id) {
                                currentActivity = group;
                                break;
                            }
                        }
                        var itemDetailsJson = {};
                        var itemDescription = DataHelper.getFirstAttributeValue(currentActivity.activityDescription);
                        var assignedUser = DataHelper.getFirstAttributeValue(currentActivity.assignedUser);
                        if(!assignedUser) {
                            assignedUser = "cfadmin";
                        }
                        var itemDetail = this._getItemDetail(currentActivity);
                        itemDetailsJson["description"] = itemDescription;
                        itemDetailsJson["assignedUser"] = assignedUser;
                        itemDetailsJson["details"] = itemDetail;
                        itemDetailsJson["actions"] = actions;
                        
                        return itemDetailsJson;
                    }
                },
                _getItemDetail: function(group) {
                    var status = DataHelper.getFirstAttributeValue(group.status);
                    var startDate = DataHelper.getFirstAttributeValue(group.startDateTime);
                    var endDate = DataHelper.getFirstAttributeValue(group.endDateTime);
                    var lastAction = DataHelper.getFirstAttributeValue(group.action);
                    var comments = DataHelper.getFirstAttributeValue(group.comments);
                    var itemDetail = "";
                    if(status == "Executing") {
                        itemDetail = "  was assigned task on " + this._formatDate(startDate) + " and should complete by " + this._getSLADate(startDate,21) + " to follow SLA of 21 Days.";
                    }
                    if(status == "Closed") {
                        itemDetail = " completed step just a while ago."
                    }
                    return itemDetail;
                },
                _getSLADate: function(date, days) {
                    var result = new Date(moment(date).add(days, 'day'));
                    result = moment(result).format('DD/MM/YYYY hh:mm A')
                    return result;
                },
                _formatDate: function(date) {
                    if(date) {
                        var result = new Date(date);
                        result = moment(result).format('DD/MM/YYYY hh:mm A');
                        return result;
                    }
                },
                _isCommentsEnabled: function(item) {
                    if(item && item.stepDetails &&  item.stepDetails.actions && item.stepDetails.actions.length>0 && item.status && item.status == "inprogress") {
                        return true;
                    }
                    return false;
                },
                _stepHasDetails: function(stepDetails) {
                    if(stepDetails && stepDetails.assignedUser && stepDetails.details) {
                        return true;
                    }
                    return false;
                },
                _isRequired: function(stepDetails) {
                    if(stepDetails && stepDetails.actions && stepDetails.actions.group 
                        && stepDetails.actions.group.length && stepDetails.actions.group.length >0 ) {
                        stepDetails.actions.group.forEach(function(action) {
                            var commentsMode = DataHelper.getFirstAttributeValue(action.commentsMode);
                            if(commentsMode != "Mandatory") {
                                return false;
                            }
                        });
                        return true;
                    }
                },
                _getActionButtonClass: function(action) {
                    if(action) {
                        if(action.happyPath) {
                            return "action-button-focus dropdownText btn btn-success m-r-5";
                        }
                        else {
                            return "action-button btn btn-secondary";
                        }
                    }
                },
                _getDataforButton: function(button, id) {
                    var data = {
                        "event": button.event,
                        "id": id
                    };
                    return data;
                }      
            });
        })();
    </script>
</dom-module>