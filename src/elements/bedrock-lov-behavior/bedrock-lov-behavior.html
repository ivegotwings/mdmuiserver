<link rel="import" href="../../../bower_components/polymer/polymer.html">

<script>
    /***
     * `RUFBehaviors.LovBehavior` provides common properties and methods that need to be implemented across all
     *  rock lov components. It is a mandatory behavior for all rock lov components to implement.
     *
     *  ### Example
     *
     *     <dom-module id="x-lov">
     *        <template>
     *        </template>
     *        <script>
     *           Polymer({
     *             is: ""x-lov",
     *
     *             behaviors: [
     *               RUFBehaviors.LovBehavior
     *             ],
     *
     *             properties: {
     *              
     *             }
     *           });
     *        <&lt;>/script>
     *     </dom-module>
     *
     * @polymerBehavior RUFBehaviors.LovBehavior
     */

    window.RUFBehaviors = window.RUFBehaviors || {};
    RUFBehaviors.LovBehavior = {

        properties: {
            _attributes: {
                type: Array,
                value: function () {
                    return ['_ALL'];
                }
            },
            _relationships: {
                type: Array,
                value: function () {
                    return ['_ALL'];
                }
            },
            _lovAttributeMap: {
                type: Object,
                value: function () {
                    return {};
                }
            },
            /**
             * Indicates the page size
             */
            pageSize: {
                type: Number,
                value: 10
            },
            /*
             * Specifies whether or not multiple items is selected at once. When it is set to <b>true</b>, 
             * multiple items are selected at a time. In this case, selected is an array of currently selected items.
             * When it is set to <b>false</b>, only one item is selected at a time.
             */
            multiSelect: {
                type: Boolean,
                value: false
            },
            /*
             * Indicates the attribute of an entity which will be used as id for the item
             */
            itemId: {
                type: String,
                value: ""
            },
            /*
             * Indicates the attribute of an entity which will be used as title for the item
             */
            itemTitle: {
                type: String,
                value: ""
            },
            /*
             * Indicates the attribute of an entity which will be used as subtitle for the item
             */
            itemSubTitle: {
                type: String,
                value: ""
            },
            /*
             * Indicates the attribute of an entity which will be used as image for the item
             */
            itemImage: {
                type: String,
                value: ""
            },
            /*
             * Indicates the attribute of an entity which will be used as color for the item
             */
            itemColor: {
                type: String,
                value: ""
            },
            /*
             * Indicates the attribute of an entity which will be used as value for the item
             */
            itemValue: {
                type: String,
                value: ""
            },
            /* 
             * Specifies whether to hide sub title or not.
             */
            noSubTitle: {
                type: Boolean,
                value: false
            },
            /* 
             * Specifies whether or not to show image with item text.
             */
            showImage: {
                type: Boolean,
                value: false
            },
            /* 
             * Specifies whether to show color with item text or not
             */
            showColor: {
                type: Boolean,
                value: false
            },
            /* 
             * Specifies whether or not to show action buttons
             */
            showActionButtons: {
                type: Boolean,
                value: false,
            },
            /*
             * Indicates the currently selected item when multiSelection is false. 
             * It indicates null if no item is selected.
             */
            selectedItem: {
                type: Object,
                value: function () {
                    return {};
                },
                notify: true
            },
            /*
             * Indicates an array that contains the selected items when the  multiselection is true.
             */
            selectedItems: {
                type: Array,
                value: function () {
                    return [];
                },
                notify: true
            },
            /*
             * Indicates the context for which the entities are requested
             */
            context: {
                type: Array,
                value: function () {
                    return [];
                }
            },
            /*
             * Indicates the valueContext for which the attributes are requested
             */
            valueContext: {
                type: Array,
                value: function () {
                    return [];
                }
            },
            /*
             * Indicates the type of an entity request
             */
            entityTypes: {
                type: Array,
                value: function () {
                    return [];
                }
            },
            _request: {
                type: Object,
                value: function () {
                    return {
                        "params": {
                            "query": {
                                "ctx": [],
                                "valCtx": [],
                                "filters": {
                                    "attributesCriterion": [],
                                    "typesCriterion": []
                                }
                            },
                            "fields": {
                                "ctxTypes": [],
                                "attributes": [],
                                "relationships": []
                            },
                            "options": {
                                "from": 0,
                                "to": 0
                            }
                        }
                    }
                }
            },
            _attributesCriterionBuilder: {
                type: Object,
                value: function () {
                    return {};
                }
            },
            _dataFormatter: {
                type: Object,
                value: function () {
                    return {};
                }
            },
            _currentLovElement: {
                type: Object,
                value: function () {
                    return {};
                }
            }
        },

        observers: [
            '_prepareAttributeModels(itemId, itemTitle, itemSubTitle, itemImage, itemColor, itemValue)'
        ],

        ready: function () {
            this.set("_request.params.query.ctx", this.context);
            this.set("_request.params.query.valCtx", this.valueContext);

            this.set("_request.params.query.filters.typesCriterion", this.entityTypes);

            if (typeof(this._attributes) !== 'undefined' && this._attributes.length > 0) {
                this.set("_request.params.fields.attributes", this._attributes);
            }

            if (typeof(this._relationships) !== 'undefined' && this._relationships.length > 0) {
                this.set("_request.params.fields.relationships", this._relationships);
            }
        },

        activate: function () {
            if (typeof (this._currentLovElement) !== 'undefined') {
                this._currentLovElement.activate();
            }
        },

        _prepareAttributeModels: function (itemId, itemTitle, itemSubTitle, itemImage, itemColor) {
            var defaultValue = this._attributes;
            this._attributes = [];

            if (typeof (this.itemId) !== 'undefined' && this.itemId !== "") {
                this.push('_attributes', this.itemId);
                this._lovAttributeMap.id = this.itemId;
            }

            if (typeof (this.itemTitle) !== 'undefined' && this.itemTitle !== "") {
                this.push('_attributes', this.itemTitle);
                this._lovAttributeMap.title = this.itemTitle;
            }

            if (typeof (this.itemSubTitle) !== 'undefined' && this.itemSubTitle !== "") {
                this.push('_attributes', this.itemSubTitle);
                this._lovAttributeMap.subtitle = this.itemSubTitle;
            }

            if (typeof (this.itemImage) !== 'undefined' && this.itemImage !== "") {
                this.push('_attributes', this.itemImage);
                this._lovAttributeMap.image = this.itemImage;
            }

            if (typeof (this.itemColor) !== 'undefined' && this.itemColor !== "") {
                this.push('_attributes', this.itemColor);
                this._lovAttributeMap.color = this.itemColor;
            }

            if (typeof (this.itemValue) == 'undefined' && this.itemValue !== "") {
                this.push('_attributes', this.itemValue);
                this._lovAttributeMap.value = this.itemValue;
            }

            if (this._attributes.length == 0) {
                this._attributes = defaultValue;
            }
        }
    };
</script>