<link rel="import" href="../app-localize-behavior/app-localize-behavior.html">

<script>

   var RUFBehaviors = RUFBehaviors || {};
   RUFBehaviors.Internationalization = {
      
      properties: {
         useKeyIfMissing: {
            type: Boolean,
            value: true
         },
         language: {
            value: 'en'
         },
         overridenResources: {
            type: Object
         }
      },
      init: function(path, defaultLanguage) {
        Polymer.AppLocalizeBehavior.loadResources.call(this, path);
        if(defaultLanguage != undefined){
          this.language = defaultLanguage;
        }
      },

      appendResource: function(path, elementId){
         var proto = this.constructor.prototype;

         // If the global ajax object has not been initialized, initialize and cache it.
         var ajax = proto.__localizationCache.ajax;
         if (!ajax) {
            ajax = proto.__localizationCache.ajax = document.createElement('iron-ajax');
         }

         var request = proto.__localizationCache.requests[path];
         if (!request) {
            ajax.url = path;
            var request = ajax.generateRequest();

            request.completes.then(
               this.__onAppendRequestResponse.bind(this),
               this.__onAppendRequestError.bind(this));

               // Cache the instance so that it can be reused if the same path is loaded.
               proto.__localizationCache.requests[path] = request;
        } else {
          request.completes.then(
          this.__onAppendRequestResponse.bind(this),
          this.__onAppendRequestError.bind(this));
        }
      },
      switchLangauge: function(newDefaultLangauge){
         if(newDefaultLangauge != undefined){
            this.language = newDefaultLangauge;
        }
      },
      __onAppendRequestResponse: function(event){
         if(event.response){
            //ToDo: prepare context specific key and append resources
            this.overridenResources = event.response;
         }
      },
      __onAppendRequestError: function(event){

      }

   };
   RUFBehaviors.Internationalization = [Polymer.AppLocalizeBehavior, RUFBehaviors.Internationalization];
</script>